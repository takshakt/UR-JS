prompt --application/deployment/install/install_installation_script_251223
begin
--   Manifest
--     INSTALL: INSTALL-Installation Script 251223
--   Manifest End
wwv_flow_imp.component_begin (
 p_version_yyyy_mm_dd=>'2024.11.30'
,p_release=>'24.2.11'
,p_default_workspace_id=>7945143549875994
,p_default_application_id=>103
,p_default_id_offset=>25186177142438240
,p_default_owner=>'WKSP_DEV'
);
wwv_flow_imp_shared.create_install_script(
 p_id=>wwv_flow_imp.id(13018871232711763)
,p_install_id=>wwv_flow_imp.id(9665506831982728)
,p_name=>'Installation Script 251223'
,p_sequence=>70
,p_script_type=>'INSTALL'
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'  CREATE TABLE "DEBUG_LOG" ',
'   (	"ID" RAW(16) DEFAULT sys_guid(), ',
'	"LOG_TIME" TIMESTAMP (6) DEFAULT systimestamp, ',
'	"MESSAGE" CLOB, ',
'	"FULL_SQL" CLOB',
'   ) ;',
'',
'  CREATE TABLE "TEMP_BLOB" ',
'   (	"ID" NUMBER(22,0) NOT NULL ENABLE, ',
'	"APPLICATION_ID" NUMBER(22,0), ',
'	"NAME" VARCHAR2(400), ',
'	"FILENAME" VARCHAR2(400), ',
'	"MIME_TYPE" VARCHAR2(255), ',
'	"CREATED_ON" DATE, ',
'	"BLOB_CONTENT" BLOB, ',
'	"PROFILE" CLOB, ',
'	"RECORDS" NUMBER, ',
'	"COLUMNS" CLOB, ',
'	 CONSTRAINT "PK_TEMP_BLOB" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "TEMP_UR_REPORTS" ',
'   (	"ID" VARCHAR2(22210) DEFAULT sys_guid() NOT NULL ENABLE, ',
'	"HOTEL_ID" VARCHAR2(106), ',
'	"KEY" VARCHAR2(110) DEFAULT sys_guid(), ',
'	"NAME" VARCHAR2(100), ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB, ',
'	"DB_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_OBJECT_CREATED_ON" DATE, ',
'	"ROWS_COUNT" NUMBER, ',
'	"TABLE_SPACE_SIZE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"DEFINITION_JSON" CLOB, ',
'	"COLUMN_ALIAS" CLOB, ',
'	"EXPRESSIONS_CLOB" CLOB',
'   ) ;',
'',
'  CREATE TABLE "TEMP_UR_REPORT_DASHBOARDS" ',
'   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110), ',
'	"NAME" VARCHAR2(100), ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB, ',
'	"SUMMARY" CLOB, ',
'	 PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGO_VERSIONS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"ALGO_ID" RAW(16) NOT NULL ENABLE, ',
'	"VERSION" VARCHAR2(10) NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"EXPRESSION" CLOB, ',
'	 CONSTRAINT "PK_UR_ALGO_VERSIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UK_UR_ALGO_VERSIONS_ALGO_VERSION" UNIQUE ("ALGO_ID", "VERSION")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTELS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"GROUP_ID" RAW(16), ',
'	"HOTEL_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"STAR_RATING" NUMBER(1,0), ',
'	"ADDRESS_ID" RAW(16), ',
'	"CONTACT_ID" RAW(16), ',
'	"OPENING_DATE" DATE, ',
'	"CURRENCY_CODE" VARCHAR2(3) DEFAULT ''GBP'', ',
'	"ASSOCIATION_START_DATE" DATE, ',
'	"ASSOCIATION_END_DATE" DATE, ',
'	"ASSOCIATED_USER_ID" RAW(16), ',
'	"ALGORITHM_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"IMAGE" BLOB, ',
'	"IMAGE_NAME" VARCHAR2(40 CHAR), ',
'	"IMG_TYPE" VARCHAR2(100 CHAR), ',
'	"CAPACITY" NUMBER, ',
'	 CONSTRAINT "PK_UR_HOTELS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_INTERFACE_LOGS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"TEMPLATE_ID" RAW(16) NOT NULL ENABLE, ',
'	"INTERFACE_TYPE" VARCHAR2(20) NOT NULL ENABLE, ',
'	"LOAD_START_TIME" TIMESTAMP (6) NOT NULL ENABLE, ',
'	"LOAD_END_TIME" TIMESTAMP (6), ',
'	"LOAD_MAPPING" CLOB, ',
'	"LOAD_STATUS" VARCHAR2(20) NOT NULL ENABLE, ',
'	"RECORDS_PROCESSED" NUMBER, ',
'	"RECORDS_SUCCESSFUL" NUMBER, ',
'	"RECORDS_FAILED" NUMBER, ',
'	"ERROR_DETAILS" VARCHAR2(1000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"FILE_ID" NUMBER, ',
'	"ERROR_JSON" CLOB, ',
'	 CHECK (Records_Processed >= 0) ENABLE, ',
'	 CHECK (Records_Successful >= 0) ENABLE, ',
'	 CHECK (Records_Failed >= 0) ENABLE, ',
'	 CONSTRAINT "PK_UR_INTERFACE_LOGS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_INTERFACE_LOGS_CON" UNIQUE ("FILE_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_REPORTS" ',
'   (	"ID" RAW(16) DEFAULT sys_guid() NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110) DEFAULT sys_guid(), ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'' NOT NULL ENABLE, ',
'	"DEFINITION" CLOB NOT NULL ENABLE, ',
'	"DB_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_OBJECT_CREATED_ON" DATE NOT NULL ENABLE, ',
'	"ROWS_COUNT" NUMBER, ',
'	"TABLE_SPACE_SIZE" NUMBER, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (Active IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "PK_UR_REPORTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORTS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_REPORT_DASHBOARDS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (ACTIVE IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "CK_KEY_FORMAT" CHECK (',
'    REGEXP_LIKE("KEY", ''^[A-Z0-9_]+$'')',
'  ) ENABLE, ',
'	 CONSTRAINT "PK_UR_REPORT_DASHBOARDS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_HOTEL_ID" UNIQUE ("HOTEL_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_NAME" UNIQUE ("NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "XXPEL_WF_GLOBAL_PROFILES_TBL" ',
'   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, ',
'	"KEY" VARCHAR2(2000 CHAR), ',
'	"NAME" VARCHAR2(2000 CHAR), ',
'	"DESCRIPTION" VARCHAR2(2000 CHAR), ',
'	"VALUE" VARCHAR2(2000 CHAR), ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"CREATED_BY" VARCHAR2(2000 CHAR), ',
'	"UPDATED_BY" VARCHAR2(2000 CHAR), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"ATTRIBUTE1" VARCHAR2(2000 CHAR), ',
'	"ATTRIBUTE2" VARCHAR2(2000 CHAR), ',
'	"ATTRIBUTE3" VARCHAR2(2000 CHAR), ',
'	"ATTRIBUTE4" VARCHAR2(2000 CHAR), ',
'	"ATTRIBUTE5" VARCHAR2(2000 CHAR), ',
'	 CONSTRAINT "XXPEL_WF_GLOBAL_PROFILES_TBL_PK" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "KEY_UNIQUE" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ADDRESSES" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"STREET_ADDRESS" VARCHAR2(200) NOT NULL ENABLE, ',
'	"CITY" VARCHAR2(100) NOT NULL ENABLE, ',
'	"COUNTY" VARCHAR2(100), ',
'	"POST_CODE" VARCHAR2(20) NOT NULL ENABLE, ',
'	"COUNTRY" VARCHAR2(100) NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"PRIMARY_ADDRESS" VARCHAR2(200) NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_ADDRESSES" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGOS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(1000), ',
'	"HOTEL_ID" RAW(16), ',
'	"CURRENT_VERSION_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_ALGOS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_ALGOS_CON" UNIQUE ("NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGO_ATTRIBUTES" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"ALGO_ID" RAW(16), ',
'	"HOTEL_ID" RAW(16), ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"KEY" VARCHAR2(120) NOT NULL ENABLE, ',
'	"DATA_TYPE" VARCHAR2(50) DEFAULT ''NUMBER'' NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(1000), ',
'	"TYPE" VARCHAR2(1) DEFAULT ''M'' NOT NULL ENABLE, ',
'	"VALUE" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"TEMPLATE_ID" RAW(16), ',
'	"ATTRIBUTE_QUALIFIER" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_ALGO_ATTRIBUTES" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UK_UR_ALGO_ATTRIBUTES_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CONTACTS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"CONTACT_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"POSITION_TITLE" VARCHAR2(100), ',
'	"EMAIL" VARCHAR2(150), ',
'	"PHONE_NUMBER" VARCHAR2(30), ',
'	"CONTACT_TYPE" VARCHAR2(50), ',
'	"PRIMARY" VARCHAR2(1) DEFAULT ''N'', ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (Primary IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "CHK_EMAIL_FORMAT" CHECK (',
'        Email IS NULL OR REGEXP_LIKE(Email, ''^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'')',
'    ) ENABLE, ',
'	 CONSTRAINT "CHK_PHONE_FORMAT" CHECK (',
'        Phone_Number IS NULL OR REGEXP_LIKE(Phone_Number, ''^\+?[0-9\-\(\) ]{7,30}$'')',
'    ) ENABLE, ',
'	 CONSTRAINT "PK_UR_CONTACTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EVENTS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"EVENT_NAME" VARCHAR2(200) NOT NULL ENABLE, ',
'	"EVENT_TYPE" VARCHAR2(100) NOT NULL ENABLE, ',
'	"EVENT_START_DATE" DATE NOT NULL ENABLE, ',
'	"EVENT_END_DATE" DATE NOT NULL ENABLE, ',
'	"ESTIMATED_ATTENDANCE" NUMBER, ',
'	"IMPACT_LEVEL" VARCHAR2(50), ',
'	"DESCRIPTION" VARCHAR2(500), ',
'	"CITY" VARCHAR2(100), ',
'	"POSTCODE" VARCHAR2(10), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"COUNTRY" VARCHAR2(100), ',
'	"EVENT_FREQUENCY" VARCHAR2(50), ',
'	"IMPACT_TYPE" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_EVENTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_ACCESSES" ',
'   (	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"USER_ID" RAW(16) NOT NULL ENABLE, ',
'	"ACCESS_TYPE" VARCHAR2(100) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_ACCESSES" PRIMARY KEY ("HOTEL_ID", "USER_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_GROUPS" ',
'   (	"ID" RAW(16), ',
'	"GROUP_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(250), ',
'	"ADDRESS_ID" RAW(16), ',
'	"CONTACT_ID" RAW(16), ',
'	"ASSOCIATION_START_DATE" DATE, ',
'	"ASSOCIATION_END_DATE" DATE, ',
'	"ASSOCIATED_EMP_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_GROUPS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_HOTEL_GROUPS_NAME" UNIQUE ("GROUP_NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_PRICE_OVERRIDE" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"STAY_DATE" DATE NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(10) DEFAULT ''Public'' NOT NULL ENABLE, ',
'	"PRICE" NUMBER(10,2) NOT NULL ENABLE, ',
'	"REASON" VARCHAR2(120), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"STATUS" VARCHAR2(10) DEFAULT ''A'' NOT NULL ENABLE, ',
'	"COMMENTS" VARCHAR2(2000), ',
'	 CONSTRAINT "UR_HPRICOVR_PRICE_CHK" CHECK (Price > 0) ENABLE, ',
'	 CONSTRAINT "UR_HPRICOVR_ID_PK" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_RESERVATIONS" ',
'   (	"ID" RAW(16), ',
'	"RES_NUMBER" VARCHAR2(20) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"ARRIVAL_DATE" DATE NOT NULL ENABLE, ',
'	"NUMBER_OF_NIGHTS" NUMBER(3,0) NOT NULL ENABLE, ',
'	"ROOMS_BOOKED" NUMBER(5,0) NOT NULL ENABLE, ',
'	"TOTAL_BOOKING_VALUE" NUMBER(12,2) NOT NULL ENABLE, ',
'	"CHARGED_FLAG" CHAR(1), ',
'	"EXCEPTION_AMOUNT" NUMBER(12,2) NOT NULL ENABLE, ',
'	"APPROVED_BY" VARCHAR2(100), ',
'	"NOTES" VARCHAR2(1000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"ATTRIBUTE1" VARCHAR2(100), ',
'	"ATTRIBUTE2" VARCHAR2(100), ',
'	"ATTRIBUTE3" VARCHAR2(100), ',
'	"ATTRIBUTE4" VARCHAR2(100), ',
'	"ATTRIBUTE5" VARCHAR2(100), ',
'	"ATTRIBUTE6" NUMBER, ',
'	"ATTRIBUTE7" NUMBER, ',
'	"ATTRIBUTE8" NUMBER, ',
'	"ATTRIBUTE9" DATE, ',
'	"ATTRIBUTE10" DATE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"RESERVATION_TYPE" VARCHAR2(2), ',
'	"EXCEPTION_DATE" DATE, ',
'	"EXCEPTION_REASON" VARCHAR2(250), ',
'	"RESERVATION_EXCEPTION_TYPE" VARCHAR2(50), ',
'	"APPROVED_BY_MANUAL" VARCHAR2(100), ',
'	"ROOM_TYPE_ID" RAW(16), ',
'	 CHECK (Number_of_Nights > 0) ENABLE, ',
'	 CHECK (Rooms_Booked >= 0) ENABLE, ',
'	 CHECK (Total_Booking_Value >= 0) ENABLE, ',
'	 CHECK (Charged_Flag IN (''Y'', ''N'')) ENABLE, ',
'	 CHECK ("EXCEPTION_AMOUNT">=0) ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_RESERVATIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_HOTEL_RES_UNIQUE_NUMBER" UNIQUE ("HOTEL_ID", "RES_NUMBER")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_ROOM_TYPES" ',
'   (	"ROOM_TYPE_ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"ROOM_TYPE_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"MAX_OCCUPANCY" NUMBER(2,0) NOT NULL ENABLE, ',
'	"BED_TYPE" VARCHAR2(50), ',
'	"DESCRIPTION" VARCHAR2(250), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"PRICE" NUMBER, ',
'	"SUPPLIMENT_TYPE" VARCHAR2(3), ',
'	"SUPPLIEMENT_PRICE_MIN" NUMBER, ',
'	"SUPPLIMENT_PRICE_MAX" NUMBER, ',
'	 CONSTRAINT "PK_UR_HOTEL_ROOM_TYPES" PRIMARY KEY ("ROOM_TYPE_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_PROFILE_OPTIONS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"KEY" VARCHAR2(50) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100), ',
'	"DESCRIPTION" VARCHAR2(200), ',
'	"VALUE" VARCHAR2(500) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	 CONSTRAINT "PK_UR_PROFILE_OPTIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_PROFILE_OPTIONS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_USERS" ',
'   (	"USER_ID" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"FIRST_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"LAST_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"EMAIL" VARCHAR2(150) NOT NULL ENABLE, ',
'	"CONTACT_NUMBER" NUMBER, ',
'	"USER_TYPE" VARCHAR2(50) NOT NULL ENABLE, ',
'	"STATUS" VARCHAR2(20) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"LOGIN_METHOD" VARCHAR2(50) NOT NULL ENABLE, ',
'	"PASSWORD_HASH" VARCHAR2(256), ',
'	"CREATED_BY" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"CREATED_ON" DATE DEFAULT SYSDATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE DEFAULT SYSDATE NOT NULL ENABLE, ',
'	"USER_NAME" VARCHAR2(255), ',
'	"NOTES" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_USERS" PRIMARY KEY ("USER_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_USERS_EMAIL" UNIQUE ("EMAIL")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "XX_FEEDBACK_EMAIL_DETAILS" ',
'   (	"EMAIL_DETAILS" VARCHAR2(2000)',
'   ) ;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_USERS_BI_TRG" ',
'FOR INSERT OR UPDATE ON ur_users',
'COMPOUND TRIGGER',
'',
'  BEFORE EACH ROW IS',
'    l_current_user_id UR_USERS.USER_ID%TYPE;',
'  BEGIN',
'    IF INSERTING THEN',
'      -- generate PK if not provided',
'      IF :NEW.user_id IS NULL THEN',
'        :NEW.user_id := SYS_GUID();',
'      END IF;',
'',
'      -- set created_by / updated_by from session package (if available)',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.created_by := l_current_user_id;',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'',
'      -- timestamps (respect any pre-filled created_on)',
'      IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'    END IF;',
'  END BEFORE EACH ROW;',
'',
'END trg_ur_users_bi_trg;',
'/',
'ALTER TRIGGER "TRG_UR_USERS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_REPORT_DASHBOARDS" ADD CONSTRAINT "FK_UR_REPORTS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := REGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORTS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_INTERFACE_LOGS" ADD CONSTRAINT "FK_UR_INTERFACE_LOGS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ENABLE;',
'',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."ID" IS ''UUID - Unique attribute identifier (Primary Key).'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."STAY_DATE" IS ''The specific date for which the price is overridden.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."HOTEL_ID" IS ''Optional Foreign Key to a Hotel table to limit the override to a specific hotel.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."TYPE" IS ''Pricing Type (e.g., Retail, Group).'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."PRICE" IS ''The overridden price for the stay date.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."REASON" IS ''Justification for the price override.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."CREATED_BY" IS ''UUID of the user who created the record.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."UPDATED_BY" IS ''UUID of the user who last updated the record.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."CREATED_ON" IS ''Timestamp of when the record was created.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."UPDATED_ON" IS ''Timestamp of when the record was last updated.'';',
'   COMMENT ON TABLE "UR_HOTEL_PRICE_OVERRIDE"  IS ''Stores daily price overrides for hotels.'';',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_HOTEL_PRICE_OVERRIDE"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_HOTEL_RESERVATIONS" ADD CONSTRAINT "FK_UR_HOTEL_RESERVATIONS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_ALL" ',
'FOR INSERT OR UPDATE OR DELETE ON ur_hotels',
'COMPOUND TRIGGER',
'',
'    v_user_id  RAW(16);',
'    v_status   BOOLEAN;',
'    v_message  VARCHAR2(4000);',
'',
'BEFORE STATEMENT IS',
'BEGIN',
'    NULL;',
'END BEFORE STATEMENT;',
'',
'BEFORE EACH ROW IS',
'BEGIN',
'    ------------------------------------------------------------------',
'    -- DELETE MODE (must delete children BEFORE deleting the hotel)',
'    ------------------------------------------------------------------',
'    IF DELETING THEN',
'        ',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :OLD.ID,',
'            p_mode     => ''DELETE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'            RAISE_APPLICATION_ERROR(',
'                -20003,',
'                ''Failed to delete attributes: '' || v_message',
'            );',
'        END IF;',
'',
unistr('        -- \274C Do NOT RETURN (not allowed)'),
unistr('        -- \2714\FE0F Just EXIT this block naturally'),
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- Resolve user ID',
'    ------------------------------------------------------------------',
'    IF NOT DELETING THEN',
'        BEGIN',
'            SELECT user_id INTO v_user_id',
'            FROM ur_users',
'            WHERE user_name = SYS_CONTEXT(''APEX$SESSION'',''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := NULL;',
'        END;',
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- BEFORE INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'',
'        IF :NEW.ID IS NULL THEN',
'            :NEW.ID := SYS_GUID();',
'        END IF;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'    ------------------------------------------------------------------',
'    -- BEFORE UPDATE',
'    ------------------------------------------------------------------',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'END BEFORE EACH ROW;',
'',
'AFTER EACH ROW IS',
'BEGIN',
'',
'    ------------------------------------------------------------------',
'    -- INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :NEW.ID,',
'            p_mode     => ''CREATE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'          '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(13018871232711763)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'  RAISE_APPLICATION_ERROR(',
'                -20001,',
'                ''Failed to create attributes: '' || v_message',
'            );',
'        END IF;',
'    END IF;',
'',
'END AFTER EACH ROW;',
'',
'AFTER STATEMENT IS',
'BEGIN',
'    NULL;',
'END AFTER STATEMENT;',
'',
'END trg_ur_hotels_all;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_ALL" ENABLE;',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BI_TRG" ENABLE;',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BIU" ',
'BEFORE INSERT ON ur_events',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.id IS NULL THEN',
'        :NEW.id := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'    END IF;',
'',
'    IF :NEW.updated_on IS NULL THEN',
'        :NEW.updated_on := SYSDATE;',
'    END IF;',
'',
'    -- Replace with actual login user RAW if needed',
'    IF :NEW.created_by IS NULL THEN',
'        :NEW.created_by := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.updated_by IS NULL THEN',
'        :NEW.updated_by := SYS_GUID();',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BIU" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_CONTACTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_CONTACTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGOS" ADD CONSTRAINT "FK_UR_ALGOS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGOS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGOS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGO_ATTRIBUTES" ADD CONSTRAINT "FK_UR_ALGO_ATTRIBUTES_ALGO" FOREIGN KEY ("ALGO_ID")',
'	  REFERENCES "UR_ALGOS" ("ID") ENABLE;',
'  ALTER TABLE "UR_ALGO_ATTRIBUTES" ADD CONSTRAINT "FK_UR_ALGO_ATTRIBUTES_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGO_VERSIONS" ADD CONSTRAINT "FK_UR_ALGO_VERSIONS_ALGO" FOREIGN KEY ("ALGO_ID")',
'	  REFERENCES "UR_ALGOS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ENABLE;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace FUNCTION FN_CLEAN_NUMBER (p_string IN VARCHAR2)',
'RETURN NUMBER',
'IS',
'    l_cleaned_string VARCHAR2(4000);',
'BEGIN',
'    IF p_string IS NULL THEN',
'        RETURN NULL;',
'    END IF;',
'',
'    -- Remove all characters that are not digits, a decimal point, or a leading minus sign',
'    l_cleaned_string := REGEXP_REPLACE(p_string, ''[^0-9.-]'', '''');',
'',
'    -- Handle invalid cases or non-numeric results',
'    IF l_cleaned_string IS NULL ',
'       OR l_cleaned_string IN (''-'', ''.'', '''', ''--'', ''..'')',
'       OR REGEXP_LIKE(l_cleaned_string, ''^-?[0-9]*\.?[0-9]*$'') = FALSE THEN',
'        RETURN NULL;',
'    END IF;',
'',
'    BEGIN',
'        RETURN TO_NUMBER(l_cleaned_string);',
'    EXCEPTION',
'        WHEN VALUE_ERROR THEN',
'            RETURN NULL;',
'        WHEN OTHERS THEN',
'            RETURN NULL;',
'    END;',
'END FN_CLEAN_NUMBER;',
'/',
'create or replace FUNCTION fn_safe_to_date(p_string IN VARCHAR2)',
'RETURN DATE',
'IS',
'BEGIN',
'    IF p_string IS NULL THEN',
'        RETURN NULL;',
'    END IF;',
'',
'    -- Attempt 1: YYYY-MM-DD (most common standard)',
'    BEGIN RETURN TO_DATE(p_string, ''YYYY-MM-DD''); EXCEPTION WHEN OTHERS THEN NULL; END;',
'    ',
'    -- Attempt 2: DD-MON-YYYY (e.g., 20-OCT-2025)',
'    BEGIN RETURN TO_DATE(p_string, ''DD-MON-YYYY''); EXCEPTION WHEN OTHERS THEN NULL; END;',
'',
'    -- Attempt 3: DD/MM/YYYY',
'    BEGIN RETURN TO_DATE(p_string, ''DD/MM/YYYY''); EXCEPTION WHEN OTHERS THEN NULL; END;',
'',
'    -- Attempt 4: MM/DD/YYYY',
'    BEGIN RETURN TO_DATE(p_string, ''MM/DD/YYYY''); EXCEPTION WHEN OTHERS THEN NULL; END;',
'',
'    -- Attempt 5: DD-MON-RR (handles 2-digit years)',
'    BEGIN RETURN TO_DATE(p_string, ''DD-MON-RR''); EXCEPTION WHEN OTHERS THEN NULL; END;',
'    ',
'    -- If all attempts fail, return NULL',
'    RETURN NULL;',
'    ',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        RETURN NULL;',
'END fn_safe_to_date;',
'/',
'create or replace FUNCTION GET_MAP_CALCULATION_FUN(p_formula IN VARCHAR2, p_collection_name IN VARCHAR2)',
'RETURN VARCHAR2 IS',
'    l_formula VARCHAR2(4000) := p_formula;',
'BEGIN',
'    FOR rec IN (',
'        SELECT regexp_substr(c001, ''^[^(]+'') src_col, ',
'               regexp_substr(c002, ''^[^(]+'') tgt_col',
'        FROM apex_collections',
'        WHERE collection_name = p_collection_name',
'    ) LOOP',
'        l_formula := REGEXP_REPLACE(',
'                        l_formula, ',
'                        ''p\.'' || rec.src_col || ''(\b|[^a-zA-Z0-9_])'', ',
'                        ''p.'' || rec.tgt_col || ''\1''',
'                     );',
'    END LOOP;',
'',
'    RETURN l_formula;',
'END;',
'/',
'create or replace FUNCTION get_profile_json (',
'  p_blob     BLOB,',
'  p_filename VARCHAR2',
') RETURN CLOB IS',
'  l_result  apex_data_parser.t_parser_profile;',
'BEGIN',
'  l_result := apex_data_parser.discover(',
'    p_content   => p_blob,',
'    p_file_name => p_filename',
'  );',
'  RETURN l_result.profile;',
'END;',
'/',
'create or replace FUNCTION guess_delimiter (',
'    p_blob IN BLOB',
') RETURN VARCHAR2 IS',
'    l_raw        RAW(32767);',
'    l_varchar2   VARCHAR2(32767);',
'    l_first_line VARCHAR2(4000);',
'    l_comma_count NUMBER := 0;',
'    l_semicolon_count NUMBER := 0;',
'    l_pipe_count NUMBER := 0;',
'    l_tab_count NUMBER := 0;',
'    l_crlf_pos NUMBER;',
'    l_lf_pos NUMBER;',
'BEGIN',
'    -- Read the first part of the BLOB',
'    l_raw := DBMS_LOB.SUBSTR(p_blob, 32767, 1);',
'    ',
'    -- Convert RAW to VARCHAR2',
'    l_varchar2 := UTL_RAW.CAST_TO_VARCHAR2(l_raw);',
'    ',
'    -- Find the end of the first line (CRLF or LF)',
'    l_crlf_pos := INSTR(l_varchar2, CHR(13) || CHR(10));',
'    l_lf_pos := INSTR(l_varchar2, CHR(10));',
'',
'    IF l_crlf_pos > 0 THEN',
'        l_first_line := SUBSTR(l_varchar2, 1, l_crlf_pos - 1);',
'    ELSIF l_lf_pos > 0 THEN',
'        l_first_line := SUBSTR(l_varchar2, 1, l_lf_pos - 1);',
'    ELSE',
'        l_first_line := l_varchar2;',
'    END IF;',
'',
'    -- Count occurrences of common delimiters',
'    l_comma_count := REGEXP_COUNT(l_first_line, '','');',
'    l_semicolon_count := REGEXP_COUNT(l_first_line, '';'');',
'    l_pipe_count := REGEXP_COUNT(l_first_line, ''\|'');',
'    l_tab_count := REGEXP_COUNT(l_first_line, CHR(9));',
'    ',
'    -- Determine the most likely delimiter',
'    IF l_comma_count > l_semicolon_count AND l_comma_count > l_pipe_count AND l_comma_count > l_tab_count THEN',
'        RETURN '','';',
'    ELSIF l_semicolon_count > l_comma_count AND l_semicolon_count > l_pipe_count AND l_semicolon_count > l_tab_count THEN',
'        RETURN '';'';',
'    ELSIF l_pipe_count > l_comma_count AND l_pipe_count > l_semicolon_count AND l_pipe_count > l_tab_count THEN',
'        RETURN ''|'';',
'    ELSIF l_tab_count > 0 THEN -- Tabs are a common delimiter but are hard to distinguish with text',
'        RETURN CHR(9);',
'    ELSE',
'        -- Default to comma or return null if none are found',
'        RETURN '','';',
'    END IF;',
'END;',
'/',
'create or replace FUNCTION sanitize_column_name(p_name IN VARCHAR2) ',
'   RETURN VARCHAR2',
'IS',
'    v_name VARCHAR2(4000);',
'BEGIN',
'    -- Replace non-alphanumeric characters with underscore',
'    v_name := REGEXP_REPLACE(p_name, ''[^A-Za-z0-9]'', ''_'');',
'',
'    -- Replace multiple consecutive underscores with a single underscore',
'    v_name := REGEXP_REPLACE(v_name, ''_+'', ''_'');',
'',
'    -- Trim leading and trailing underscores',
'    v_name := REGEXP_REPLACE(v_name, ''^_+|_+$'', '''');',
'',
'    -- Convert to uppercase',
'    RETURN UPPER(v_name);',
'END sanitize_column_name;',
'/',
'create or replace FUNCTION XXUR_GET_QULIFIER_TEMP_FUN(p_temp_name in varchar2)',
'return VARCHAR2',
'IS ',
'v_name varchar2(20000);',
'BEGIN',
'SELECT NAME INTO v_name',
'           FROM UR_ALGO_ATTRIBUTES ',
'          WHERE ATTRIBUTE_QUALIFIER = ''STAY_DATE'' ',
'            AND KEY LIKE ''''||p_temp_name||''.%'' ; ',
'RETURN v_name;',
'END;',
'/',
'',
'  CREATE UNIQUE INDEX "PK_ADDRESSES" ON "UR_ADDRESSES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UK_UR_ALGO_VERSIONS_ALGO_VERSION" ON "UR_ALGO_VERSIONS" ("ALGO_ID", "VERSION") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_PROFILE_OPTIONS_KEY" ON "UR_PROFILE_OPTIONS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_INTERFACE_LOGS_CON" ON "UR_INTERFACE_LOGS" ("FILE_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_REPORT_DASHBOARDS" ON "UR_REPORT_DASHBOARDS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGO_VERSIONS" ON "UR_ALGO_VERSIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_ROOM_TYPES" ON "UR_HOTEL_ROOM_TYPES" ("ROOM_TYPE_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_REPORTS" ON "UR_REPORTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORTS_KEY" ON "UR_REPORTS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UK_UR_ALGO_ATTRIBUTES_KEY" ON "UR_ALGO_ATTRIBUTES" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_TEMP_BLOB" ON "TEMP_BLOB" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_USERS" ON "UR_USERS" ("USER_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGOS" ON "UR_ALGOS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_GROUPS" ON "UR_HOTEL_GROUPS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_RESERVATIONS" ON "UR_HOTEL_RESERVATIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_HOTEL_ID" ON "UR_REPORT_DASHBOARDS" ("HOTEL_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CONTACTS_ONE_PRIMARY_UX" ON "UR_CONTACTS" (CASE "PRIMARY" WHEN ''Y'' THEN RAWTOHEX("HOTEL_ID") ELSE NULL END ) ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_INTERFACE_LOGS" ON "UR_INTERFACE_LOGS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_PROFILE_OPTIONS" ON "UR_PROFILE_OPTIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_ALGOS_CON" ON "UR_ALGOS" ("NAME") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_EVENTS" ON "UR_EVENTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_HOTEL_GROUPS_NAME" ON "UR_HOTEL_GROUPS" ("GROUP_NAME") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGO_ATTRIBUTES" ON "UR_ALGO_ATTRIBUTES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "KEY_UNIQUE" ON "XXPEL_WF_GLOBAL_PROFILES_TBL" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_CONTACTS" ON "UR_CONTACTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_HOTEL_RES_UNIQUE_NUMBER" ON "UR_HOTEL_RESERVATIONS" ("HOTEL_ID", "RES_NUMBER") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_USERS_EMAIL" ON "UR_USERS" ("EMAIL") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTELS" ON "UR_HOTELS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_TEMPLATES" ON "UR_TEMPLATES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_KEY" ON "UR_REPORT_DASHBOARDS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_TEMPLATES_KEY" ON "UR_TEMPLATES" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "XXPEL_WF_GLOBAL_PROFILES_TBL_PK" ON "XXPEL_WF_GLOBAL_PROFILES_TBL" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_ACCESSES" ON "UR_HOTEL_ACCESSES" ("HOTEL_ID", "USER_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_NAME" ON "UR_REPORT_DASHBOARDS" ("NAME") ',
'  ;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PACKAGE XXPEL_A001_FEEDBACK AS',
'  -- Procedure: Submit feedback, create JIRA issue, send notifications',
'  PROCEDURE SUBMIT_FEEDBACK(',
'    p_feedback       IN VARCHAR2,',
'    p_rating         IN VARCHAR2,',
'    p_new_type       IN VARCHAR2,',
'    p_summary        IN VARCHAR2,',
'    p_description    IN VARCHAR2,',
'    p_page_id        IN NUMBER,',
'    p_app_id         IN NUMBER,',
'    p_app_user       IN VARCHAR2',
'  );',
'END XXPEL_A001_FEEDBACK;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PROCEDURE xxpel_parse_error_json (',
'    p_json_clob      IN  CLOB,',
'    p_collection_name IN VARCHAR2 DEFAULT ''ERROR_COLLECTION'',',
'    p_ai_message     OUT CLOB,',
'    p_status         OUT VARCHAR2',
') AS',
'    l_json_data   JSON_ARRAY_T;',
'    l_obj         JSON_OBJECT_T;',
'    l_error_obj   JSON_OBJECT_T;',
'    l_file_id     VARCHAR2(50);',
'    l_template_id VARCHAR2(100);',
'    l_line_no     NUMBER;',
'    l_message     VARCHAR2(4000);',
'    l_count       PLS_INTEGER := 0;',
'BEGIN',
'    -- Drop and recreate collection',
'    IF apex_collection.collection_exists(p_collection_name) THEN',
'        apex_collection.delete_collection(p_collection_name);',
'    END IF;',
'',
'    apex_collection.create_collection(p_collection_name);',
'',
'    -- Parse the JSON array',
'    l_json_data := JSON_ARRAY_T.parse(p_json_clob);',
'',
'    FOR i IN 0 .. l_json_data.get_size - 1 LOOP',
'        l_obj := TREAT(l_json_data.get(i) AS JSON_OBJECT_T);',
'',
'        l_file_id     := l_obj.get_string(''File_ID'');',
'        l_template_id := l_obj.get_string(''Template_ID'');',
'        l_error_obj   := l_obj.get_object(''error'');',
'        l_line_no     := l_error_obj.get_number(''Line_Number'');',
'        l_message     := l_error_obj.get_string(''message'');',
'',
'        apex_collection.add_member(',
'            p_collection_name => p_collection_name,',
'            p_c001 => l_file_id,',
'            p_c002 => l_template_id,',
'            p_c003 => TO_CHAR(l_line_no),',
'            p_c004 => l_message',
'        );',
'',
'        l_count := l_count + 1;',
'    END LOOP;',
'',
'    -- Status and AI message logic',
'    IF l_count > 0 THEN',
'        p_status := ''S'';',
'        p_ai_message := ''Parsed '' || l_count || '' errors successfully.'';',
'    ELSE',
'        p_status := ''W'';',
'        p_ai_message := ''No errors found in the JSON input.'';',
'    END IF;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_ai_message := ''Error while parsing JSON: '' || SQLERRM;',
'END;',
'/',
'create or replace PROCEDURE POPULATE_ERROR_COLLECTION_FROM_LOG (',
'    p_interface_log_id IN  UR_INTERFACE_LOGS.ID%TYPE,',
'    p_collection_name  IN  VARCHAR2,',
'    p_status           OUT VARCHAR2,',
'    p_message          OUT VARCHAR2',
')',
'IS',
'    l_error_json       CLOB;',
'    l_errors_count     NUMBER := 0;',
'    l_warnings_count   NUMBER := 0;',
'    l_total_count      NUMBER := 0;',
'    l_is_new_format    BOOLEAN := FALSE;',
'BEGIN',
'    -- Initialize OUT parameters to a default error state.',
'    p_status  := ''E'';',
'    p_message := ''An unexpected error occurred during processing.'';',
'',
'    -- Step 1: Validate inputs',
'    IF p_interface_log_id IS NULL THEN',
'        p_status  := ''E'';',
'        p_message := ''Error: The Interface Log ID cannot be null.'';',
'        RETURN;',
'    END IF;',
'',
'    IF p_collection_name IS NULL OR TRIM(p_collection_name) IS NULL THEN',
'        p_status  := ''E'';',
'        p_message := ''Error: The Collection Name cannot be null or empty.'';',
'        RETURN;',
'    END IF;',
'',
'    -- Step 2: Fetch the ERROR_JSON from the logs table',
'    BEGIN',
'        SELECT error_json',
'        INTO   l_error_json',
'        FROM   ur_interface_logs',
'        WHERE  id = p_interface_log_id;',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status  := ''E'';',
'            p_message := ''Error: No record found for Interface Log ID: '' || RAWTOHEX(p_interface_log_id) || ''.'';',
'            RETURN;',
'    END;',
'',
'    -- Step 3: Check if the fetched JSON is null or empty',
'    IF l_error_json IS NULL OR DBMS_LOB.GETLENGTH(l_error_json) = 0 THEN',
'        p_status  := ''W'';',
'        p_message := ''Warning: The error log for the specified ID is empty. No data to populate.'';',
'        -- It''s a good practice to still ensure the collection is empty in this case.',
'        APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(p_collection_name => p_collection_name);',
'        RETURN;',
'    END IF;',
'',
'    -- Step 4: Parse the JSON and check for validity',
'    BEGIN',
'        APEX_JSON.PARSE(l_error_json);',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            -- APEX_JSON raises an unhandled exception (ORA-20987) for parse errors.',
'            p_status  := ''E'';',
'            p_message := ''Error: Failed to parse the ERROR_JSON content. The JSON string may be malformed.'';',
'            RETURN;',
'    END;',
'',
'    -- Step 5: Initialize the APEX Collection',
'    -- This creates the collection if it doesn''t exist or clears it if it does.',
'    APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(',
'        p_collection_name => p_collection_name',
'    );',
'',
'    -- Step 6: Determine JSON format and populate the collection',
'    -- New format: {"errors":[...],"warnings":[...]}',
'    -- Legacy format: [{row:1,error:"..."},...]',
'',
'    -- Check if this is the new nested format by looking for "errors" key',
'    l_errors_count := APEX_JSON.GET_COUNT(p_path => ''errors'');',
'    l_warnings_count := APEX_JSON.GET_COUNT(p_path => ''warnings'');',
'',
'    IF l_errors_count IS NOT NULL OR l_warnings_count IS NOT NULL THEN',
'        -- New format detected',
'        l_is_new_format := TRUE;',
'        l_errors_count := NVL(l_errors_count, 0);',
'        l_warnings_count := NVL(l_warnings_count, 0);',
'',
'        -- Process errors array',
'        -- Collection columns: c001=row, c002=message, c003=line, c004=status, c005=data_issues',
'        FOR i IN 1..l_errors_count LOOP',
'            APEX_COLLECTION.ADD_MEMBER(',
'                p_collection_name => p_collection_name,',
'                p_c001            => APEX_JSON.GET_VARCHAR2(p_path => ''errors[%d].row'', p0 => i),',
'                p_c002            => APEX_JSON.GET_VARCHAR2(p_path => ''errors[%d].error'', p0 => i),',
'                p_c003            => APEX_JSON.GET_VARCHAR2(p_path => ''errors[%d].line'', p0 => i),',
'                p_c004            => NVL(APEX_JSON.GET_VARCHAR2(p_path => ''errors[%d].status'', p0 => i), ''ERROR''),',
'                p_c005            => APEX_JSON.GET_VARCHAR2(p_path => ''errors[%d].data_issues'', p0 => i)',
'            );',
'        END LOOP;',
'',
'        -- Process warnings array',
'        -- Collection columns: c001=row, c002=details, c003=line, c004=status, c005=null',
'        FOR i IN 1..l_warnings_count LOOP',
'            APEX_COLLECTION.ADD_MEMBER(',
'                p_collection_name => p_collection_name,',
'                p_c001            => APEX_JSON.GET_VARCHAR2(p_path => ''warnings[%d].row'', p0 => i),',
'                p_c002            => APEX_JSON.GET_VARCHAR2(p_path => ''warnings[%d].details'', p0 => i),',
'                p_c003            => APEX_JSON.GET_VARCHAR2(p_path => ''warnings[%d].line'', p0 => i),',
'                p_c004            => NVL(APEX_JSON.GET_VARCHAR2(p_path => ''warnings[%d].status'', p0 => i), ''WARNING''),',
'                p_c005            => NULL',
'            );',
'        END LOOP;',
'',
'        l_total_count := l_errors_count + l_warnings_count;',
'',
'    ELSE',
'        -- Legacy format: simple array at root level',
'        l_total_count := APEX_JSON.GET_COUNT(p_path => ''.'');',
'        l_total_count := NVL(l_total_count, 0);',
'',
'        FOR i IN 1..l_total_count LOOP',
'            -- Legacy format: c001=row, c002=error, c004=ERROR (default status)',
'            APEX_COLLECTION.ADD_MEMBER(',
'                p_collection_name => p_collection_name,',
'                p_c001            => APEX_JSON.GET_VARCHAR2(p_path => ''[%d].row'', p0 => i),',
'                p_c002            => APEX_JSON.GET_VARCHAR2(p_path => ''[%d].error'', p0 => i),',
'                p_c003            => NULL,',
'                p_c004            => ''ERROR'',',
'                p_c005            => NULL',
'            );',
'        END LOOP;',
'',
'        l_errors_count := l_total_count;',
'    END IF;',
'',
'    IF l_total_count > 0 THEN',
'        p_status  := ''S'';',
'        IF l_is_new_format THEN',
'            p_message := ''Success: Collection '''''' || p_collection_name || '''''' populated with ''',
'                         || l_errors_count || '' error(s) and '' || l_warnings_count || '' warning(s).'';',
'        ELSE',
'            p_message := ''Success: Collection '''''' || p_collection_name || '''''' has been populated with ''',
'                         || l_total_count || '' error(s).'';',
'        END IF;',
'    ELSE',
'        -- No errors or warnings found',
'        p_status  := ''W'';',
'        p_message := ''Warning: The error log contains no errors or warnings. The collection is empty.'';',
'    END IF;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        -- A final catch-all for any other unexpected Oracle errors.',
'        p_status  := ''E'';',
'        p_message := ''An unexpected system error occurred: '' || SQLERRM;',
'END POPULATE_ERROR_COLLECTION_FROM_LOG;',
'/',
'create or replace PROCEDURE DELETE_TEMPLATES_AND_DB_OBJECTS_JSON (',
'  p_id            IN VARCHAR2 DEFAULT NULL,',
'  p_hotel_id      IN VARCHAR2 DEFAULT NULL,',
'  p_key           IN VARCHAR2 DEFAULT NULL,',
'  p_name          IN VARCHAR2 DEFAULT NULL,',
'  p_type          IN VARCHAR2 DEFAULT NULL,',
'  p_active        IN CHAR DEFAULT NULL,           -- ''Y'' or ''N''',
'  p_db_obj_empty  IN CHAR DEFAULT NULL,           -- ''Y'' = only if table is empty, else skip',
'  p_delete_all    IN CHAR DEFAULT ''N'',            -- ''Y'' to delete EVERYTHING',
'  p_debug         IN CHAR DEFAULT ''N'',            -- ''Y'' to log debug messages to APEX debug',
'  p_json_output   OUT CLOB',
')',
'AS',
'  v_sql            VARCHAR2(1000);',
'  v_rows_count     NUMBER;',
'  v_status         CHAR(1);',
'  v_message        VARCHAR2(4000);',
'  v_json_list      CLOB := ''['';',
'  v_first          BOOLEAN := TRUE;',
'  v_tmp_json       CLOB;',
'',
'  CURSOR c_templates IS',
'    SELECT id, hotel_id, key, name, type, active, db_object_name',
'    FROM ur_templates',
'    WHERE (p_delete_all = ''Y''',
'          OR (p_id IS NULL OR id = p_id))',
'      AND (p_delete_all = ''Y''',
'           OR (p_hotel_id IS NULL OR hotel_id = p_hotel_id))',
'      AND (p_delete_all = ''Y''',
'           OR (p_key IS NULL OR key = p_key))',
'      AND (p_delete_all = ''Y''',
'           OR (p_name IS NULL OR name = p_name))',
'      AND (p_delete_all = ''Y''',
'           OR (p_type IS NULL OR type = p_type))',
'      AND (p_delete_all = ''Y''',
'           OR (p_active IS NULL OR active = p_active));',
'           ',
'  -- Helper to escape JSON strings - simple version; improves safety',
'  FUNCTION json_escape(str IN VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN REPLACE(REPLACE(REPLACE(REPLACE(str, ''\'', ''\\''), ''"'', ''\"''), CHR(10), ''\n''), CHR(13), '''');',
'  EXCEPTION WHEN OTHERS THEN',
'    RETURN '''';',
'  END;',
'',
'  PROCEDURE dbg(p_msg VARCHAR2) IS',
'  BEGIN',
'    IF p_debug = ''Y'' THEN',
'      apex_debug.message(p_msg);',
'    END IF;',
'  END;',
'',
'  PROCEDURE append_result (',
'    p_id            IN VARCHAR2,',
'    p_hotel_id      IN VARCHAR2,',
'    p_key           IN VARCHAR2,',
'    p_name          IN VARCHAR2,',
'    p_type          IN VARCHAR2,',
'    p_active        IN CHAR,',
'    p_db_obj_name   IN VARCHAR2,',
'    p_status        IN CHAR,',
'    p_message       IN VARCHAR2',
'  ) IS',
'  BEGIN',
'    IF v_first T'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(13018871232711763)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'HEN',
'      v_first := FALSE;',
'    ELSE',
'      v_json_list := v_json_list || '','';',
'    END IF;',
'',
'    v_json_list := v_json_list || ''{'' ||',
'      ''"id":"''          || json_escape(p_id)          || ''",'' ||',
'      ''"hotel_id":"''    || json_escape(p_hotel_id)    || ''",'' ||',
'      ''"key":"''         || json_escape(p_key)         || ''",'' ||',
'      ''"name":"''        || json_escape(p_name)        || ''",'' ||',
'      ''"type":"''        || json_escape(p_type)        || ''",'' ||',
'      ''"active":"''      || json_escape(p_active)      || ''",'' ||',
'      ''"db_object_name":"'' || json_escape(p_db_obj_name) || ''",'' ||',
'      ''"status":"''      || json_escape(p_status)      || ''",'' ||',
'      ''"message":"''     || json_escape(p_message)     || ''"'' ||',
'    ''}'';',
'  END;',
'BEGIN',
'  dbg(''Started DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'',
'  FOR rec IN c_templates LOOP',
'    dbg(''Processing template ID='' || rec.id || '', DB_OBJECT_NAME='' || rec.db_object_name);',
'',
'    IF rec.db_object_name IS NULL THEN',
'      v_status := ''E'';',
'      v_message := ''No DB_OBJECT_NAME specified for template, skipping.'';',
'      dbg(v_message);',
'      append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, NULL, v_status, v_message);',
'      CONTINUE;',
'    END IF;',
'',
'    -- -- Check if table exists in user schema',
'    -- SELECT COUNT(*)',
'    --   INTO v_rows_count',
'    --   FROM all_tables',
'    --  WHERE table_name = rec.db_object_name',
'    --    AND owner = USER;',
'',
'    -- IF v_rows_count = 0 THEN',
'    --   v_status := ''E'';',
'    --   v_message := ''DB Object ['' || rec.db_object_name || ''] does not exist or is not a table.'';',
'    --   dbg(v_message);',
'    --   append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    --   CONTINUE;',
'    -- END IF;',
'',
'    -- Check if table should be empty before deleting',
'    IF p_db_obj_empty = ''Y'' THEN',
'      v_sql := ''SELECT COUNT(*) FROM '' || rec.db_object_name;',
'      BEGIN',
'        EXECUTE IMMEDIATE v_sql INTO v_rows_count;',
'      EXCEPTION',
'        WHEN OTHERS THEN',
'          v_rows_count := -1; -- can''t count, treat as error or non-empty',
'      END;',
'',
'      IF v_rows_count > 0 THEN',
'        v_status := ''E'';',
'        v_message := ''DB Object table ['' || rec.db_object_name || ''] is not empty (ROWS='' || v_rows_count || ''), skipping deletion.'';',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'        CONTINUE;',
'      END IF;',
'      dbg(''DB Object table ['' || rec.db_object_name || ''] is empty, proceeding.'');',
'    END IF;',
'',
'    -- Try to drop the table and delete template',
'    BEGIN',
'      v_sql := ''DROP TABLE '' || rec.db_object_name || '' CASCADE CONSTRAINTS'';',
'      dbg(''Executing: '' || v_sql);',
'      EXECUTE IMMEDIATE v_sql;',
'',
'      dbg(''Dropped table '' || rec.db_object_name);',
'',
'      DELETE FROM ur_templates WHERE id = rec.id;',
'',
'      dbg(''Deleted template id='' || rec.id);',
'',
'      v_status := ''S'';',
'      v_message := ''Successfully dropped table and deleted template.'';',
'      append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'',
'    EXCEPTION',
'      WHEN OTHERS THEN',
'        v_status := ''E'';',
'        v_message := ''Error dropping table or deleting template: '' || SQLERRM;',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    END;',
'  END LOOP;',
'',
'  v_json_list := v_json_list || '']'';',
'',
'  p_json_output := v_json_list;',
'',
'  dbg(''Completed DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'END DELETE_TEMPLATES_AND_DB_OBJECTS_JSON;',
'/',
'create or replace PROCEDURE add_alert_1(',
'        p_existing_json IN  CLOB,',
'        p_message       IN  VARCHAR2,',
'        p_icon          IN  VARCHAR2 DEFAULT NULL,',
'        p_title         IN  VARCHAR2 DEFAULT NULL,',
'        p_timeout       IN  NUMBER   DEFAULT NULL,',
'        p_html_safe     IN  VARCHAR2 DEFAULT ''N'',  -- NEW: Y = allow HTML',
'        p_updated_json  OUT CLOB',
'    ) IS',
'        l_json_array json_array_t;',
'        l_new_object json_object_t;',
'    BEGIN',
'        -- Create the new JSON object',
'        l_new_object := new json_object_t();',
'        l_new_object.put(''message'', p_message);',
'        l_new_object.put(''icon'', nvl(p_icon, ''success''));',
'        l_new_object.put(''title'', nvl(p_title, ''''));',
'        l_new_object.put(''html'', nvl(p_html_safe, ''N'')); -- NEW key',
'',
'        IF p_timeout IS NOT NULL THEN',
'            l_new_object.put(''timeOut'', to_char(p_timeout));',
'        END IF;',
'',
'        -- Append to existing JSON array',
'        IF p_existing_json IS NULL OR trim(p_existing_json) = '''' THEN',
'            l_json_array := new json_array_t();',
'        ELSE',
'            l_json_array := json_array_t(p_existing_json);',
'        END IF;',
'',
'        l_json_array.append(l_new_object);',
'',
'        p_updated_json := l_json_array.to_clob;',
'    END add_alert_1;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'   CREATE SEQUENCE  "XXPEL_WF_FEEDBACK_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 61 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_ALGOS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_CONTACTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER trg_ur_events_biu',
'BEFORE INSERT ON ur_events',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.id IS NULL THEN',
'        :NEW.id := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'    END IF;',
'',
'    IF :NEW.updated_on IS NULL THEN',
'        :NEW.updated_on := SYSDATE;',
'    END IF;',
'',
'    -- Replace with actual login user RAW if needed',
'    IF :NEW.created_by IS NULL THEN',
'        :NEW.created_by := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.updated_by IS NULL THEN',
'        :NEW.updated_by := SYS_GUID();',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTELS_ALL" ',
'FOR INSERT OR UPDATE OR DELETE ON ur_hotels',
'COMPOUND TRIGGER',
'',
'    v_user_id  RAW(16);',
'    v_status   BOOLEAN;',
'    v_message  VARCHAR2(4000);',
'',
'BEFORE STATEMENT IS',
'BEGIN',
'    NULL;',
'END BEFORE STATEMENT;',
'',
'BEFORE EACH ROW IS',
'BEGIN',
'    ------------------------------------------------------------------',
'    -- DELETE MODE (must delete children BEFORE deleting the hotel)',
'    ------------------------------------------------------------------',
'    IF DELETING THEN',
'        ',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :OLD.ID,',
'            p_mode     => ''DELETE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'            RAISE_APPLICATION_ERROR(',
'                -20003,',
'                ''Failed to delete attributes: '' || v_message',
'            );',
'        END IF;',
'',
unistr('        -- \274C Do NOT RETURN (not allowed)'),
unistr('        -- \2714\FE0F Just EXIT this block naturally'),
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- Resolve user ID',
'    ------------------------------------------------------------------',
'    IF NOT DELETING THEN',
'        BEGIN',
'            SELECT user_id INTO v_user_id',
'            FROM ur_users',
'            WHERE user_name = SYS_CONTEXT(''APEX$SESSION'',''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := NULL;',
'        END;',
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- BEFORE INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'',
'        IF :NEW.ID IS NULL THEN',
'            :NEW.ID := SYS_GUID();',
'        END IF;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'    ------------------------------------------------------------------',
'    -- BEFORE UPDATE',
'    ------------------------------------------------------------------',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'END BEFORE EACH ROW;',
'',
'AFTER EACH ROW IS',
'BEGIN',
'',
'    ------------------------------------------------------------------',
'    -- INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :NEW.ID,',
'            p_mode     => ''CREATE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'            RAISE_APPLICATION_ERROR(',
'                -20001,',
'                ''Failed to create attributes: '' || v_message',
'            );',
'        END IF;',
'    END IF;',
'',
'END AFTER EACH ROW;',
'',
'AFTER STATEMENT IS',
'BEGIN',
'    NULL;',
'END AFTER STATEMENT;',
'',
'END trg_ur_hotels_all;',
'/',
'create or replace TRIGGER "TRG_UR_HOTELS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_HOTEL_PRICE_OVERRIDE"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := REGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_TEMPLATES',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_USERS_BI_TRG" ',
'FOR INSERT OR UPDATE ON ur_users',
'COMPOUND TRIGGER',
'',
'  BEFORE EACH ROW IS',
'    l_current_user_id UR_USERS.USER_ID%TYPE;',
'  BEGIN',
'    IF INSERTING THEN',
'      -- generate PK if not provided',
'      IF :NEW.user_id IS NULL THEN',
'        :NEW.user_id := SYS_GUID();',
'      END IF;',
'',
'      -- set created_by / updated_by from session package (if available)',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.created_by := l_current_user_id;',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'',
'      -- timestamps (respect any pre-filled created_on)',
'      IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'    END IF;',
'  END BEFORE EACH ROW;',
'',
'END trg_ur_users_bi_trg;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace TYPE UR_attribute_value_table IS TABLE OF UR_attribute_value_row',
'/',
'create or replace TYPE UR_attribute_value_row AS OBJECT (',
'    stay_date        DATE,',
'    attribute_value  VARCHAR2(4000)',
')',
'/',
'create or replace TYPE t_result_tab_obj AS TABLE OF t_result_rec_obj',
'/',
'create or replace TYPE t_result_rec_obj IS OBJECT (',
'  algo_name VARCHAR2(255),',
'  stay_date DATE,',
'  day_of_week VARCHAR2(10),',
'  evaluated_price VARCHAR2(4000),  -- Changed from NUMBER to VARCHAR2',
'  applied_rule CLOB',
')',
'/',
'create or replace TYPE log_rec_obj AS OBJECT (',
'    log_id        NUMBER,',
'    log_message   VARCHAR2(255)',
')',
'/',
'create or replace TYPE log_tab_type AS TABLE OF log_rec_obj;',
'CREATE OR REPLACE PACKAGE pkg_log_data_trg AS',
'    -- Global variable now uses the SQL type',
'    g_log_data_tab log_tab_type;',
'',
'    PROCEDURE init;',
'    PROCEDURE process;',
'END pkg_log_data_trg',
'/',
'create or replace TYPE my_date_list IS TABLE OF DATE',
'/',
'create or replace TYPE attribute_value_row AS OBJECT (',
'    stay_date       DATE,',
'    attribute_value NUMBER',
')',
'/',
'create or replace TYPE attribute_value_table AS TABLE OF attribute_value_row',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_USERS_BI_TRG" ',
'FOR INSERT OR UPDATE ON ur_users',
'COMPOUND TRIGGER',
'',
'  BEFORE EACH ROW IS',
'    l_current_user_id UR_USERS.USER_ID%TYPE;',
'  BEGIN',
'    IF INSERTING THEN',
'      -- generate PK if not provided',
'      IF :NEW.user_id IS NULL THEN',
'        :NEW.user_id := SYS_GUID();',
'      END IF;',
'',
'      -- set created_by / updated_by from session package (if available)',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.created_by := l_current_user_id;',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'',
'      -- timestamps (respect any pre-filled created_on)',
'      IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'    END IF;',
'  END BEFORE EACH ROW;',
'',
'END trg_ur_users_bi_trg;',
'/',
'ALTER TRIGGER "TRG_UR_USERS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(13018871232711763)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := REGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ENABLE;',
'',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."ID" IS ''UUID - Unique attribute identifier (Primary Key).'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."STAY_DATE" IS ''The specific date for which the price is overridden.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."HOTEL_ID" IS ''Optional Foreign Key to a Hotel table to limit the override to a specific hotel.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."TYPE" IS ''Pricing Type (e.g., Retail, Group).'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."PRICE" IS ''The overridden price for the stay date.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."REASON" IS ''Justification for the price override.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."CREATED_BY" IS ''UUID of the user who created the record.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."UPDATED_BY" IS ''UUID of the user who last updated the record.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."CREATED_ON" IS ''Timestamp of when the record was created.'';',
'   COMMENT ON COLUMN "UR_HOTEL_PRICE_OVERRIDE"."UPDATED_ON" IS ''Timestamp of when the record was last updated.'';',
'   COMMENT ON TABLE "UR_HOTEL_PRICE_OVERRIDE"  IS ''Stores daily price overrides for hotels.'';',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_HOTEL_PRICE_OVERRIDE"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_ALL" ',
'FOR INSERT OR UPDATE OR DELETE ON ur_hotels',
'COMPOUND TRIGGER',
'',
'    v_user_id  RAW(16);',
'    v_status   BOOLEAN;',
'    v_message  VARCHAR2(4000);',
'',
'BEFORE STATEMENT IS',
'BEGIN',
'    NULL;',
'END BEFORE STATEMENT;',
'',
'BEFORE EACH ROW IS',
'BEGIN',
'    ------------------------------------------------------------------',
'    -- DELETE MODE (must delete children BEFORE deleting the hotel)',
'    ------------------------------------------------------------------',
'    IF DELETING THEN',
'        ',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :OLD.ID,',
'            p_mode     => ''DELETE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'            RAISE_APPLICATION_ERROR(',
'                -20003,',
'                ''Failed to delete attributes: '' || v_message',
'            );',
'        END IF;',
'',
unistr('        -- \274C Do NOT RETURN (not allowed)'),
unistr('        -- \2714\FE0F Just EXIT this block naturally'),
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- Resolve user ID',
'    ------------------------------------------------------------------',
'    IF NOT DELETING THEN',
'        BEGIN',
'            SELECT user_id INTO v_user_id',
'            FROM ur_users',
'            WHERE user_name = SYS_CONTEXT(''APEX$SESSION'',''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := NULL;',
'        END;',
'    END IF;',
'',
'    ------------------------------------------------------------------',
'    -- BEFORE INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'',
'        IF :NEW.ID IS NULL THEN',
'            :NEW.ID := SYS_GUID();',
'        END IF;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'    ------------------------------------------------------------------',
'    -- BEFORE UPDATE',
'    ------------------------------------------------------------------',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'END BEFORE EACH ROW;',
'',
'AFTER EACH ROW IS',
'BEGIN',
'',
'    ------------------------------------------------------------------',
'    -- INSERT',
'    ------------------------------------------------------------------',
'    IF INSERTING THEN',
'        ur_utils.create_hotel_calculated_attributes(',
'            p_hotel_id => :NEW.ID,',
'            p_mode     => ''CREATE'',',
'            p_status   => v_status,',
'            p_message  => v_message',
'        );',
'',
'        IF NOT v_status THEN',
'            RAISE_APPLICATION_ERROR(',
'                -20001,',
'                ''Failed to create attributes: '' || v_message',
'            );',
'        END IF;',
'    END IF;',
'',
'END AFTER EACH ROW;',
'',
'AFTER STATEMENT IS',
'BEGIN',
'    NULL;',
'END AFTER STATEMENT;',
'',
'END trg_ur_hotels_all;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_ALL" ENABLE;',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BI_TRG" ENABLE;',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BIU" ',
'BEFORE INSERT ON ur_events',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.id IS NULL THEN',
'        :NEW.id := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'    END IF;',
'',
'    IF :NEW.updated_on IS NULL THEN',
'        :NEW.updated_on := SYSDATE;',
'    END IF;',
'',
'    -- Replace with actual login user RAW if needed',
'    IF :NEW.created_by IS NULL THEN',
'        :NEW.created_by := SYS_GUID();',
'    END IF;',
'',
'    IF :NEW.updated_by IS NULL THEN',
'        :NEW.updated_by := SYS_GUID();',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BIU" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_CONTACTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_CONTACTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGOS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGOS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ENABLE;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PACKAGE BODY XXPEL_A001_FEEDBACK AS',
'',
'  FUNCTION get_profile_value(p_key VARCHAR2) RETURN VARCHAR2 IS',
'    v_return_value VARCHAR2(4000);',
'  BEGIN',
'    SELECT VALUE INTO v_return_value FROM XXPEL_WF_GLOBAL_PROFILES_TBL WHERE KEY = p_key;',
'    RETURN v_return_value;',
'  EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      RETURN NULL;',
'  END get_profile_value;',
'',
'  PROCEDURE SUBMIT_FEEDBACK(',
'    p_feedback       IN VARCHAR2,',
'    p_rating         IN VARCHAR2,',
'    p_new_type       IN VARCHAR2,',
'    p_summary        IN VARCHAR2,',
'    p_description    IN VARCHAR2,',
'    p_page_id        IN NUMBER,',
'    p_app_id         IN NUMBER,',
'    p_app_user       IN VARCHAR2',
'  ) IS',
'    L_FEEDBACK_ID     NUMBER;',
'    L_EMAIL_login     VARCHAR2(2000);',
'    L_EMAIL           VARCHAR2(2000);',
'    L_EMAIL_ENABLE    VARCHAR2(2000);',
'    L_CLOB            CLOB;',
'    L_JIRA_PAYLOAD    CLOB;',
'    L_ISSUE_KEY       VARCHAR2(100);',
'    L_ISSUE_URL       VARCHAR2(4000);',
'    L_JIRA_URL        VARCHAR2(4000);',
'    L_JIRA_USERNAME   VARCHAR2(2000);',
'    L_JIRA_API_TOKEN  VARCHAR2(4000);',
'    L_EMAIL_FROM      VARCHAR2(4000);',
'    L_NEW_TYPE        VARCHAR2(100) := NVL(p_new_type, ''Feedback'');',
'    L_SUMMARY         VARCHAR2(4000) := p_summary;',
'    L_DESCRIPTION     VARCHAR2(4000) := p_description;',
'    ',
'    L_JIRA_BROWSE_URL VARCHAR2(4000);',
'     L_feedback_type VARCHAR2(4000);',
'BEGIN',
' /*   IF p_new_type IS NULL THEN',
'      L_DESCRIPTION := p_feedback;',
'      L_SUMMARY := p_rating;',
'    END IF;*/',
'SELECT DECODE(p_new_type,2,''Bug'',3,''Enhancement Request'',''Feedback'') INTO L_feedback_type',
' from dual;',
'    L_EMAIL := get_profile_value(''FEEDBACK_EMAIL_ADDR'');',
'    L_EMAIL_ENABLE := get_profile_value(''ENABLE_FEEDBACK_EMAIL'');',
'    L_JIRA_URL := get_profile_value(''JIRA_API_URL'');',
'    L_JIRA_USERNAME := get_profile_value(''JIRA_USERNAME'');',
'    L_JIRA_API_TOKEN := get_profile_value(''JIRA_API_TOKEN'');',
'    L_EMAIL_FROM := get_profile_value(''EMAIL_FROM_ADDR'');',
'    L_JIRA_BROWSE_URL := get_profile_value(''JIRA_BROWSE_URL'');',
'',
'    BEGIN',
'    --  SELECT ''sahilmagdum@projecteidos.com'' INTO L_EMAIL_login FROM dual;',
'      SELECT EMAIL',
'      INTO L_EMAIL_login FROM ur_users WHERE upper(USER_NAME) =  upper(v(''app_user''));',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        L_EMAIL_login := ''unknown@yourdomain.com'';',
'    END;',
'',
'    apex_util.submit_feedback(',
'      p_comment        => p_feedback,',
'      p_application_id => p_app_id,',
'      p_page_id        => p_page_id,',
'      p_rating         => p_rating,',
'      p_ATTRIBUTE_01   => L_feedback_type,',
'      p_ATTRIBUTE_02   => L_SUMMARY,',
'      p_ATTRIBUTE_03   => L_DESCRIPTION,',
'      p_ATTRIBUTE_04   => L_FEEDBACK_ID',
'    );',
'',
'    -- JIRA integration',
'    IF L_feedback_type IN (''Bug'', ''Enhancement Request'') THEN',
'      L_JIRA_PAYLOAD := ''{',
'        "fields": {',
'          "project": {"key": "FOUR"},',
'          "summary": "'' || REPLACE(L_SUMMARY, ''"'', ''\"'') || '' - Feedback Ref: '' || L_FEEDBACK_ID || ''",',
'          "description": {',
'            "type": "doc",',
'            "version": 1,',
'            "content": [{',
'              "type": "paragraph",',
'              "content": [',
'                {"type": "text", "text": "Type: '' || L_feedback_type || ''"}, {"type": "hardBreak"},',
'                {"type": "text", "text": "Feedback Ref: '' || L_FEEDBACK_ID || ''"}, {"type": "hardBreak"},',
'                {"type": "text", "text": "Raised by: '' || L_EMAIL_login || ''"}, {"type": "hardBreak"},',
'                {"type": "text", "text": "Description: '' || REPLACE(L_DESCRIPTION, ''"'', ''\"'') || ''"}',
'              ]',
'            }]',
'          },',
'          "issuetype": {"name": "'' || L_feedback_type || ''"}',
'        }',
'      }'';',
'',
'      apex_web_service.g_request_headers(1).name := ''Content-Type'';',
'      apex_web_service.g_request_headers(1).value := ''application/json'';',
'',
'      L_CLOB := apex_web_service.make_rest_request(',
'        p_url => L_JIRA_URL,',
'        p_http_method => ''POST'',',
'        p_username => L_JIRA_USERNAME,',
'        p_password => L_JIRA_API_TOKEN,',
'        p_body => L_JIRA_PAYLOAD',
'      );',
'',
'      apex_json.parse(L_CLOB);',
'      L_ISSUE_KEY := apex_json.get_varchar2(p_path => ''key'');',
'      L_ISSUE_URL := L_JIRA_URL || L_ISSUE_KEY;',
'    END IF;',
'',
'    -- Email to feedback submitter',
'    apex_mail.send(',
'      p_from => L_EMAIL_FROM,',
'      p_to => L_EMAIL_login,',
'      p_subj => ''Your feedback has been submitted - Ref: '' || L_FEEDBACK_ID,',
'      p_body => ''Your '' || L_feedback_type || '' request has been submitted. Summary: '' || L_SUMMARY,',
'      p_body_html =>',
'        ''Hi,<br><br>Your feedback has been submitted.<br><br>'' ||',
'        ''Summary: '' || L_SUMMARY || ''<br>'' ||',
'        ''Description: '' || L_DESCRIPTION || ',
'        CASE WHEN L_ISSUE_KEY IS NOT NULL THEN ''<br>JIRA Issue: <a href="'' || L_ISSUE_URL || ''" target="_blank">'' || L_ISSUE_KEY || ''</a>'' ELSE '''' END ||',
'        ''<br><br>Regards,<br>Workforce Management Team''',
'    );',
'    apex_mail.push_queue;',
'',
'    -- Email to internal team / managers if email enabled & configured',
'    IF NVL(UPPER(L_EMAIL_ENABLE),''N'') = ''Y'' AND L_EMAIL IS NOT NULL THEN',
'      apex_mail.send(',
'        p_from => L_EMAIL_FROM,',
'        p_to => L_EMAIL,',
'        p_subj => ''A new '' || L_feedback_type || '' has been raised for Workforce - Ref: '' || L_FEEDBACK_ID,',
'        p_body => ''Your '' || L_feedback_type || '' request has been submitted. Summary: '' || L_SUMMARY,',
'        p_body_html =>',
'          ''Hi,<br><br>A new '' || L_feedback_type || '' has been raised.<br><br>'' ||',
'          ''Summary: '' || L_SUMMARY || ''<br>'' ||',
'          ''Description: '' || L_DESCRIPTION || ''<br>'' ||',
'          ''Requestor: '' || L_EMAIL_login || ',
'          CASE WHEN L_ISSUE_KEY IS NOT NULL THEN ''<br>JIRA Issue: <a href="'' || L_ISSUE_URL || ''" target="_blank">'' || L_ISSUE_KEY || ''</a>'' ELSE '''' END ||',
'          ''<br><br>Please review accordingly.<br><br>Regards,<br>Workforce Management Team''',
'      );',
'      apex_mail.push_queue;',
'    END IF;',
'',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE;',
'END SUBMIT_FEEDBACK;',
'',
'END XXPEL_A001_FEEDBACK;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
' '))
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13036957672711838)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'FN_CLEAN_NUMBER'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13037188631711839)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'FN_SAFE_TO_DATE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13037399693711839)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'GET_MAP_CALCULATION_FUN'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13037564422711840)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'GET_PROFILE_JSON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13037807450711841)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'GUESS_DELIMITER'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13038014309711842)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'SANITIZE_COLUMN_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13038207141711842)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'XXUR_GET_QULIFIER_TEMP_FUN'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13031366239711817)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'KEY_UNIQUE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13031585078711817)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_ADDRESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13031727459711818)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_TEMP_BLOB'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13031990453711819)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGOS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13032219107711820)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGO_ATTRIBUTES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13032373890711820)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGO_VERSIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13032547480711821)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_CONTACTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13032764557711822)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_EVENTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033008301711823)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTELS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033178558711824)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_ACCESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033335218711824)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_GROUPS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033537948711825)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_RESERVATIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033800403711826)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_ROOM_TYPES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13033984512711827)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_INTERFACE_LOGS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13034152748711827)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_PROFILE_OPTIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13034353444711828)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13034574603711829)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13034799650711830)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_TEMPLATES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13034958738711830)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_USERS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13035125211711831)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UK_UR_ALGO_ATTRIBUTES_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13035413359711832)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UK_UR_ALGO_VERSIONS_ALGO_VERSION'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13035601298711833)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_HOTEL_RES_UNIQUE_NUMBER'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13035753248711833)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_HOTEL_GROUPS_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13035933769711834)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_PROFILE_OPTIONS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13036142870711835)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORTS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13036422157711836)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_HOTEL_ID'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13036581762711836)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13036807343711837)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13031124711711816)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_TEMPLATES_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13030979233711815)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_USERS_EMAIL'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13030767108711814)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_ALGOS_CON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13030582318711814)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CONTACTS_ONE_PRIMARY_UX'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13030351462711813)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_INTERFACE_LOGS_CON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13030174370711812)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'XXPEL_WF_GLOBAL_PROFILES_TBL_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029986491711811)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'XXPEL_A001_FEEDBACK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029786777711811)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'ADD_ALERT_1'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029599568711810)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'DELETE_TEMPLATES_AND_DB_OBJECTS_JSON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029381563711809)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'POPULATE_ERROR_COLLECTION_FROM_LOG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029184564711808)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'XXPEL_PARSE_ERROR_JSON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13029013921711808)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'SEQUENCE'
,p_object_name=>'XXPEL_WF_FEEDBACK_SEQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13028723102711807)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'DEBUG_LOG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13028603599711806)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_BLOB'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13028198804711805)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13028387267711805)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13027363639711801)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ADDRESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13027600073711802)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGOS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13027787445711803)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGO_ATTRIBUTES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13028020915711804)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGO_VERSIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13027136483711801)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CONTACTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026952217711800)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EVENTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026746061711799)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTELS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13025798277711795)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_ACCESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026016335711796)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_GROUPS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026194000711797)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_PRICE_OVERRIDE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026393119711798)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_RESERVATIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13026554995711798)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_ROOM_TYPES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13025600691711795)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_INTERFACE_LOGS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13025220433711793)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_PROFILE_OPTIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13025337542711794)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13024954567711792)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13024753610711792)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_USERS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13024369474711790)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'XXPEL_WF_GLOBAL_PROFILES_TBL'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13024579822711791)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'XX_FEEDBACK_EMAIL_DETAILS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13020811073711776)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ADDRESSES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13020942282711777)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGOS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13021206730711778)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGO_ATTRIBUTES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13021402580711778)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGO_VERSIONS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13021573347711779)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_CONTACTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13021799459711780)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_EVENTS_BIU'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13021987335711781)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_EVENTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13022205623711781)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTELS_ALL'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13022395608711782)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTELS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13022538232711783)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_GROUPS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13022741441711784)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_PRICE_OVERRIDE_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023010886711785)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_RESERVATIONS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023202107711785)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_ROOM_TYPES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023348013711786)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_INTERFACE_LOGS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023620019711787)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_REPORTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023778992711788)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_REPORT_DASHBOARDS_BI'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13023972816711788)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_TEMPLATES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13024152377711789)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_USERS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13020391110711775)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'ATTRIBUTE_VALUE_ROW'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13020588324711775)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'ATTRIBUTE_VALUE_TABLE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13019763019711772)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'LOG_REC_OBJ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13019936786711773)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'LOG_TAB_TYPE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13020157832711774)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'MY_DATE_LIST'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13019596820711772)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'T_RESULT_REC_OBJ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13019416946711771)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'T_RESULT_TAB_OBJ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13019184070711770)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'UR_ATTRIBUTE_VALUE_ROW'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(13018924607711768)
,p_script_id=>wwv_flow_imp.id(13018871232711763)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'UR_ATTRIBUTE_VALUE_TABLE'
);
wwv_flow_imp.component_end;
end;
/
