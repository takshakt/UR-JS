---
# ====== Page: Interface Dashboard ===========================
id: 1601
identification: 
  name: Interface Dashboard
  alias: INTERFACE-DASHBOARD
  title: Interface Dashboard

appearance: 
  page-mode: Normal
  page-template: Theme Default
  template-options: 
  - '#DEFAULT#'

navigation-menu: 
  override-user-interface-level: false

navigation: 
  cursor-focus: Do not focus cursor
  warn-on-unsaved-changes: true

javascript: 
  execute-when-page-loads: |
    function callProcess(processName) {
      return new Promise(function(resolve, reject) {
        let hotelId = $v('P0_HOTEL_ID');
    
        // Normalize: treat empty string as NULL
        if (!hotelId || hotelId.trim() === '') {
          hotelId = null;
        }
    
        apex.server.process(
          processName,
          { x01: hotelId },
          { success: resolve, error: reject }
        );
      });
    }
    
    // ---- Helper: Make Bar Chart ----
    function makeBar(ctx, labels, dataset) {
      return new Chart(ctx, {
        type: 'bar',
        data: { 
          labels: labels, 
          datasets: [ dataset ] 
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: false,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }
    
    // ---- Helper: Make Line Chart ----
    function makeLine(ctx, labels, datasets, optionsExtra) {
      return new Chart(ctx, {
        type: 'line',
        data: { labels: labels, datasets: datasets },
        options: Object.assign({
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: true } }
        }, optionsExtra || {})
      });
    }
    
    function loadDashboard() {
      Promise.all([
        callProcess('GET_CARD_TOTAL'),
        callProcess('GET_CARD_SUCCESS'),
        callProcess('GET_CARD_FAILED'),
        callProcess('GET_CARD_INPROGRESS_1'),
        callProcess('GET_CARD_PENDING'),
        callProcess('GET_CHART_DAILY_STATUS'),
        callProcess('GET_CHART_TOP_TEMPLATES'),
        callProcess('GET_CHART_FAILURE_PERCENTAGE'),
        callProcess('GET_CHART_FREQ'),
        callProcess('GET_CHART_HOTEL_SUCCESS')
      ]).then(function(results) {
        try {
          // ---- Cards ----
          $('#val-total').text((results[0] && results[0].value) || 0);
          $('#val-success').text((results[1] && results[1].value) || 0);
          $('#val-failed').text((results[2] && results[2].value) || 0);
        //--  $('#val-inprogress').text((results[3] && results[3].value) || 0);
    if (results[3]) {
      const success = results[3].success || 0;
      const total = results[3].value || 0;
    
      // Update separate spans
      $('#val-success-rows').text(success);
      $('#val-total-rows').text(total);
    }
    
          $('#val-pending').text(
           results[4] && results[4].value !== undefined
             ? results[4].value + 's' // seconds
             : '0s'
        );
    
    
        // ---- Chart 6: Daily Status ----
        (function() {
          var payload = results[5] || [];
          var labels  = payload.map(r => r.load_date);
          var success = payload.map(r => r.successful_count);
          var failed  = payload.map(r => r.failed_count);
          var ctx = document.getElementById('chart-daily').getContext('2d');
          makeLine(ctx, labels, [
            { label: 'Success', data: success, borderWidth: 2, fill: false, tension: 0.3 },
            { label: 'Failed',  data: failed,  borderWidth: 2, fill: false, tension: 0.3 }
          ]);
        })();
    
        // ---- Chart 7: Top Templates ----
        (function() {
          var payload = results[6] || [];
          var labels  = payload.map(r => r.template_name);
          var totals  = payload.map(r => r.total_records);
          var ctx = document.getElementById('chart-templates').getContext('2d');
          makeBar(ctx, labels, { label: 'Records', data: totals, borderRadius: 6, barPercentage: 0.7 });
        })();
    
        // ---- Chart 8: Failure % ----
        (function() {
          var payload = results[7] || [];
          var labels  = payload.map(r => r.template_name);
          var pct     = payload.map(r => r.failure_percentage);
          var ctx = document.getElementById('chart-template-fail').getContext('2d');
          makeBar(ctx, labels, { label: 'Failure %', data: pct });
        })();
    
    // ---- Chart 9: Template Usage Frequency ----
    (function() {
      var payload = results[8] || [];
      if (!payload || payload.length === 0) {
        console.warn("No data available for Template Usage Frequency chart");
        return; // don’t try to render
      }
    
      var labels = payload.map(r => r.template_name);
      var counts = payload.map(r => r.usage_count);
    
      var ctx = document.getElementById('chart-usage-frequency').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            label: 'Usage Count',
            data: counts,
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
              '#9966FF', '#FF9F40', '#66FF66', '#FF6666',
              '#6699FF', '#FFCC99'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' },
            title: {
              display: true,
              text: 'Template Usage Frequency'
            }
          }
        }
      });
    })();
    
        // ---- Chart 10: Hotel Success % ----
        (function() {
          var payload = results[9] || [];
          var labels  = payload.map(r => r.hotel_name);
          var pct     = payload.map(r => r.success_percentage);
          var ctx = document.getElementById('chart-hotel-success').getContext('2d');
          makeBar(ctx, labels, { label: 'Success %', data: pct });
        })();
    
        } catch(e) {
          console.error('Dashboard render error:', e);
          alert('Error rendering dashboard: ' + e.message);
        }
      }).catch(function(err) {
        console.error('AJAX error:', err);
        alert('Failed to load dashboard data. Check console for details.');
      });
    }
    // Load dashboard once when page is ready
    loadDashboard();
    

security: 
  authentication: Page Requires Authentication
  deep-linking: Application Default
  page-access-protection: Arguments Must Have Checksum
  form-auto-complete: Off
  browser-cache: Application Default

session-management: 
  rejoin-sessions: Application Default

advanced: 
  enable-duplicate-page-submissions: Yes - Enable page to be re-posted
  reload-on-submit: Only for Success

server-cache: 
  caching: Disabled

regions: 
- # ====== Region: Main Region =================================
  id: 12885615709327143
  identification: 
    name: Main Region
    type: Static Content

  source: 
    html-code: |
      <!-- Dashboard HTML -->
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap">
      <div id="iface-dashboard" class="iface-dashboard">
        <div class="iface-left">
          <div class="iface-cards">
            <div class="iface-card" id="card-total">
              <div class="card-title">Total Runs (24h)</div>
              <div class="card-value" id="val-total">—</div>
              <div class="card-sub">since yesterday</div>
            </div>
            <div class="iface-card" id="card-success">
              <div class="card-title">Success (24h)</div>
              <div class="card-value" id="val-success">—</div>
              <div class="card-sub">successful runs</div>
            </div>
            <div class="iface-card" id="card-failed">
              <div class="card-title">Failures (24h)</div>
              <div class="card-value" id="val-failed">—</div>
              <div class="card-sub">failed runs</div>
            </div>
      <div class="iface-card" id="card-records">
        <div class="card-title">Records Processed (24h)</div>
      
        <div class="card-value" id="val-inprogress">
          <span id="val-success-rows">0</span> | <span id="val-total-rows">0</span>
        </div>
      
        <div class="card-sub">
          <span>successful rows</span> | <span>total rows</span>
        </div>
      </div>
      
            <div class="iface-card" id="card-avg">
              <div class="card-title">Avg Duration (sec)</div>
              <div class="card-value" id="val-pending">—</div>
              <div class="card-sub">average run time</div>
            </div>
            
          </div>
      
          <div class="iface-charts">
            <div class="chart-card">
              <div class="chart-title">Daily: Success vs Failed (7 days)</div>
              <canvas id="chart-daily"></canvas>
            </div>
      
            <div class="chart-row">
              <div class="chart-card">
                <div class="chart-title">Top Templates by Records</div>
                <canvas id="chart-templates"></canvas>
              </div>
              <div class="chart-card">
                <div class="chart-title">Template Failures (%)</div>
                <canvas id="chart-template-fail"></canvas>
              </div>
            </div>
      
            <div class="chart-row">
              <div class="chart-card">
                <div class="chart-title">Top Usage Frequency</div>
                <canvas id="chart-usage-frequency"></canvas>
              </div>
              <div class="chart-card">
                <div class="chart-title">Hotel Success % (Top 10)</div>
                <canvas id="chart-hotel-success"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <style>
      #iface-dashboard { font-family: 'Inter', sans-serif; padding: 18px; background:#f4fbff; border-radius:10px; }
      .iface-cards { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom:18px; }
      .iface-card { background: white; border-radius: 10px; padding: 14px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); text-align:center; }
      .card-title { font-size: 13px; color:#6c7a89; margin-bottom:6px; }
      .card-value { font-size: 26px; font-weight:700; color:#0b6b6b; }
      .card-sub { font-size:12px; color:#99a0a6; margin-top:6px; }
      
      .iface-charts .chart-card { background:white; padding:12px; border-radius:10px; box-shadow: 0 6px 18px rgba(0,0,0,0.04); margin-bottom:12px; }
      .chart-title { font-weight:600; margin-bottom:8px; color:#334e52; }
      .chart-row { display:flex; gap:12px; }
      .chart-row > .chart-card { flex:1; }
      
      canvas { width:100% !important; height:260px !important; }
      @media (max-width:1100px) {
        .iface-cards { grid-template-columns: repeat(2,1fr); }
        .chart-row { flex-direction: column; }
      }
      </style>
      
      <!-- Chart.js CDN -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      

  layout: 
    sequence: 10
    parent-region: Full Region # 15037252385055035
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--noPadding
    - t-Region--removeHeader js-removeLandmark
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: IG Region ===================================
  id: 14353600952988347
  identification: 
    name: IG Region
    type: Interactive Grid

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT
          UIL.ID,
          UIL.HOTEL_ID,
          UH.HOTEL_NAME,
          UT.NAME AS TEMPLATE_NAME,  
          U.FIRST_NAME || ' ' || U.LAST_NAME AS FULL_NAME,
          UIL.LOAD_START_TIME,
          UIL.LOAD_END_TIME,
          UIL.LOAD_MAPPING,
          UIL.LOAD_STATUS,
          UIL.RECORDS_PROCESSED,
          UIL.RECORDS_SUCCESSFUL,
          UIL.RECORDS_FAILED,
          UIL.FILE_ID,
          UIL.ERROR_JSON
      FROM UR_INTERFACE_LOGS UIL
      LEFT JOIN UR_HOTELS UH ON UIL.HOTEL_ID = UH.ID
      LEFT JOIN UR_TEMPLATES UT ON UIL.TEMPLATE_ID = UT.ID
      LEFT JOIN UR_USERS U ON UIL.CREATED_BY = U.USER_ID
      WHERE (
             :P0_HOTEL_ID IS NULL
             OR TRIM(:P0_HOTEL_ID) = ''
             OR :P0_HOTEL_ID = 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'
             OR UIL.HOTEL_ID IN (
                  SELECT HEXTORAW(TRIM(column_value))
                  FROM TABLE(apex_string.split(:P0_HOTEL_ID, ','))
                  WHERE REGEXP_LIKE(TRIM(column_value), '^[0-9A-Fa-f]{32}$')
             )
      )
      
    page-items-to-submit: 
    - P0_HOTEL_ID

  layout: 
    sequence: 10
    parent-region: Full Region # 15037252385055035
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Interactive Report
    template-options: 
    - '#DEFAULT#'
    - t-IRR-region--noBorders
    - t-IRR-region--hideHeader js-addHiddenHeadingRoleDesc
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    id: 14353777569988348
    edit: 
      enabled: false

    performance: 
      lazy-loading: false

    appearance: 
      select-first-row: true
      fixed-row-height: true

    pagination: 
      type: Scroll
      show-total-count: true

    toolbar: 
      show: true
      controls: 
      - Search Column Selection
      - Search Field
      - Actions Menu
      - Reset Button
      - Save Button

    enable-users-to: 
      save-public-report: true
      flashback: true
      define-chart-view: true
      download: true

    download: 
      formats: 
      - CSV
      - HTML
      - Excel
      - PDF
      send-as-email: true

    heading: 
      fixed-to: Page

    icon-view: 
      show: false

    detail-view: 
      show: false

    saved-reports: 
    - # ====== Saved Report: Primary Report ========================
      id: 15039632743057523
      identification: 
        name: Primary Report
        alias: 150397

  columns: 
  - # ====== Column: ID ==========================================
    id: 14353863484988349
    identification: 
      column-name: ID
      type: Link

    heading: 
      heading: ID
      alignment: start

    layout: 
      sequence: 10
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:4:&SESSION.::&DEBUG.::P4_INTERFACE_ID_1,P4_ERROR_JSON_1,P4_HOTEL_NAME_1:&ID.,&ERROR_JSON.,&HOTEL_NAME.'
        page: 4 # Interface Dashboard Details
        values: 
          p4_interface_id_1: '&ID.'
          p4_error_json_1: '&ERROR_JSON.'
          p4_hotel_name_1: '&HOTEL_NAME.'

      link-text: '&P4_INTERFACE_ID.'

    source: 
      type: Database Column
      database-column: ID
      data-type: VARCHAR2
      query-only: false
      primary-key: true

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      text-case: Mixed
      lov-type: Distinct Column
      exact-match: true

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: false
      hide: true

    security: 
      escape-special-characters: true

  - # ====== Column: HOTEL_ID ====================================
    id: 14353969439988350
    identification: 
      column-name: HOTEL_ID
      type: Hidden

    settings: 
      value-protected: false

    layout: 
      sequence: 20

    accessibility: 
      value-identifies-row: false

    source: 
      type: Database Column
      database-column: HOTEL_ID
      data-type: VARCHAR2
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    session-state: 
      data-type: VARCHAR2

    export-/-printing: 
      include-in-export-/-print: false

    enable-users-to: 
      sort: false

  - # ====== Column: LOAD_START_TIME =============================
    id: 15034097924055003
    identification: 
      column-name: LOAD_START_TIME
      type: Date Picker

    heading: 
      heading: Load Start Time
      alignment: start

    settings: 
      show-time: false
      display-as: Popup
      minimum-date: None
      maximum-date: None
      multiple-months: No
      use-defaults: true

    layout: 
      sequence: 80
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: true

    source: 
      type: Database Column
      database-column: LOAD_START_TIME
      data-type: TIMESTAMP
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      lov-type: Distinct Column
      date-ranges: All

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: LOAD_END_TIME ===============================
    id: 15034146832055004
    identification: 
      column-name: LOAD_END_TIME
      type: Date Picker

    heading: 
      heading: Load End Time
      alignment: start

    settings: 
      show-time: false
      display-as: Popup
      minimum-date: None
      maximum-date: None
      multiple-months: No
      use-defaults: true

    layout: 
      sequence: 90
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false

    source: 
      type: Database Column
      database-column: LOAD_END_TIME
      data-type: TIMESTAMP
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      lov-type: Distinct Column
      date-ranges: All

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: LOAD_MAPPING ================================
    id: 15034278453055005
    identification: 
      column-name: LOAD_MAPPING
      type: Hidden

    settings: 
      value-protected: false

    layout: 
      sequence: 160

    accessibility: 
      value-identifies-row: false

    source: 
      type: Database Column
      database-column: LOAD_MAPPING
      data-type: CLOB
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    session-state: 
      data-type: CLOB

    export-/-printing: 
      include-in-export-/-print: false

    configuration: 
      build-option: Commented Out # 8557885664922129

  - # ====== Column: LOAD_STATUS =================================
    id: 15034322304055006
    identification: 
      column-name: LOAD_STATUS
      type: Text Field

    heading: 
      heading: Load Status
      alignment: start

    settings: 
      trim-spaces: Leading and Trailing
      text-case: NO CHANGE

    layout: 
      sequence: 100
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: true
      maximum-length: 20

    source: 
      type: Database Column
      database-column: LOAD_STATUS
      data-type: VARCHAR2
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      text-case: Mixed
      lov-type: Distinct Column
      exact-match: true

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: RECORDS_PROCESSED ===========================
    id: 15034404496055007
    identification: 
      column-name: RECORDS_PROCESSED
      type: Number Field

    heading: 
      heading: Records Processed
      alignment: start

    settings: 
      number-alignment: Start
      virtual-keyboard: Decimal

    layout: 
      sequence: 110
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false

    source: 
      type: Database Column
      database-column: RECORDS_PROCESSED
      data-type: NUMBER
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      lov-type: None

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: RECORDS_SUCCESSFUL ==========================
    id: 15034590801055008
    identification: 
      column-name: RECORDS_SUCCESSFUL
      type: Number Field

    heading: 
      heading: Records Successful
      alignment: start

    settings: 
      number-alignment: Start
      virtual-keyboard: Decimal

    layout: 
      sequence: 120
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false

    source: 
      type: Database Column
      database-column: RECORDS_SUCCESSFUL
      data-type: NUMBER
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      lov-type: None

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: RECORDS_FAILED ==============================
    id: 15034620646055009
    identification: 
      column-name: RECORDS_FAILED
      type: Number Field

    heading: 
      heading: Records Failed
      alignment: start

    settings: 
      number-alignment: Start
      virtual-keyboard: Decimal

    layout: 
      sequence: 130
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false

    source: 
      type: Database Column
      database-column: RECORDS_FAILED
      data-type: NUMBER
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      lov-type: None

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: FILE_ID =====================================
    id: 15035278504055015
    identification: 
      column-name: FILE_ID
      type: Hidden

    settings: 
      value-protected: false

    layout: 
      sequence: 140

    accessibility: 
      value-identifies-row: false

    source: 
      type: Database Column
      database-column: FILE_ID
      data-type: NUMBER
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    session-state: 
      data-type: VARCHAR2

    export-/-printing: 
      include-in-export-/-print: false

    enable-users-to: 
      sort: false

  - # ====== Column: ERROR_JSON ==================================
    id: 15035380655055016
    identification: 
      column-name: ERROR_JSON
      type: Text Field

    heading: 
      heading: 'Error JSON '
      alignment: start

    settings: 
      trim-spaces: Leading and Trailing
      text-case: NO CHANGE

    layout: 
      sequence: 150
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false

    source: 
      type: Database Column
      database-column: ERROR_JSON
      data-type: CLOB
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      lov-type: Distinct Column

    export-/-printing: 
      include-in-export-/-print: false

    enable-users-to: 
      hide: true

    configuration: 
      build-option: Commented Out # 8557885664922129

  - # ====== Column: HOTEL_NAME ==================================
    id: 15036362601055026
    identification: 
      column-name: HOTEL_NAME
      type: Text Field

    heading: 
      heading: Hotel Name
      alignment: start

    settings: 
      trim-spaces: Leading and Trailing
      text-case: NO CHANGE

    layout: 
      sequence: 50
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false
      maximum-length: 100

    source: 
      type: Database Column
      database-column: HOTEL_NAME
      data-type: VARCHAR2
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      text-case: Mixed
      lov-type: Distinct Column
      exact-match: true

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: TEMPLATE_NAME ===============================
    id: 15036912750055032
    identification: 
      column-name: TEMPLATE_NAME
      type: Text Field

    heading: 
      heading: Template Name
      alignment: start

    settings: 
      trim-spaces: Leading and Trailing
      text-case: NO CHANGE

    layout: 
      sequence: 70
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false
      maximum-length: 100

    source: 
      type: Database Column
      database-column: TEMPLATE_NAME
      data-type: VARCHAR2
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      text-case: Mixed
      lov-type: Distinct Column
      exact-match: true

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  - # ====== Column: FULL_NAME ===================================
    id: 15037181540055034
    identification: 
      column-name: FULL_NAME
      type: Text Field

    heading: 
      heading: User Name
      alignment: start

    settings: 
      trim-spaces: Leading and Trailing
      text-case: NO CHANGE

    layout: 
      sequence: 170
      column-alignment: start
      stretch: Use Report Setting

    accessibility: 
      value-identifies-row: false

    validation: 
      value-required: false
      maximum-length: 201

    source: 
      type: Database Column
      database-column: FULL_NAME
      data-type: VARCHAR2
      query-only: false
      primary-key: false

    default: 
      duplicate-copies-existing-value: true

    column-filter: 
      enabled: true
      performance-impacting-operators: 
      - Contains
      - Starts With
      - Case Insensitive
      - Regular Expression
      text-case: Mixed
      lov-type: Distinct Column
      exact-match: true

    export-/-printing: 
      include-in-export-/-print: true

    enable-users-to: 
      sort: true
      control-break/aggregate: true
      hide: true

  printing: 
    page: 
      size: Letter
      orientation: Landscape
      units: Inches
      width: 11
      height: 8.5
      border-width: 0.5
      border-color: '#666666'

    page-header: 
      font: Helvetica
      font-weight: Normal
      font-size: 12
      font-color: '#000000'
      alignment: center

    column-headings: 
      font: Helvetica
      font-weight: Bold
      font-size: 10
      font-color: '#000000'
      background-color: '#EEEEEE'

    columns: 
      font: Helvetica
      font-weight: Normal
      font-size: 10
      font-color: '#000000'
      background-color: '#FFFFFF'

    page-footer: 
      font: Helvetica
      font-weight: Normal
      font-size: 12
      font-color: '#000000'
      alignment: center

- # ====== Region: Full Region =================================
  id: 15037252385055035
  identification: 
    name: Full Region
    type: Static Content

  layout: 
    sequence: 30
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--noPadding
    - t-Region--removeHeader js-removeLandmark
    - t-Region--noBorder
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Breadcrumb ==================================
  id: 15694395767538894
  identification: 
    name: Breadcrumb
    title: Interface Dashboard
    type: Breadcrumb

  source: 
    breadcrumb: Breadcrumb # 8558440305922134

  layout: 
    sequence: 20
    parent-region: Hotel Selector # 25697469516364507
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Title Bar
    template-options: 
    - '#DEFAULT#'
    - t-BreadcrumbRegion--useBreadcrumbTitle
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    appearance: 
      breadcrumb-template: Breadcrumb
      template-options: 
      - '#DEFAULT#'

page-items: 
- # ====== Page Item: P1601_HOTEL_LIST =========================
  id: 15035580429055018
  identification: 
    name: P1601_HOTEL_LIST
    type: Select List

  label: 
    label: Hotel List
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 10
    region: Full Region # 15037252385055035
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: 4
    label-column-span: Page Template Default

  appearance: 
    template: Required - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |
      SELECT NVL(hotel_name, 'Name') AS display_value,
             RAWTOHEX(id)            AS return_value
        FROM ur_hotels
      WHERE nvl(ASSOCIATION_END_DATE,sysdate) >= sysdate
      
    display-extra-values: true
    display-null-value: true
    null-display-value: '-- FULL DASHBOARD --'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  configuration: 
    build-option: Commented Out # 8557885664922129

- # ====== Page Item: P1601_ALERT_MESSAGE ======================
  id: 34125482179226717
  identification: 
    name: P1601_ALERT_MESSAGE
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 20
    region: No Parent
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Always, replacing any existing value in session state

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: false
    restricted-characters: All characters can be saved.

  configuration: 
    build-option: Commented Out # 8557885664922129

dynamic-actions: 
- # ====== Dynamic Action: New_3 ===============================
  id: 14715275519561131
  identification: 
    name: New_3

  execution: 
    sequence: 90
    event-scope: Static
    type: Immediate

  when: 
    event: Custom
    custom-event: showAlert
    selection-type: jQuery Selector
    jquery-selector: body

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 14715725022561132
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        var title = $v('P1601_ALERT_TITLE') || 'Notification';
        var message = $v('P1601_ALERT_MESSAGE');
        var icon  = $v('P1601_ALERT_ICON') || 'success';
        
        if(message){
          Swal.fire({
            position: 'top-end',
            icon: icon,
            title: title,
            text: message,
            showConfirmButton: false,
            timer: 2500
          });
          
          $s('P1601_ALERT_MESSAGE','');
        }

    execution: 
      sequence: 10
      event: New_3 # 14715275519561131
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Refresh Hotel =======================
  id: 14716111223561133
  identification: 
    name: Refresh Hotel

  execution: 
    sequence: 60
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P1601_HOTEL_LIST
    - P0_HOTEL_ID

  actions: 
  - # ====== Action: Show ========================================
    id: 15035638920055019
    identification: 
      action: Show

    affected-elements: 
      selection-type: Region
      region: IG Region # 14353600952988347

    execution: 
      sequence: 20
      event: Refresh Hotel # 14716111223561133
      fire-when-event-result-is: True
      fire-on-initialization: true

  - # ====== Action: Refresh =====================================
    id: 15036424300055027
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: Full Region # 15037252385055035

    execution: 
      sequence: 40
      event: Refresh Hotel # 14716111223561133
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 8557885664922129

  - # ====== Action: Submit Page =================================
    id: 15036762514055030
    identification: 
      action: Submit Page

    settings: 
      show-processing: true

    execution: 
      sequence: 30
      event: Refresh Hotel # 14716111223561133
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: New =================================
  id: 14716527145561134
  identification: 
    name: New

  execution: 
    sequence: 10
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P1601_FILE_LOAD

  actions: 
  - # ====== Action: Submit Page =================================
    id: 14717040162561135
    identification: 
      action: Submit Page

    settings: 
      show-processing: true

    execution: 
      sequence: 20
      event: New # 14716527145561134
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: New_1 ===============================
  id: 14717455189561136
  identification: 
    name: New_1

  execution: 
    sequence: 20
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P1601_TEMPLATE_LOV

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 14717928807561138
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        DECLARE
        BEGIN
          -- Insert the template
          INSERT INTO UR_TEMPLATES (
            KEY,
            NAME,
            TYPE,
            ACTIVE,
            DEFINITION,
            CREATED_BY,
            CREATED_ON,
            UPDATED_BY,
            UPDATED_ON
          ) VALUES (
            'EXP_TEMPLATE_'|| ROUND(
            (CAST(SYSTIMESTAMP AT TIME ZONE 'UTC' AS DATE) - DATE '1970-01-01') * 86400
          ),
            'Expense Template '|| ROUND(
            (CAST(SYSTIMESTAMP AT TIME ZONE 'UTC' AS DATE) - DATE '1970-01-01') * 86400
          ),
            'RMS',
            'Y',  -- or hardcode 'ADMIN'
            '[{"name":"EMPLOYEE_NAME","data-type":1,"data-type-len":100,"selector":"Employee Name","is-json":false},{"name":"EXPENSE_ID","data-type":2,"selector":"Expense Id","is-json":false},{"name":"EXP_TYPE","data-type":1,"data-type-len":50,"selector":"Exp Type","is-json":false},{"name":"PROJECT_NAME","data-type":1,"data-type-len":100,"selector":"Project Name","is-json":false},{"name":"EXPENSE_PURPOSE","data-type":1,"data-type-len":50,"selector":"Expense Purpose","is-json":false},{"name":"EXPENSE_DATE_FROM","data-type":3,"selector":"Expense Date From","format-mask":"DD\"-\"MON\"-\"RR","is-json":false},{"name":"EXPENSE_DATE_TO","data-type":3,"selector":"Expense Date To","format-mask":"DD\"-\"MON\"-\"RR","is-json":false},{"name":"STATUS","data-type":1,"data-type-len":50,"selector":"Status","is-json":false},{"name":"CURRENCY","data-type":1,"data-type-len":50,"selector":"Currency","is-json":false},{"name":"CLAIM_AMOUNT","data-type":2,"selector":"Claim Amount","is-json":false},{"name":"EXPENSE_ATTACHMENT","data-type":2,"selector":"Expense Attachment","is-json":false},{"name":"EXPENSE_COMMENT","data-type":1,"data-type-len":32767,"selector":"Expense Comment","is-json":false},{"name":"CREATED_BY","data-type":1,"data-type-len":50,"selector":"Created By","is-json":false},{"name":"CREATION_DATE","data-type":3,"selector":"Creation Date","format-mask":"YYYY\"-\"MM\"-\"DD\" \"HH24\":\"MI\":\"SS","is-json":false},{"name":"LAST_UPDATED_BY","data-type":1,"data-type-len":50,"selector":"Last Updated By","is-json":false},{"name":"LAST_UPDATE_DATE","data-type":3,"selector":"Last Update Date","format-mask":"YYYY\"-\"MM\"-\"DD\" \"HH24\":\"MI\":\"SS","is-json":false}]',
            '3AB2E656C7307FD1E063DD59000A5850',
            SYSTIMESTAMP,
                '3AB2E656C7307FD1E063DD59000A5850',
            SYSTIMESTAMP
          );
        END;
        

    execution: 
      sequence: 10
      event: New_1 # 14717455189561136
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

- # ====== Dynamic Action: Page_Load_DA ========================
  id: 14718291363561139
  identification: 
    name: Page_Load_DA

  execution: 
    sequence: 50
    event-scope: Static

  when: 
    event: Page Load

- # ====== Dynamic Action: Changed =============================
  id: 14718685906561140
  identification: 
    name: Changed

  execution: 
    sequence: 100
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P1601_ALERT_MESSAGE

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 14719175221561141
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        var messagesJson = $v("P1001_ALERT_MESSAGE");  // get the string from hidden page item
        
        if (messagesJson) {
          try {
            // Try parsing the string
            var parsed = JSON.parse(messagesJson);
        
            // Check if parsed result is array or object
            if (Array.isArray(parsed)) {
              // It's an array - pass as is
              showAlertToastr(parsed);
            } else if (parsed && typeof parsed === 'object') {
              // Single object - pass it wrapped in array for consistency 
              showAlertToastr([parsed]);
            } else {
              // Parsed to something else (string/number) — just pass original string
              showAlertToastr(messagesJson);
            }
          } catch (e) {
            // Parsing failed — probably plain text, pass as is
            showAlertToastr(messagesJson);
          }
        }

    execution: 
      sequence: 10
      event: Changed # 14718685906561140
      fire-when-event-result-is: True
      fire-on-initialization: false

processes: 
- # ====== Process: GET_CARD_TOTAL =============================
  id: 14352484123988335
  identification: 
    name: GET_CARD_TOTAL
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        l_total NUMBER;
        l_hotel_id RAW(16);
      BEGIN
        l_hotel_id := apex_application.g_x01;
      
        SELECT COUNT(*)
        INTO l_total
        FROM UR_INTERFACE_LOGS
        WHERE LOAD_START_TIME >= SYSDATE - 1
          AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
        apex_json.open_object;
        apex_json.write('value', NVL(l_total, 0));
        apex_json.close_object;
      END;
      

  execution: 
    sequence: 20
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CARD_SUCCESS ===========================
  id: 14352675320988337
  identification: 
    name: GET_CARD_SUCCESS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        l_total NUMBER;
        l_hotel_id RAW(16);
      BEGIN
        l_hotel_id := apex_application.g_x01;
      
        SELECT COUNT(*)
        INTO l_total
        FROM UR_INTERFACE_LOGS
        WHERE LOAD_STATUS = 'SUCCESS'
          AND LOAD_START_TIME >= SYSDATE - 1
          AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
        apex_json.open_object;
        apex_json.write('value', NVL(l_total, 0));
        apex_json.close_object;
      END;
      

  execution: 
    sequence: 30
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CARD_FAILED ============================
  id: 14352746274988338
  identification: 
    name: GET_CARD_FAILED
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        l_total     NUMBER;
        l_hotel_id  RAW(16);
      BEGIN
        l_hotel_id := apex_application.g_x01;
      
        SELECT COUNT(*)
          INTO l_total
          FROM UR_INTERFACE_LOGS
         WHERE LOAD_START_TIME >= SYSDATE - 1
           AND (
                 LOAD_STATUS = 'FAILED'
                 OR (
                      LOAD_STATUS = 'IN_PROGRESS'
                      AND LOAD_START_TIME < SYSDATE - (1/24)  -- older than 1 hour
                    )
               )
           AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
        apex_json.open_object;
        apex_json.write('value', NVL(l_total, 0));
        apex_json.close_object;
      END;
      

  execution: 
    sequence: 40
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CARD_INPROGRESS ========================
  id: 14352818473988339
  identification: 
    name: GET_CARD_INPROGRESS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        l_total NUMBER;
        l_hotel_id RAW(16);
      BEGIN
        l_hotel_id := apex_application.g_x01;
      
        SELECT COUNT(*)
        INTO l_total
        FROM UR_INTERFACE_LOGS
        WHERE LOAD_STATUS = 'IN_PROGRESS'
          AND LOAD_START_TIME >= SYSDATE - 1
          AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
        apex_json.open_object;
        apex_json.write('value', NVL(l_total, 0));
        apex_json.close_object;
      END;
      

  execution: 
    sequence: 50
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

  configuration: 
    build-option: Commented Out # 8557885664922129

- # ====== Process: GET_CARD_PENDING ===========================
  id: 14352995841988340
  identification: 
    name: GET_CARD_PENDING
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
          l_avg_seconds NUMBER;
      BEGIN
          -- Get hotel ID passed from JS
          l_hotel_id := apex_application.g_x01;
      
          SELECT AVG(
                   EXTRACT(DAY    FROM (LOAD_END_TIME - LOAD_START_TIME)) * 86400 +
                   EXTRACT(HOUR   FROM (LOAD_END_TIME - LOAD_START_TIME)) * 3600 +
                   EXTRACT(MINUTE FROM (LOAD_END_TIME - LOAD_START_TIME)) * 60 +
                   EXTRACT(SECOND FROM (LOAD_END_TIME - LOAD_START_TIME))
                 )
            INTO l_avg_seconds
            FROM UR_INTERFACE_LOGS
           WHERE LOAD_END_TIME IS NOT NULL
             AND LOAD_START_TIME >= SYSDATE - 1
             AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
          apex_json.open_object;
          apex_json.write('value', NVL(ROUND(l_avg_seconds, 0), 0)); -- return as number of seconds
          apex_json.close_object;
      END;
      

  execution: 
    sequence: 70
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CHART_DAILY_STATUS =====================
  id: 14353062198988341
  identification: 
    name: GET_CHART_DAILY_STATUS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
      BEGIN
          -- Read hotel_id from x01 (passed from JS)
          l_hotel_id := apex_application.g_x01;
      
          apex_json.open_array; -- Return as JSON array
          FOR rec IN (
              SELECT TRUNC(LOAD_START_TIME) AS load_date,
                     COUNT(CASE WHEN load_status = 'SUCCESS' THEN 1 END) AS successful_count,
                     COUNT(CASE WHEN load_status != 'SUCCESS' AND load_status != 'IN_PROGRESS' THEN 1 END) AS failed_count
              FROM UR_INTERFACE_LOGS
              WHERE LOAD_START_TIME >= SYSDATE - 7
                AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id)
              GROUP BY TRUNC(LOAD_START_TIME)
              ORDER BY TRUNC(LOAD_START_TIME)
          )
          LOOP
              apex_json.open_object;
              apex_json.write('load_date', TO_CHAR(rec.load_date, 'YYYY-MM-DD'));
              apex_json.write('successful_count', rec.successful_count);
              apex_json.write('failed_count', rec.failed_count);
              apex_json.close_object;
          END LOOP;
          apex_json.close_array;
      END;
      

  execution: 
    sequence: 90
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CHART_TOP_TEMPLATES ====================
  id: 14353137314988342
  identification: 
    name: GET_CHART_TOP_TEMPLATES
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
      BEGIN
          l_hotel_id := apex_application.g_x01;
      
          apex_json.open_array;
          FOR rec IN (
              SELECT t.NAME AS template_name,
                     SUM(l.RECORDS_PROCESSED) AS total_records
              FROM UR_INTERFACE_LOGS l
              JOIN UR_TEMPLATES t ON l.TEMPLATE_ID = t.ID
              WHERE l_hotel_id IS NULL OR l.HOTEL_ID = l_hotel_id
              GROUP BY t.NAME
              ORDER BY total_records DESC
              FETCH FIRST 10 ROWS ONLY
          )
          LOOP
              apex_json.open_object;
              apex_json.write('template_name', rec.template_name);
              apex_json.write('total_records', rec.total_records);
              apex_json.close_object;
          END LOOP;
          apex_json.close_array;
      END;
      

  execution: 
    sequence: 100
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CHART_FAILURE_PERCENTAGE ===============
  id: 14353213320988343
  identification: 
    name: GET_CHART_FAILURE_PERCENTAGE
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
      BEGIN
          l_hotel_id := apex_application.g_x01;
      
          apex_json.open_array;
          FOR rec IN (
              SELECT t.NAME AS template_name,
                     SUM(l.RECORDS_FAILED) AS total_failed,
                     COUNT(*) AS total_runs,
                     ROUND((SUM(l.RECORDS_FAILED) / NULLIF(SUM(l.RECORDS_PROCESSED),0)) * 100, 2) AS failure_percentage
              FROM UR_INTERFACE_LOGS l
              JOIN UR_TEMPLATES t ON l.TEMPLATE_ID = t.ID
              WHERE l.RECORDS_PROCESSED > 0
                AND (l_hotel_id IS NULL OR l.HOTEL_ID = l_hotel_id)
              GROUP BY t.NAME
              ORDER BY failure_percentage DESC
              FETCH FIRST 10 ROWS ONLY
          )
          LOOP
              apex_json.open_object;
              apex_json.write('template_name', rec.template_name);
              apex_json.write('total_failed', rec.total_failed);
              apex_json.write('total_runs', rec.total_runs);
              apex_json.write('failure_percentage', rec.failure_percentage);
              apex_json.close_object;
          END LOOP;
          apex_json.close_array;
      END;
      

  execution: 
    sequence: 110
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CHART_TOP_ERRORS =======================
  id: 14353395150988344
  identification: 
    name: GET_CHART_TOP_ERRORS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
      BEGIN
        apex_json.open_array;
        FOR rec IN (
          SELECT error_message,
                 error_count
          FROM (
            SELECT JSON_VALUE(ERROR_JSON, '$.error.message') AS error_message,
                   COUNT(*) AS error_count
            FROM UR_INTERFACE_LOGS
            WHERE ERROR_JSON IS NOT NULL
            GROUP BY JSON_VALUE(ERROR_JSON, '$.error.message')
            ORDER BY error_count DESC
          )
          FETCH FIRST 10 ROWS ONLY
        )
        LOOP
          apex_json.open_object;
          apex_json.write('error_message', rec.error_message);
          apex_json.write('error_count', rec.error_count);
          apex_json.close_object;
        END LOOP;
        apex_json.close_array;
      END;
      

  execution: 
    sequence: 140
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

  configuration: 
    build-option: Commented Out # 8557885664922129

- # ====== Process: GET_CHART_HOTEL_SUCCESS ====================
  id: 14353435548988345
  identification: 
    name: GET_CHART_HOTEL_SUCCESS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
      BEGIN
          l_hotel_id := apex_application.g_x01;
      
          apex_json.open_array;
          FOR rec IN (
              SELECT h.HOTEL_NAME,
                     ROUND((SUM(CASE WHEN l.LOAD_STATUS = 'SUCCESS' THEN 1 ELSE 0 END) / COUNT(l.id)) * 100, 2) AS success_percentage
              FROM UR_INTERFACE_LOGS l
              JOIN UR_HOTELS h ON l.HOTEL_ID = h.ID
              WHERE l_hotel_id IS NULL OR l.HOTEL_ID = l_hotel_id
              GROUP BY h.HOTEL_NAME
              ORDER BY success_percentage DESC
              FETCH FIRST 10 ROWS ONLY
          )
          LOOP
              apex_json.open_object;
              apex_json.write('hotel_name', rec.hotel_name);
              apex_json.write('success_percentage', rec.success_percentage);
              apex_json.close_object;
          END LOOP;
          apex_json.close_array;
      END;
      

  execution: 
    sequence: 130
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: New ========================================
  id: 14714478600561128
  identification: 
    name: New
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        v_profile_clob CLOB;
        v_records NUMBER;
        v_columns CLOB;
      
        -- Variables for parsing v_columns JSON
        CURSOR cur_columns IS
          SELECT jt.name, jt.data_type
            FROM JSON_TABLE(
                   v_columns,
                   '$[*]'
                   COLUMNS (
                     name VARCHAR2(100) PATH '$.name',
                     data_type VARCHAR2(20) PATH '$."data-type"'
                   )
                 ) jt;
      
      BEGIN
        -- Create or truncate APEX collection before processing
        IF apex_collection.collection_exists('UR_FILE_DATA_PROFILES') THEN
          apex_collection.delete_collection('UR_FILE_DATA_PROFILES');
        END IF;
        
        apex_collection.create_collection('UR_FILE_DATA_PROFILES');
      
        FOR r IN (
          SELECT ID, APPLICATION_ID, NAME, FILENAME, MIME_TYPE, CREATED_ON, BLOB_CONTENT
            FROM APEX_APPLICATION_TEMP_FILES
           WHERE NAME = :P1601_FILE_LOAD
        ) LOOP
          INSERT INTO temp_BLOB (
            ID,
            APPLICATION_ID,
            NAME,
            FILENAME,
            MIME_TYPE,
            CREATED_ON,
            BLOB_CONTENT
          ) VALUES (
            r.ID,
            r.APPLICATION_ID,
            r.NAME,
            r.FILENAME,
            r.MIME_TYPE,
            r.CREATED_ON,
            r.BLOB_CONTENT
          );
        END LOOP;
      
        FOR rec IN (
          SELECT ID, BLOB_CONTENT, filename, name
            FROM temp_BLOB
           WHERE profile IS NULL -- only parse if profile not yet loaded
        ) LOOP
          -- Call APEX_DATA_PARSER.GET_FILE_PROFILE on the blob content
          SELECT apex_data_parser.discover(
                   p_content => rec.BLOB_CONTENT,
                   p_file_name => rec.filename
                 )
            INTO v_profile_clob
            FROM dual;
      
          -- Extract "parsed-rows"
          SELECT TO_NUMBER(JSON_VALUE(v_profile_clob, '$."parsed-rows"'))
            INTO v_records
            FROM dual;
      
          -- Extract filtered columns with mapped data types
          SELECT TO_CLOB(
                   JSON_ARRAYAGG(
                     JSON_OBJECT(
                       'name' VALUE jt.name,
                       'data-type' VALUE CASE jt.data_type
                                          WHEN 1 THEN 'TEXT'
                                          WHEN 2 THEN 'NUMBER'
                                          WHEN 3 THEN 'DATE'
                                          ELSE 'TEXT'
                                        END
                     )
                   )
                 )
            INTO v_columns
            FROM JSON_TABLE(v_profile_clob, '$."columns"[*]'
                   COLUMNS (
                     name       VARCHAR2(100) PATH '$.name',
                     data_type  NUMBER       PATH '$."data-type"'
                   )
                ) jt;
      
          -- Insert each column into APEX collection
          FOR col IN cur_columns LOOP
            apex_collection.add_member(
              p_collection_name => 'UR_FILE_DATA_PROFILES',
              p_c001            => col.name,
              p_c002            => col.data_type
            );
          END LOOP;
      
          -- Update temp_BLOB table
          UPDATE temp_BLOB
             SET profile = v_profile_clob,
                 records = v_records,
                 columns = v_columns
           WHERE ID = rec.ID;
        END LOOP;
      
        COMMIT;
      END;

  execution: 
    sequence: 10
    point: After Submit
    run-process: Once Per Page Visit (default)

  error: 
    display-location: Inline in Notification

  configuration: 
    build-option: Commented Out # 8557885664922129

- # ====== Process: New_1 ======================================
  id: 14714879459561129
  identification: 
    name: New_1
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
        l_json CLOB;
      BEGIN
        l_json := UR_utils.get_collection_json('UR_FILE_DATA_PROFILES');
      
        INSERT INTO UR_TEMPLATES (
          KEY,
          NAME,
          TYPE,
          ACTIVE,
          DEFINITION,
          CREATED_BY,
          CREATED_ON,
          UPDATED_BY,
          UPDATED_ON
        ) VALUES (
          UPPER(
            SUBSTR(
              REGEXP_REPLACE(
                REGEXP_REPLACE(
                  REGEXP_REPLACE(
                    TRIM(:P1601_TEMPLATE_NAME),
                    '^[^A-Za-z0-9]+|[^A-Za-z0-9]+$', ''
                  ),
                  '[^A-Za-z0-9]+', '_'
                ),
                '_+', '_'
              ),
              1, 110
            )
          ),
          :P1601_TEMPLATE_NAME,
          :P1601_TEMPLATE_TYPE,
          'Y',  -- or hardcode 'ADMIN'
          l_json,
          '3AB2E656C7307FD1E063DD59000A5850',
          SYSTIMESTAMP,
          '3AB2E656C7307FD1E063DD59000A5850',
          SYSTIMESTAMP
        );
      
        apex_debug.message('Debug info: ' || l_json);
        
        apex_pwa.send_push_notification (
          p_application_id => 103,
          p_user_name      => 'VKANT',
          p_title          => 'Template Created Successfully.',
          p_body           => 'Order #123456 will arrive within 3 days.' );
      
      --   :P1601_AI_RESPONSE := 'Insert Successful';
      apex_pwa.push_queue;
      -- RETURN 'SUCCESS';
      
      --   apex.message.showToast(
      --     pMessage => 'Changes saved',
      --     pPosition => 'top-right',   -- or 'top-left', 'bottom-right', 'bottom-left'
      --     pDuration => 3000,          -- milliseconds; 0 means sticky until closed
      --     pCloseIcon => true,         -- show a close (x) icon
      --     pStyle => 'success'         -- values: 'success', 'warning', 'error', 'information'
      --   );
      
      -- apex_application.g_print_success_message := 'Record saved successfully!';
      
      EXCEPTION
        WHEN OTHERS THEN
          -- :P1601_AI_RESPONSE := 'Insert Failed: ' || SQLERRM;
          apex_debug.message('Insert Failed: ' || SQLERRM);
          -- RETURN 'Failed '||SQLERRM;
      END;

  execution: 
    sequence: 30
    point: Processing
    run-process: Once Per Page Visit (default)

  success-message: 
    success-message: Succesfully Done

  error: 
    error-message: Blah blah blah
    display-location: Inline in Notification

  configuration: 
    build-option: Commented Out # 8557885664922129

- # ====== Process: GET_CHART_FREQ =============================
  id: 15036881172055031
  identification: 
    name: GET_CHART_FREQ
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_hotel_id RAW(16);
      BEGIN
          -- Read hotel_id from x01 (passed from JS)
          l_hotel_id := apex_application.g_x01;
      
          apex_json.open_array;
          FOR rec IN (
              SELECT t.NAME AS template_name,
                     COUNT(l.ID) AS usage_count
              FROM UR_INTERFACE_LOGS l
              JOIN UR_TEMPLATES t ON l.TEMPLATE_ID = t.ID
              WHERE l_hotel_id IS NULL OR l.HOTEL_ID = l_hotel_id
              GROUP BY t.NAME
              ORDER BY usage_count DESC
          )
          LOOP
              apex_json.open_object;
              apex_json.write('template_name', rec.template_name);
              apex_json.write('usage_count', rec.usage_count);
              apex_json.close_object;
          END LOOP;
          apex_json.close_array;
      END;
      

  execution: 
    sequence: 120
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_CARD_INPROGRESS_1 ======================
  id: 17725396030370802
  identification: 
    name: GET_CARD_INPROGRESS_1
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          l_total       NUMBER := 0;
          l_success     NUMBER := 0;
          l_hotel_id    RAW(16);
      BEGIN
          l_hotel_id := apex_application.g_x01;
      
          -- Total records processed in last 24h
          SELECT NVL(SUM(RECORDS_PROCESSED), 0)
            INTO l_total
            FROM UR_INTERFACE_LOGS
           WHERE LOAD_START_TIME >= SYSDATE - 1
             AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
          -- Successful records processed in last 24h
          SELECT NVL(SUM(RECORDS_SUCCESSFUL), 0)
            INTO l_success
            FROM UR_INTERFACE_LOGS
           WHERE LOAD_START_TIME >= SYSDATE - 1
             AND (l_hotel_id IS NULL OR HOTEL_ID = l_hotel_id);
      
          apex_json.open_object;
          apex_json.write('value', l_total);      -- total processed rows
          apex_json.write('success', l_success);  -- successfully processed rows
          apex_json.close_object;
      END;
      

  execution: 
    sequence: 60
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

