prompt --application/deployment/install/install_initial_script
begin
--   Manifest
--     INSTALL: INSTALL-Initial Script
--   Manifest End
wwv_flow_imp.component_begin (
 p_version_yyyy_mm_dd=>'2024.11.30'
,p_release=>'24.2.11'
,p_default_workspace_id=>7945143549875994
,p_default_application_id=>103
,p_default_id_offset=>0
,p_default_owner=>'WKSP_DEV'
);
wwv_flow_imp_shared.create_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_install_id=>wwv_flow_imp.id(9665506831982728)
,p_name=>'Initial Script'
,p_sequence=>10
,p_script_type=>'INSTALL'
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'',
'  CREATE TABLE "DEBUG_LOG" ',
'   (	"ID" RAW(16) DEFAULT sys_guid(), ',
'	"LOG_TIME" TIMESTAMP (6) DEFAULT systimestamp, ',
'	"MESSAGE" CLOB',
'   ) ;',
'',
'  CREATE TABLE "EXPENSES" ',
'   (	"EMPLOYEE_NAME" VARCHAR2(100), ',
'	"EXPENSE_ID" NUMBER, ',
'	"EXP_TYPE" VARCHAR2(50), ',
'	"PROJECT_NAME" VARCHAR2(100), ',
'	"EXPENSE_PURPOSE" VARCHAR2(50), ',
'	"EXPENSE_DATE_FROM" DATE, ',
'	"EXPENSE_DATE_TO" DATE, ',
'	"STATUS" VARCHAR2(50), ',
'	"CURRENCY" VARCHAR2(50), ',
'	"CLAIM_AMOUNT" NUMBER, ',
'	"EXPENSE_ATTACHMENT" NUMBER, ',
'	"EXPENSE_COMMENT" CLOB, ',
'	"CREATED_BY" VARCHAR2(50), ',
'	"CREATION_DATE" TIMESTAMP (6), ',
'	"LAST_UPDATED_BY" VARCHAR2(50), ',
'	"LAST_UPDATE_DATE" TIMESTAMP (6)',
'   ) ;',
'',
'  CREATE TABLE "TEMP_BLOB" ',
'   (	"ID" NUMBER(22,0) NOT NULL ENABLE, ',
'	"APPLICATION_ID" NUMBER(22,0), ',
'	"NAME" VARCHAR2(400), ',
'	"FILENAME" VARCHAR2(400), ',
'	"MIME_TYPE" VARCHAR2(255), ',
'	"CREATED_ON" DATE, ',
'	"BLOB_CONTENT" BLOB, ',
'	"PROFILE" CLOB, ',
'	"RECORDS" NUMBER, ',
'	"COLUMNS" CLOB, ',
'	 CONSTRAINT "PK_TEMP_BLOB" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "TEMP_UR_REPORTS" ',
'   (	"ID" VARCHAR2(22210) DEFAULT sys_guid() NOT NULL ENABLE, ',
'	"HOTEL_ID" VARCHAR2(106), ',
'	"KEY" VARCHAR2(110) DEFAULT sys_guid(), ',
'	"NAME" VARCHAR2(100), ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB, ',
'	"DB_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_OBJECT_CREATED_ON" DATE, ',
'	"ROWS_COUNT" NUMBER, ',
'	"TABLE_SPACE_SIZE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"DEFINITION_JSON" CLOB, ',
'	"COLUMN_ALIAS" CLOB, ',
'	"EXPRESSIONS_CLOB" CLOB',
'   ) ;',
'',
'  CREATE TABLE "TEMP_UR_REPORT_DASHBOARDS" ',
'   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110), ',
'	"NAME" VARCHAR2(100), ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB, ',
'	"SUMMARY" CLOB, ',
'	 PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGO_VERSIONS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"ALGO_ID" RAW(16) NOT NULL ENABLE, ',
'	"VERSION" VARCHAR2(10) NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"EXPRESSION" CLOB, ',
'	 CONSTRAINT "PK_UR_ALGO_VERSIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UK_UR_ALGO_VERSIONS_ALGO_VERSION" UNIQUE ("ALGO_ID", "VERSION")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTELS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"GROUP_ID" RAW(16), ',
'	"HOTEL_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"STAR_RATING" NUMBER(1,0), ',
'	"ADDRESS_ID" RAW(16), ',
'	"CONTACT_ID" RAW(16), ',
'	"OPENING_DATE" DATE, ',
'	"CURRENCY_CODE" VARCHAR2(3) DEFAULT ''GBP'', ',
'	"ASSOCIATION_START_DATE" DATE, ',
'	"ASSOCIATION_END_DATE" DATE, ',
'	"ASSOCIATED_USER_ID" RAW(16), ',
'	"ALGORITHM_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"IMAGE" BLOB, ',
'	"IMAGE_NAME" VARCHAR2(40 CHAR), ',
'	"IMG_TYPE" VARCHAR2(100 CHAR), ',
'	 CONSTRAINT "PK_UR_HOTELS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_INTERFACE_LOGS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"TEMPLATE_ID" RAW(16) NOT NULL ENABLE, ',
'	"INTERFACE_TYPE" VARCHAR2(20) NOT NULL ENABLE, ',
'	"LOAD_START_TIME" TIMESTAMP (6) NOT NULL ENABLE, ',
'	"LOAD_END_TIME" TIMESTAMP (6), ',
'	"LOAD_MAPPING" CLOB, ',
'	"LOAD_STATUS" VARCHAR2(20) NOT NULL ENABLE, ',
'	"RECORDS_PROCESSED" NUMBER, ',
'	"RECORDS_SUCCESSFUL" NUMBER, ',
'	"RECORDS_FAILED" NUMBER, ',
'	"ERROR_DETAILS" VARCHAR2(1000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"FILE_ID" NUMBER, ',
'	"ERROR_JSON" CLOB, ',
'	 CHECK (Records_Processed >= 0) ENABLE, ',
'	 CHECK (Records_Successful >= 0) ENABLE, ',
'	 CHECK (Records_Failed >= 0) ENABLE, ',
'	 CONSTRAINT "PK_UR_INTERFACE_LOGS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_REPORTS" ',
'   (	"ID" RAW(16) DEFAULT sys_guid() NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110) DEFAULT sys_guid(), ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'' NOT NULL ENABLE, ',
'	"DEFINITION" CLOB NOT NULL ENABLE, ',
'	"DB_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_OBJECT_CREATED_ON" DATE NOT NULL ENABLE, ',
'	"ROWS_COUNT" NUMBER, ',
'	"TABLE_SPACE_SIZE" NUMBER, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (Active IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "PK_UR_REPORTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORTS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_REPORT_DASHBOARDS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(50), ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'', ',
'	"DEFINITION" CLOB NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (ACTIVE IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "CK_KEY_FORMAT" CHECK (',
'    REGEXP_LIKE("KEY", ''^[A-Z0-9_]+$'')',
'  ) ENABLE, ',
'	 CONSTRAINT "PK_UR_REPORT_DASHBOARDS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_HOTEL_ID" UNIQUE ("HOTEL_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_REPORT_DASHBOARDS_NAME" UNIQUE ("NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEMPLATES" ',
'   (	"ID" RAW(32) DEFAULT sys_guid() NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"KEY" VARCHAR2(110) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"TYPE" VARCHAR2(50) NOT NULL ENABLE, ',
'	"ACTIVE" VARCHAR2(1) DEFAULT ''Y'' NOT NULL ENABLE, ',
'	"DEFINITION" CLOB NOT NULL ENABLE, ',
'	"DB_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_OBJECT_CREATED_ON" DATE, ',
'	"ROWS_COUNT" NUMBER, ',
'	"TABLE_SPACE_SIZE" NUMBER, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"DB_VIEW_OBJECT_NAME" VARCHAR2(150), ',
'	"DB_VIEW_OBJECT_CREATED_ON" DATE, ',
'	 CHECK (Active IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "PK_UR_TEMPLATES" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_TEMPLATES_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "HTMLDB_PLAN_TABLE" ',
'   (	"STATEMENT_ID" VARCHAR2(30), ',
'	"PLAN_ID" NUMBER, ',
'	"TIMESTAMP" DATE, ',
'	"REMARKS" VARCHAR2(4000), ',
'	"OPERATION" VARCHAR2(30), ',
'	"OPTIONS" VARCHAR2(255), ',
'	"OBJECT_NODE" VARCHAR2(128), ',
'	"OBJECT_OWNER" VARCHAR2(128), ',
'	"OBJECT_NAME" VARCHAR2(128), ',
'	"OBJECT_ALIAS" VARCHAR2(261), ',
'	"OBJECT_INSTANCE" NUMBER(*,0), ',
'	"OBJECT_TYPE" VARCHAR2(128), ',
'	"OPTIMIZER" VARCHAR2(255), ',
'	"SEARCH_COLUMNS" NUMBER, ',
'	"ID" NUMBER(*,0), ',
'	"PARENT_ID" NUMBER(*,0), ',
'	"DEPTH" NUMBER(*,0), ',
'	"POSITION" NUMBER(*,0), ',
'	"COST" NUMBER(*,0), ',
'	"CARDINALITY" NUMBER(*,0), ',
'	"BYTES" NUMBER(*,0), ',
'	"OTHER_TAG" VARCHAR2(255), ',
'	"PARTITION_START" VARCHAR2(255), ',
'	"PARTITION_STOP" VARCHAR2(255), ',
'	"PARTITION_ID" NUMBER(*,0), ',
'	"OTHER" LONG, ',
'	"DISTRIBUTION" VARCHAR2(30), ',
'	"CPU_COST" NUMBER(*,0), ',
'	"IO_COST" NUMBER(*,0), ',
'	"TEMP_SPACE" NUMBER(*,0), ',
'	"ACCESS_PREDICATES" VARCHAR2(4000), ',
'	"FILTER_PREDICATES" VARCHAR2(4000), ',
'	"PROJECTION" VARCHAR2(4000), ',
'	"TIME" NUMBER(*,0), ',
'	"QBLOCK_NAME" VARCHAR2(128)',
'   ) ;',
'',
'  CREATE TABLE "UR_ADAM_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY__" NUMBER, ',
'	"ADR__USD_" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_ADAM_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ADDRESSES" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"STREET_ADDRESS" VARCHAR2(200) NOT NULL ENABLE, ',
'	"CITY" VARCHAR2(100) NOT NULL ENABLE, ',
'	"COUNTY" VARCHAR2(100), ',
'	"POST_CODE" VARCHAR2(20) NOT NULL ENABLE, ',
'	"COUNTRY" VARCHAR2(100) NOT NULL ENABLE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"PRIMARY_ADDRESS" VARCHAR2(200) NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_ADDRESSES" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGOS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(1000), ',
'	"HOTEL_ID" RAW(16), ',
'	"CURRENT_VERSION_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_ALGOS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_ALGOS_CON" UNIQUE ("NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_ALGO_ATTRIBUTES" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"ALGO_ID" RAW(16), ',
'	"HOTEL_ID" RAW(16), ',
'	"NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"KEY" VARCHAR2(120) NOT NULL ENABLE, ',
'	"DATA_TYPE" VARCHAR2(50) DEFAULT ''NUMBER'' NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(1000), ',
'	"TYPE" VARCHAR2(1) DEFAULT ''M'' NOT NULL ENABLE, ',
'	"VALUE" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"TEMPLATE_ID" RAW(16), ',
'	"ATTRIBUTE_QUALIFIER" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_ALGO_ATTRIBUTES" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UK_UR_ALGO_ATTRIBUTES_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_BHAUMIK_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_BHAUMIK_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_BHAUMIK_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_22SEPT1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_22SEPT1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_22SEPT_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_22SEPT_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_CHINAR_22SEPT_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_28_SEP_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_28_SEP_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_CHINAR_28_SEP_T_STAY_UQ" UNIQUE ("STAY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_STAY_DATE_TEMPLATE_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_STAY_DATE_TEMPLATE_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_CHINAR_STAY_DATE_TEMPLATE_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_TEST_111_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_TEST_111_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CHINAR_TEST_112_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_CHINAR_TEST_112_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_CHINAR_TEST_112_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_CONTACTS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"CONTACT_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"POSITION_TITLE" VARCHAR2(100), ',
'	"EMAIL" VARCHAR2(150), ',
'	"PHONE_NUMBER" VARCHAR2(30), ',
'	"CONTACT_TYPE" VARCHAR2(50), ',
'	"PRIMARY" VARCHAR2(1) DEFAULT ''N'', ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CHECK (Primary IN (''Y'', ''N'')) ENABLE, ',
'	 CONSTRAINT "CHK_EMAIL_FORMAT" CHECK (',
'        Email IS NULL OR REGEXP_LIKE(Email, ''^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'')',
'    ) ENABLE, ',
'	 CONSTRAINT "CHK_PHONE_FORMAT" CHECK (',
'        Phone_Number IS NULL OR REGEXP_LIKE(Phone_Number, ''^\+?[0-9\-\(\) ]{7,30}$'')',
'    ) ENABLE, ',
'	 CONSTRAINT "PK_UR_CONTACTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN11_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COL001" VARCHAR2(4000), ',
'	"COL002" VARCHAR2(4000), ',
'	"COL003" VARCHAR2(4000), ',
'	"COL004" VARCHAR2(4000), ',
'	"REVENUE_INSIGHT___HOTEL_INDIGO_LONDON___1_LEICESTER_SQUARE_BY_IHG___GBP" VARCHAR2(4000), ',
'	"COL006" VARCHAR2(4000), ',
'	"COL007" VARCHAR2(4000), ',
'	"COL008" VARCHAR2(4000), ',
'	"COL009" VARCHAR2(4000), ',
'	"COL010" VARCHAR2(4000), ',
'	"COL011" VARCHAR2(4000), ',
'	"COL012" VARCHAR2(4000), ',
'	"COL013" VARCHAR2(4000), ',
'	"COL014" VARCHAR2(4000), ',
'	"COL015" VARCHAR2(4000), ',
'	"COL016" VARCHAR2(4000), ',
'	"COL017" VARCHAR2(4000), ',
'	"COL018" VARCHAR2(4000), ',
'	"COL019" VARCHAR2(4000), ',
'	"COL020" VARCHAR2(4000), ',
'	"COL021" VARCHAR2(4000), ',
'	"COL022" VARCHAR2(4000), ',
'	"COL023" VARCHAR2(4000), ',
'	"COL024" VARCHAR2(4000), ',
'	"COL025" VARCHAR2(4000), ',
'	"COL026" VARCHAR2(4000), ',
'	"COL027" VARCHAR2(4000), ',
'	"COL028" NUMBER, ',
'	"COL029" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN11_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN_VK_2_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_2_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_2_T_RNS__OTB__UQ" UNIQUE ("RNS__OTB_")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN_VK_3_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_3_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_3_T_RNS__OTB__UQ" UNIQUE ("RNS__OTB_")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN_VK_4_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_4_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_DAILY_BREAKDOWN_VK_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_DAILY_BREAKDOWN_VK_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EVENTS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"EVENT_NAME" VARCHAR2(200) NOT NULL ENABLE, ',
'	"EVENT_TYPE" VARCHAR2(100) NOT NULL ENABLE, ',
'	"EVENT_START_DATE" DATE NOT NULL ENABLE, ',
'	"EVENT_END_DATE" DATE NOT NULL ENABLE, ',
'	"ESTIMATED_ATTENDANCE" NUMBER, ',
'	"IMPACT_LEVEL" VARCHAR2(50), ',
'	"DESCRIPTION" VARCHAR2(500), ',
'	"CITY" VARCHAR2(100), ',
'	"POSTCODE" VARCHAR2(10), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"COUNTRY" VARCHAR2(100), ',
'	"EVENT_FREQUENCY" VARCHAR2(50), ',
'	"IMPACT_TYPE" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_EVENTS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXPENSE_TEMPLATE_02_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXPENSE_TEMPLATE_02_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_2122122_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_2122122_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_212212_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_212212_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_21221_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_21221_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_21_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_21_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_3_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_3_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_EXP_REPORT_T" ',
'   (	"ROW_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"USERNAME" VARCHAR2(4000), ',
'	"PROJECTNAME" VARCHAR2(4000), ',
'	"TASKNAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"HRS" NUMBER, ',
'	"DATE_WORK" DATE, ',
'	"TO_DATE_WORK" DATE, ',
'	"COMMENTS" VARCHAR2(4000), ',
'	"CREATE_BY" VARCHAR2(4000), ',
'	"LAST_UPDATE_BY" VARCHAR2(4000), ',
'	"CREATE_DATE" DATE, ',
'	"LAST_UPDATE_DATE" DATE, ',
'	"LAST_UPDATE_LOGIN" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	 CONSTRAINT "UR_EXP_REPORT_T_PK" PRIMARY KEY ("ROW_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_ACCESSES" ',
'   (	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"USER_ID" RAW(16) NOT NULL ENABLE, ',
'	"ACCESS_TYPE" VARCHAR2(100) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_ACCESSES" PRIMARY KEY ("HOTEL_ID", "USER_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_GROUPS" ',
'   (	"ID" RAW(16), ',
'	"GROUP_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"DESCRIPTION" VARCHAR2(250), ',
'	"ADDRESS_ID" RAW(16), ',
'	"CONTACT_ID" RAW(16), ',
'	"ASSOCIATION_START_DATE" DATE, ',
'	"ASSOCIATION_END_DATE" DATE, ',
'	"ASSOCIATED_EMP_ID" RAW(16), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_GROUPS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_HOTEL_GROUPS_NAME" UNIQUE ("GROUP_NAME")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_RESERVATIONS" ',
'   (	"ID" RAW(16), ',
'	"RES_NUMBER" VARCHAR2(20) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16), ',
'	"ARRIVAL_DATE" DATE NOT NULL ENABLE, ',
'	"NUMBER_OF_NIGHTS" NUMBER(3,0) NOT NULL ENABLE, ',
'	"ROOMS_BOOKED" NUMBER(5,0) NOT NULL ENABLE, ',
'	"TOTAL_BOOKING_VALUE" NUMBER(12,2) NOT NULL ENABLE, ',
'	"CHARGED_FLAG" CHAR(1), ',
'	"EXCEPTION_AMOUNT" NUMBER(12,2) NOT NULL ENABLE, ',
'	"APPROVED_BY" VARCHAR2(100), ',
'	"NOTES" VARCHAR2(1000), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"ATTRIBUTE1" VARCHAR2(100), ',
'	"ATTRIBUTE2" VARCHAR2(100), ',
'	"ATTRIBUTE3" VARCHAR2(100), ',
'	"ATTRIBUTE4" VARCHAR2(100), ',
'	"ATTRIBUTE5" VARCHAR2(100), ',
'	"ATTRIBUTE6" NUMBER, ',
'	"ATTRIBUTE7" NUMBER, ',
'	"ATTRIBUTE8" NUMBER, ',
'	"ATTRIBUTE9" DATE, ',
'	"ATTRIBUTE10" DATE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"RESERVATION_TYPE" VARCHAR2(2), ',
'	"EXCEPTION_DATE" DATE, ',
'	"EXCEPTION_REASON" VARCHAR2(250), ',
'	"RESERVATION_EXCEPTION_TYPE" VARCHAR2(50), ',
'	"APPROVED_BY_MANUAL" VARCHAR2(100), ',
'	"ROOM_TYPE_ID" RAW(16), ',
'	 CHECK (Number_of_Nights > 0) ENABLE, ',
'	 CHECK (Rooms_Booked >= 0) ENABLE, ',
'	 CHECK (Total_Booking_Value >= 0) ENABLE, ',
'	 CHECK (Charged_Flag IN (''Y'', ''N'')) ENABLE, ',
'	 CHECK ("EXCEPTION_AMOUNT">=0) ENABLE, ',
'	 CONSTRAINT "PK_UR_HOTEL_RESERVATIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_HOTEL_RES_NUMBER" UNIQUE ("RES_NUMBER")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_HOTEL_ROOM_TYPES" ',
'   (	"ROOM_TYPE_ID" RAW(16) NOT NULL ENABLE, ',
'	"HOTEL_ID" RAW(16) NOT NULL ENABLE, ',
'	"ROOM_TYPE_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"MAX_OCCUPANCY" NUMBER(2,0) NOT NULL ENABLE, ',
'	"BED_TYPE" VARCHAR2(50), ',
'	"DESCRIPTION" VARCHAR2(250), ',
'	"CREATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) NOT NULL ENABLE, ',
'	"CREATED_ON" DATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE NOT NULL ENABLE, ',
'	"PRICE" NUMBER, ',
'	"SUPPLIMENT_TYPE" VARCHAR2(3), ',
'	"SUPPLIEMENT_PRICE_MIN" NUMBER, ',
'	"SUPPLIMENT_PRICE_MAX" NUMBER, ',
'	 CONSTRAINT "PK_UR_HOTEL_ROOM_TYPES" PRIMARY KEY ("ROOM_TYPE_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_INDIGO_L_SQUARE_I_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE_" DATE, ',
'	"DOW" VARCHAR2(4000), ',
'	"EVENTS_2025" VARCHAR2(4000), ',
'	"RMS_RATE" NUMBER, ',
'	"LIGHTHOUSE_RATE" VARCHAR2(4000), ',
'	"HURDLES" VARCHAR2(4000), ',
'	"PROPOSED_RATE" NUMBER, ',
'	"MLOS3_PROPOSED_RATE" NUMBER, ',
'	"MANUAL_OVERRIDE" NUMBER, ',
'	"RATE_TO_PUBLISH" NUMBER, ',
'	"ROOMS" NUMBER, ',
'	"GROUPS_ROOMS" NUMBER, ',
'	"OCC" NUMBER, ',
'	"STLY" NUMBER, ',
'	"OOO" NUMBER, ',
'	"OCC_FINAL_LY" NUMBER, ',
'	"COMP_SET_LY_OCC" NUMBER, ',
'	"ADR" NUMBER, ',
'	"ADR_STLY_LY" NUMBER, ',
'	"ADR_FINAL_LY" NUMBER, ',
'	"COMP_SET_LY_ADR" NUMBER, ',
'	"REVPAR_TY" NUMBER, ',
'	"REVPAR_LY" NUMBER, ',
'	"COMP_SET_REVPAR_LY" NUMBER, ',
'	"LIVE_RGI" NUMBER, ',
'	"LY_RGI" NUMBER, ',
'	"C1_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C3_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C7_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C1_DAY__GROUP_PICK_UP" NUMBER, ',
'	"C3_DAY_GROUP_PICK_UP" NUMBER, ',
'	"C7_DAY_GROUP_PICK_UP" NUMBER, ',
'	"C1_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C3_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C7_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C1_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C3_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C7_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C1_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C3_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C7_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C1_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"C3_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"C7_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"REV_OTB" NUMBER, ',
'	"COLUMN_" NUMBER, ',
'	"LOS1_RATE" VARCHAR2(4000), ',
'	"LOS3_RATE" VARCHAR2(4000), ',
'	"LOS1_RNK" VARCHAR2(4000), ',
'	"LOS3_RNK" VARCHAR2(4000), ',
'	"RMS_RATE_PUBLISH_CHECK" NUMBER, ',
'	"OVERBOOKING" NUMBER, ',
'	"COL053" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_INDIGO_L_SQUARE_I_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_INDIGO_L_SQUARE_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE_" DATE, ',
'	"DOW" VARCHAR2(4000), ',
'	"EVENTS_2025" VARCHAR2(4000), ',
'	"RMS_RATE" NUMBER, ',
'	"LIGHTHOUSE_RATE" VARCHAR2(4000), ',
'	"HURDLES" VARCHAR2(4000), ',
'	"PROPOSED_RATE" NUMBER, ',
'	"MLOS3_PROPOSED_RATE" NUMBER, ',
'	"MANUAL_OVERRIDE" NUMBER, ',
'	"RATE_TO_PUBLISH" NUMBER, ',
'	"ROOMS" NUMBER, ',
'	"GROUP'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'S_ROOMS" NUMBER, ',
'	"OCC" NUMBER, ',
'	"STLY" NUMBER, ',
'	"OOO" NUMBER, ',
'	"OCC_FINAL_LY" NUMBER, ',
'	"COMP_SET_LY_OCC" NUMBER, ',
'	"ADR" NUMBER, ',
'	"ADR_STLY_LY" NUMBER, ',
'	"ADR_FINAL_LY" NUMBER, ',
'	"COMP_SET_LY_ADR" NUMBER, ',
'	"REVPAR_TY" NUMBER, ',
'	"REVPAR_LY" NUMBER, ',
'	"COMP_SET_REVPAR_LY" NUMBER, ',
'	"LIVE_RGI" NUMBER, ',
'	"LY_RGI" NUMBER, ',
'	"C1_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C3_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C7_DAY_RNTS_PICK_UP" NUMBER, ',
'	"C1_DAY__GROUP_PICK_UP" NUMBER, ',
'	"C3_DAY_GROUP_PICK_UP" NUMBER, ',
'	"C7_DAY_GROUP_PICK_UP" NUMBER, ',
'	"C1_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C3_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C7_DAY_RNTS_PICK_UP_LY" NUMBER, ',
'	"C1_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C3_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C7_DAY_REVENUE_PICK_UP_LY" NUMBER, ',
'	"C1_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C3_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C7_DAY_ADR_PICK_UP" VARCHAR2(4000), ',
'	"C1_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"C3_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"C7_DAY_REVENUE_PICK_UP" NUMBER, ',
'	"REV_OTB" NUMBER, ',
'	"COLUMN_" NUMBER, ',
'	"LOS1_RATE" VARCHAR2(4000), ',
'	"LOS3_RATE" VARCHAR2(4000), ',
'	"LOS1_RNK" VARCHAR2(4000), ',
'	"LOS3_RNK" VARCHAR2(4000), ',
'	"RMS_RATE_PUBLISH_CHECK" NUMBER, ',
'	"OVERBOOKING" NUMBER, ',
'	"COL053" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_INDIGO_L_SQUARE_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_LOS1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_LOS1_T_DATE_UQ" UNIQUE ("DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS1_YORK_2_T" ',
'   (	"REC_ID" RAW(16), ',
'	"SDATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_LOS1_YORK_2_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_LOS1_YORK_2_T_SDATE_UQ" UNIQUE ("SDATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS1_YORK_2_T_INTERFACE" ',
'   (	"REC_ID" RAW(16), ',
'	"SDATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16)',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS1_YORK_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_LOS1_YORK_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_LOS1_YORK_T_DATE_UQ" UNIQUE ("DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS1_YORK_T_INTERFACE" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16)',
'   ) ;',
'',
'  CREATE TABLE "UR_LOS3_YORK_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" VARCHAR2(4000), ',
'	"HILTON_YORK" VARCHAR2(4000), ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"RADISSON_HOTEL_YORK" VARCHAR2(4000), ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" VARCHAR2(4000), ',
'	"NOVOTEL_YORK_CENTRE" VARCHAR2(4000), ',
'	"DOUBLETREE_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"MOXY_YORK" VARCHAR2(4000), ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" VARCHAR2(4000), ',
'	"HAMPTON_BY_HILTON_YORK" VARCHAR2(4000), ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_LOS3_YORK_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_LOS3_YORK_T_DATE_UQ" UNIQUE ("DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_PROFILE_OPTIONS" ',
'   (	"ID" RAW(16) NOT NULL ENABLE, ',
'	"KEY" VARCHAR2(50) NOT NULL ENABLE, ',
'	"NAME" VARCHAR2(100), ',
'	"DESCRIPTION" VARCHAR2(200), ',
'	"VALUE" VARCHAR2(500) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	 CONSTRAINT "PK_UR_PROFILE_OPTIONS" PRIMARY KEY ("ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_PROFILE_OPTIONS_KEY" UNIQUE ("KEY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST1_22_CHINAR_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST1_22_CHINAR_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_TEST_CHINAR_1_T_BOOKING_ID_UQ" UNIQUE ("BOOKING_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_29_SEP_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_29_SEP_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_TEST_CHINAR_29_SEP_T_STAY_UQ" UNIQUE ("STAY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_29_SEP_T_INTERFACE" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16)',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_2_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_2_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_TEST_CHINAR_2_T_BOOKING_ID_UQ" UNIQUE ("BOOKING_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_NEWEST_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_NEWEST_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_NO_USC_NEW_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_NO_USC_NEW_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_NO_USC_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_NO_USC_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_CHINAR_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY__" NUMBER, ',
'	"ADR__USD_" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_CHINAR_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_STACY_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_STACY_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TEST_TEMPLATE_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY__" NUMBER, ',
'	"ADR__USD_" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TEST_TEMPLATE_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_TT_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_TT_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_UR_CHINAR_QUAL_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_UR_CHINAR_QUAL_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_UR_CHINAR_QUAL_T_STAY_UQ" UNIQUE ("STAY")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_UR_CHINAR_QUAL_T_INTERFACE" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16)',
'   ) ;',
'',
'  CREATE TABLE "UR_USERS" ',
'   (	"USER_ID" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"FIRST_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"LAST_NAME" VARCHAR2(100) NOT NULL ENABLE, ',
'	"EMAIL" VARCHAR2(150) NOT NULL ENABLE, ',
'	"CONTACT_NUMBER" NUMBER, ',
'	"USER_TYPE" VARCHAR2(50) NOT NULL ENABLE, ',
'	"STATUS" VARCHAR2(20) NOT NULL ENABLE, ',
'	"START_DATE" DATE, ',
'	"END_DATE" DATE, ',
'	"LOGIN_METHOD" VARCHAR2(50) NOT NULL ENABLE, ',
'	"PASSWORD_HASH" VARCHAR2(256), ',
'	"CREATED_BY" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"UPDATED_BY" RAW(16) DEFAULT SYS_GUID() NOT NULL ENABLE, ',
'	"CREATED_ON" DATE DEFAULT SYSDATE NOT NULL ENABLE, ',
'	"UPDATED_ON" DATE DEFAULT SYSDATE NOT NULL ENABLE, ',
'	"USER_NAME" VARCHAR2(255), ',
'	"NOTES" VARCHAR2(50), ',
'	 CONSTRAINT "PK_UR_USERS" PRIMARY KEY ("USER_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UQ_UR_USERS_EMAIL" UNIQUE ("EMAIL")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_250915_1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_250915_1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_250915_1_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_250915_2_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_250915_2_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_250915_2_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_250915_3_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_250915_3_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_250915_4_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_250915_4_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_250915_4_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_250915_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" DATE, ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_250915_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_250915_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_ATT_QUAL1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"COLUMN_" VARCHAR2(4000), ',
'	"RNS__OTB_" NUMBER, ',
'	"REVENUE__OTB_" NUMBER, ',
'	"OUT_OF_ORDER__OOO___OTB_" NUMBER, ',
'	"RNS__OTB_STLY_" NUMBER, ',
'	"ROOM_REVENUE__OTB_STLY_" NUMBER, ',
'	"RNS__PICKUP_CY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_CY_" NUMBER, ',
'	"RNS__PICKUP_LY_" NUMBER, ',
'	"ROOM_REVENUE__PICKUP_LY_" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_ATT_QUAL1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_ATT_QUAL1_T_RNS__OTB__UQ" UNIQUE ("RNS__OTB_")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_LEAVE_SETUP_T" ',
'   (	"REC_ID" RAW(16), ',
'	"LID" NUMBER, ',
'	"USER_NAME" VARCHAR2(4000), ',
'	"CURRENT_LEAVE" NUMBER, ',
'	"CARRY_LEAVE" NUMBER, ',
'	"CURRENT_YEAR_FROM" DATE, ',
'	"CURRENT_YEAR_TO" DATE, ',
'	"PAID_SICK_DAYS_ALLOWANCE" NUMBER, ',
'	"LEAVE_PROGRAM_RUN" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_LEAVE_SETUP_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_NEW_CHINAR_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_NEW_CHINAR_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_NEW_CHINAR_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_NEW_CHINAR_T_INTERFACE" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" VARCHAR2(4000), ',
'	"STAY_DATE" VARCHAR2(4000), ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16)',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_SAMPLE_HOTEL_DATA_T" ',
'   (	"REC_ID" RAW(16), ',
'	"BOOKING_ID" NUMBER, ',
'	"BOOKING_DATE" DATE, ',
'	"STAY_DATE" DATE, ',
'	"OCCUPANCY" NUMBER, ',
'	"ADR_USD" NUMBER, ',
'	"NUMBER_OF_ROOMS" NUMBER, ',
'	"BOOKING_CHANNEL" VARCHAR2(4000), ',
'	"GUEST_COUNTRY" VARCHAR2(4000), ',
'	"REVENUE" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_SAMPLE_HOTEL_DATA_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_VK_SAMPLE_HOTEL_DATA_T_STAY_DATE_UQ" UNIQUE ("STAY_DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_SEG1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"EMPLOYEE_ID" VARCHAR2(4000), ',
'	"POSITION" VARCHAR2(4000), ',
'	"DOJ" VARCHAR2(4000), ',
'	"PHONE_NO" VARCHAR2(4000), ',
'	"EMAIL" VARCHAR2(4000), ',
'	"ROLE" VARCHAR2(4000), ',
'	"USER_NAME" VARCHAR2(4000), ',
'	"RIGHT_TO_WORK" VARCHAR2(4000), ',
'	"END_DATE" VARCHAR2(4000), ',
'	"REVIEW_DATE" VARCHAR2(4000), ',
'	"APPROVER_EMAIL" VARCHAR2(4000), ',
'	"PROBATION_PERIOD_DATE" DATE, ',
'	"GENDER" VARCHAR2(4000), ',
'	"ENABLE_SM_LEAVE" VARCHAR2(4000), ',
'	"FIRST_NAME" VARCHAR2(4000), ',
'	"LAST_NAME" VARCHAR2(4000), ',
'	"EMP_DETAIL_ID" NUMBER, ',
'	"LEGACY_EMP_NUMBER" VARCHAR2(4000), ',
'	"MIDDLE_NAME" VARCHAR2(4000), ',
'	"KNOWN_AS" VARCHAR2(4000), ',
'	"START_DATE" DATE, ',
'	"ACTIVE_EMPLOYEE_TYPE" NUMBER, ',
'	"JOB_DESCRIPTION" VARCHAR2(4000), ',
'	"GRADE" VARCHAR2(4000), ',
'	"MANAGER" VARCHAR2(4000), ',
'	"SUPERVISOR" VARCHAR2(4000), ',
'	"VACATION_RULES_MANAGER" VARCHAR2(4000), ',
'	"ADDRESS_LINE1" VARCHAR2(4000), ',
'	"ADDRESS_LINE2" VARCHAR2(4000), ',
'	"ADDRESS_LINE3" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_SEG1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_SEGMENT_QUALIFIER1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"EMPLOYEE_ID" VARCHAR2(4000), ',
'	"POSITION" VARCHAR2(4000), ',
'	"DOJ" DATE, ',
'	"PHONE_NO" VARCHAR2(4000), ',
'	"EMAIL" VARCHAR2(4000), ',
'	"ROLE" VARCHAR2(4000), ',
'	"USER_NAME" VARCHAR2(4000), ',
'	"RIGHT_TO_WORK" VARCHAR2(4000), ',
'	"END_DATE" VARCHAR2(4000), ',
'	"REVIEW_DATE" VARCHAR2(4000), ',
'	"APPROVER_EMAIL" VARCHAR2(4000), ',
'	"PROBATION_PERIOD_DATE" DATE, ',
'	"GENDER" VARCHAR2(4000), ',
'	"ENABLE_SM_LEAVE" VARCHAR2(4000), ',
'	"FIRST_NAME" VARCHAR2(4000), ',
'	"LAST_NAME" VARCHAR2(4000), ',
'	"EMP_DETAIL_ID" NUMBER, ',
'	"LEGACY_EMP_NUMBER" VARCHAR2(4000), ',
'	"MIDDLE_NAME" VARCHAR2(4000), ',
'	"KNOWN_AS" VARCHAR2(4000), ',
'	"START_DATE" DATE, ',
'	"ACTIVE_EMPLOYEE_TYPE" NUMBER, ',
'	"JOB_DESCRIPTION" VARCHAR2(4000), ',
'	"GRADE" VARCHAR2(4000), ',
'	"MANAGER" VARCHAR2(4000), ',
'	"SUPERVISOR" VARCHAR2(4000), ',
'	"VACATION_RULES_MANAGER" VARCHAR2(4000), ',
'	"ADDRESS_LINE1" VARCHAR2(4000), ',
'	"ADDRESS_LINE2" VARCHAR2(4000), ',
'	"ADDRESS_LINE3" VARCHAR2(4000), ',
'	"TEST" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_SEGMENT_QUALIFIER1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_SEGMENT_QUALIFIER2_T" ',
'   (	"REC_ID" RAW(16), ',
'	"EMPLOYEE_ID" VARCHAR2(4000), ',
'	"POSITION" VARCHAR2(4000), ',
'	"DOJ" VARCHAR2(4000), ',
'	"PHONE_NO" VARCHAR2(4000), ',
'	"EMAIL" VARCHAR2(4000), ',
'	"ROLE" VARCHAR2(4000), ',
'	"USER_NAME" VARCHAR2(4000), ',
'	"RIGHT_TO_WORK" VARCHAR2(4000), ',
'	"END_DATE" VARCHAR2(4000), ',
'	"REVIEW_DATE" VARCHAR2(4000), ',
'	"APPROVER_EMAIL" VARCHAR2(4000), ',
'	"PROBATION_PERIOD_DATE" DATE, ',
'	"GENDER" VARCHAR2(4000), ',
'	"ENABLE_SM_LEAVE" VARCHAR2(4000), ',
'	"FIRST_NAME" VARCHAR2(4000), ',
'	"LAST_NAME" VARCHAR2(4000), ',
'	"EMP_DETAIL_ID" NUMBER, ',
'	"LEGACY_EMP_NUMBER" VARCHAR2(4000), ',
'	"MIDDLE_NAME" VARCHAR2(4000), ',
'	"KNOWN_AS" VARCHAR2(4000), ',
'	"START_DATE" DATE, ',
'	"ACTIVE_EMPLOYEE_TYPE" NUMBER, ',
'	"JOB_DESCRIPTION" VARCHAR2(4000), ',
'	"GRADE" VARCHAR2(4000), ',
'	"MANAGER" VARCHAR2(4000), ',
'	"SUPERVISOR" VARCHAR2(4000), ',
'	"VACATION_RULES_MANAGER" VARCHAR2(4000), ',
'	"ADDRESS_LINE1" VARCHAR2(4000), ',
'	"ADDRESS_LINE2" VARCHAR2(4000), ',
'	"ADDRESS_LINE3" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_SEGMENT_QUALIFIER2_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_SEGMENT_QUALIFIER_T" ',
'   (	"REC_ID" RAW(16), ',
'	"EMPLOYEE_ID" VARCHAR2(4000), ',
'	"POSITION" VARCHAR2(4000), ',
'	"DOJ" VARCHAR2(4000), ',
'	"PHONE_NO" VARCHAR2(4000), ',
'	"EMAIL" VARCHAR2(4000), ',
'	"ROLE" VARCHAR2(4000), ',
'	"USER_NAME" VARCHAR2(4000), ',
'	"RIGHT_TO_WORK" VARCHAR2(4000), ',
'	"END_DATE" VARCHAR2(4000), ',
'	"REVIEW_DATE" VARCHAR2(4000), ',
'	"APPROVER_EMAIL" VARCHAR2(4000), ',
'	"PROBATION_PERIOD_DATE" DATE, ',
'	"GENDER" VARCHAR2(4000), ',
'	"ENABLE_SM_LEAVE" VARCHAR2(4000), ',
'	"FIRST_NAME" VARCHAR2(4000), ',
'	"LAST_NAME" VARCHAR2(4000), ',
'	"EMP_DETAIL_ID" NUMBER, ',
'	"LEGACY_EMP_NUMBER" VARCHAR2(4000), ',
'	"MIDDLE_NAME" VARCHAR2(4000), ',
'	"KNOWN_AS" VARCHAR2(4000), ',
'	"START_DATE" DATE, ',
'	"ACTIVE_EMPLOYEE_TYPE" NUMBER, ',
'	"JOB_DESCRIPTION" VARCHAR2(4000), ',
'	"GRADE" VARCHAR2(4000), ',
'	"MANAGER" VARCHAR2(4000), ',
'	"SUPERVISOR" VARCHAR2(4000), ',
'	"VACATION_RULES_MANAGER" VARCHAR2(4000), ',
'	"ADDRESS_LINE1" VARCHAR2(4000), ',
'	"ADDRESS_LINE2" VARCHAR2(4000), ',
'	"ADDRESS_LINE3" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_SEGMENT_QUALIFIER_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_VK_TMS_TASK_T" ',
'   (	"REC_ID" RAW(16), ',
'	"ID" NUMBER, ',
'	"PRJ_ID" NUMBER, ',
'	"NAME" VARCHAR2(4000), ',
'	"DESCRIPTION" VARCHAR2(4000), ',
'	"END_DATE" VARCHAR2(4000), ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_VK_TMS_TASK_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE TABLE "UR_YORK_LOS1_T" ',
'   (	"REC_ID" RAW(16), ',
'	"DATE" DATE, ',
'	"DAY" VARCHAR2(4000), ',
'	"MY_OTB" NUMBER, ',
'	"MARKET_DEMAND" NUMBER, ',
'	"DELTA_HOTELS_BY_MARRIOTT_YORK" NUMBER, ',
'	"HILTON_YORK" NUMBER, ',
'	"HOLIDAY_INN_YORK_AN_IHG_HOTEL" NUMBER, ',
'	"RADISSON_HOTEL_YORK" NUMBER, ',
'	"THE_MILNER_YORK_FORMERLY_THE_PRINCIPAL_YORK" NUMBER, ',
'	"NOVOTEL_YORK_CENTRE" NUMBER, ',
'	"DOUBLETREE_BY_HILTON_YORK" NUMBER, ',
'	"MOXY_YORK" NUMBER, ',
'	"HOTEL_INDIGO_YORK_AN_IHG_HOTEL" NUMBER, ',
'	"HAMPTON_BY_HILTON_YORK" NUMBER, ',
'	"ELMBANK_YORK_TAPESTRY_COLLECTION_BY_HILTON" NUMBER, ',
'	"CREATED_BY" RAW(16), ',
'	"UPDATED_BY" RAW(16), ',
'	"CREATED_ON" DATE, ',
'	"UPDATED_ON" DATE, ',
'	"HOTEL_ID" RAW(16), ',
'	"INTERFACE_LOG_ID" RAW(16), ',
'	 CONSTRAINT "UR_YORK_LOS1_T_PK" PRIMARY KEY ("REC_ID")',
'  USING INDEX  ENABLE, ',
'	 CONSTRAINT "UR_YORK_LOS1_T_DATE_UQ" UNIQUE ("DATE")',
'  USING INDEX  ENABLE',
'   ) ;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_ADAM_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ADAM_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_ADAM_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_ADAM_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGOS" ADD CONSTRAINT "FK_UR_ALGOS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGOS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.I'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'D := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGOS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGO_ATTRIBUTES" ADD CONSTRAINT "FK_UR_ALGO_ATTRIBUTES_ALGO" FOREIGN KEY ("ALGO_ID")',
'	  REFERENCES "UR_ALGOS" ("ID") ENABLE;',
'  ALTER TABLE "UR_ALGO_ATTRIBUTES" ADD CONSTRAINT "FK_UR_ALGO_ATTRIBUTES_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_ALGO_VERSIONS" ADD CONSTRAINT "FK_UR_ALGO_VERSIONS_ALGO" FOREIGN KEY ("ALGO_ID")',
'	  REFERENCES "UR_ALGOS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_BHAUMIK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_BHAUMIK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_BHAUMIK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_BHAUMIK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_22SEPT1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_22SEPT1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_22SEPT_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_22SEPT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_28_SEP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_28_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_28_SEP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_28_SEP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_STAY_DATE_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_TEST_111_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_111_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_111_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_TEST_111_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_TEST_112_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_112_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_112_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_TEST_112_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_CONTACTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_CONTACTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN11_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN11_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN11_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN11_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXPENSE_TEMPLATE_02_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXPENSE_TEMPLATE_02_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXPENSE_TEMPLATE_02_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_2122122_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_2122122_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_2122122_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_212212_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_212212_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_212212_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_21221_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_21221_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_21221_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_21_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_21_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_21_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_3_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_3_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_HOTEL_RESERVATIONS" ADD CONSTRAINT "FK_UR_HOTEL_RESERVATIONS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_INDIGO_L_SQUARE_I_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_I_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_I_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_INDIGO_L_SQUARE_I_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_INDIGO_L_SQUARE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_INDIGO_L_SQUARE_T_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_INTERFACE_LOGS" ADD CONSTRAINT "FK_UR_INTERFACE_LOGS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_YORK_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_YORK_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_YORK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_YORK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS3_YORK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS3_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS3_YORK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS3_YORK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORTS_BI_TRG" ENABLE;',
'',
'  ALTER TABLE "UR_REPORT_DASHBOARDS" ADD CONSTRAINT "FK_UR_REPORTS_HOTEL" FOREIGN KEY ("HOTEL_ID")',
'	  REFERENCES "UR_HOTELS" ("ID") ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := R'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'EGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_TEMPLATES',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST1_22_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST1_22_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST1_22_CHINAR_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST1_22_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_29_SEP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_29_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_29_SEP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_29_SEP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NEWEST_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NEWEST_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NEWEST_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NEWEST_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_NEW_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NO_USC_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NO_USC_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_STACY_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_STACY_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_STACY_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_STACY_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_TEMPLATE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_TEMPLATE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_TEMPLATE_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TT_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TT_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_UR_CHINAR_QUAL_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_UR_CHINAR_QUAL_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_UR_CHINAR_QUAL_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_UR_CHINAR_QUAL_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_USERS_BI_TRG" ',
'FOR INSERT OR UPDATE ON ur_users',
'COMPOUND TRIGGER',
'',
'  BEFORE EACH ROW IS',
'    l_current_user_id UR_USERS.USER_ID%TYPE;',
'  BEGIN',
'    IF INSERTING THEN',
'      -- generate PK if not provided',
'      IF :NEW.user_id IS NULL THEN',
'        :NEW.user_id := SYS_GUID();',
'      END IF;',
'',
'      -- set created_by / updated_by from session package (if available)',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.created_by := l_current_user_id;',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'',
'      -- timestamps (respect any pre-filled created_on)',
'      IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'    END IF;',
'  END BEFORE EACH ROW;',
'',
'END trg_ur_users_bi_trg;',
'/',
'ALTER TRIGGER "TRG_UR_USERS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_3_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_3_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_4_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_4_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_4_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_ATT_QUAL1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_ATT_QUAL1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_ATT_QUAL1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_ATT_QUAL1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_LEAVE_SETUP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_LEAVE_SETUP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_LEAVE_SETUP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_LEAVE_SETUP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_NEW_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_NEW_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_NEW_CHINAR_T_BI_TRG;',
'/',
'ALTER TRIGGER "UR_VK_NEW_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SAMPLE_HOTEL_DATA_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEG1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEG1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEG1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEG1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_TMS_TASK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_TMS_TASK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_TMS_TASK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_TMS_TASK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_YORK_LOS1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_YORK_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_YORK_LOS1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_YORK_LOS1_T_BI_TRG" ENABLE;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_ROOM_TYPES" ON "UR_HOTEL_ROOM_TYPES" ("ROOM_TYPE_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_HOTEL_RES_NUMBER" ON "UR_HOTEL_RESERVATIONS" ("RES_NUMBER") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_KEY" ON "UR_REPORT_DASHBOARDS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_29_SEP_T_PK" ON "UR_TEST_CHINAR_29_SEP_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_NO_USC_NEW_T_PK" ON "UR_TEST_CHINAR_NO_USC_NEW_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_2_T_PK" ON "UR_VK_250915_2_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_4_T_PK" ON "UR_DAILY_BREAKDOWN_VK_4_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_2_T_PK" ON "UR_TEST_CHINAR_2_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_SEGMENT_QUALIFIER2_T_PK" ON "UR_VK_SEGMENT_QUALIFIER2_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UK_UR_ALGO_VERSIONS_ALGO_VERSION" ON "UR_ALGO_VERSIONS" ("ALGO_ID", "VERSION") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_T_PK" ON "UR_DAILY_BREAKDOWN_VK_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_YORK_2_T_SDATE_UQ" ON "UR_LOS1_YORK_2_T" ("SDATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UK_UR_ALGO_ATTRIBUTES_KEY" ON "UR_ALGO_ATTRIBUTES" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_1_T_BOOKING_ID_UQ" ON "UR_TEST_CHINAR_1_T" ("BOOKING_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_3_T_PK" ON "UR_VK_250915_3_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_SEGMENT_QUALIFIER_T_PK" ON "UR_VK_SEGMENT_QUALIFIER_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_INTERFACE_LOGS" ON "UR_INTERFACE_LOGS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_HOTEL_GROUPS_NAME" ON "UR_HOTEL_GROUPS" ("GROUP_NAME") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORTS_KEY" ON "UR_REPORTS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_GROUPS" ON "UR_HOTEL_GROUPS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_NAME" ON "UR_REPORT_DASHBOARDS" ("NAME") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_BHAUMIK_T_STAY_DATE_UQ" ON "UR_BHAUMIK_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_T_PK" ON "UR_EXP_REPORT_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_NEW_CHINAR_T_PK" ON "UR_VK_NEW_CHINAR_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_2_T_BOOKING_ID_UQ" ON "UR_TEST_CHINAR_2_T" ("BOOKING_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_1_T_STAY_DATE_UQ" ON "UR_VK_250915_1_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_2_T_STAY_DATE_UQ" ON "UR_VK_250915_2_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_T_DATE_UQ" ON "UR_LOS1_T" ("DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_STACY_T_PK" ON "UR_TEST_STACY_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_ACCESSES" ON "UR_HOTEL_ACCESSES" ("HOTEL_ID", "USER_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_REPORTS" ON "UR_REPORTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_STAY_DATE_TEMPLATE_T_PK" ON "UR_CHINAR_STAY_DATE_TEMPLATE_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_4_T_STAY_DATE_UQ" ON "UR_VK_250915_4_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGOS" ON "UR_ALGOS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGO_ATTRIBUTES" ON "UR_ALGO_ATTRIBUTES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_ALGOS_CON" ON "UR_ALGOS" ("NAME") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_2122122_T_PK" ON "UR_EXP_REPORT_2122122_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_TEMPLATE_T_PK" ON "UR_TEST_TEMPLATE_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_SAMPLE_HOTEL_DATA_T_PK" ON "UR_VK_SAMPLE_HOTEL_DATA_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_CONTACTS" ON "UR_CONTACTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_PROFILE_OPTIONS_KEY" ON "UR_PROFILE_OPTIONS" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_28_SEP_T_PK" ON "UR_CHINAR_28_SEP_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_T_PK" ON "UR_DAILY_BREAKDOWN_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTELS" ON "UR_HOTELS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_TEMPLATES" ON "UR_TEMPLATES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_22SEPT1_T_PK" ON "UR_CHINAR_22SEPT1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS3_YORK_T_DATE_UQ" ON "UR_LOS3_YORK_T" ("DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_1_T_PK" ON "UR_VK_250915_1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_EVENTS" ON "UR_EVENTS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_USERS" ON "UR_USERS" ("USER_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_YORK_T_PK" ON "UR_LOS1_YORK_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_T_STAY_DATE_UQ" ON "UR_VK_250915_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_HOTEL_RESERVATIONS" ON "UR_HOTEL_RESERVATIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_STAY_DATE_TEMPLATE_T_STAY_DATE_UQ" ON "UR_CHINAR_STAY_DATE_TEMPLATE_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN11_T_PK" ON "UR_DAILY_BREAKDOWN11_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_21_T_PK" ON "UR_EXP_REPORT_21_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_INDIGO_L_SQUARE_T_PK" ON "UR_INDIGO_L_SQUARE_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_SEG1_T_PK" ON "UR_VK_SEG1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_SEGMENT_QUALIFIER1_T_PK" ON "UR_VK_SEGMENT_QUALIFIER1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_ADAM_T_PK" ON "UR_ADAM_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_4_T_PK" ON "UR_VK_250915_4_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_22SEPT_T_PK" ON "UR_CHINAR_22SEPT_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_2_T_PK" ON "UR_DAILY_BREAKDOWN_VK_2_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_29_SEP_T_STAY_UQ" ON "UR_TEST_CHINAR_29_SEP_T" ("STAY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_NEWEST_T_PK" ON "UR_TEST_CHINAR_NEWEST_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_ATT_QUAL1_T_PK" ON "UR_VK_ATT_QUAL1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_REPORT_DASHBOARDS" ON "UR_REPORT_DASHBOARDS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_TEMPLATES_KEY" ON "UR_TEMPLATES" ("KEY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_TEST_111_T_PK" ON "UR_CHINAR_TEST_111_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST1_22_CHINAR_T_PK" ON "UR_TEST1_22_CHINAR_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_250915_T_PK" ON "UR_VK_250915_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_YORK_LOS1_T_PK" ON "UR_YORK_LOS1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_3_T_PK" ON "UR_EXP_REPORT_3_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_1_T_PK" ON "UR_TEST_CHINAR_1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_TMS_TASK_T_PK" ON "UR_VK_TMS_TASK_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_ADDRESSES" ON "UR_ADDRESSES" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_BHAUMIK_T_PK" ON "UR_BHAUMIK_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_28_SEP_T_STAY_UQ" ON "UR_CHINAR_28_SEP_T" ("STAY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS3_YORK_T_PK" ON "UR_LOS3_YORK_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_UR_CHINAR_QUAL_T_PK" ON "UR_UR_CHINAR_QUAL_T" ("REC_ID") ',
'  ;',
'',
'  CR'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'EATE UNIQUE INDEX "UR_TEST_CHINAR_T_PK" ON "UR_TEST_CHINAR_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_YORK_T_DATE_UQ" ON "UR_LOS1_YORK_T" ("DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_ATT_QUAL1_T_RNS__OTB__UQ" ON "UR_VK_ATT_QUAL1_T" ("RNS__OTB_") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_LEAVE_SETUP_T_PK" ON "UR_VK_LEAVE_SETUP_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_REPORT_DASHBOARDS_HOTEL_ID" ON "UR_REPORT_DASHBOARDS" ("HOTEL_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_T_PK" ON "UR_LOS1_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_3_T_RNS__OTB__UQ" ON "UR_DAILY_BREAKDOWN_VK_3_T" ("RNS__OTB_") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_LOS1_YORK_2_T_PK" ON "UR_LOS1_YORK_2_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TT_T_PK" ON "UR_TT_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_YORK_LOS1_T_DATE_UQ" ON "UR_YORK_LOS1_T" ("DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_22SEPT_T_STAY_DATE_UQ" ON "UR_CHINAR_22SEPT_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_212212_T_PK" ON "UR_EXP_REPORT_212212_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXP_REPORT_21221_T_PK" ON "UR_EXP_REPORT_21221_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_3_T_PK" ON "UR_DAILY_BREAKDOWN_VK_3_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_VK_NEW_CHINAR_T_STAY_DATE_UQ" ON "UR_VK_NEW_CHINAR_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_TEMP_BLOB" ON "TEMP_BLOB" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_EXPENSE_TEMPLATE_02_T_PK" ON "UR_EXPENSE_TEMPLATE_02_T" ("ROW_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_TEST_CHINAR_NO_USC_T_PK" ON "UR_TEST_CHINAR_NO_USC_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_ALGO_VERSIONS" ON "UR_ALGO_VERSIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_INDIGO_L_SQUARE_I_T_PK" ON "UR_INDIGO_L_SQUARE_I_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "PK_UR_PROFILE_OPTIONS" ON "UR_PROFILE_OPTIONS" ("ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UQ_UR_USERS_EMAIL" ON "UR_USERS" ("EMAIL") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_TEST_112_T_PK" ON "UR_CHINAR_TEST_112_T" ("REC_ID") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_UR_CHINAR_QUAL_T_STAY_UQ" ON "UR_UR_CHINAR_QUAL_T" ("STAY") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_CHINAR_TEST_112_T_STAY_DATE_UQ" ON "UR_CHINAR_TEST_112_T" ("STAY_DATE") ',
'  ;',
'',
'  CREATE UNIQUE INDEX "UR_DAILY_BREAKDOWN_VK_2_T_RNS__OTB__UQ" ON "UR_DAILY_BREAKDOWN_VK_2_T" ("RNS__OTB_") ',
'  ;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PACKAGE Graph_SQL AS',
'  PROCEDURE proc_crud_json(',
'    p_mode      IN VARCHAR2,    -- C=Create, U=Update, D=Delete, F=Fetch metadata',
'    p_table     IN VARCHAR2,    -- Table name (must be in user''s schema)',
'    p_payload   IN CLOB,        -- JSON payload string',
'    p_debug     IN VARCHAR2 DEFAULT ''N'', -- ''Y'' or ''N''',
'    p_status    OUT VARCHAR2,   -- S=Success, E=Error',
'    p_message   OUT CLOB,       -- Message or JSON (for Fetch mode)',
unistr('    p_icon      OUT VARCHAR2,   -- \2705 added: icon type (success, error, info, warning\2026)'),
unistr('    p_title     OUT VARCHAR2    -- \2705 added: alert title (Success!, Update Failed, etc.)'),
'  );',
'',
'END graph_SQL;',
'/',
'create or replace PACKAGE pkg_generic_crud AS',
'  PROCEDURE proc_crud_json(',
'    p_mode      IN VARCHAR2,    -- C=Create, U=Update, D=Delete, F=Fetch metadata',
'    p_table     IN VARCHAR2,    -- Table name (must be in user''s schema)',
'    p_payload   IN CLOB,        -- JSON payload string',
'    p_debug     IN VARCHAR2 DEFAULT ''N'', -- ''Y'' or ''N''',
'    p_status    OUT VARCHAR2,   -- S=Success, E=Error',
'    p_message   OUT CLOB,       -- Message or JSON (for Fetch mode)',
unistr('    p_icon      OUT VARCHAR2,   -- \2705 added: icon type (success, error, info, warning\2026)'),
unistr('    p_title     OUT VARCHAR2    -- \2705 added: alert title (Success!, Update Failed, etc.)'),
'  );',
'',
'END pkg_generic_crud;',
'/',
'create or replace PACKAGE ur_utils IS',
'',
'  -- Modified get_collection_json procedure (returns JSON plus status/message)',
'  PROCEDURE get_collection_json(',
'    p_collection_name IN VARCHAR2,',
'    p_json_clob OUT CLOB,',
'    p_status OUT VARCHAR2,',
'    p_message OUT VARCHAR2',
'  );',
'  ',
'  PROCEDURE POPULATE_ERROR_COLLECTION_FROM_LOG (',
'    p_interface_log_id IN  UR_INTERFACE_LOGS.ID%TYPE,',
'    p_collection_name  IN  VARCHAR2,',
'    p_status           OUT VARCHAR2,',
'    p_message          OUT VARCHAR2',
'    );',
'',
'  PROCEDURE VALIDATE_TEMPLATE_DEFINITION (',
'      p_json_clob   IN            CLOB,',
'      p_alert_clob  IN OUT NOCOPY CLOB,',
'      p_status      OUT           VARCHAR2',
'  );',
'  ',
'  FUNCTION GET_ATTRIBUTE_VALUE (',
'    p_attribute_id    IN  RAW       DEFAULT NULL,',
'    p_attribute_key   IN  VARCHAR2  DEFAULT NULL,',
'    p_hotel_id        IN  RAW       DEFAULT NULL,',
'    p_stay_date       IN  DATE      DEFAULT NULL,',
'    p_round_digits    IN  NUMBER    DEFAULT 2',
'  ) RETURN UR_attribute_value_table PIPELINED;',
'',
'  PROCEDURE GET_ATTRIBUTE_VALUE (',
'    p_attribute_id    IN  RAW       DEFAULT NULL,',
'    p_attribute_key   IN  VARCHAR2  DEFAULT NULL,',
'    p_hotel_id        IN  RAW       DEFAULT NULL,',
'    p_stay_date       IN  DATE      DEFAULT NULL,',
'    p_round_digits    IN  NUMBER    DEFAULT 2,',
'    p_debug_flag      IN  BOOLEAN   DEFAULT FALSE,',
'    p_response_clob   OUT CLOB',
'  );',
'',
'  PROCEDURE manage_algo_attributes(',
'    p_template_key   IN  VARCHAR2,',
'    p_mode           IN  CHAR,',
'    p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'    p_status         OUT BOOLEAN,',
'    p_message        OUT VARCHAR2',
'  );',
'',
'    procedure add_alert(',
'        p_existing_json   IN  CLOB,',
'        p_message         IN  VARCHAR2,',
'        p_icon            IN  VARCHAR2 DEFAULT NULL,',
'        p_title           IN  VARCHAR2 DEFAULT NULL,',
'        p_timeOut         IN  NUMBER   DEFAULT NULL,',
'        p_updated_json    OUT CLOB',
'    );',
'  PROCEDURE define_db_object(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2,',
'    p_mode         IN  VARCHAR2 DEFAULT ''N''',
'  );',
'',
'  PROCEDURE create_ranking_view(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
');',
'',
'  PROCEDURE LOAD_DATA_MAPPING_COLLECTION (',
'    p_file_id         IN  VARCHAR2,',
'    p_template_id     IN  VARCHAR2,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT VARCHAR2,',
'    p_message         OUT VARCHAR2',
'  );',
'  ',
'  FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2;',
'',
'  PROCEDURE Load_Data (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT boolean,',
'    p_message         OUT VARCHAR2);',
'    ',
'  PROCEDURE fetch_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
'  );',
'',
'    PROCEDURE DELETE_TEMPLATES (',
'    p_id           IN VARCHAR2 DEFAULT NULL,',
'    p_hotel_id     IN VARCHAR2 DEFAULT NULL,',
'    p_key          IN VARCHAR2 DEFAULT NULL,',
'    p_name         IN VARCHAR2 DEFAULT NULL,',
'    p_type         IN VARCHAR2 DEFAULT NULL,',
'    p_active       IN CHAR DEFAULT NULL,',
'    p_db_obj_empty IN CHAR DEFAULT NULL,',
'    p_delete_all   IN CHAR DEFAULT ''N'',',
'    p_debug        IN CHAR DEFAULT ''N'',',
'    p_json_output  OUT CLOB',
'  );',
'',
'  FUNCTION normalize_json (p_json CLOB) RETURN CLOB; ',
'',
'  PROCEDURE validate_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode       IN CHAR,',
'    p_hotel_id   IN VARCHAR2,',
'    p_status     OUT VARCHAR2,  -- ''S'' for success, ''E'' for error',
'    p_message    OUT VARCHAR2',
'  );',
'',
'END ur_utils;',
'/',
'create or replace PACKAGE ur_utils_test IS',
'',
'  -- Modified get_collection_json procedure (returns JSON plus status/message)',
'  PROCEDURE get_collection_json(',
'    p_collection_name IN VARCHAR2,',
'    p_json_clob OUT CLOB,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  );',
'',
'  PROCEDURE manage_algo_attributes(',
'    p_template_key   IN  VARCHAR2,',
'    p_mode           IN  CHAR,',
'    p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'    p_status         OUT BOOLEAN,',
'    p_message        OUT VARCHAR2',
'  );',
'',
'    procedure add_alert(',
'        p_existing_json   IN  CLOB,',
'        p_message         IN  VARCHAR2,',
'        p_icon            IN  VARCHAR2 DEFAULT NULL,',
'        p_title           IN  VARCHAR2 DEFAULT NULL,',
'        p_timeOut         IN  NUMBER   DEFAULT NULL,',
'        p_updated_json    OUT CLOB',
'    );',
'  PROCEDURE define_db_object(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  );',
'',
'  PROCEDURE LOAD_DATA_MAPPING_COLLECTION (',
'    p_file_id         IN  VARCHAR2,',
'    p_template_id     IN  VARCHAR2,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT VARCHAR2,',
'    p_message         OUT VARCHAR2',
'  );',
'  ',
'  FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2;',
'',
'  PROCEDURE Load_Data (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT boolean,',
'    p_message         OUT VARCHAR2);',
'    ',
'  PROCEDURE fetch_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
'  );',
'',
'    PROCEDURE DELETE_TEMPLATES (',
'    p_id           IN VARCHAR2 DEFAULT NULL,',
'    p_hotel_id     IN VARCHAR2 DEFAULT NULL,',
'    p_key          IN VARCHAR2 DEFAULT NULL,',
'    p_name         IN VARCHAR2 DEFAULT NULL,',
'    p_type         IN VARCHAR2 DEFAULT NULL,',
'    p_active       IN CHAR DEFAULT NULL,',
'    p_db_obj_empty IN CHAR DEFAULT NULL,',
'    p_delete_all   IN CHAR DEFAULT ''N'',',
'    p_debug        IN CHAR DEFAULT ''N'',',
'    p_json_output  OUT CLOB',
'  );',
'',
'  FUNCTION normalize_json (p_json CLOB) RETURN CLOB; ',
'',
'  PROCEDURE validate_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode       IN CHAR,',
'    p_hotel_id   IN VARCHAR2,',
'    p_status     OUT VARCHAR2,  -- ''S'' for success, ''E'' for error',
'    p_message    OUT VARCHAR2',
'  );',
'',
'END ur_utils_test;',
'/',
'create or replace PACKAGE ur_utils_test_1 IS',
'',
'  -- Modified get_collection_json procedure (returns JSON plus status/message)',
'  PROCEDURE get_collection_json(',
'    p_collection_name IN VARCHAR2,',
'    p_json_clob OUT CLOB,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  );',
'',
'  PROCEDURE manage_algo_attributes(',
'    p_template_key   IN  VARCHAR2,',
'    p_mode           IN  CHAR,',
'    p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'    p_status         OUT BOOLEAN,',
'    p_message        OUT VARCHAR2',
'  );',
'',
'    procedure add_alert(',
'        p_existing_json   IN  CLOB,',
'        p_message         IN  VARCHAR2,',
'        p_icon            IN  VARCHAR2 DEFAULT NULL,',
'        p_title           IN  VARCHAR2 DEFAULT NULL,',
'        p_timeOut         IN  NUMBER   DEFAULT NULL,',
'        p_updated_json    OUT CLOB',
'    );',
'  PROCEDURE define_db_object(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  );',
'',
'  PROCEDURE LOAD_DATA_MAPPING_COLLECTION (',
'    p_file_id         IN  VARCHAR2,',
'    p_template_id     IN  VARCHAR2,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT VARCHAR2,',
'    p_message         OUT VARCHAR2',
'  );',
'  ',
'  FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2;',
'',
'  PROCEDURE Load_Data (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT boolean,',
'    p_message         OUT VARCHAR2);',
'    ',
'  PROCEDURE fetch_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
'  );',
'',
'    PROCEDURE DELETE_TEMPLATES (',
'    p_id           IN VARCHAR2 DEFAULT NULL,',
'    p_hotel_id     IN VARCHAR2 DEFAULT NULL,',
'    p_key          IN VARCHAR2 DEFAULT NULL,',
'    p_name         IN VARCHAR2 DEFAULT NULL,',
'    p_type         IN VARCHAR2 DEFAULT NULL,',
'    p_active       IN CHAR DEFAULT NULL,',
'    p_db_obj_empty IN CHAR DEFAULT NULL,',
'    p_delete_all   IN CHAR DEFAULT ''N'',',
'    p_debug        IN CHAR DEFAULT ''N'',',
'    p_json_output  OUT CLOB',
'  );',
'',
'  FUNCTION normalize_json (p_json CLOB) RETURN CLOB; ',
'',
'  PROCEDURE validate_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode       IN CHAR,',
'    p_hotel_id   IN VARCHAR2,',
'    p_status     OUT VARCHAR2,  -- ''S'' for success, ''E'' for error',
'    p_message    OUT VARCHAR2',
'  );',
'',
'END ur_utils_test_1;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PROCEDURE call_ai_chat_completion (',
'    p_system_msg  IN VARCHAR2,',
'    p_user_prompt IN CLOB,           -- JSON format string, e.g. ''{"text": "Hello"}''',
'    p_model_id    IN VARCHAR2,',
'    p_web_cred    IN VARCHAR2,',
'    p_completion  OUT CLOB,',
'    p_token_count OUT NUMBER',
') IS',
'    l_http_request   UTL_HTTP.req;',
'    l_http_response  UTL_HTTP.resp;',
'    l_response_text  CLOB;',
'    ',
'    l_url           VARCHAR2(4000) := ''https://api.openai.com/v1/chat/completions'';',
'    l_api_key       VARCHAR2(4000);',
'    ',
'    l_body_json     CLOB;',
'    l_msg_array     JSON_ARRAY_T;',
'    l_payload       JSON_OBJECT_T;',
'    ',
'    l_json_response JSON_OBJECT_T;',
'    l_choices       JSON_ARRAY_T;',
'    l_usage         JSON_OBJECT_T;',
'    ',
'    -- to read chunks from response',
'    l_buffer        VARCHAR2(32767);',
'BEGIN',
'    -- Retrieve API key from APEX Web Credential (which securely stores API Key as Password)',
'    l_api_key := APEX_WEB_CREDENTIAL.GET_PASSWORD(p_web_cred);',
'',
'    -- Compose the messages array (with system and user message)',
'    l_msg_array := JSON_ARRAY_T();',
'    l_msg_array.APPEND(JSON_OBJECT_T(''role'' VALUE ''system'', ''content'' VALUE p_system_msg));',
'    l_msg_array.APPEND(JSON_OBJECT_T(''role'' VALUE ''user'', ''content'' VALUE l_user_message));',
'    -- user prompt is passed as JSON string (already JSON formatted)',
'    -- Assume p_user_prompt is JSON string representing message object(s),',
'',
'    -- We''ll parse p_user_prompt as JSON to get user message(s)',
'    -- Two options:',
'    -- - if p_user_prompt is a single message string (just text), wrap it',
'    -- - if p_user_prompt is JSON array or JSON object representing messages, append all',
'',
'    -- For flexibility, let''s assume p_user_prompt is JSON string representing user message text, simple.',
'',
'    -- Alternative: If user prompt is a JSON object with {"text": "..."} then:',
'    DECLARE',
'        l_user_msg JSON_OBJECT_T;',
'    BEGIN',
'        l_user_msg := JSON_OBJECT_T.parse(p_user_prompt);',
'        l_msg_array.APPEND(JSON_OBJECT_T(''role'' VALUE ''user'', ''content'' VALUE l_user_msg.get_String(''text'')));',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'          -- fallback: treat p_user_prompt as plain text',
'          l_msg_array.APPEND(JSON_OBJECT_T(''role'' VALUE ''user'' VALUE p_user_prompt));',
'    END;',
'',
'    -- Build payload JSON object',
'    l_payload := JSON_OBJECT_T();',
'    l_payload.put(''model'', p_model_id);',
'    l_payload.put(''messages'', l_msg_array);',
'    ',
'    -- Convert l_payload to clob',
'    l_body_json := l_payload.to_clob;',
'',
'    -- Prepare HTTPS request',
'    l_http_request := UTL_HTTP.begin_request(',
'        url => l_url,',
'        method => ''POST'',',
'        http_version => ''HTTP/1.1''',
'    );',
'',
'    -- Set headers',
'    UTL_HTTP.set_header(l_http_request, ''Content-Type'', ''application/json'');',
'    UTL_HTTP.set_header(l_http_request, ''Authorization'', ''Bearer '' || l_api_key);',
'',
'    -- Write payload',
'    UTL_HTTP.write_text(l_http_request, l_body_json);',
'',
'    -- Get Response',
'    l_http_response := UTL_HTTP.get_response(l_http_request);',
'',
'    l_response_text := EMPTY_CLOB();',
'    DBMS_LOB.createtemporary(l_response_text, TRUE);',
'',
'    BEGIN',
'        LOOP',
'            UTL_HTTP.read_text(l_http_response, l_buffer, 32767);',
'            DBMS_LOB.writeappend(l_response_text, LENGTH(l_buffer), l_buffer);',
'        END LOOP;',
'    EXCEPTION',
'        WHEN UTL_HTTP.END_OF_BODY THEN',
'            NULL;',
'    END;',
'    UTL_HTTP.end_response(l_http_response);',
'',
'    -- Parse JSON response',
'    l_json_response := JSON_OBJECT_T.parse(l_response_text);',
'',
'    -- Get completion text (first choice)',
'    l_choices := l_json_response.get_Array(''choices'');',
'    IF l_choices.COUNT > 0 THEN',
'        p_completion := l_choices.get_Object(1).get_String(''message'').get_String(''content'');',
'    ELSE',
'        p_completion := NULL;',
'    END IF;',
'',
'    -- Get token count from usage',
'    l_usage := l_json_response.get_Object(''usage'');',
'    IF l_usage IS NOT NULL THEN',
'        p_token_count := l_usage.get_Number(''total_tokens'');',
'    ELSE',
'        p_token_count := NULL;',
'    END IF;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        -- Return error message in output variable',
'        p_completion := ''Error: '' || SQLERRM;',
'        p_token_count := NULL;',
'END call_openai_chat_completion;',
'/',
'create or replace PROCEDURE call_openai_chat_completion (',
'    p_system_msg IN VARCHAR2,',
'    p_user_msg   IN VARCHAR2,',
'    p_result     OUT CLOB',
') AS',
'    l_url      VARCHAR2(32767) := ''https://api.openai.com/v1/chat/completions'';',
'    l_body     CLOB;',
'    l_response CLOB;',
'    l_api_key  VARCHAR2(4000);',
'BEGIN',
'    -- Get API key from application item',
'    l_api_key := ''xsdcsdfsdf'';',
'',
'    -- Build JSON request body',
'    l_body := json_object(',
'                 ''model'' VALUE ''gpt-4o-mini'',',
'                 ''messages'' VALUE json_array(',
'                     json_object(''role'' VALUE ''system'', ''content'' VALUE p_system_msg),',
'                     json_object(''role'' VALUE ''user'',   ''content'' VALUE p_user_msg)',
'                 )',
'              );',
'',
'    -- Call API',
'    l_response := apex_web_service.make_rest_request(',
'        p_url         => l_url,',
'        p_http_method => ''POST'',',
'        p_body        => l_body,',
'        p_http_headers => apex_t_varchar2(',
'                              ''Content-Type'', ''application/json'',',
'                              ''Authorization'', ''Bearer '' || l_api_key',
'                          )',
'    );',
'',
'    -- Parse the response',
'    SELECT json_value(l_response, ''$.choices[0].message.content'')',
'      INTO p_result',
'      FROM dual;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_result := ''Error: '' || SQLERRM;',
'END call_openai_chat_completion;',
'/',
'create or replace PROCEDURE DELETE_TEMPLATES_AND_DB_OBJECTS_JSON (',
'  p_id            IN VARCHAR2 DEFAULT NULL,',
'  p_hotel_id      IN VARCHAR2 DEFAULT NULL,',
'  p_key           IN VARCHAR2 DEFAULT NULL,',
'  p_name          IN VARCHAR2 DEFAULT NULL,',
'  p_type          IN VARCHAR2 DEFAULT NULL,',
'  p_active        IN CHAR DEFAULT NULL,           -- ''Y'' or ''N''',
'  p_db_obj_empty  IN CHAR DEFAULT NULL,           -- ''Y'' = only if table is empty, else skip',
'  p_delete_all    IN CHAR DEFAULT ''N'',            -- ''Y'' to delete EVERYTHING',
'  p_debug         IN CHAR DEFAULT ''N'',            -- ''Y'' to log debug messages to APEX debug',
'  p_json_output   OUT CLOB',
')',
'AS',
'  v_sql            VARCHAR2(1000);',
'  v_rows_count     NUMBER;',
'  v_status         CHAR(1);',
'  v_message        VARCHAR2(4000);',
'  v_json_list      CLOB := ''['';',
'  v_first          BOOLEAN := TRUE;',
'  v_tmp_json       CLOB;',
'',
'  CURSOR c_templates IS',
'    SELECT id, hotel_id, key, name, type, active, db_object_name',
'    FROM ur_templates',
'    WHERE (p_delete_all = ''Y''',
'          OR (p_id IS NULL OR id = p_id))',
'      AND (p_delete_all = ''Y''',
'           OR (p_hotel_id IS NULL OR hotel_id = p_hotel_id))',
'      AND (p_delete_all = ''Y''',
'           OR (p_key IS NULL OR key = p_key))',
'      AND (p_delete_all = ''Y''',
'           OR (p_name IS NULL OR name = p_name))',
'      AND (p_delete_all = ''Y''',
'           OR (p_type IS NULL OR type = p_type))',
'      AND (p_delete_all = ''Y''',
'           OR (p_active IS NULL OR active = p_active));',
'           ',
'  -- Helper to escape JSON strings - simple version; improves safety',
'  FUNCTION json_escape(str IN VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN REPLACE(REPLACE(REPLACE(REPLACE(str, ''\'', ''\\''), ''"'', ''\"''), CHR(10), ''\n''), CHR(13), '''');',
'  EXCEPTION WHEN OTHERS THEN',
'    RETURN '''';',
'  END;',
'',
'  PROCEDURE dbg(p_msg VARCHAR2) IS',
'  BEGIN',
'    IF p_debug = ''Y'' THEN',
'      apex_debug.message(p_msg);',
'    END IF;',
'  END;',
'',
'  PROCEDURE append_result (',
'    p_id            IN VARCHAR2,',
'    p_hotel_id      IN VARCHAR2,',
'    p_key           IN VARCHAR2,',
'    p_name          IN VARCHAR2,',
'    p_type          IN VARCHAR2,',
'    p_active        IN CHAR,',
'    p_db_obj_name   IN VARCHAR2,',
'    p_status        IN CHAR,',
'    p_message       IN VARCHAR2',
'  ) IS',
'  BEGIN',
'    IF v_first THEN',
'      v_first := FALSE;',
'    ELSE',
'      v_json_list := v_json_list || '','';',
'    END IF;',
'',
'    v_json_list := v_json_list || ''{'' ||',
'      ''"id":"''          || json_escape(p_id)          || ''",'' ||',
'      ''"hotel_id":"''    || json_escape(p_hotel_id)    || ''",'' ||',
'      ''"key":"''         || json_escape(p_key)         || ''",'' ||',
'      ''"name":"''        || json_escape(p_name)        || ''",'' ||',
'      ''"type":"''        || json_escape(p_type)        || ''",'' ||',
'      ''"active":"''      || json_escape(p_active)      || ''",'' ||',
'      ''"db_object_name":"'' || json_escape(p_db_obj_name) || ''",'' ||',
'      ''"status":"''      || json_escape(p_status)      || ''",'' ||',
'      ''"message":"''     || json_escape(p_message)     || ''"'' ||',
'    ''}'';',
'  END;',
'BEGIN',
'  dbg(''Started DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'',
'  FOR rec IN c_templates LOOP',
'    dbg(''Processing template ID='' || rec.id || '', DB_OBJECT_NAME='' || rec.db_object_name);',
'',
'    IF rec.db_object_name IS NULL THEN',
'      v_status := ''E'';',
'      v_message := ''No DB_OBJECT_NAME specified for template, skipping.'';',
'      dbg(v_message);',
'      append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, NULL, v_status, v_message);',
'      CONTINUE;',
'    END IF;',
'',
'    -- -- Check if table exists in user schema',
'    -- SELECT COUNT(*)',
'    --   INTO v_rows_count',
'    --   FROM all_tables',
'    --  WHERE table_name = rec.db_object_name',
'    --    AND owner = USER;',
'',
'    -- IF v_rows_count = 0 THEN',
'    --   v_status := ''E'';',
'    --   v_message := ''DB Object ['' || rec.db_object_name || ''] does not exist or is not a table.'';',
'    --   dbg(v_message);',
'    --   append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    --   CONTINUE;',
'    -- END IF;',
'',
'    -- Check if table should be empty before deleting',
'    IF p_db_obj_empty = ''Y'' THEN',
'      v_sql := ''SELECT COUNT(*) FROM '' || rec.db_object_name;',
'      BEGIN',
'        EXECUTE IMMEDIATE v_sql INTO v_rows_count;',
'      EXCEPTION',
'        WHEN OTHERS THEN',
'          v_rows_count := -1; -- can''t count, treat as error or non-empty',
'      END;',
'',
'      IF v_rows_count > 0 THEN',
'        v_status := ''E'';',
'        v_message := ''DB Object table ['' || rec.db_object_name || ''] is not empty (ROWS='' || v_rows_count || ''), skipping deletion.'';',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'        CONTINUE;',
'      END IF;',
'      dbg(''DB Object table ['' || rec.db_object_name || ''] is empty, proceeding.'');',
'    END IF;',
'',
'    -- Try to drop the table and delete template',
'    BEGIN',
'      v_sql := ''DROP TABLE '' || rec.db_object_name || '' CASCADE CONSTRAINTS'';',
'      dbg(''Executing: '' || v_sql);',
'      EXECUTE IMMEDIATE v_sql;',
'',
'      dbg(''Dropped table '' || rec.db_object_name);',
'',
'      DELETE FROM ur_templates WHERE id = rec.id;',
'',
'      dbg(''Deleted template id='' || rec.id);',
'',
'      v_status := ''S'';',
'      v_message := ''Successfully dropped table and deleted template.'';',
'      append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'',
'    EXCEPTION',
'      WHEN OTHERS THEN',
'        v_status := ''E'';',
'        v_message := ''Error dropping table or deleting template: '' || SQLERRM;',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    END;',
'  END LOOP;',
'',
'  v_json_list := v_json_list || '']'';',
'',
'  p_json_output := v_json_list;',
'',
'  dbg(''Completed DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'END DELETE_TEMPLATES_AND_DB_OBJECTS_JSON;',
'/',
'create or replace PROCEDURE generic_crud_proc (',
'  p_mode      IN VARCHAR2,',
'  p_table     IN VARCHAR2,',
'  p_payload   IN CLOB,',
'  p_debug     IN VARCHAR2 DEFAULT ''N'',',
'  p_status    OUT VARCHAR2,',
'  p_message   OUT CLOB',
') IS',
'  -- Types for column metadata',
'  TYPE t_col_rec IS RECORD (',
'    column_name  VARCHAR2(100),',
'    data_type    VARCHAR2(30),',
'    nullable     CHAR(1)',
'  );',
'  TYPE t_col_tab IS TABLE OF t_col_rec INDEX BY PLS_INTEGER;',
'',
'  v_columns     t_col_tab;',
'  v_pk_cols     SYS.ODCIVARCHAR2LIST;',
'',
'  v_col_cnt     PLS_INTEGER := 0;',
'  v_pk_cnt      PLS_INTEGER := 0;',
'',
'  v_json_obj    JSON_OBJECT_T;',
'  v_sql         CLOB;',
'  v_cursor      INTEGER DEFAULT DBMS_SQL.OPEN_CURSOR;',
'  v_col_value_varchar   VARCHAR2(4000);',
'  v_col_value_number    NUMBER;',
'  v_col_value_date      DATE;',
'  v_col_value_raw       RAW(16);',
'',
'  v_bind_idx    INTEGER;',
'  v_col_meta    t_col_rec;',
'',
'  v_missing     SYS.ODCIVARCHAR2LIST := SYS.ODCIVARCHAR2LIST();',
'  v_err_msg     VARCHAR2(4000);',
'',
'  PROCEDURE log_debug(p_msg VARCHAR2) IS',
'  BEGIN',
'    IF UPPER(p_debug) = ''Y'' THEN',
'      BEGIN',
'        APEX_DEBUG.MESSAGE(''DEBUG: '' || p_msg);',
'      EXCEPTION WHEN OTHERS THEN',
'        DBMS_OUTPUT.PUT_LINE(''DEBUG: '' || p_msg);',
'      END;',
'    END IF;',
'  END;',
'',
'  FUNCTION hex_to_raw16(hexstr VARCHAR2) RETURN RAW IS',
'  BEGIN',
'    IF LENGTH(hexstr) = 32 THEN',
'      RETURN HEXTORAW(hexstr);',
'    ELSE',
'      RETURN NULL;',
'    END IF;',
'  END;',
'',
'  -- Utility to validate mandatory columns present in JSON',
'PROCEDURE validate_mandatory_cols IS',
'BEGIN',
'  FOR i IN 1 .. v_col_cnt LOOP',
'    IF v_columns(i).nullable = ''N'' THEN',
'      IF NOT v_json_obj.has(v_columns(i).column_name) THEN',
'        v_missing.EXTEND;',
'        v_missing(v_missing.COUNT) := v_columns(i).column_name;',
'      END IF;',
'    END IF;',
'  END LOOP;',
'',
'  IF v_missing.COUNT > 0 THEN',
'    DECLARE',
'      v_list_str VARCHAR2(4000);',
'    BEGIN',
'      SELECT LISTAGG(column_value, '', '') WITHIN GROUP (ORDER BY column_value)',
'        INTO v_list_str',
'        FROM TABLE(v_missing);',
'      v_err_msg := ''Mandatory columns missing: '' || v_list_str;',
'    END;',
'    RAISE_APPLICATION_ERROR(-20001, v_err_msg);',
'  END IF;',
'END;',
'',
'  -- Utility to fetch column metadata dynamically',
'  PROCEDURE load_metadata IS',
'  BEGIN',
'    SELECT column_name, data_type, nullable',
'      BULK COLLECT INTO v_columns',
'      FROM all_tab_columns',
'     WHERE table_name = UPPER(p_table)',
'       AND owner = USER',
'     ORDER BY column_id;',
'',
'    IF v_columns.COUNT = 0 THEN',
'      v_err_msg := ''Table "'' || p_table || ''" does not exist or no columns found.'';',
'      RAISE_APPLICATION_ERROR(-20002, v_err_msg);',
'    END IF;',
'',
'    SELECT acc.column_name',
'      BULK COLLECT INTO v_pk_cols',
'      FROM all_constraints ac',
'      JOIN all_cons_columns acc ON ac.constraint_name = acc.constraint_name AND ac.owner = acc.owner',
'     WHERE ac.constraint_type = ''P''',
'       AND ac.table_name = UPPER(p_table)',
'       AND ac.owner = USER',
'     ORDER BY acc.position;',
'',
'    v_col_cnt := v_columns.COUNT;',
'    v_pk_cnt := v_pk_cols.COUNT;',
'  END;',
'',
'  -- Procedure to generate sample payloads JSON (for F mode)',
'  FUNCTION sample_payload_json RETURN CLOB IS',
'    v_json JSON_OBJECT_T := JSON_OBJECT_T();',
'    v_sample_create JSON_OBJECT_T := JSON_OBJECT_T();',
'    v_sample_update JSON_OBJECT_T := JSON_OBJECT_T();',
'    v_sample_delete JSON_OBJECT_T := JSON_OBJECT_T();',
'  BEGIN',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      IF v_columns(i).data_type LIKE ''VARCHAR2%'' THEN',
'        v_sample_create.put(v_columns(i).column_name, v_columns(i).column_name || ''_sample'');',
'        v_sample_update.put(v_columns(i).column_name, v_columns(i).column_name || ''_updated'');',
'      ELSIF v_columns(i).data_type LIKE ''NUMBER%'' THEN',
'        v_sample_create.put(v_columns(i).column_name, 123);',
'        v_sample_update.put(v_columns(i).column_name, 456);',
'      ELSIF v_columns(i).data_type LIKE ''DATE%'' THEN',
'        v_sample_create.put(v_columns(i).column_name, TO_CHAR(SYSDATE, ''YYYY-MM-DD"T"HH24:MI:SS''));',
'        v_sample_update.put(v_columns(i).column_name, TO_CHAR(SYSDATE+1, ''YYYY-MM-DD"T"HH24:MI:SS''));',
'      ELSIF v_columns(i).data_type = ''RAW'' THEN',
'        -- UUID as 32 char hex string',
'        v_sample_create.put(v_columns(i).column_name, ''A1B2C3D4E5F60718293A4B5C6D7E8F90'');',
'        v_sample_update.put(v_columns(i).column_name, ''F0E8D7C6B5A4938271607F5E4D3C2B1A'');',
'      END IF;',
'    END LOOP;',
'    -- For delete and update PK columns required:',
'    FOR i IN 1 .. v_pk_cnt LOOP',
'      v_sample_delete.put(v_pk_cols(i), ''A1B2C3D4E5F60718293A4B5C6D7E8F90'');',
'      v_sample_update.put(v_pk_cols(i), ''A1B2C3D4E5F60718293A4B5C6D7E8F90'');',
'    END LOOP;',
'',
'    v_json.put(''table_name'', p_table);',
'    v_json.put(''columns'', JSON_ARRAY_T());',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      DECLARE',
'        v_col_obj JSON_OBJECT_T := JSON_OBJECT_T();',
'      BEGIN',
'        v_col_obj.put(''column_name'', v_columns(i).column_name);',
'        v_col_obj.put(''data_type'', v_columns(i).data_type);',
'        v_col_obj.put(''nullable'', v_columns(i).nullable);',
'        v_col_obj.put(''sample_value'', v_sample_create.get(v_columns(i).column_name));',
'        v_json.get_Array(''columns'').append(v_col_obj);',
'      END;',
'    END LOOP;',
'',
'    v_json.put(''sample_create_payload'', v_sample_create);',
'    v_json.put(''sample_update_payload'', v_sample_update);',
'    v_json.put(''sample_delete_payload'', v_sample_delete);',
'',
'    RETURN v_json.to_clob;',
'  END;',
'',
'BEGIN',
'  p_status := ''E'';',
'  p_message := NULL;',
'',
'  log_debug(''Starting procedure for mode='' || p_mode || '', table='' || p_table);',
'',
'  -- Validate mode input',
'  IF p_mode NOT IN (''C'',''U'',''D'',''F'') THEN',
'    p_message := ''Invalid mode. Allowed values: C (Create), U (Update), D (Delete), F (Fetch metadata).'';',
'    RETURN;',
'  END IF;',
'',
'  -- Load table metadata',
'  load_metadata;',
'  log_debug(''Metadata loaded: '' || v_col_cnt || '' columns, '' || v_pk_cnt || '' primary key columns.'');',
'',
'  IF p_mode = ''F'' THEN',
'    -- Return metadata JSON and sample payloads',
'    p_message := sample_payload_json;',
'    p'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'_status := ''S'';',
'    RETURN;',
'  END IF;',
'',
'  -- Parse JSON payload',
'  v_json_obj := JSON_OBJECT_T.parse(p_payload);',
'  log_debug(''Payload parsed.'');',
'',
'  -- Validate mandatory columns if C or U',
'  IF p_mode IN (''C'', ''U'') THEN',
'    validate_mandatory_cols;',
'    log_debug(''Mandatory columns validation passed.'');',
'  END IF;',
'',
'  -- Build dynamic DML and execute with DBMS_SQL',
'  IF p_mode = ''C'' THEN',
'    -- INSERT',
'    v_sql := ''INSERT INTO '' || p_table || '' ('';',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      IF v_json_obj.has(v_columns(i).column_name) THEN',
'        IF i > 1 AND v_sql NOT LIKE ''%($'' THEN',
'          v_sql := v_sql || '', '';',
'        END IF;',
'        v_sql := v_sql || v_columns(i).column_name;',
'      END IF;',
'    END LOOP;',
'    v_sql := v_sql || '') VALUES ('';',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      IF v_json_obj.has(v_columns(i).column_name) THEN',
'        IF i > 1 AND v_sql NOT LIKE ''%($'' THEN',
'          v_sql := v_sql || '', '';',
'        END IF;',
'        v_sql := v_sql || '':'' || v_columns(i).column_name;',
'      END IF;',
'    END LOOP;',
'    v_sql := v_sql || '')'';',
'',
'    log_debug(''Insert SQL: '' || v_sql);',
'',
'    DBMS_SQL.PARSE(v_cursor, v_sql, DBMS_SQL.NATIVE);',
'',
'    -- Bind variables',
'    v_bind_idx := 0;',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      IF v_json_obj.has(v_columns(i).column_name) THEN',
'        v_bind_idx := v_bind_idx + 1;',
'        v_col_meta := v_columns(i);',
'',
'        IF v_col_meta.data_type LIKE ''VARCHAR2%'' THEN',
'          v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'',
'        ELSIF v_col_meta.data_type LIKE ''NUMBER%'' THEN',
'          v_col_value_number := v_json_obj.get_Number(v_col_meta.column_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_number);',
'',
'        ELSIF v_col_meta.data_type LIKE ''DATE%'' THEN',
'          -- Parse ISO8601 to DATE',
'          v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'          v_col_value_date := TO_TIMESTAMP_TZ(v_col_value_varchar, ''YYYY-MM-DD"T"HH24:MI:SS.FF TZH:TZM'');',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_date);',
'',
'        ELSIF v_col_meta.data_type = ''RAW'' THEN',
'          -- Expect 32 char hex string for UUID',
'          v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'          v_col_value_raw := hex_to_raw16(v_col_value_varchar);',
'          IF v_col_value_raw IS NULL THEN',
'            RAISE_APPLICATION_ERROR(-20003, ''Invalid UUID format for column '' || v_col_meta.column_name);',
'          END IF;',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_raw);',
'',
'        ELSE',
'          -- Default varchar2',
'          v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'        END IF;',
'      END IF;',
'    END LOOP;',
'',
'    -- Execute statement',
'    IF DBMS_SQL.EXECUTE(v_cursor) = 1 THEN',
'      p_status := ''S'';',
'      p_message := ''Insert successful'';',
'    ELSE',
'      p_status := ''E'';',
'      p_message := ''Insert affected '' || SQL%ROWCOUNT || '' rows (expected 1).'';',
'    END IF;',
'    DBMS_SQL.CLOSE_CURSOR(v_cursor);',
'',
'  ELSIF p_mode = ''U'' THEN',
'    -- UPDATE: SET columns present in payload except PK; WHERE pk cols from payload',
'',
'    v_sql := ''UPDATE '' || p_table || '' SET '';',
'    DECLARE ',
'      v_sep BOOLEAN := FALSE;',
'    BEGIN',
'      FOR i IN 1 .. v_col_cnt LOOP',
'        IF v_json_obj.has(v_columns(i).column_name) AND NOT v_pk_cols.exists(v_pk_cols.FIRST) THEN',
'          IF v_pk_cols.exists(i) AND v_pk_cols(i) = v_columns(i).column_name THEN',
'            NULL; -- skip PK columns for SET clause',
'          ELSE',
'            IF v_sep THEN',
'              v_sql := v_sql || '', '';',
'            END IF;',
'            v_sql := v_sql || v_columns(i).column_name || '' = :'' || v_columns(i).column_name;',
'            v_sep := TRUE;',
'          END IF;',
'        END IF;',
'      END LOOP;',
'    END;',
'    -- WHERE clause with PK columns',
'    v_sql := v_sql || '' WHERE '';',
'    FOR i IN 1 .. v_pk_cnt LOOP',
'      IF i > 1 THEN',
'        v_sql := v_sql || '' AND '';',
'      END IF;',
'      v_sql := v_sql || v_pk_cols(i) || '' = :'' || v_pk_cols(i);',
'    END LOOP;',
'',
'    log_debug(''Update SQL: '' || v_sql);',
'',
'    DBMS_SQL.PARSE(v_cursor, v_sql, DBMS_SQL.NATIVE);',
'',
'    -- Bind SET columns values',
'    FOR i IN 1 .. v_col_cnt LOOP',
'      IF v_json_obj.has(v_columns(i).column_name) THEN',
'        IF v_pk_cols.EXISTS(1) AND v_pk_cols.exists(i) AND v_pk_cols(i) = v_columns(i).column_name THEN',
'          NULL; -- skip here, will bind below as PK',
'        ELSE',
'          v_col_meta := v_columns(i);',
'          IF v_col_meta.data_type LIKE ''VARCHAR2%'' THEN',
'            v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'            DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'          ELSIF v_col_meta.data_type LIKE ''NUMBER%'' THEN',
'            v_col_value_number := v_json_obj.get_Number(v_col_meta.column_name);',
'            DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_number);',
'          ELSIF v_col_meta.data_type LIKE ''DATE%'' THEN',
'            v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'            v_col_value_date := TO_TIMESTAMP_TZ(v_col_value_varchar, ''YYYY-MM-DD"T"HH24:MI:SS.FF TZH:TZM'');',
'            DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_date);',
'          ELSIF v_col_meta.data_type = ''RAW'' THEN',
'            v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'            v_col_value_raw := hex_to_raw16(v_col_value_varchar);',
'            IF v_col_value_raw IS NULL THEN',
'              RAISE_APPLICATION_ERROR(-20003, ''Invalid UUID format for column '' || v_col_meta.column_name);',
'            END IF;',
'            DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_raw);',
'          ELSE',
'            v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'            DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'          END IF;',
'        END IF;',
'      END IF;',
'    END LOOP;',
'',
'    -- Bind PK columns for WHERE clause',
'    FOR i IN 1 .. v_pk_cnt LOOP',
'      v_col_meta.column_name := v_pk_cols(i);',
'      -- Push PK metadata to find data_type',
'      FOR j IN 1 .. v_col_cnt LOOP',
'        IF v_columns(j).column_name = v_col_meta.column_name THEN',
'          v_col_meta := v_columns(j);',
'          EXIT;',
'        END IF;',
'      END LOOP;',
'',
'      IF NOT v_json_obj.has(v_col_meta.column_name) THEN',
'        RAISE_APPLICATION_ERROR(-20004, ''Primary key column missing in payload for UPDATE: '' || v_col_meta.column_name);',
'      END IF;',
'',
'      IF v_col_meta.data_type LIKE ''VARCHAR2%'' THEN',
'        v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'        DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'      ELSIF v_col_meta.data_type LIKE ''NUMBER%'' THEN',
'        v_col_value_number := v_json_obj.get_Number(v_col_meta.column_name);',
'        DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_number);',
'      ELSIF v_col_meta.data_type LIKE ''DATE%'' THEN',
'        v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'        v_col_value_date := TO_TIMESTAMP_TZ(v_col_value_varchar, ''YYYY-MM-DD"T"HH24:MI:SS.FF TZH:TZM'');',
'        DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_date);',
'      ELSIF v_col_meta.data_type = ''RAW'' THEN',
'        v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'        v_col_value_raw := hex_to_raw16(v_col_value_varchar);',
'        IF v_col_value_raw IS NULL THEN',
'          RAISE_APPLICATION_ERROR(-20003, ''Invalid UUID format for column '' || v_col_meta.column_name);',
'        END IF;',
'        DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_raw);',
'      ELSE',
'        v_col_value_varchar := v_json_obj.get_String(v_col_meta.column_name);',
'        DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_meta.column_name, v_col_value_varchar);',
'      END IF;',
'    END LOOP;',
'',
'    IF DBMS_SQL.EXECUTE(v_cursor) >= 0 THEN',
'      p_status := ''S'';',
'      p_message := ''Update successful.'';',
'    ELSE',
'      p_status := ''E'';',
'      p_message := ''Update affected zero rows.'';',
'    END IF;',
'    DBMS_SQL.CLOSE_CURSOR(v_cursor);',
'',
'  ELSIF p_mode = ''D'' THEN',
'    -- DELETE: WHERE clause on PK columns',
'',
'    IF v_pk_cnt = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20005, ''Table '' || p_table || '' does not have a primary key; cannot delete generically.'');',
'    END IF;',
'',
'    v_sql := ''DELETE FROM '' || p_table || '' WHERE '';',
'    FOR i IN 1 .. v_pk_cnt LOOP',
'      IF i > 1 THEN',
'        v_sql := v_sql || '' AND '';',
'      END IF;',
'      v_sql := v_sql || v_pk_cols(i) || '' = :'' || v_pk_cols(i);',
'    END LOOP;',
'',
'    log_debug(''Delete SQL: '' || v_sql);',
'',
'    DBMS_SQL.PARSE(v_cursor, v_sql, DBMS_SQL.NATIVE);',
'',
'    -- Bind PK values',
'    FOR i IN 1 .. v_pk_cnt LOOP',
'      DECLARE',
'        v_col_name VARCHAR2(100) := v_pk_cols(i);',
'        v_col_type VARCHAR2(30);',
'        v_val_varchar VARCHAR2(4000);',
'        v_val_number NUMBER;',
'        v_val_date DATE;',
'        v_val_raw RAW(16);',
'      BEGIN',
'        FOR j IN 1 .. v_col_cnt LOOP',
'          IF v_columns(j).column_name = v_col_name THEN',
'            v_col_type := v_columns(j).data_type;',
'            EXIT;',
'          END IF;',
'        END LOOP;',
'',
'        IF NOT v_json_obj.has(v_col_name) THEN',
'          RAISE_APPLICATION_ERROR(-20006, ''Primary key '' || v_col_name || '' missing from payload for DELETE'');',
'        END IF;',
'',
'        IF v_col_type LIKE ''VARCHAR2%'' THEN',
'          v_val_varchar := v_json_obj.get_String(v_col_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_name, v_val_varchar);',
'        ELSIF v_col_type LIKE ''NUMBER%'' THEN',
'          v_val_number := v_json_obj.get_Number(v_col_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_name, v_val_number);',
'        ELSIF v_col_type LIKE ''DATE%'' THEN',
'          v_val_varchar := v_json_obj.get_String(v_col_name);',
'          v_val_date := TO_TIMESTAMP_TZ(v_val_varchar, ''YYYY-MM-DD"T"HH24:MI:SS.FF TZH:TZM'');',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_name, v_val_date);',
'        ELSIF v_col_type = ''RAW'' THEN',
'          v_val_varchar := v_json_obj.get_String(v_col_name);',
'          v_val_raw := hex_to_raw16(v_val_varchar);',
'          IF v_val_raw IS NULL THEN',
'            RAISE_APPLICATION_ERROR(-20003, ''Invalid UUID format for column '' || v_col_name);',
'          END IF;',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_name, v_val_raw);',
'        ELSE',
'          v_val_varchar := v_json_obj.get_String(v_col_name);',
'          DBMS_SQL.BIND_VARIABLE(v_cursor, '':'' || v_col_name, v_val_varchar);',
'        END IF;',
'      END;',
'    END LOOP;',
'',
'    IF DBMS_SQL.EXECUTE(v_cursor) >= 0 THEN',
'      p_status := ''S'';',
'      p_message := ''Delete successful.'';',
'    ELSE',
'      p_status := ''E'';',
'      p_message := ''Delete affected zero rows.'';',
'    END IF;',
'    DBMS_SQL.CLOSE_CURSOR(v_cursor);',
'',
'  END IF;',
'',
'EXCEPTION',
'  WHEN JSON_VALUE_ERROR THEN',
'    p_status := ''E'';',
'    p_message := ''Invalid JSON input.'';',
'  WHEN OTHERS THEN',
'    IF DBMS_SQL.IS_OPEN(v_cursor) THEN',
'      DBMS_SQL.CLOSE_CURSOR(v_cursor);',
'    END IF;',
'    p_status := ''E'';',
'    p_message := ''Error: '' || SQLERRM;',
'END generic_crud_proc;',
'/',
'create or replace PROCEDURE load_data_standalone (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT BOOLEAN,',
'    p_message         OUT VARCHAR2',
') IS',
'    l_blob        BLOB;',
'    l_file_name   VARCHAR2(255);',
'    l_table_name  VARCHAR2(255);',
'    l_template_id RAW(16);',
'    l_log_id      RAW(16);',
'    l_apex_user   VARCHAR2(255) := NVL(v(''APP_USER''),''APEX_USER'');',
'',
'    TYPE t_map_rec IS RECORD (',
'        src_col     VARCHAR2(128),',
'        tgt_col     VARCHAR2(128),',
'        parser_col  VARCHAR2(20),',
'        data_type   VARCHAR2(50)',
'    );',
'',
'    TYPE t_map IS TABLE OF t_map_rec INDEX BY VARCHAR2(128);',
'    l_mapping t_map;',
'',
'    l_cols        VARCHAR2(32767);',
'    l_vals        VARCHAR2(32767);',
'    l_insert_vals VARCHAR2(32767);',
'    l_update_list VARCHAR2(32767);',
'    l_sql         CLOB;',
'    k             VARCHAR2(128);',
'    l_key_col     VARCHAR2(128);  -- dynamic key column (STAY_DATE)',
'BEGIN',
'    -- 0. Get file blob and name',
'    SELECT blob_content, filename',
'      INTO l_blob, l_file_name',
'      FROM temp_blob',
'     WHERE id = p_file_id;',
'',
'    -- 1. Get target table + template',
'    SELECT db_object_name, id',
'      INTO l_table_name, l_template_id',
'      FROM ur_templates',
'     WHERE upper(id) = upper(p_template_key);',
'',
'    -- 2. Insert interface log',
'    l_log_id := sys_guid();',
'    INSERT INTO ur_interface_logs(',
'        id, hotel_id, template_id, interface_type, load_start_time,',
'        load_status, created_by, updated_by, created_on, updated_on, file_id',
'    ) VALUES (',
'        l_log_id, p_hotel_id, l_template_id, ''UPLOAD'', SYSTIMESTAMP,',
'        ''IN_PROGRESS'',',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        SYSDATE, SYSDATE, p_file_id',
'    );',
'',
'    -- 3. Load mapping from collection',
'    FOR rec IN (',
'        SELECT regexp_substr(c001, ''^[^(]+'') src_col,',
'               regexp_substr(c002, ''^[^(]+'') tgt_col,',
'               TRIM(c004) parser_col,',
'               UPPER(regexp_replace(c001, ''^[^(]+\(([^)]+)\).*'', ''\1'')) datatype',
'          FROM apex_collections',
'         WHERE collection_name = p_collection_name',
'           AND c003 = ''Maps To''',
'           AND c004 IS NOT NULL',
'    ) LOOP',
'        l_mapping(UPPER(TRIM(rec.src_col))).src_col    := TRIM(rec.src_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).tgt_col    := TRIM(rec.tgt_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).parser_col := TRIM(rec.parser_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).data_type  := TRIM(rec.datatype);',
'',
'        -- Identify key column dynamically',
'        IF UPPER(TRIM(rec.tgt_col)) = ''STAY_DATE'' THEN',
'            l_key_col := TRIM(rec.parser_col);  -- e.g., COL003',
'        END IF;',
'    END LOOP;',
'',
'    IF l_mapping.COUNT = 0 OR l_key_col IS NULL THEN',
'        RAISE_APPLICATION_ERROR(-20001,''No mapped columns or key column (STAY_DATE) found!'');',
'    END IF;',
'',
'    -- 4. Build dynamic SELECT, UPDATE, INSERT parts',
'    k := l_mapping.FIRST;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.EXISTS(k) THEN',
'            -- SELECT part',
'            IF l_vals IS NOT NULL THEN l_vals := l_vals || '', ''; END IF;',
'            l_vals := l_vals || ''p.''||l_mapping(k).parser_col||'' AS "''||l_mapping(k).tgt_col||''"'';',
'',
'            -- UPDATE list (skip key columns)',
'            IF l_mapping(k).tgt_col NOT IN (''HOTEL_ID'',''STAY_DATE'') THEN',
'                IF l_update_list IS NOT NULL THEN l_update_list := l_update_list || '', ''; END IF;',
'                IF l_mapping(k).data_type = ''NUMBER'' THEN',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = CASE WHEN REGEXP_LIKE(src.''||l_mapping(k).parser_col||'',''''^-?\d+(\.\d+)?$'''') THEN TO_NUMBER(src.''||l_mapping(k).parser_col||'') ELSE NULL END'';',
'                ELSIF l_mapping(k).data_type = ''DATE'' THEN',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = TO_DATE(src.''||l_mapping(k).parser_col||'', ''''YYYY-MM-DD'''')'';',
'                ELSE',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = src.''||l_mapping(k).parser_col;',
'                END IF;',
'            END IF;',
'',
'            -- INSERT values',
'            IF l_insert_vals IS NOT NULL THEN l_insert_vals := l_insert_vals || '', ''; END IF;',
'            l_insert_vals := l_insert_vals || ''src.''||l_mapping(k).parser_col;',
'        END IF;',
'        k := l_mapping.NEXT(k);',
'    END LOOP;',
'',
'    -- Build column list for INSERT',
'    l_cols := '''';',
'    k := l_mapping.FIRST;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.EXISTS(k) THEN',
'            IF l_cols IS NOT NULL AND l_cols <> '''' THEN l_cols := l_cols || '', ''; END IF;',
'            l_cols := l_cols || ''"''||l_mapping(k).tgt_col||''"'';',
'        END IF;',
'        k := l_mapping.NEXT(k);',
'    END LOOP;',
'',
'    -- 5. Build dynamic MERGE SQL',
'    l_sql := ''',
'MERGE INTO ''||l_table_name||'' tgt',
'USING (',
'    SELECT :hotel_id AS HOTEL_ID, ''||l_vals||''',
'    FROM TABLE(apex_data_parser.parse(p_content => :b1, p_file_name => :b2)) p',
'    WHERE p.line_number > 1',
') src',
'ON (tgt.HOTEL_ID = src.HOTEL_ID AND tgt."''||UPPER(l_key_col)||''" = src."''||UPPER(l_key_col)||''")',
'WHEN MATCHED THEN',
'    UPDATE SET ''||l_update_list||''',
'WHEN NOT MATCHED THEN',
'    INSERT (HOTEL_ID, ''||l_cols||'')',
'    SELECT :hotel_id, ''||l_insert_vals||'' FROM src'';',
'',
'    -- Debug log',
'    INSERT INTO debug_log(message) VALUES(''MERGE SQL: ''||l_sql);',
'    COMMIT;',
'',
'    -- 6. Execute dynamic MERGE',
'    EXECUTE IMMEDIATE l_sql',
'      USING p_hotel_id, l_blob, l_file_name;',
'',
'    -- 7. Update interface log',
'    UPDATE ur_interface_logs',
'       SET load_end_time = SYSTIMESTAMP,',
'           load_status = ''SUCCESS'',',
'           updated_by = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'           updated_on = SYSDATE',
'     WHERE id = l_log_id;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: Upload completed. Rows=''||SQL%ROWCOUNT;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := FALSE;',
'        p_message := ''Failure: ''||SQLERRM;',
'        INSERT INTO debug_log(message) VALUES(''ERROR: ''||SQLERRM);',
'        COMMIT;',
'',
'        UPDATE ur_interface_logs',
'           SET load_end_time = SYSTIMESTAMP,',
'               load_status = ''FAILED'',',
'               updated_by = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'               updated_on = SYSDATE',
'         WHERE id = l_log_id;',
'',
'        ROLLBACK;',
'END load_data_standalone;',
'/',
'create or replace PROCEDURE load_data_t (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT BOOLEAN,',
'    p_message         OUT VARCHAR2',
') IS',
'    l_blob        BLOB;',
'    l_file_name   VARCHAR2(255);',
'    l_table_name  VARCHAR2(255);',
'    l_template_id RAW(16);',
'    l_log_id      RAW(16);',
'    l_apex_user   VARCHAR2(255) := NVL(v(''APP_USER''),''APEX_USER'');',
'',
'    TYPE t_map_rec IS RECORD (',
'        src_col     VARCHAR2(128),',
'        tgt_col     VARCHAR2(128),',
'        parser_col  VARCHAR2(20),',
'        data_type   VARCHAR2(50)',
'    );',
'',
'    TYPE t_map IS TABLE OF t_map_rec INDEX BY VARCHAR2(128);',
'    l_mapping t_map;',
'',
'    l_cols VARCHAR2(32767);',
'    l_vals VARCHAR2(32767);',
'    l_update_list VARCHAR2(32767);',
'    l_sql CLOB;',
'    k VARCHAR2(128);',
'    l_key_col VARCHAR2(128);  -- dynamic key column (e.g., STAY_DATE)',
'BEGIN',
'    -- 0. Get file blob and name',
'    SELECT blob_content, filename',
'      INTO l_blob, l_file_name',
'      FROM temp_blob',
'     WHERE id = p_file_id;',
'',
'    -- 1. Get target table + template',
'    SELECT db_object_name, id',
'      INTO l_table_name, l_template_id',
'      FROM ur_templates',
'     WHERE upper(id) = upper(p_template_key);',
'',
'    -- 2. Insert interface log',
'    l_log_id := sys_guid();',
'    INSERT INTO ur_interface_logs(',
'        id, hotel_id, template_id, interface_type, load_start_time,',
'        load_status, created_by, updated_by, created_on, updated_on, file_id',
'    ) VALUES (',
'        l_log_id, p_hotel_id, l_template_id, ''UPLOAD'', SYSTIMESTAMP,',
'        ''IN_PROGRESS'',',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        SYSDATE, SYSDATE, p_file_id',
'    );',
'',
'    -- 3. Load mapping from collection',
'    FOR rec IN (',
'        SELECT regexp_substr(c001, ''^[^(]+'') src_col,',
'               regexp_substr(c002, ''^[^(]+'') tgt_col,',
'               TRIM(c004) parser_col,',
'               UPPER(regexp_replace(c001, ''^[^(]+\(([^)]+)\).*'', ''\1'')) datatype',
'          FROM apex_collections',
'         WHERE collection_name = p_collection_name',
'           AND c003 = ''Maps To''',
'           AND c004 IS NOT NULL',
'    ) LOOP',
'        l_mapping(UPPER(TRIM(rec.src_col))).src_col    := TRIM(rec.src_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).tgt_col    := TRIM(rec.tgt_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).parser_col := TRIM(rec.parser_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).data_type  := TRIM(rec.datatype);',
'',
'        -- Identify key column dynamically',
'        IF UPPER(TRIM(rec.tgt_col)) = ''STAY_DATE'' THEN',
'            l_key_col := TRIM(rec.parser_col);  -- e.g., COL003',
'        END IF;',
'    END LOOP;',
'',
'    IF l_mapping.COUNT = 0 OR l_key_col IS NULL THEN',
'        RAISE_APPLICATION_ERROR(-20001,''No mapped columns or key column (STAY_DATE) found!'');',
'    END IF;',
'',
'    -- 4. Build dynamic SELECT, UPDATE, INSERT parts',
'    k := l_mapping.FIRST;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.EXISTS(k) THEN',
'            -- SELECT part',
'            IF l_vals IS NOT NULL THEN l_vals := l_vals || '', ''; END IF;',
'            l_vals := l_vals || ''p.''||l_mapping(k).parser_col||'' AS "''||l_mapping(k).tgt_col||''"'';',
'',
'            -- UPDATE list (skip key columns)',
'            IF l_mapping(k).tgt_col NOT IN (''HOTEL_ID'',''STAY_DATE'') THEN',
'                IF l_update_list IS NOT NULL THEN l_update_list := l_update_list || '', ''; END IF;',
'                IF l_mapping(k).data_type = ''NUMBER'' THEN',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = CASE WHEN REGEXP_LIKE(src.''||l_mapping(k).parser_col||'',''''^-?\d+(\.\d+)?$'''') THEN TO_NUMBER(src.''||l_mapping(k).parser_col||'') ELSE NULL END'';',
'                ELSIF l_mapping(k).data_type = ''DATE'' THEN',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = TO_DATE(src.''||l_mapping(k).parser_col||'', ''''YYYY-MM-DD'''')'';',
'                ELSE',
'                    l_update_list := l_update_list || ''"''||l_mapping(k).tgt_col||''" = src.''||l_mapping(k).parser_col;',
'                END IF;',
'            END IF;',
'        END IF;',
'        k := l_mapping.NEXT(k);',
'    END LOOP;',
'',
'    -- Build column list for INSERT',
'    l_cols := '''';',
'    k := l_mapping.FIRST;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.EXISTS(k) THEN',
'            IF l_cols IS NOT NULL AND l_cols <> '''' THEN l_cols := l_cols || '', ''; END IF;',
'            l_cols := l_cols || ''"''||l_mapping(k).tgt_col||''"'';',
'        END IF;',
'        k := l_mapping.NEXT(k);',
'    END LOOP;',
'',
'    -- 5. Build dynamic MERGE SQL',
'    l_sql := ''',
'MERGE INTO ''||l_table_name||'' tgt',
'USING (',
'    SELECT :hotel_id AS HOTEL_ID, ''||l_vals||''',
'    FROM TABLE(apex_data_parser.parse(p_content => :b1, p_file_name => :b2)) p',
'    WHERE p.line_number > 1',
') src',
'ON (tgt.HOTEL_ID = src.HOTEL_ID AND tgt."''||UPPER(l_key_col)||''" = src."''||UPPER(l_key_col)||''")',
'WHEN MATCHED THEN',
'    UPDATE SET ''||l_update_list||''',
'WHEN NOT MATCHED THEN',
'    INSERT (HOTEL_ID, ''||l_cols||'')',
'    VALUES (:hotel_id, ''||l_cols||'')'';',
'',
'    INSERT INTO debug_log(message) VALUES(''MERGE SQL: ''||l_sql);',
'    COMMIT;',
'',
'    -- 6. Execute dynamic MERGE',
'    EXECUTE IMMEDIATE l_sql',
'      USING p_hotel_id, l_blob, l_file_name, p_hotel_id;',
'',
'    -- 7. Update interface log',
'    UPDATE ur_interface_logs',
'       SET load_end_time = SYSTIMESTAMP,',
'           load_status = ''SUCCESS'',',
'           updated_by = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'           updated_on = SYSDATE',
'     WHERE id = l_log_id;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: Upload completed. Rows=''||SQL%ROWCOUNT;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := FALSE;',
'        p_message := ''Failure: ''||SQLERRM;',
'        INSERT INTO debug_log(message) VALUES(''ERROR: ''||SQLERRM);',
'        COMMIT;',
'        UPDATE ur_interface_logs',
'           SET load_end_time = SYSTIMESTAMP,',
'               load_status = ''FAILED'',',
'               updated_by = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'               updated_on = SYSDATE',
'         WHERE id = l_log_id;',
'        ROLLBACK;',
'END load_data_t;',
'/',
'create or replace PROCEDURE match_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
') IS',
'    -- Local types',
'    TYPE t_name_type_rec IS RECORD(',
'        name       VARCHAR2(100),',
'        data_type  VARCHAR2(30)',
'    );',
'    TYPE t_name_type_tab IS TABLE OF t_name_type_rec;',
'',
'    TYPE t_template_rec IS RECORD(',
'        id         VARCHAR2(50),',
'        name       VARCHAR2(200),',
'        definition t_name_type_tab',
'    );',
'    TYPE t_template_tab IS TABLE OF t_template_rec INDEX BY PLS_INTEGER;',
'',
'    -- Variables',
'    v_source_clob       CLOB;',
'    v_source_normalized CLOB;',
'    ',
'    v_target_id         VARCHAR2(50);',
'    v_target_name       VARCHAR2(200);',
'    v_target_def_clob   CLOB;',
'    v_target_normalized CLOB;',
'',
'    v_source_defs       t_name_type_tab := t_name_type_tab();',
'    v_target_defs       t_name_type_tab := t_name_type_tab();',
'',
'    v_templates         t_template_tab;',
'    v_count_templates   PLS_INTEGER := 0;',
'',
'    v_json_output       CLOB := ''['';',
'    v_min_score_use     NUMBER;',
'    v_separator         VARCHAR2(1) := '''';',
'',
'    v_match_count       NUMBER;',
'    v_score             NUMBER;',
'',
'    CURSOR c_targets IS',
'      SELECT ID, NAME, DEFINITION FROM UR_TEMPLATES WHERE hotel_id = p_hotel_id;',
'',
'    -- Debug procedure',
'    PROCEDURE debug(p_msg VARCHAR2) IS',
'    BEGIN',
'        IF UPPER(p_debug_flag) = ''Y'' THEN',
'            DBMS_OUTPUT.PUT_LINE(''[DEBUG] '' || p_msg);',
'        END IF;',
'    END;',
'',
'    -- Normalize data-type keys in JSON string (case sensitive replacement)',
'    FUNCTION normalize_json(p_json CLOB) RETURN CLOB IS',
'    BEGIN',
'        RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'    END;',
'',
'    -- Parse definition JSON into PL/SQL collection',
'    FUNCTION parse_definition(p_clob CLOB) RETURN t_name_type_tab IS',
'        l_defs t_name_type_tab := t_name_type_tab();',
'        idx     PLS_INTEGER := 0;',
'    BEGIN',
'        FOR rec IN (',
'            SELECT lower(trim(name)) AS name, lower(trim(data_type)) AS data_type FROM JSON_TABLE(',
'                p_clob,',
'                ''$[*]'' COLUMNS (',
'                    name VARCHAR2(100) PATH ''$.name'',',
'                    data_type VARCHAR2(30) PATH ''$.data_type''',
'                )',
'            )',
'        ) LOOP',
'            idx := idx + 1;',
'            l_defs.EXTEND;',
'            l_defs(idx).name := rec.name;',
'            l_defs(idx).data_type := rec.data_type;',
'        END LOOP;',
'        RETURN l_defs;',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            RETURN NULL;',
'    END;',
'',
'    -- Count matches (name + data_type case-insensitive)',
'    FUNCTION count_matches(p_source t_name_type_tab, p_target t_name_type_tab) RETURN NUMBER IS',
'        v_count NUMBER := 0;',
'    BEGIN',
'        FOR i IN 1 .. p_source.COUNT LOOP',
'            FOR j IN 1 .. p_target.COUNT LOOP',
'                IF p_source(i).name = p_target(j).name AND p_source(i).data_type = p_target(j).data_type THEN',
'                    v_count := v_count + 1;',
'                    EXIT;',
'                END IF;',
'            END LOOP;',
'        END LOOP;',
'        RETURN v_count;',
'    END;',
'',
'BEGIN',
'    -- Validate inputs and assign to local variable',
'    v_min_score_use := NVL(p_min_score, 90);',
'    IF v_min_score_use < 0 OR v_min_score_use > 100 THEN',
'        v_min_score_use := 90;',
'    END IF;',
'',
'    IF p_file_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''File ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    IF p_hotel_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''Hotel ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    debug(''Starting processing...'');',
'    debug(''File ID: '' || p_file_id);',
'    debug(''Hotel ID: '' || p_hotel_id);',
'    debug(''Minimum Score: '' || v_min_score_use);',
'',
'    -- Fetch and normalize source CLOB',
'    BEGIN',
'        SELECT columns INTO v_source_clob FROM temp_blob WHERE id = p_file_id;',
'        IF v_source_clob IS NULL THEN',
'            p_status := ''E'';',
'            p_message := ''Source definition not found for file_id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        END IF;',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status := ''E'';',
'            p_message := ''Source file not found for id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Error fetching source definition: '' || SQLERRM;',
'            p_output_json := NULL;',
'            RETURN;',
'    END;',
'',
'    v_source_normalized := normalize_json(v_source_clob);',
'',
'    -- Parse source defs',
'    v_source_defs := parse_definition(v_source_normalized);',
'    IF v_source_defs IS NULL OR v_source_defs.COUNT = 0 THEN',
'        p_status := ''E'';',
'        p_message := ''Cannot parse source definition JSON or empty definition'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'    debug(''Parsed Source definitions: '' || v_source_defs.COUNT || '' fields'');',
'',
'    -- Initialize JSON output',
'    v_json_output := ''['';',
'    v_count_templates := 0;',
'',
'    -- Loop over target templates from cursor',
'    FOR r_target IN c_targets LOOP',
'        v_target_id := r_target.ID;',
'        v_target_name := r_target.NAME;',
'        v_target_def_clob := r_target.DEFINITION;',
'',
'        IF v_target_def_clob IS NULL THEN',
'            debug(''Skipping template '' || v_target_id || '' due to NULL definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_target_normalized := normalize_json(v_target_def_clob);',
'',
'        v_target_defs := parse_definition(v_target_normalized);',
'        IF v_target_defs IS NULL OR v_target_defs.COUNT = 0 THEN',
'            debug(''Skipping template '' || v_target_id || '' due to parsing error or empty definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_match_count := count_matches(v_source_defs, v_target_defs);',
'',
'        v_score := ROUND((2 * v_match_count) / (v_source_defs.COUNT + v_target_defs.COUNT) * 100);',
'',
'        debug(''Template '' || v_target_id || '' ('' ||'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
' v_target_name || ''): Matches='' || ',
'              v_match_count || '', Score='' || v_score);',
'',
'        IF v_score >= v_min_score_use THEN',
'            IF v_count_templates > 0 THEN',
'                v_json_output := v_json_output || '','';',
'            END IF;',
'            v_json_output := v_json_output || ''{"Template_id":"'' || v_target_id || ',
'                            ''","Template_Name":"'' || REPLACE(v_target_name,''"'',''\"'') || ',
'                            ''","Score":'' || v_score || ''}'';',
'            v_count_templates := v_count_templates + 1;',
'        END IF;',
'    END LOOP;',
'',
'    v_json_output := v_json_output || '']'';',
'',
'    IF v_count_templates = 0 THEN',
'        p_output_json := ''[{}]'';',
'        p_message := ''No templates matched the minimum score threshold'';',
'        debug(''No matching templates found.'');',
'    ELSE',
'        p_output_json := v_json_output;',
'        p_message := ''Templates matched: '' || v_count_templates;',
'        debug(''Matching templates count: '' || v_count_templates);',
'    END IF;',
'',
'    p_status := ''S'';',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_message := ''Unexpected error: '' || SQLERRM;',
'        p_output_json := NULL;',
'END match_templates;',
'/',
'create or replace PROCEDURE prc_insert_hotel_group IS',
'  l_payload  CLOB;',
'  l_status   VARCHAR2(10);',
'  l_message  CLOB;',
'BEGIN',
'  -- Example JSON payload',
'  l_payload := ''{',
'    "ID": "3d6da1647275228de063dd59000a9241",',
'    "GROUP_NAME": "Luxury Hotels",',
'    "CREATED_BY": "3d6da164727f228de063dd59000a9241",',
'    "UPDATED_BY": "3d6da1647281228de063dd59000a9241",',
'    "CREATED_ON": "2025-08-28",',
'    "UPDATED_ON": "2025-08-28"',
'  }'';',
'',
'  pkg_generic_crud.proc_crud_json(',
'    p_mode    => ''C'',',
'    p_table   => ''UR_HOTEL_GROUPS'',',
'    p_payload => l_payload,',
'    p_debug   => ''Y'',',
'    p_status  => l_status,',
'    p_message => l_message',
'  );',
'',
'  DBMS_OUTPUT.put_line(''Insert Status  : '' || l_status);',
'  DBMS_OUTPUT.put_line(''Insert Message : '' || l_message);',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    DBMS_OUTPUT.put_line(''Error in prc_insert_hotel_group: '' || SQLERRM);',
'END;',
'/',
'create or replace PROCEDURE p_generic_crud(',
'    p_mode         IN VARCHAR2,    -- ''C'', ''U'', ''D'', ''F''',
'    p_table_name   IN VARCHAR2,    -- Table name (case-insensitive)',
'    p_payload      IN CLOB,        -- JSON payload (for C/U/D)',
'    p_debug        IN VARCHAR2 DEFAULT ''N'', -- ''Y'' for debug output',
'    p_status       OUT VARCHAR2,   -- ''S'' for success, ''E'' for error',
'    p_message      OUT CLOB        -- Success/Error/Info messages or result',
') AS',
'    -- Local Variables',
'    l_sql         VARCHAR2(32767);',
'    l_cols        SYS_REFCURSOR;',
'    l_column_list VARCHAR2(4000);',
'    l_col_val_bind VARCHAR2(4000);',
'    l_primary_key_col VARCHAR2(255);',
'    l_pk_value   VARCHAR2(4000);',
'    l_bind_vars  DBMS_SQL.VARCHAR2_TABLE;',
'    l_datatype   VARCHAR2(50);',
'    l_mandatory  VARCHAR2(1);',
'    l_unique     VARCHAR2(1);',
'    l_cnt        INTEGER;',
'    -- For Fetch Mode',
'    l_json       CLOB;',
'    l_payload_json apex_json.t_values;',
'    l_idx        NUMBER;',
'    l_col_name   varchar2(255);',
'    -- Misc',
'    l_id_value   VARCHAR2(4000);',
'    l_found_pk   NUMBER;',
'    l_dynamic_sql VARCHAR2(32767);',
'',
'    -- Helper subroutines',
'    PROCEDURE debug(msg VARCHAR2) IS',
'    BEGIN',
'        IF UPPER(p_debug) = ''Y'' THEN',
'            APEX_DEBUG.MESSAGE(''[GEN_CRUD] '' || msg);',
'        END IF;',
'    END;',
'',
'    -- Fetch a single value from JSON (by key)',
'    FUNCTION json_get(payload CLOB, key VARCHAR2) RETURN VARCHAR2 IS',
'    BEGIN',
'        RETURN apex_json.get_varchar2(p_path => ''$."''||key||''"'', p_source => payload);',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            RETURN NULL;',
'    END;',
'',
'    -- Get comma-separated columns and binds for the payload, filtering only valid columns',
'    PROCEDURE build_column_lists(table_name IN VARCHAR2, payload IN CLOB, ',
'                               out_cols OUT VARCHAR2, out_vals OUT VARCHAR2, ',
'                               out_updates OUT VARCHAR2) IS',
'        l_cols_arr  apex_t_varchar2;',
'        l_vals_arr  apex_t_varchar2;',
'        l_upd_arr   apex_t_varchar2;',
'        l_sql2      VARCHAR2(2000);',
'        l_val       VARCHAR2(4000);',
'        l_col       VARCHAR2(255);',
'        l_coltype   VARCHAR2(64);',
'        l_idx       INTEGER := 1;',
'    BEGIN',
'        FOR c IN (SELECT column_name, data_type FROM user_tab_columns ',
'                    WHERE table_name = UPPER(table_name)) LOOP',
'            l_val := json_get(payload, c.column_name);',
'            IF l_val IS NOT NULL THEN',
'                l_cols_arr(l_idx) := c.column_name;',
'                l_vals_arr(l_idx) := '':''||l_idx;',
'                l_upd_arr(l_idx) := c.column_name||'' = :''||l_idx;',
'                l_idx := l_idx + 1;',
'            END IF;',
'        END LOOP;',
'        out_cols := LISTAGG(l_cols_arr, '', '');',
'        out_vals := LISTAGG(l_vals_arr, '', '');',
'        out_updates := LISTAGG(l_upd_arr, '', '');',
'    END;',
'',
'    -- Returns the primary key column for a table',
'    FUNCTION get_pk_column (table_name IN VARCHAR2) RETURN VARCHAR2 IS',
'        l_pk_col VARCHAR2(255);',
'    BEGIN',
'        SELECT column_name INTO l_pk_col',
'        FROM user_cons_columns',
'        WHERE constraint_name = (',
'            SELECT constraint_name FROM user_constraints',
'             WHERE table_name = UPPER(table_name)',
'               AND constraint_type = ''P''',
'               AND ROWNUM = 1',
'        ) AND rownum = 1;',
'        RETURN l_pk_col;',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN RETURN NULL;',
'    END;',
'',
'    -- Checks for required (NOT NULL and no default) columns',
'    PROCEDURE get_mandatory_columns(table_name IN VARCHAR2, out_msg OUT CLOB) IS',
'        l_json CLOB := ''{"mandatoryColumns":['';',
'        l_cnt  INTEGER := 0;',
'    BEGIN',
'        FOR c IN (SELECT column_name, data_type, data_length, nullable, data_default ',
'                    FROM user_tab_columns ',
'                    WHERE table_name = UPPER(table_name)) LOOP',
'            IF c.nullable = ''N'' AND (c.data_default IS NULL OR TRIM(c.data_default) IS NULL) THEN',
'                IF l_cnt > 0 THEN l_json := l_json || '',''; END IF;',
'                l_json := l_json || ''{"column":"'' || c.column_name || ''","data_type":"'' || c.data_type || ''"}'';',
'                l_cnt := l_cnt + 1;',
'            END IF;',
'        END LOOP;',
'        l_json := l_json || '']}'';',
'        out_msg := l_json;',
'    END;',
'',
'BEGIN',
'    -- Set debug context',
'    IF UPPER(p_debug) = ''Y'' THEN',
'        APEX_DEBUG.ENABLE;',
'        debug(''Procedure invoked in mode: ''||p_mode||'', Table=''||p_table_name);',
'    END IF;',
'',
'    IF UPPER(p_mode) = ''F'' THEN',
'        -- FETCH mode: Retrieve metadata and provide sample C/U/D example payloads',
'        l_json := ''{"fields":['';',
'        l_cnt := 0;',
'        FOR c IN (SELECT column_name, data_type, data_length, nullable, data_default ',
'                    FROM user_tab_columns WHERE table_name = UPPER(p_table_name)) LOOP',
'            IF l_cnt > 0 THEN l_json := l_json || '',''; END IF;',
'            l_json := l_json||''{"column":"''||c.column_name',
'                     ||''","data_type":"''||c.data_type',
'                     ||''","length":''||NVL(c.data_length,0)',
'                     ||'',"nullable":"''||c.nullable',
'                     ||''","default":"''||REPLACE(NVL(c.data_default,''null''),''"'',''\"'')||''"}'';',
'            l_cnt := l_cnt + 1;',
'        END LOOP;',
'        l_json := l_json || '']'';',
'',
'        -- Find PK',
'        l_primary_key_col := get_pk_column(p_table_name);',
'',
'        -- Sample Example',
'        l_json := l_json ||',
'          '',"sampleExamples":{'' ||',
'          ''"Create":"p_mode=''''C'''', p_table_name=''''''||p_table_name||'''''', p_payload={...MandatoryCols...}",'' ||',
'          ''"Update":"p_mode=''''U'''', p_table_name=''''''||p_table_name||'''''', p_payload={''||l_primary_key_col||'':<value>, ...fields...}",'' ||',
'          ''"Delete":"p_mode=''''D'''', p_table_name=''''''||p_table_name||'''''', p_payload={''||l_primary_key_col||'':<value>}"'' ||',
'          ''} }'';',
'        p_status := ''S'';',
'        p_message := l_json;',
'        RETURN;',
'    END IF;',
'',
'    -- All other modes (C/U/D) require table to exist, payload to be valid',
'    -- Find primary key column',
'    l_primary_key_col := get_pk_column(p_table_name);',
'',
'    IF l_primary_key_col IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''{"error":"Primary key not found for table ''||p_table_name||''"}'';',
'        RETURN;',
'    END IF;',
'',
'    -- Parse payload as JSON',
'    apex_json.parse(l_payload_json, p_payload);',
'    l_id_value := apex_json.get_varchar2(p_path => ''$."''||l_primary_key_col||''"'', p_values => l_payload_json);',
'',
'    IF UPPER(p_mode) = ''C'' THEN',
'        -- Gather mandatory fields',
'        debug(''Checking mandatory fields'');',
'        FOR c IN (SELECT column_name, data_type, nullable FROM user_tab_columns ',
'                   WHERE table_name = UPPER(p_table_name)) LOOP',
'            IF c.nullable=''N'' THEN',
'                l_col_name := c.column_name;',
'                IF apex_json.get_varchar2(p_path => ''$."''||l_col_name||''"'', p_values => l_payload_json) IS NULL THEN',
'                    p_status := ''E'';',
'                    p_message := ''{"error":"Mandatory field ''||l_col_name||'' is missing"}'';',
'                    RETURN;',
'                END IF;',
'            END IF;',
'        END LOOP;',
'',
'        -- Insert statement',
'        l_column_list := '''';',
'        l_col_val_bind := '''';',
'        l_idx := 1;',
'        FOR c IN (SELECT column_name FROM user_tab_columns WHERE table_name = UPPER(p_table_name)) LOOP',
'            l_col_name := c.column_name;',
'            IF apex_json.get_varchar2(p_path => ''$."''||l_col_name||''"'', p_values => l_payload_json) IS NOT NULL THEN',
'                IF l_column_list IS NOT NULL AND l_column_list <> '''' THEN',
'                    l_column_list := l_column_list || '', '';',
'                    l_col_val_bind := l_col_val_bind || '', '';',
'                END IF;',
'                l_column_list := l_column_list || l_col_name;',
'                l_col_val_bind := l_col_val_bind || '':''||l_idx;',
'                l_bind_vars(l_idx) := apex_json.get_varchar2(p_path => ''$."''||l_col_name||''"'', p_values => l_payload_json);',
'                l_idx := l_idx + 1;',
'            END IF;',
'        END LOOP;',
'',
'        l_sql := ''INSERT INTO ''||p_table_name||'' (''||l_column_list||'') VALUES (''||l_col_val_bind||'')'';',
'        debug(''Insert SQL: ''||l_sql);',
'        EXECUTE IMMEDIATE l_sql USING l_bind_vars;',
'        p_status := ''S'';',
'        p_message := ''{"msg":"Row inserted successfully","'' || l_primary_key_col || ''":"'' || l_bind_vars(1) || ''"}'';',
'        RETURN;',
'    ELSIF UPPER(p_mode) = ''U'' THEN',
'        -- Require primary key value',
'        IF l_id_value IS NULL THEN',
'            p_status := ''E'';',
'            p_message := ''{"error":"Primary key value required for Update"}'';',
'            RETURN;',
'        END IF;',
'        -- Build set clause',
'        l_column_list := '''';',
'        l_col_val_bind := '''';',
'        l_idx := 1;',
'        FOR c IN (SELECT column_name FROM user_tab_columns WHERE table_name = UPPER(p_table_name) AND column_name <> l_primary_key_col) LOOP',
'            l_col_name := c.column_name;',
'            IF apex_json.get_varchar2(p_path => ''$."''||l_col_name||''"'', p_values => l_payload_json) IS NOT NULL THEN',
'                IF l_column_list IS NOT NULL AND l_column_list <> '''' THEN',
'                    l_column_list := l_column_list || '', '';',
'                END IF;',
'                l_column_list := l_column_list || l_col_name || '' = :''||l_idx;',
'                l_bind_vars(l_idx) := apex_json.get_varchar2(p_path => ''$."''||l_col_name||''"'', p_values => l_payload_json);',
'                l_idx := l_idx + 1;',
'            END IF;',
'        END LOOP;',
'        IF l_column_list IS NULL OR l_column_list = '''' THEN',
'            p_status := ''E'';',
'            p_message := ''{"error":"No updatable fields provided"}'';',
'            RETURN;',
'        END IF;',
'',
'        l_sql := ''UPDATE ''||p_table_name||'' SET ''||l_column_list',
'                 ||'' WHERE ''||l_primary_key_col||'' = :''||l_idx;',
'        l_bind_vars(l_idx) := l_id_value;',
'        debug(''Update SQL: ''||l_sql);',
'',
'        EXECUTE IMMEDIATE l_sql USING l_bind_vars;',
'        p_status := ''S'';',
'        p_message := ''{"msg":"Row updated successfully","''||l_primary_key_col||''":"'' || l_id_value || ''"}'';',
'        RETURN;',
'    ELSIF UPPER(p_mode) = ''D'' THEN',
'        -- Require primary key value',
'        IF l_id_value IS NULL THEN',
'            p_status := ''E'';',
'            p_message := ''{"error":"Primary key value required for Delete"}'';',
'            RETURN;',
'        END IF;',
'',
'        l_sql := ''DELETE FROM ''||p_table_name||'' WHERE ''||l_primary_key_col||'' = :1'';',
'        debug(''Delete SQL: ''||l_sql);',
'',
'        EXECUTE IMMEDIATE l_sql USING l_id_value;',
'        p_status := ''S'';',
'        p_message := ''{"msg":"Row deleted successfully","''||l_primary_key_col||''":"'' || l_id_value || ''"}'';',
'        RETURN;',
'    ELSE',
'        p_status := ''E'';',
'        p_message := ''{"error":"Unsupported mode - use C,U,D,F"}'';',
'    END IF;',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_message := ''{"error":"''||SQLERRM||''"}'';',
'        debug(''ERROR encountered: ''||SQLERRM);',
'END p_generic_crud;',
'/',
'create or replace PROCEDURE ur_upload_file_proc (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT BOOLEAN,',
'    p_message         OUT VARCHAR2',
') IS',
'    l_blob        BLOB;',
'    l_file_name   VARCHAR2(255);',
'    l_table_name  VARCHAR2(255);',
'    l_template_id RAW(16);',
'    l_total_rows  NUMBER := 0;',
'    l_success_cnt NUMBER := 0;',
'    l_fail_cnt    NUMBER := 0;',
'    l_log_id      RAW(16);',
'    l_error_json  CLOB := ''['';',
'    l_first_err   BOOLEAN := TRUE;',
'',
'    -- mapping record type',
'    TYPE t_map_rec IS RECORD (',
'        src_col     VARCHAR2(128),  ',
'        tgt_col     VARCHAR2(128),  ',
'        parser_col  VARCHAR2(20),   ',
'        data_type   VARCHAR2(50)',
'    );',
'    TYPE t_map IS TABLE OF t_map_rec INDEX BY VARCHAR2(128);',
'',
'    l_mapping   t_map;',
'    l_apex_user VARCHAR2(255) := NVL(v(''APP_USER''),''APEX_USER'');',
'',
'    l_cols   VARCHAR2(32767);',
'    l_vals   VARCHAR2(32767);',
'    l_sql    CLOB;',
'    k        VARCHAR2(128);',
'    v_expr   VARCHAR2(4000);',
'    l_map_count NUMBER;',
'',
'    l_existing_cnt NUMBER;',
'BEGIN',
'    -------------------------------------------------------------------',
'    -- 0. DUPLICATE CHECK',
'    -------------------------------------------------------------------',
'    SELECT COUNT(*)',
'      INTO l_existing_cnt',
'      FROM ur_interface_logs',
'     WHERE file_id     = p_file_id',
'       AND load_status = ''SUCCESS'';',
'',
'    IF l_existing_cnt > 0 THEN',
'        p_status  := FALSE;',
'        p_message := ''Failure: File ID ''||p_file_id||'' is already uploaded successfully.'';',
'        RETURN;',
'    END IF;',
'',
'    -- 1. Get blob and file name',
'    SELECT blob_content, filename',
'      INTO l_blob, l_file_name',
'      FROM temp_blob',
'     WHERE id = p_file_id;',
'',
'    -- 2. Get target table name + template id',
'    SELECT db_object_name, id',
'      INTO l_table_name, l_template_id',
'      FROM ur_templates',
'     WHERE upper(id) = upper(p_template_key);',
'',
'    -- 3. Insert log entry',
'    l_log_id := sys_guid();',
'    INSERT INTO ur_interface_logs (',
'        id, hotel_id, template_id, interface_type,',
'        load_start_time, load_status, created_by, updated_by,',
'        created_on, updated_on, file_id',
'    )',
'    VALUES (',
'        l_log_id,',
'        p_hotel_id,',
'        l_template_id,',
'        ''UPLOAD'',',
'        systimestamp,',
'        ''IN_PROGRESS'',',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        sysdate, sysdate,',
'        p_file_id',
'    );',
'',
'    -- 4. Load mapping',
'    FOR rec IN (',
'        SELECT regexp_substr(c001, ''^[^(]+'')                    src_col,',
'               regexp_substr(c002, ''^[^(]+'')                    tgt_col,',
'               TRIM(c004)                                       parser_col,',
'               UPPER(regexp_replace(c001, ''^[^(]+\(([^)]+)\).*'', ''\1'')) datatype',
'          FROM apex_collections',
'         WHERE collection_name = p_collection_name',
'           AND c003 = ''Maps To''',
'           AND c004 IS NOT NULL',
'    ) LOOP',
'        l_mapping(UPPER(TRIM(rec.src_col))).src_col    := TRIM(rec.src_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).tgt_col    := TRIM(rec.tgt_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).parser_col := TRIM(rec.parser_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).data_type  := TRIM(rec.datatype);',
'    END LOOP;',
'',
'    l_map_count := l_mapping.count;',
'    IF l_map_count = 0 THEN',
'        RAISE_APPLICATION_ERROR(-20001, ''No mapped columns found in collection!'');',
'    END IF;',
'',
'    -- 5. Build dynamic column list and values',
'    k := l_mapping.first;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.exists(k)',
'           AND l_mapping(k).tgt_col IS NOT NULL',
'           AND l_mapping(k).parser_col IS NOT NULL',
'        THEN',
'            IF l_cols IS NOT NULL THEN',
'                l_cols := l_cols || '','';',
'                l_vals := l_vals || '','';',
'            END IF;',
'',
'            l_cols := l_cols || l_mapping(k).tgt_col;',
'',
'            -- safe conversions',
'            IF l_mapping(k).data_type = ''NUMBER'' THEN',
'                v_expr := ''CASE WHEN REGEXP_LIKE(p.''|| l_mapping(k).parser_col ||'', ''''^-?\d+(\.\d+)?$'''') ''||',
'                          ''THEN TO_NUMBER(p.''|| l_mapping(k).parser_col ||'') ELSE NULL END'';',
'            ELSIF l_mapping(k).data_type = ''DATE'' THEN',
'                v_expr := ''CASE ''||',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-\d{2}-\d{4}\s+\d{2}:\d{2}:\d{2}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MM-YYYY HH24:MI:SS'''') ''||',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-[A-Z]{3}-\d{4}\s+\d{2}:\d{2}:\d{2}$'''', ''''i'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MON-YYYY HH24:MI:SS'''') ''||',
'                          '' ELSE NULL END'';',
'            ELSE',
'                v_expr := ''p.''|| l_mapping(k).parser_col;',
'            END IF;',
'',
'            l_vals := l_vals || v_expr;',
'        END IF;',
'        k := l_mapping.next(k);',
'    END LOOP;',
'',
'    ----------------------------------------------------------------',
'    -- 6. Try BULK insert, fallback to row-by-row on failure',
'    ----------------------------------------------------------------',
'    l_sql :=',
'        ''INSERT INTO ''|| l_table_name ||'' (HOTEL_ID,''|| l_cols ||'',INTERFACE_LOG_ID) ''||',
'        ''SELECT :hotel_id,''|| l_vals ||'',:log_id ''||',
'        ''  FROM TABLE(apex_data_parser.parse(p_content => :b1, p_file_name => :b2)) p ''||',
'        '' WHERE p.line_number > 1'';',
'',
'    BEGIN',
'        EXECUTE IMMEDIATE l_sql USING p_hotel_id, l_log_id, l_blob, l_file_name;',
'        l_success_cnt := SQL%ROWCOUNT;',
'        l_total_rows  := l_success_cnt;',
'exception',
'    when others then',
'        l_fail_cnt := l_fail_cnt + 1;',
'        -- build comma-separated row data dynamically',
'        declare',
'            l_rowdata   clob := '''';',
'            l_val       varchar2(4000);',
'            i           integer := 1;',
'            key         varchar2(128);',
'            l_col_count integer := 0;',
'            col_array   dbms_sql.varchar2_table;',
'            l_errmsg    varchar2(4000); -- store SQLERRM',
'        begin',
'            l_errmsg := sqlerrm; -- capture the error message',
'',
'            -- Prepare array of headers (columns) for the error row',
'            key := l_header.first;',
'            while key is not null loop',
'                l_col_count := l_col_count + 1;',
'                col_array(l_col_count) := key;',
'                key := l_header.next(key);',
'            end loop;',
'',
'            for j in 1 .. l_col_count loop',
'                execute immediate',
'                   ''begin :x := rec.'' || l_header(col_array(j)).tgt_col || ''; end;''',
'                using out l_val;',
'                if j > 1 then',
'                    l_rowdata := l_rowdata || '','';',
'                end if;',
'                l_rowdata := l_rowdata || nvl(l_val,'''');',
'            end loop;',
'',
'            if not l_first_err then',
'                l_error_json := l_error_json || '','';',
'            end if;',
'',
'            -- build JSON with PL/SQL variable l_errmsg',
'            l_error_json := l_error_json ||',
'                json_object(',
'                  ''File_ID'' value 10114138698744212,',
'                  ''Template_ID'' value l_template_id,',
'                  ''error'' value json_object(',
'                      ''Line_Number'' value rec.line_number,',
'                      ''data'' value l_rowdata,',
'                      ''message'' value l_errmsg',
'                  )',
'                );',
'',
'            l_first_err := false;',
'        end;',
'end;',
'',
'',
'    ----------------------------------------------------------------',
'    -- 7. Update log entry',
'    ----------------------------------------------------------------',
'    l_error_json := l_error_json || '']'';',
'',
'    UPDATE ur_interface_logs',
'       SET load_end_time      = systimestamp,',
'           load_status        = CASE WHEN l_fail_cnt = 0 THEN ''SUCCESS'' ELSE ''FAILED'' END,',
'           records_processed  = l_total_rows,',
'           records_successful = l_success_cnt,',
'           records_failed     = l_fail_cnt,',
'           error_json         = CASE WHEN l_fail_cnt > 0 THEN l_error_json ELSE NULL END,',
'           updated_by         = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'           updated_on         = sysdate',
'     WHERE id = l_log_id;',
'',
'    COMMIT;',
'',
'    p_status  := (l_fail_cnt = 0);',
'    p_message := CASE WHEN l_fail_cnt = 0',
'                 THEN ''Success: Upload completed for File ID ''||p_file_id||',
unistr('                      '' \2192 Total=''||l_total_rows||'', Success=''||l_success_cnt'),
'                 ELSE ''Completed with errors: Total=''||l_total_rows||',
'                      '', Success=''||l_success_cnt||'', Failed=''||l_fail_cnt END;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status  := FALSE;',
'        p_message := ''Failure: ''||SQLERRM;',
'',
'        UPDATE ur_interface_logs',
'           SET load_end_time = systimestamp,',
'               load_status   = ''FAILED'',',
'               error_json    = l_error_json || ''{"error":"'' || REPLACE(SQLERRM,''"'','''''''') || ''"}]'',',
'               updated_on    = sysdate',
'         WHERE id = l_log_id;',
'',
'        ROLLBACK;',
'END ur_upload_file_proc;',
'/',
'create or replace PROCEDURE validate_or_clean_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode IN CHAR,',
'    p_hotel_id IN VARCHAR2,',
'    p_status OUT VARCHAR2, -- ''S'' or ''E''',
'    p_message OUT VARCHAR2',
') IS',
'  TYPE t_str_list IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_attributes t_str_list;',
'  v_functions t_str_list;',
'  v_operators t_str_list;',
'  v_attr_count NUMBER := 0;',
'  v_func_count NUMBER := 0;',
'  v_oper_count NUMBER := 0;',
'',
'  TYPE t_token_rec IS RECORD (',
'    token VARCHAR2(4000),',
'    start_pos PLS_INTEGER,',
'    end_pos PLS_INTEGER',
'  );',
'  TYPE t_token_tab IS TABLE OF t_token_rec INDEX BY PLS_INTEGER;',
'  v_tokens t_token_tab;',
'  v_token_count PLS_INTEGER := 0;',
'',
'  TYPE t_token_tab_nt IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_unmatched_tokens t_token_tab;',
'  v_unmatched_count PLS_INTEGER := 0;',
'',
'  -- To mark tokens consumed by multi-word operators',
'  TYPE t_bool_tab IS TABLE OF BOOLEAN INDEX BY PLS_INTEGER;',
'  v_token_consumed t_bool_tab;',
'',
'  v_mode CHAR := UPPER(p_mode);',
'',
'  -- Trim and uppercase token helper',
'  FUNCTION normalize_token(p_token VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN UPPER(TRIM(p_token));',
'  END;',
'',
'  -- Strip function parameters, e.g. "ROUND (n,d)" -> "ROUND"',
'  FUNCTION normalize_func_name(p_func VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN REGEXP_REPLACE(UPPER(TRIM(p_func)), ''\s*\(.*\)$'');',
'  END;',
'',
'  -- Checks if token is numeric',
'  FUNCTION is_number(p_token VARCHAR2) RETURN BOOLEAN IS',
'  BEGIN',
'    RETURN REGEXP_LIKE(p_token, ''^[+-]?(\d+(\.\d*)?|\.\d+)([Ee][+-]?\d+)?$'');',
'  END;',
'',
'  -- Check presence in list',
'  FUNCTION is_in_list(p_token VARCHAR2, p_list t_str_list, cnt NUMBER) RETURN BOOLEAN IS',
'  BEGIN',
'    FOR i IN 1..cnt LOOP',
'      IF p_list(i) = p_token THEN',
'        RETURN TRUE;',
'      END IF;',
'    END LOOP;',
'    RETURN FALSE;',
'  END;',
'',
'  -- Check if token valid: attribute, operator, function, number, parentheses',
'  FUNCTION is_token_valid(p_token VARCHAR2) RETURN BOOLEAN IS',
'    l_token VARCHAR2(100) := p_token;',
'  BEGIN',
'    -- Parentheses always valid tokens',
'    IF l_token IN (''('', '')'') THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    -- Strip trailing ''('' from function calls',
'    IF SUBSTR(l_token, -1) = ''('' THEN',
'      l_token := SUBSTR(l_token, 1, LENGTH(l_token) - 1);',
'    END IF;',
'',
'    -- Check if number',
'    IF is_number(l_token) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    l_token := normalize_token(l_token);',
'',
'    IF is_in_list(l_token, v_attributes, v_attr_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_functions, v_func_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_operators, v_oper_count) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    RETURN FALSE;',
'  END;',
'',
'  PROCEDURE load_functions(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION FUNCTIONS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := normalize_func_name(r.return_value);',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20010, ''Functions LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_operators(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION OPERATORS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.return_value));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20011, ''Operators LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_attributes(p_hotel_id IN VARCHAR2, p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT key FROM ur_algo_attributes WHERE hotel_id = p_hotel_id',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.key));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20012, ''Attributes missing for hotel_id '' || p_hotel_id);',
'    END IF;',
'  END;',
'',
'  -- Tokenizer splitting expression into tokens, tracking start/end pos',
'  PROCEDURE tokenize_expression(p_expr IN VARCHAR2, p_tokens OUT t_token_tab, p_count OUT NUMBER) IS',
'    l_pos PLS_INTEGER := 1;',
'    l_len PLS_INTEGER := LENGTH(p_expr);',
'    l_token VARCHAR2(4000);',
'    l_token_start PLS_INTEGER;',
'    l_token_end PLS_INTEGER;',
'  BEGIN',
'    p_tokens.DELETE;',
'    p_count := 0;',
'    WHILE l_pos <= l_len LOOP',
'      l_token := REGEXP_SUBSTR(p_expr,',
'        ''([A-Za-z0-9_\.]+|\d+(\.\d+)?|\(|\)|\S)'',',
'        l_pos,',
'        1,',
'        ''i'');',
'      EXIT WHEN l_token IS NULL;',
'      l_token_start := INSTR(p_expr, l_token, l_pos);',
'      l_token_end := l_token_start + LENGTH(l_token) - 1;',
'      p_count := p_count + 1;',
'      p_tokens(p_count) := t_token_rec(token => l_token, start_pos => l_token_start, end_pos => l_token_end);',
'      l_pos := l_token_end + 1;',
'      WHILE l_pos <= l_len AND SUBSTR(p_expr, l_pos, 1) = '' '' LOOP',
'        l_pos := l_pos + 1;',
'      END LOOP;',
'    END LOOP;',
'  END;',
'',
'  FUNCTION build_json_errors(p_unmatched t_token_tab, p_count PLS_INTEGER) RETURN VARCHAR2 IS',
'    v_json VARCHAR2(4000) := ''['';',
'  BEGIN',
'    IF p_count = 0 THEN',
'      RETURN ''[]'';',
'    END IF;',
'    FOR i IN 1..p_count LOOP',
'      v_json := v_json || ''{"token":"'' || p_unmatched(i).token ||',
'                ''","start":'' || p_unmatched(i).start_pos ||',
'                '',"end":'' || p_unmatched(i).end_pos || ''}'';',
'      IF i < p_count THEN',
'        v_json := v_json || '','';',
'      END IF;',
'    END LOOP;',
'    v_json := v_json || '']'';',
'    RETURN v_json;',
'  END;',
'',
'  -- Return number of consecutive tokens matched as an operator starting at start_idx',
'  FUNCTION get_longest_operator_match(start_idx IN PLS_INTEGER) RETURN PLS_INTEGER IS',
'    combined VARCHAR2(4000);',
'    max_words CONSTANT PLS_INTEGER := 4; -- max operator words count',
'    words_count PLS_INTEGER;',
'    l_len PLS_INTEGER := LEAST(max_words, v_token_count - start_idx + 1);',
'    i PLS_INTEGER;',
'  BEGIN',
'    FOR words_count IN REVERSE 1 .. l_len LOOP',
'      combined := '''';',
'      FOR i IN start_idx .. start_idx + words_count - 1 LOOP',
'        IF combined IS NULL OR combined = '''' THEN',
'          combined := UPPER(TRIM(v_tokens(i).token));',
'        ELSE',
'          combined := combined || '' '' || UPPER(TRIM(v_tokens(i).token));',
'        END IF;',
'      END LOOP;',
'      IF is_in_list(combined, v_operators, v_oper_count) THEN',
'        RETURN words_count;',
'      END IF;',
'    END LOOP;',
'    RETURN 0;',
'  END;',
'',
'BEGIN',
'  p_status := ''E'';',
'  p_message := NULL;',
'',
'  IF v_mode NOT IN (''V'', ''C'') THEN',
'    p_status := ''E'';',
'    p_message := ''Invalid mode "'' || p_mode || ''". Valid are V or C.'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_hotel_id IS NULL THEN',
'    p_status := ''E'';',
'    p_message := ''hotel_id is mandatory'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_expression IS NULL OR LENGTH(TRIM(p_expression)) = 0 THEN',
'    p_status := ''E'';',
'    p_message := ''Expression is empty'';',
'    RETURN;',
'  END IF;',
'',
'  load_functions(v_functions, v_func_count);',
'  load_operators(v_operators, v_oper_count);',
'  load_attributes(p_hotel_id, v_attributes, v_attr_count);',
'',
'  tokenize_expression(p_expression, v_tokens, v_token_count);',
'',
'  -- Initialize consumed array',
'  v_token_consumed.DELETE;',
'',
'  DECLARE',
'    i PLS_INTEGER := 1;',
'    words_matched PLS_INTEGER := 0;',
'  BEGIN',
'    WHILE i <= v_token_count LOOP',
'      words_matched := get_longest_operator_match(i);',
'      IF words_matched > 0 THEN',
'        FOR j IN i .. i + words_matched - 1 LOOP',
'          v_token_consumed(j) := TRUE;',
'        END LOOP;',
'        i := i + words_matched;',
'      ELSE',
'        -- Single token valid check',
'        v_token_consumed(i) := is_token_valid(normalize_token(v_tokens(i).token));',
'        i := i + 1;',
'      END IF;',
'    END LOOP;',
'  END;',
'',
'  IF v_mode = ''V'' THEN',
'    v_unmatched_tokens.DELETE;',
'    v_unmatched_count := 0;',
'    FOR i IN 1 .. v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'_token_consumed(i) = FALSE THEN',
'        v_unmatched_count := v_unmatched_count + 1;',
'        v_unmatched_tokens(v_unmatched_count) := v_tokens(i);',
'      END IF;',
'    END LOOP;',
'',
'    IF v_unmatched_count > 0 THEN',
'      p_status := ''E'';',
'      p_message := ''Invalid tokens: '' || build_json_errors(v_unmatched_tokens, v_unmatched_count);',
'    ELSE',
'      p_status := ''S'';',
'      p_message := ''Expression validated successfully.'';',
'    END IF;',
'',
'  ELSIF v_mode = ''C'' THEN',
'    p_status := ''S'';',
'    p_message := '''';',
'    FOR i IN 1..v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = TRUE THEN',
'        p_message := p_message || v_tokens(i).token || '' '';',
'      END IF;',
'    END LOOP;',
'    p_message := RTRIM(p_message);',
'  END IF;',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    p_status := ''E'';',
'    p_message := ''Failure: '' || SQLERRM;',
'END validate_or_clean_expression;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_ALGOS_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER TRG_UR_ALGO_VERSIONS_BI_TRG',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'create or replace TRIGGER TRG_UR_CONTACTS_BI_TRG',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTELS_BI_TRG"',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG"',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG"',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER trg_ur_report_dashboards_bi',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := REGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'create or replace TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_TEMPLATES',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'create or replace TRIGGER "UR_ADAM_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_ADAM_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_ADAM_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_BHAUMIK_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_BHAUMIK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_BHAUMIK_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_22SEPT1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_22SEPT_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_28_SEP_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_28_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_28_SEP_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_STAY_DATE_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_TEST_111_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_111_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_111_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_CHINAR_TEST_112_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_112_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_112_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN11_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN11_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN11_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_DAILY_BREAKDOWN_VK_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_EXPENSE_TEMPLATE_02_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXPENSE_TEMPLATE_02_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_2122122_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_2122122_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_212212_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_212212_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_21221_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_21221_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_21_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_21_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_3_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_3_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_EXP_REPORT_T_BI_TRG"',
'      BEFORE INSERT ON "UR_EXP_REPORT_T"',
'      FOR EACH ROW',
'      WHEN (NEW.ID IS NULL)',
'      BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'create or replace TRIGGER "UR_INDIGO_L_SQUARE_I_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_I_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_I_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_INDIGO_L_SQUARE_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_LOS1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_LOS1_YORK_2_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'  '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'  :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_2_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_LOS1_YORK_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_LOS3_YORK_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_LOS3_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS3_YORK_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST1_22_CHINAR_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST1_22_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST1_22_CHINAR_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_29_SEP_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_29_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_29_SEP_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_2_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_2_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_NEWEST_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NEWEST_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NEWEST_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_NEW_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_NO_USC_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_CHINAR_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_STACY_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_STACY_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_STACY_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TEST_TEMPLATE_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TEST_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_TEMPLATE_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_TT_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_TT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TT_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_UR_CHINAR_QUAL_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_UR_CHINAR_QUAL_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_UR_CHINAR_QUAL_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_250915_1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_250915_2_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_2_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_250915_3_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_3_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_250915_4_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_4_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_250915_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_ATT_QUAL1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_ATT_QUAL1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_ATT_QUAL1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_LEAVE_SETUP_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_LEAVE_SETUP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_LEAVE_SETUP_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_NEW_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_NEW_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_NEW_CHINAR_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_SAMPLE_HOTEL_DATA_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_SEG1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEG1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEG1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_SEGMENT_QUALIFIER_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_VK_TMS_TASK_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_VK_TMS_TASK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_TMS_TASK_T_BI_TRG;',
'/',
'create or replace TRIGGER "UR_YORK_LOS1_T_BI_TRG"',
'BEFORE INSERT OR UPDATE ON "UR_YORK_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_YORK_LOS1_T_BI_TRG;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace TYPE log_rec_obj AS OBJECT (',
'    log_id        NUMBER,',
'    log_message   VARCHAR2(255)',
')',
'/',
'create or replace TYPE log_tab_type AS TABLE OF log_rec_obj;',
'CREATE OR REPLACE PACKAGE pkg_log_data_trg AS',
'    -- Global variable now uses the SQL type',
'    g_log_data_tab log_tab_type;',
'',
'    PROCEDURE init;',
'    PROCEDURE process;',
'END pkg_log_data_trg',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGOHOTELS_R2_V" ("HOTELID", "BOOKING_ID - VK Sample Hotel Data", "BOOKING_DATE - VK Sample Hotel Data", "NUMBER_OF_ROOMS - VK Sample Hotel Data", "BOOKING_ID - test template", "BOOKING_DATE - test t'
||'emplate", "NUMBER_OF_ROOMS - test template") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS "BOOKING_ID - VK Sample Hotel Data",',
'       t1_rn.BOOKING_DATE AS "BOOKING_DATE - VK Sample Hotel Data",',
'       t1_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - VK Sample Hotel Data",',
'       t2_rn.BOOKING_ID AS "BOOKING_ID - test template",',
'       t2_rn.BOOKING_DATE AS "BOOKING_DATE - test template",',
'       t2_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - test template"',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGOHOTELS_R6_V" ("HOTELID", "BOOKING_ID - VK Sample Hotel Data", "BOOKING_DATE - VK Sample Hotel Data", "BOOKING_ID - test template", "OCCUPANCY__ - test template", "REVENUE - test template") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, BOOKING_ID, OCCUPANCY__, REVENUE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS "BOOKING_ID - VK Sample Hotel Data",',
'       t1_rn.BOOKING_DATE AS "BOOKING_DATE - VK Sample Hotel Data",',
'       t2_rn.BOOKING_ID AS "BOOKING_ID - test template",',
'       t2_rn.OCCUPANCY__ AS "OCCUPANCY__ - test template",',
'       t2_rn.REVENUE AS "REVENUE - test template"',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGOHOTELS_REPORT1_V" ("HOTELID", "BOOKING_ID - VK Sample Hotel Data", "NUMBER_OF_ROOMS - VK Sample Hotel Data", "REVENUE - test template", "STAY_DATE - test template") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, REVENUE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY REVENUE) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS "BOOKING_ID - VK Sample Hotel Data",',
'       t1_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - VK Sample Hotel Data",',
'       t2_rn.REVENUE AS "REVENUE - test template",',
'       t2_rn.STAY_DATE AS "STAY_DATE - test template"',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGOHOTELS_REPORT24_V" ("HOTELID", "NUMBER_OF_ROOMS - VK Sample Hotel Data", "BOOKING_ID - VK Sample Hotel Data", "GUEST_COUNTRY - VK Sample Hotel Data", "BOOKING_DATE - VK Sample Hotel Data", "BOOKI'
||'NG_ID - test template", "OCCUPANCY__ - test template", "ADR__USD_ - test template", "NUMBER_OF_ROOMS - test template") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, NUMBER_OF_ROOMS, BOOKING_ID, GUEST_COUNTRY, BOOKING_DATE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY NUMBER_OF_ROOMS) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, BOOKING_ID, OCCUPANCY__, ADR__USD_, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - VK Sample Hotel Data",',
'       t1_rn.BOOKING_ID AS "BOOKING_ID - VK Sample Hotel Data",',
'       t1_rn.GUEST_COUNTRY AS "GUEST_COUNTRY - VK Sample Hotel Data",',
'       t1_rn.BOOKING_DATE AS "BOOKING_DATE - VK Sample Hotel Data",',
'       t2_rn.BOOKING_ID AS "BOOKING_ID - test template",',
'       t2_rn.OCCUPANCY__ AS "OCCUPANCY__ - test template",',
'       t2_rn.ADR__USD_ AS "ADR__USD_ - test template",',
'       t2_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - test template"',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGOHOTELS_REPORTTEMP_V" ("HOTELID", "BOOKING_ID - VK Sample Hotel Data", "BOOKING_DATE - VK Sample Hotel Data", "OCCUPANCY__ - test template", "NUMBER_OF_ROOMS - test template") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, OCCUPANCY__, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY OCCUPANCY__) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS "BOOKING_ID - VK Sample Hotel Data",',
'       t1_rn.BOOKING_DATE AS "BOOKING_DATE - VK Sample Hotel Data",',
'       t2_rn.OCCUPANCY__ AS "OCCUPANCY__ - test template",',
'       t2_rn.NUMBER_OF_ROOMS AS "NUMBER_OF_ROOMS - test template"',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_INDIGO_HOTELS_R2_V" ("HOTELID", "T1_RN_BOOKING_ID", "T1_RN_BOOKING_DATE", "T1_RN_NUMBER_OF_ROOMS", "T1_RN_GUEST_COUNTRY", "T1_RN_REVENUE", "T2_RN_BOOKING_ID", "T2_RN_BOOKING_DATE", "T2_RN_NUMBER_OF_ROO'
||'MS") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, NUMBER_OF_ROOMS, GUEST_COUNTRY, REVENUE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_VK_SAMPLE_HOTEL_DATA_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
'),',
't2_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, NUMBER_OF_ROOMS, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_TEST_TEMPLATE_T',
'  WHERE hotel_id = ''3B9B828094379CA8E063DD59000AC846''',
')',
'SELECT COALESCE(t1_rn.hotel_id, t2_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS t1_rn_BOOKING_ID,',
'       t1_rn.BOOKING_DATE AS t1_rn_BOOKING_DATE,',
'       t1_rn.NUMBER_OF_ROOMS AS t1_rn_NUMBER_OF_ROOMS,',
'       t1_rn.GUEST_COUNTRY AS t1_rn_GUEST_COUNTRY,',
'       t1_rn.REVENUE AS t1_rn_REVENUE,',
'       t2_rn.BOOKING_ID AS t2_rn_BOOKING_ID,',
'       t2_rn.BOOKING_DATE AS t2_rn_BOOKING_DATE,',
'       t2_rn.NUMBER_OF_ROOMS AS t2_rn_NUMBER_OF_ROOMS',
'FROM t1_rn',
'JOIN t2_rn',
'    ON t1_rn.hotel_id = t2_rn.hotel_id',
'   AND t1_rn.STAY_DATE = t2_rn.STAY_DATE',
'ORDER BY COALESCE(t1_rn.rn, t2_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE FORCE EDITIONABLE VIEW "TEMP_MARRIOTCENTRALLONDON_R1_V" ("HOTELID", "T1_RN_BOOKING_ID", "T1_RN_BOOKING_DATE") AS ',
'  WITH t1_rn AS (',
'  SELECT hotel_id, BOOKING_ID, BOOKING_DATE, STAY_DATE,',
'         ROW_NUMBER() OVER (PARTITION BY hotel_id ORDER BY BOOKING_ID) rn',
'  FROM UR_TEST_CHINAR_T',
'  WHERE hotel_id = ''3B9B847282589D45E063DD59000A6D5F''',
')',
'SELECT COALESCE(t1_rn.hotel_id, null) AS hotelid,',
'       t1_rn.BOOKING_ID AS t1_rn_BOOKING_ID,',
'       t1_rn.BOOKING_DATE AS t1_rn_BOOKING_DATE',
'FROM t1_rn',
'',
'ORDER BY COALESCE(t1_rn.rn,0)  ;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_ADAM_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ADAM_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_ADAM_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_ADAM_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ADDRESSES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.CREATED_BY := v_current_user;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO v_current_user FROM UR_USERS WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        :NEW.UPDATED_BY := v_current_user;',
'        :NEW.UPDATED_ON '))
);
end;
/
begin
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
':= SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ADDRESSES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGOS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGOS"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id ',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGOS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_ALGO_ATTRIBUTES"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch USER_ID from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Set default DATA_TYPE if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Set default TYPE if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'    -- Automatically generate KEY from NAME using UR_UTILS.Clean_TEXT if KEY is null or empty',
'    IF :NEW.KEY IS NULL OR TRIM(:NEW.KEY) = '''' THEN',
'      :NEW.KEY := UR_UTILS.Clean_TEXT(:NEW.NAME);',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Do NOT modify KEY during update, leave as is',
'',
'    -- Ensure DATA_TYPE defaults if null',
'    IF :NEW.DATA_TYPE IS NULL THEN',
'      :NEW.DATA_TYPE := ''NUMBER'';',
'    END IF;',
'',
'    -- Ensure TYPE defaults if null',
'    IF :NEW.TYPE IS NULL THEN',
'      :NEW.TYPE := ''M'';',
'    END IF;',
'',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_ATTRIBUTES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_ALGO_VERSIONS',
'FOR EACH ROW',
'DECLARE',
'  v_user_id RAW(16);',
'  v_max_version NUMBER;',
'  v_new_version NUMBER;',
'BEGIN',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Fetch user_id from UR_USERS based on APEX session user',
'  SELECT USER_ID INTO v_user_id',
'  FROM UR_USERS',
'  WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF INSERTING THEN',
'    -- Set audit columns',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- Auto increment VERSION',
'    BEGIN',
'      SELECT MAX(TO_NUMBER(VERSION)) INTO v_max_version',
'      FROM UR_ALGO_VERSIONS',
'      WHERE ALGO_ID = :NEW.ALGO_ID;',
'',
'      v_new_version := NVL(v_max_version, 0) + 1;',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_new_version := 1;',
'      WHEN VALUE_ERROR THEN',
'        -- version column has non-numeric values - fallback to 1',
'        v_new_version := 1;',
'    END;',
'    :NEW.VERSION := TO_CHAR(v_new_version);',
'',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Update UR_ALGOS table CURRENT_VERSION_ID to the VERSION record ID that was just inserted/updated',
'  UPDATE UR_ALGOS',
'  SET CURRENT_VERSION_ID = :NEW.ID,',
'      UPDATED_BY = v_user_id,',
'      UPDATED_ON = SYSDATE',
'  WHERE ID = :NEW.ALGO_ID;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_ALGO_VERSIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_BHAUMIK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_BHAUMIK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_BHAUMIK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_BHAUMIK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_22SEPT1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_22SEPT1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_22SEPT_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_22SEPT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_22SEPT_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_22SEPT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_28_SEP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_28_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_28_SEP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_28_SEP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_STAY_DATE_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_TEST_111_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_111_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_111_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_TEST_111_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_CHINAR_TEST_112_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_CHINAR_TEST_112_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_CHINAR_TEST_112_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_CHINAR_TEST_112_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_CONTACTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_CONTACTS',
'FOR EACH ROW',
'DECLARE',
'    v_primary_count NUMBER;',
'    v_user_id RAW(16);',
'BEGIN',
'    -- Assign ID if null',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback in case no user found',
'        END;',
'',
'        :NEW.CREATED_BY := v_user_id;',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        BEGIN',
'            SELECT USER_ID INTO v_user_id',
'              FROM UR_USERS',
'             WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                v_user_id := SYS_GUID();  -- fallback if user unknown',
'        END;',
'',
'        :NEW.UPDATED_BY := v_user_id;',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'',
'    -- Enforce only one PRIMARY=''Y'' per HOTEL_ID',
'    IF :NEW.PRIMARY = ''Y'' THEN',
'        SELECT COUNT(*)',
'          INTO v_primary_count',
'          FROM UR_CONTACTS',
'         WHERE HOTEL_ID = :NEW.HOTEL_ID',
'           AND PRIMARY = ''Y''',
'           AND ID != :NEW.ID;',
'',
'        IF v_primary_count > 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''Only one PRIMARY contact allowed per HOTEL_ID'');',
'        END IF;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_CONTACTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN11_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN11_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN11_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN11_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_DAILY_BREAKDOWN_VK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_DAILY_BREAKDOWN_VK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_DAILY_BREAKDOWN_VK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_DAILY_BREAKDOWN_VK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_EVENTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_EVENTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        -- Assign a new GUID if EVENT_ID is null (typical on insert)',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY ',
'        FROM UR_USERS ',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_EVENTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXPENSE_TEMPLATE_02_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXPENSE_TEMPLATE_02_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXPENSE_TEMPLATE_02_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_2122122_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_2122122_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_2122122_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_212212_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_212212_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_212212_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_21221_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_21221_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_21221_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_21_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_21_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_21_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_3_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_3_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_EXP_REPORT_T_BI_TRG" ',
'      BEFORE INSERT ON "UR_EXP_REPORT_T"',
'      FOR EACH ROW',
'       WHEN (NEW.ID IS NULL) BEGIN',
'        :NEW.ID := SYS_GUID();',
'      END;',
'    ',
'/',
'ALTER TRIGGER "UR_EXP_REPORT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTELS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTELS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'        IF :NEW.CURRENCY_CODE IS NULL THEN',
'            :NEW.CURRENCY_CODE := ''GBP'';',
'        END IF;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTELS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_GROUPS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_GROUPS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_RESERVATIONS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_RESERVATIONS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_HOTEL_ROOM_TYPES',
'FOR EACH ROW',
'DECLARE',
'    v_current_user RAW(16);',
'BEGIN',
'  -- The following line is problematic in a row-level trigger and should generally be avoided.',
'  -- Date columns store date and time internally, the format is for display.',
'  -- execute immediate q''[alter session set nls_date_format=''YYYY-MM-DD HH24:MI:SS'']'';',
'',
'  IF :NEW.ROOM_TYPE_ID IS NULL THEN',
'    -- Assign a new GUID if ROOM_TYPE_ID is null (for new records typically)',
'    :NEW.ROOM_TYPE_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    ',
'    SELECT USER_ID INTO :NEW.CREATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.CREATED_ON := SYSDATE;',
'    -- For new records, UPDATED_BY and UPDATED_ON are also set initially.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  IF UPDATING THEN',
'    -- When updating an existing record, update UPDATED_BY and UPDATED_ON.',
'    SELECT USER_ID INTO :NEW.UPDATED_BY FROM UR_USERS WHERE USER_NAME = (SYS_CONTEXT (''APEX$SESSION'', ''APP_USER''));',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_HOTEL_ROOM_TYPES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_INDIGO_L_SQUARE_I_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_I_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_I_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_INDIGO_L_SQUARE_I_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_INDIGO_L_SQUARE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_INDIGO_L_SQUARE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_INDIGO_L_SQUARE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_INDIGO_L_SQUARE_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_INTERFACE_LOGS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_INTERFACE_LOGS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_YORK_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_YORK_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS1_YORK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS1_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS1_YORK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS1_YORK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_LOS3_YORK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_LOS3_YORK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_LOS3_YORK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_LOS3_YORK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORTS_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_REPORTS',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORTS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ',
'BEFORE INSERT OR UPDATE ON UR_REPORT_DASHBOARDS',
'FOR EACH ROW',
'DECLARE',
'  v_hotel_name VARCHAR2(100);',
'  v_key_candidate VARCHAR2(110);',
'  v_user_id RAW(16);',
'  v_json_error EXCEPTION;',
'  PRAGMA EXCEPTION_INIT(v_json_error, -22827); -- ORA-22827 JSON parse error code',
'  ',
'BEGIN',
'  -- Set ID if NULL',
'  IF :NEW.ID IS NULL THEN',
'    :NEW.ID := SYS_GUID();',
'  END IF;',
'',
'  -- Default CREATED_BY, UPDATED_BY, CREATED_ON, UPDATED_ON depending on insert/update',
'  IF INSERTING THEN',
'',
'    -- Fetch CURRENT USER ID from UR_USERS via APEX user',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.CREATED_BY := v_user_id;',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20001, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_ON := SYSDATE;',
'',
'    -- ACTIVE default',
'    IF :NEW.ACTIVE IS NULL THEN',
'      :NEW.ACTIVE := ''Y'';',
'    END IF;',
'',
'    -- If HOTEL_ID is provided and Name/Key are NULL or empty, derive from Hotel''s name',
'    IF :NEW.HOTEL_ID IS NOT NULL THEN',
'      SELECT HOTEL_NAME INTO v_hotel_name FROM UR_HOTELS WHERE ID = :NEW.HOTEL_ID;',
'',
'      -- Populate NAME if empty',
'      IF :NEW.NAME IS NULL OR TRIM(:NEW.NAME) = '''' THEN',
'        :NEW.NAME := v_hotel_name;',
'      END IF;',
'',
'      -- Populate KEY if empty',
'      IF :NEW."KEY" IS NULL OR TRIM(:NEW."KEY") = '''' THEN',
'        -- Derive KEY from hotel name (uppercase, replace spaces with underscore, remove special chars except _)',
'        v_key_candidate := REGEXP_REPLACE(UPPER(v_hotel_name), ''[^A-Z0-9_]'', '''');',
'        v_key_candidate := REPLACE(v_key_candidate, '' '', ''_'');  -- Redundant after regex but keep for clarity',
'',
'        -- Append ''_DASHBOARD'' suffix if not already present',
'        IF NOT v_key_candidate LIKE ''%_DASHBOARD'' THEN',
'          v_key_candidate := v_key_candidate || ''_DASHBOARD'';',
'        END IF;',
'',
'        :NEW."KEY" := v_key_candidate;',
'      END IF;',
'    END IF;',
'',
'  ELSIF UPDATING THEN',
'',
'    -- Refresh UPDATED_BY and UPDATED_ON regardless',
'    BEGIN',
'      SELECT USER_ID INTO v_user_id',
'      FROM UR_USERS',
'      WHERE USER_NAME = SYS_CONTEXT('''))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'APEX$SESSION'', ''APP_USER'');',
'    EXCEPTION',
'      WHEN NO_DATA_FOUND THEN',
'        v_user_id := NULL;',
'    END;',
'',
'    IF v_user_id IS NOT NULL THEN',
'      :NEW.UPDATED_BY := v_user_id;',
'    ELSE',
'      RAISE_APPLICATION_ERROR(-20002, ''Unable to find USER_ID for current APEX user'');',
'    END IF;',
'',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'',
'  -- Validate DEFINITION is valid JSON - raise error if not',
'  BEGIN',
'    -- Attempt to parse JSON in DEFINITION by wrapping in JSON_EXISTS which fails if invalid',
'    IF NOT JSON_EXISTS(:NEW.DEFINITION, ''$'') THEN',
'      RAISE_APPLICATION_ERROR(-20003, ''Definition column contains invalid JSON data.'');',
'    END IF;',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      RAISE_APPLICATION_ERROR(-20004, ''Definition column contains invalid JSON data.'');',
'  END;',
'',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_REPORT_DASHBOARDS_BI" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON UR_TEMPLATES',
'FOR EACH ROW',
'BEGIN',
'    IF :NEW.ID IS NULL THEN',
'        :NEW.ID := SYS_GUID();',
'    END IF;',
'',
'    IF INSERTING THEN',
'        SELECT USER_ID INTO :NEW.CREATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.CREATED_ON := SYSDATE;',
'',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'        SELECT USER_ID INTO :NEW.UPDATED_BY',
'          FROM UR_USERS',
'         WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'        :NEW.UPDATED_ON := SYSDATE;',
'    END IF;',
'END;',
'/',
'ALTER TRIGGER "TRG_UR_TEMPLATES_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST1_22_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST1_22_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST1_22_CHINAR_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST1_22_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_29_SEP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_29_SEP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_29_SEP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_29_SEP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NEWEST_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NEWEST_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NEWEST_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NEWEST_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_NEW_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_NO_USC_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_NO_USC_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_NO_USC_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_NO_USC_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_CHINAR_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_STACY_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_STACY_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_STACY_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_STACY_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TEST_TEMPLATE_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TEST_TEMPLATE_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TEST_TEMPLATE_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TEST_TEMPLATE_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_TT_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_TT_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_TT_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_TT_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_UR_CHINAR_QUAL_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_UR_CHINAR_QUAL_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_UR_CHINAR_QUAL_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_UR_CHINAR_QUAL_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "TRG_UR_USERS_BI_TRG" ',
'FOR INSERT OR UPDATE ON ur_users',
'COMPOUND TRIGGER',
'',
'  BEFORE EACH ROW IS',
'    l_current_user_id UR_USERS.USER_ID%TYPE;',
'  BEGIN',
'    IF INSERTING THEN',
'      -- generate PK if not provided',
'      IF :NEW.user_id IS NULL THEN',
'        :NEW.user_id := SYS_GUID();',
'      END IF;',
'',
'      -- set created_by / updated_by from session package (if available)',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.created_by := l_current_user_id;',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'',
'      -- timestamps (respect any pre-filled created_on)',
'      IF :NEW.created_on IS NULL THEN',
'        :NEW.created_on := SYSDATE;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'',
'    ELSIF UPDATING THEN',
'      l_current_user_id := app_user_ctx.get_current_user_id;',
'      IF l_current_user_id IS NOT NULL THEN',
'        :NEW.updated_by := l_current_user_id;',
'      END IF;',
'      :NEW.updated_on := SYSDATE;',
'    END IF;',
'  END BEFORE EACH ROW;',
'',
'END trg_ur_users_bi_trg;',
'/',
'ALTER TRIGGER "TRG_UR_USERS_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_3_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_3_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_3_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_3_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_4_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_4_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_4_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_4_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_250915_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_250915_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_250915_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_250915_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_ATT_QUAL1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_ATT_QUAL1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_ATT_QUAL1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_ATT_QUAL1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_LEAVE_SETUP_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_LEAVE_SETUP_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_LEAVE_SETUP_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_LEAVE_SETUP_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_NEW_CHINAR_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_NEW_CHINAR_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_NEW_CHINAR_T_BI_TRG;',
'/',
'ALTER TRIGGER "UR_VK_NEW_CHINAR_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SAMPLE_HOTEL_DATA_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEG1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEG1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEG1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEG1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER2_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_SEGMENT_QUALIFIER_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_SEGMENT_QUALIFIER_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_SEGMENT_QUALIFIER_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_SEGMENT_QUALIFIER_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_VK_TMS_TASK_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_VK_TMS_TASK_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_VK_TMS_TASK_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_VK_TMS_TASK_T_BI_TRG" ENABLE;',
'',
'  CREATE OR REPLACE EDITIONABLE TRIGGER "UR_YORK_LOS1_T_BI_TRG" ',
'BEFORE INSERT OR UPDATE ON "UR_YORK_LOS1_T"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END UR_YORK_LOS1_T_BI_TRG;',
'',
'/',
'ALTER TRIGGER "UR_YORK_LOS1_T_BI_TRG" ENABLE;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace FUNCTION get_profile_json (',
'  p_blob     BLOB,',
'  p_filename VARCHAR2',
') RETURN CLOB IS',
'  l_result  apex_data_parser.t_parser_profile;',
'BEGIN',
'  l_result := apex_data_parser.discover(',
'    p_content   => p_blob,',
'    p_file_name => p_filename',
'  );',
'  RETURN l_result.profile;',
'END;',
'/',
'create or replace FUNCTION guess_delimiter (',
'    p_blob IN BLOB',
') RETURN VARCHAR2 IS',
'    l_raw        RAW(32767);',
'    l_varchar2   VARCHAR2(32767);',
'    l_first_line VARCHAR2(4000);',
'    l_comma_count NUMBER := 0;',
'    l_semicolon_count NUMBER := 0;',
'    l_pipe_count NUMBER := 0;',
'    l_tab_count NUMBER := 0;',
'    l_crlf_pos NUMBER;',
'    l_lf_pos NUMBER;',
'BEGIN',
'    -- Read the first part of the BLOB',
'    l_raw := DBMS_LOB.SUBSTR(p_blob, 32767, 1);',
'    ',
'    -- Convert RAW to VARCHAR2',
'    l_varchar2 := UTL_RAW.CAST_TO_VARCHAR2(l_raw);',
'    ',
'    -- Find the end of the first line (CRLF or LF)',
'    l_crlf_pos := INSTR(l_varchar2, CHR(13) || CHR(10));',
'    l_lf_pos := INSTR(l_varchar2, CHR(10));',
'',
'    IF l_crlf_pos > 0 THEN',
'        l_first_line := SUBSTR(l_varchar2, 1, l_crlf_pos - 1);',
'    ELSIF l_lf_pos > 0 THEN',
'        l_first_line := SUBSTR(l_varchar2, 1, l_lf_pos - 1);',
'    ELSE',
'        l_first_line := l_varchar2;',
'    END IF;',
'',
'    -- Count occurrences of common delimiters',
'    l_comma_count := REGEXP_COUNT(l_first_line, '','');',
'    l_semicolon_count := REGEXP_COUNT(l_first_line, '';'');',
'    l_pipe_count := REGEXP_COUNT(l_first_line, ''\|'');',
'    l_tab_count := REGEXP_COUNT(l_first_line, CHR(9));',
'    ',
'    -- Determine the most likely delimiter',
'    IF l_comma_count > l_semicolon_count AND l_comma_count > l_pipe_count AND l_comma_count > l_tab_count THEN',
'        RETURN '','';',
'    ELSIF l_semicolon_count > l_comma_count AND l_semicolon_count > l_pipe_count AND l_semicolon_count > l_tab_count THEN',
'        RETURN '';'';',
'    ELSIF l_pipe_count > l_comma_count AND l_pipe_count > l_semicolon_count AND l_pipe_count > l_tab_count THEN',
'        RETURN ''|'';',
'    ELSIF l_tab_count > 0 THEN -- Tabs are a common delimiter but are hard to distinguish with text',
'        RETURN CHR(9);',
'    ELSE',
'        -- Default to comma or return null if none are found',
'        RETURN '','';',
'    END IF;',
'END;',
'/',
'create or replace FUNCTION sanitize_column_name(p_name IN VARCHAR2) ',
'   RETURN VARCHAR2',
'IS',
'    v_name VARCHAR2(4000);',
'BEGIN',
'    -- Replace non-alphanumeric characters with underscore',
'    v_name := REGEXP_REPLACE(p_name, ''[^A-Za-z0-9]'', ''_'');',
'',
'    -- Replace multiple consecutive underscores with a single underscore',
'    v_name := REGEXP_REPLACE(v_name, ''_+'', ''_'');',
'',
'    -- Trim leading and trailing underscores',
'    v_name := REGEXP_REPLACE(v_name, ''^_+|_+$'', '''');',
'',
'    -- Convert to uppercase',
'    RETURN UPPER(v_name);',
'END sanitize_column_name;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'create or replace PACKAGE BODY Graph_SQL AS',
'',
'  -- Type to hold column info',
'  TYPE t_colrec IS RECORD (',
'    col_name    VARCHAR2(30),',
'    data_type   VARCHAR2(30),',
'    nullable    VARCHAR2(1),   -- ''Y'' or ''N''',
'    data_length NUMBER,',
'    data_precision NUMBER,',
'    data_scale  NUMBER,',
'    is_pk       BOOLEAN,',
'    default_val VARCHAR2(4000)',
'  );',
'  TYPE t_colrec_tab IS TABLE OF t_colrec INDEX BY PLS_INTEGER;',
'',
'  -- Debug utility',
'  PROCEDURE dbg(p_msg VARCHAR2, p_debug_flag VARCHAR2) IS',
'  BEGIN',
'    IF p_debug_flag = ''Y'' THEN',
'      BEGIN',
'        APEX_DEBUG.MESSAGE(p_msg);',
'        ',
'      EXCEPTION WHEN OTHERS THEN',
'        DBMS_OUTPUT.put_line(p_msg);',
'      END;',
'    END IF;',
'  END;',
'',
'  -- Get table metadata',
'  FUNCTION get_table_columns(p_table VARCHAR2) RETURN t_colrec_tab IS',
'    cols t_colrec_tab;',
'    idx  PLS_INTEGER := 0;',
'    TYPE t_varchar2_tab IS TABLE OF VARCHAR2(30);',
'    pk_cols t_varchar2_tab;',
'  BEGIN',
'    -- Fetch PKs',
'    SELECT cols.column_name',
'    BULK COLLECT INTO pk_cols',
'    FROM user_constraints cons',
'    JOIN user_cons_columns cols',
'      ON cons.constraint_name = cols.constraint_name',
'    WHERE cons.constraint_type = ''P''',
'      AND cons.table_name = UPPER(p_table);',
'',
'    -- Fetch all columns',
'    FOR r IN (',
'      SELECT column_name, data_type, nullable,',
'             data_length, data_precision, data_scale, data_default',
'      FROM user_tab_columns',
'      WHERE table_name = UPPER(p_table)',
'      ORDER BY column_id',
'    ) LOOP',
'      idx := idx + 1;',
'      cols(idx).col_name := r.column_name;',
'      cols(idx).data_type := r.data_type;',
'      cols(idx).nullable := r.nullable;',
'      cols(idx).data_length := r.data_length;',
'      cols(idx).data_precision := r.data_precision;',
'      cols(idx).data_scale := r.data_scale;',
'      cols(idx).is_pk := (r.column_name MEMBER OF pk_cols);',
'      cols(idx).default_val := r.data_default;',
'    END LOOP;',
'',
'    RETURN cols;',
'  END;',
'',
'  -- Sample value helper',
'  FUNCTION sample_value(p_col t_colrec) RETURN VARCHAR2 IS',
'  BEGIN',
'    IF p_col.is_pk THEN',
'      IF UPPER(p_col.data_type) = ''RAW'' THEN',
'        RETURN LOWER(RAWTOHEX(SYS_GUID()));',
'      ELSE',
'        RETURN ''PK_VALUE'';',
'      END IF;',
'    END IF;',
'',
'    CASE UPPER(p_col.data_type)',
'      WHEN ''NUMBER'' THEN RETURN ''123'';',
'      WHEN ''DATE'' THEN RETURN TO_CHAR(SYSDATE, ''YYYY-MM-DD'');',
'      WHEN ''TIMESTAMP(6)'' THEN RETURN TO_CHAR(SYSTIMESTAMP, ''YYYY-MM-DD"T"HH24:MI:SS'');',
'      WHEN ''RAW'' THEN RETURN LOWER(RAWTOHEX(SYS_GUID()));',
'      ELSE RETURN ''SampleText'';',
'    END CASE;',
'  END;',
'',
'  -- Main procedure',
'  PROCEDURE proc_crud_json(',
'    p_mode      IN VARCHAR2,',
'    p_table     IN VARCHAR2,',
'    p_payload   IN CLOB,',
'    p_debug     IN VARCHAR2 DEFAULT ''N'',',
'    p_status    OUT VARCHAR2,',
'    p_message   OUT CLOB,',
'    p_icon out varchar2,',
'    p_title out varchar2',
'  ) IS',
'    l_cols t_colrec_tab;',
'  BEGIN',
'    dbg(''Start proc_crud_json, mode=''||p_mode, p_debug);',
'',
'    ------------------------------------------------------------------',
'    -- F = FETCH METADATA',
'    ------------------------------------------------------------------',
'    IF UPPER(p_mode) = ''F'' THEN',
'      l_cols := get_table_columns(p_table);',
'      IF l_cols.COUNT = 0 THEN',
'        p_status := ''E'';',
'        p_message := ''Table "''||p_table||''" does not exist or has no columns'';',
'        RETURN;',
'      END IF;',
'    ',
'      -- Build JSON metadata',
'      DECLARE',
'        l_json_response JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_fields       JSON_ARRAY_T := JSON_ARRAY_T();',
'        l_mandatories  JSON_ARRAY_T := JSON_ARRAY_T();',
'        l_sample_c     JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_sample_u     JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_sample_d     JSON_OBJECT_T := JSON_OBJECT_T();',
'      BEGIN',
'        FOR i IN 1 .. l_cols.COUNT LOOP',
'          DECLARE',
'            l_field_obj JSON_OBJECT_T := JSON_OBJECT_T();',
'          BEGIN',
'          ',
'            l_field_obj.put(''column_name'', l_cols(i).col_name);',
'            l_field_obj.put(''data_type'', l_cols(i).data_type);',
'            l_field_obj.put(''nullable'', l_cols(i).nullable);',
'            l_field_obj.put(''is_primary_key'', CASE WHEN l_cols(i).is_pk THEN ''Y'' ELSE ''N'' END);',
'            l_field_obj.put(''default_value'', l_cols(i).default_val);',
'            l_field_obj.put(''sample_value'', sample_value(l_cols(i)));',
'            l_fields.append(l_field_obj);',
'',
'            IF l_cols(i).nullable = ''N'' OR l_cols(i).is_pk THEN',
'              l_mandatories.append(l_cols(i).col_name);',
'              l_sample_c.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'            END IF;',
'',
'            IF l_cols(i).is_pk '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'THEN',
'              l_sample_u.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'              l_sample_d.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'            ELSE',
'              IF l_cols(i).nullable = ''Y'' THEN',
'                l_sample_u.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'              END IF;',
'            END IF;',
'          END;',
'        END LOOP;',
'',
'        l_json_response.put(''fields'', l_fields);',
'        l_json_response.put(''mandatory_columns'', l_mandatories);',
'        l_json_response.put(''sample_create_payload'', l_sample_c);',
'        l_json_response.put(''sample_update_payload'', l_sample_u);',
'        l_json_response.put(''sample_delete_payload'', l_sample_d);',
'',
'        p_status := ''S'';',
'        p_message := l_json_response.to_string;',
'      END;',
'',
'',
'------------------------------------------------------------------',
'-- C = CREATE / INSERT (dynamic, JSON-driven)',
'------------------------------------------------------------------',
'ELSIF UPPER(p_mode) = ''C'' THEN',
'  dbg(''Entering CREATE mode for table ''||p_table, p_debug);',
'',
'  DECLARE',
'    l_sql         VARCHAR2(32767);',
'    l_insert_cols VARCHAR2(32767) := '''';',
'    l_insert_vals VARCHAR2(32767) := '''';',
'    l_val         VARCHAR2(4000);',
'    l_clob         clob;',
'    c             INTEGER;',
'    rc            INTEGER;',
'    l_any_found   BOOLEAN := FALSE;',
'    l_new_id      RAW(16);  -- Generate SYS_GUID manually',
'  BEGIN',
'    -- Generate new ID',
'    l_new_id := SYS_GUID();',
'',
'    -- Load column metadata for the target table',
'    l_cols := get_table_columns(p_table);',
'    IF l_cols.COUNT = 0 THEN',
'      p_status  := ''E'';',
'      p_message := ''Table "''||p_table||''" does not exist or has no columns'';',
'      RETURN;',
'    END IF;',
'    -- Build column and bind lists',
'    FOR i IN 1 .. l_cols.COUNT LOOP',
'    ',
'      IF UPPER(l_cols(i).col_name) = ''ID'' THEN',
'         l_val := (l_new_id);  -- assign SYS_GUID for ID',
'      ELSE',
'            l_val :=  json_query( p_payload , ''$."''||l_cols(i).col_name||''"'' returning clob)  ;   -- Need to add col type if clob type  ---------------------------------------------',
'       -- l_val := json_value(p_payload, ''$."''||l_cols(i).col_name||''"'');',
'      END IF;',
'      IF l_val IS NOT NULL THEN',
'        l_any_found := TRUE;',
'        l_insert_cols := l_insert_cols || l_cols(i).col_name || '','';',
'        l_insert_vals := l_insert_vals || '':'' || l_cols(i).col_name || '','';',
'      END IF;',
'    END LOOP;',
'    IF NOT l_any_found THEN',
'      p_status  := ''E'';',
'      p_message := ''No matching columns found in payload for insert'';',
'      RETURN;',
'    END IF;',
'    l_insert_cols := RTRIM(l_insert_cols, '','');',
'    l_insert_vals := RTRIM(l_insert_vals, '','');',
'    -- Compose SQL',
'    l_sql := ''INSERT INTO '' || p_table || '' ('' || l_insert_cols || '') '' ||',
'             ''VALUES ('' || l_insert_vals || '')'';',
'    dbg(''Generated INSERT SQL: ''||l_sql, p_debug);',
'    -- Parse and bind',
'    c := DBMS_SQL.open_cursor;',
'    DBMS_SQL.parse(c, l_sql, DBMS_SQL.native);',
'    -- Bind values',
'    FOR i IN 1 .. l_cols.COUNT LOOP',
'      IF UPPER(l_cols(i).col_name) = ''ID'' THEN',
'        DBMS_SQL.bind_variable(c, '':''||l_cols(i).col_name, l_new_id);',
'      ELSE',
'       -- l_val := json_query( p_payload , ''$."''||l_cols(i).col_name||''"'' returning clob) ;',
'        if upper(l_cols(i).data_type) = ''CLOB'' then',
'         l_clob := json_query( p_payload , ''$."''||l_cols(i).col_name||''"'' returning clob) ;',
'        else',
'            l_val := json_value(p_payload, ''$."''||l_cols(i).col_name||''"'');',
'        end if;',
'',
'       -- l_val := json_value(p_payload, ''$."''||l_cols(i).col_name||''"'');',
'        IF l_val IS NOT NULL OR l_clob IS NOT NULL THEN        ',
'         -- DBMS_SQL.bind_variable(c, '':''||l_cols(i).col_name, l_val); ',
'         if upper(l_cols(i).data_type) = ''CLOB'' then',
'            dbms_sql.bind_variable(c, '':''||l_cols(i).col_name, l_clob);  -- l_val must be CLOB',
'        else',
'            dbms_sql.bind_variable(c, '':''||l_cols(i).col_name, to_char(l_val));',
'        end if;',
'        END IF;',
'      END IF;',
'      ',
'    END LOOP;',
'    rc := DBMS_SQL.execute(c);',
'    DBMS_SQL.close_cursor(c);',
'    p_status  := ''S'';',
'    p_message := ''Inserted ''||rc||'' row(s). New ID ='' || RAWTOHEX(l_new_id) || '''';',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      IF DBMS_SQL.is_open(c) THEN',
'        DBMS_SQL.close_cursor(c);',
'      END IF;',
'      p_status  := ''E'';',
'      p_message := ''Insert failed: ''||SQLERRM;',
'      dbg(''Insert failed: ''||SQLERRM, p_debug);',
'  END;',
'',
'',
'',
'    ------------------------------------------------------------------',
'    -- U = UPDATE',
'    ------------------------------------------------------------------',
'ELSIF UPPER(p_mode) = ''U'' THEN',
'   dbg(''--- UPDATE MODE START ---'', p_debug);',
'',
'   DECLARE',
'     l_sql       VARCHAR2(32767);',
'     l_set_list  VARCHAR2(32767);',
'     l_pk_col    VARCHAR2(128);',
'     c           INTEGER;',
'     l_rows      INTEGER;',
'     l_val       VARCHAR2(4000);',
'     l_first     BOOLEAN := TRUE;',
'   BEGIN',
'     -- 1. Get primary key column',
'     SELECT ucc.column_name',
'       INTO l_pk_col',
'       FROM user_constraints uc',
'       JOIN user_cons_columns ucc ',
'         ON uc.constraint_name = ucc.constraint_name',
'      WHERE uc.table_name = UPPER(p_table)',
'        AND uc.constraint_type = ''P''',
'        AND ROWNUM = 1;',
'',
'     dbg(''Primary Key Column='' || l_pk_col, p_debug);',
'',
'     -- 2. Build SET clause dynamically in PL/SQL',
'     l_set_list := '''';',
'     FOR rec IN (',
'       SELECT column_name',
'       FROM user_tab_columns',
'       WHERE table_name = UPPER(p_table)',
'         AND column_name <> l_pk_col',
'       ORDER BY column_id',
'     )',
'     LOOP',
'       l_val := json_value(p_payload, ''$."''||rec.column_name||''"'' returning varchar2(4000));',
'       IF l_val IS NOT NULL THEN',
'         IF l_first THEN',
'           l_set_list := ''"''||rec.column_name||''" = :''||rec.column_name;',
'           l_first := FALSE;',
'         ELSE',
'           l_set_list := l_set_list || '', "''||rec.column_name||''" = :''||rec.column_name;',
'         END IF;',
'       END IF;',
'     END LOOP;',
'',
'     IF l_set_list IS NULL THEN',
'       p_status  := ''E'';',
'       p_message := ''No updatable columns found in JSON payload.'';',
'       RETURN;',
'     END IF;',
'',
'     -- 3. Final UPDATE statement',
'     l_sql := ''UPDATE '' || p_table || '' SET '' || l_set_list ||',
'              '' WHERE "'' || l_pk_col || ''" = :''||l_pk_col;',
'',
'     dbg(''Final Update SQL = '' || l_sql, p_debug);',
'',
'     -- 4. Parse and bind',
'     c := dbms_sql.open_cursor;',
'     dbms_sql.parse(c, l_sql, dbms_sql.native);',
'',
'     -- Bind non-PK values',
'     FOR rec IN (',
'       SELECT column_name',
'       FROM user_tab_columns',
'       WHERE table_name = UPPER(p_table)',
'         AND column_name <> l_pk_col',
'     )',
'     LOOP',
'       l_val := json_value(p_payload, ''$."''||rec.column_name||''"'' returning varchar2(4000));',
'       IF l_val IS NOT NULL THEN',
'         dbms_sql.bind_variable(c, '':''||rec.column_name, l_val);',
'         dbg(''Binding ''||rec.column_name||''=''||l_val, p_debug);',
'       END IF;',
'     END LOOP;',
'',
'     -- Bind PK',
'     l_val := json_value(p_payload, ''$."''||l_pk_col||''"'' returning varchar2(4000));',
'     IF l_val IS NOT NULL THEN',
'       dbms_sql.bind_variable(c, '':''||l_pk_col, l_val);',
'       dbg(''Binding PK ''||l_pk_col||''=''||l_val, p_debug);',
'     END IF;',
'',
'     -- 5. Execute',
'     l_rows := dbms_sql.execute(c);',
'     dbms_sql.close_cursor(c);',
'',
'     p_status  := ''S'';',
'     p_message := ''Updated ''||l_rows||'' hotel successfully.'';',
'    p_icon  := ''success'';',
'    p_title := ''Success!'';',
'',
'   ',
'',
'',
'     dbg(''--- UPDATE MODE END ---'', p_debug);',
'   EXCEPTION',
'     WHEN OTHERS THEN',
'       IF dbms_sql.is_open(c) THEN',
'         dbms_sql.close_cursor(c);',
'       END IF;',
'       p_status  := ''E'';',
'       p_message := ''Update failed: ''||SQLERRM;',
'        p_icon  := ''error'';',
'    p_title := ''Update Failed'';',
'       dbg(''Update failed: ''||SQLERRM, p_debug);',
'   END;',
'',
'',
'',
'',
'------------------------------------------------------------------',
'-- D = DELETE',
'------------------------------------------------------------------',
'ELSIF p_mode = ''D'' THEN',
'    -- Delete record(s) based on primary key(s)',
'    DECLARE',
'        l_pk_col VARCHAR2(200);',
'        l_pk_val VARCHAR2(4000);',
'        l_sql    VARCHAR2(4000);',
'    BEGIN',
'        -- Fetch the primary key column dynamically',
'        SELECT cols.column_name',
'        INTO   l_pk_col',
'        FROM   all_constraints cons',
'        JOIN   all_cons_columns cols',
'        ON     cons.constraint_name = cols.constraint_name',
'        AND    cons.owner = cols.owner',
'        WHERE  cons.constraint_type = ''P''',
'        AND    cons.table_name = UPPER(p_table)',
'        AND    ROWNUM = 1;',
'',
'        -- Extract PK value from JSON',
'        l_pk_val := json_value(p_payload, ''$."'' || l_pk_col || ''"'');',
'',
'        IF l_pk_val IS NULL THEN',
'            p_status  := ''E'';',
'            p_message := ''Primary key ''||l_pk_col||'' not found in payload'';',
'            RETURN;',
'        END IF;',
'',
'        -- Build DELETE SQL',
'        l_sql := ''DELETE FROM '' || p_table || '' WHERE '' || l_pk_col || '' = :pk'';',
'',
'        IF p_debug = ''Y'' THEN',
'            dbms_output.put_line(''DELETE SQL: '' || l_sql);',
'            dbms_output.put_line(''PK VALUE : '' || l_pk_val);',
'        END IF;',
'',
'        -- Execute delete',
'        EXECUTE IMMEDIATE l_sql USING l_pk_val;',
'',
'        p_status  := ''S'';',
'        p_message := ''Delete successful.'';',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status  := ''E'';',
'            p_message := ''Delete failed: '' || SQLERRM;',
'    END;',
'',
'    ------------------------------------------------------------------',
'    -- Other modes not implemented yet',
'    ------------------------------------------------------------------',
'    ELSE',
'      p_status := ''E'';',
'      p_message := ''Mode ''||p_mode||'' not implemented'';',
'    END IF;',
'',
'  END proc_crud_json;',
'',
'END Graph_SQL;',
'/',
'create or replace PACKAGE BODY pkg_generic_crud AS',
'',
'  -- Type to hold column info',
'  TYPE t_colrec IS RECORD (',
'    col_name    VARCHAR2(30),',
'    data_type   VARCHAR2(30),',
'    nullable    VARCHAR2(1),   -- ''Y'' or ''N''',
'    data_length NUMBER,',
'    data_precision NUMBER,',
'    data_scale  NUMBER,',
'    is_pk       BOOLEAN,',
'    default_val VARCHAR2(4000)',
'  );',
'  TYPE t_colrec_tab IS TABLE OF t_colrec INDEX BY PLS_INTEGER;',
'',
'  -- Debug utility',
'  PROCEDURE dbg(p_msg VARCHAR2, p_debug_flag VARCHAR2) IS',
'  BEGIN',
'    IF p_debug_flag = ''Y'' THEN',
'      BEGIN',
'        APEX_DEBUG.MESSAGE(p_msg);',
'      EXCEPTION WHEN OTHERS THEN',
'        DBMS_OUTPUT.put_line(p_msg);',
'      END;',
'    END IF;',
'  END;',
'',
'  -- Get table metadata',
'  FUNCTION get_table_columns(p_table VARCHAR2) RETURN t_colrec_tab IS',
'    cols t_colrec_tab;',
'    idx  PLS_INTEGER := 0;',
'    TYPE t_varchar2_tab IS TABLE OF VARCHAR2(30);',
'    pk_cols t_varchar2_tab;',
'  BEGIN',
'    -- Fetch PKs',
'    SELECT cols.column_name',
'    BULK COLLECT INTO pk_cols',
'    FROM user_constraints cons',
'    JOIN user_cons_columns cols',
'      ON cons.constraint_name = cols.constraint_name',
'    WHERE cons.constraint_type = ''P''',
'      AND cons.table_name = UPPER(p_table);',
'',
'    -- Fetch all columns',
'    FOR r IN (',
'      SELECT column_name, data_type, nullable,',
'             data_length, data_precision, data_scale, data_default',
'      FROM user_tab_columns',
'      WHERE table_name = UPPER(p_table)',
'      ORDER BY column_id',
'    ) LOOP',
'      idx := idx + 1;',
'      cols(idx).col_name := r.column_name;',
'      cols(idx).data_type := r.data_type;',
'      cols(idx).nullable := r.nullable;',
'      cols(idx).data_length := r.data_length;',
'      cols(idx).data_precision := r.data_precision;',
'      cols(idx).data_scale := r.data_scale;',
'      cols(idx).is_pk := (r.column_name MEMBER OF pk_cols);',
'      cols(idx).default_val := r.data_default;',
'    END LOOP;',
'',
'    RETURN cols;',
'  END;',
'',
'  -- Sample value helper',
'  FUNCTION sample_value(p_col t_colrec) RETURN VARCHAR2 IS',
'  BEGIN',
'    IF p_col.is_pk THEN',
'      IF UPPER(p_col.data_type) = ''RAW'' THEN',
'        RETURN LOWER(RAWTOHEX(SYS_GUID()));',
'      ELSE',
'        RETURN ''PK_VALUE'';',
'      END IF;',
'    END IF;',
'',
'    CASE UPPER(p_col.data_type)',
'      WHEN ''NUMBER'' THEN RETURN ''123'';',
'      WHEN ''DATE'' THEN RETURN TO_CHAR(SYSDATE, ''YYYY-MM-DD'');',
'      WHEN ''TIMESTAMP(6)'' THEN RETURN TO_CHAR(SYSTIMESTAMP, ''YYYY-MM-DD"T"HH24:MI:SS'');',
'      WHEN ''RAW'' THEN RETURN LOWER(RAWTOHEX(SYS_GUID()));',
'      ELSE RETURN ''SampleText'';',
'    END CASE;',
'  END;',
'',
'  -- Main procedure',
'  PROCEDURE proc_crud_json(',
'    p_mode      IN VARCHAR2,',
'    p_table     IN VARCHAR2,',
'    p_payload   IN CLOB,',
'    p_debug     IN VARCHAR2 DEFAULT ''N'',',
'    p_status    OUT VARCHAR2,',
'    p_message   OUT CLOB,',
'    p_icon out varchar2,',
'    p_title out varchar2',
'  ) IS',
'    l_cols t_colrec_tab;',
'  BEGIN',
'    dbg(''Start proc_crud_json, mode=''||p_mode, p_debug);',
'',
'    ------------------------------------------------------------------',
'    -- F = FETCH METADATA',
'    ------------------------------------------------------------------',
'    IF UPPER(p_mode) = ''F'' THEN',
'      l_cols := get_table_columns(p_table);',
'      IF l_cols.COUNT = 0 THEN',
'        p_status := ''E'';',
'        p_message := ''Table "''||p_table||''" does not exist or has no columns'';',
'        RETURN;',
'      END IF;',
'',
'      -- Build JSON metadata',
'      DECLARE',
'        l_json_response JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_fields       JSON_ARRAY_T := JSON_ARRAY_T();',
'        l_mandatories  JSON_ARRAY_T := JSON_ARRAY_T();',
'        l_sample_c     JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_sample_u     JSON_OBJECT_T := JSON_OBJECT_T();',
'        l_sample_d     JSON_OBJECT_T := JSON_OBJECT_T();',
'      BEGIN',
'        FOR i IN 1 .. l_cols.COUNT LOOP',
'          DECLARE',
'            l_field_obj JSON_OBJECT_T := JSON_OBJECT_T();',
'          BEGIN',
'            l_field_obj.put(''column_name'', l_cols(i).col_name);',
'            l_field_obj.put(''data_type'', l_cols(i).data_type);',
'            l_field_obj.put(''nullable'', l_cols(i).nullable);',
'            l_field_obj.put(''is_primary_key'', CASE WHEN l_cols(i).is_pk THEN ''Y'' ELSE ''N'' END);',
'            l_field_obj.put(''default_value'', l_cols(i).default_val);',
'            l_field_obj.put(''sample_value'', sample_value(l_cols(i)));',
'            l_fields.append(l_field_obj);',
'',
'            IF l_cols(i).nullable = ''N'' OR l_cols(i).is_pk THEN',
'              l_mandatories.append(l_cols(i).col_name);',
'              l_sample_c.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'            END IF;',
'',
'            IF l_cols(i).is_pk THEN',
'              l_sample_u.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'              l_sample_d.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'            ELSE',
'              IF l_cols(i).nullable = ''Y'' THEN',
'                l_sample_u.put(l_cols(i).col_name, sample_value(l_cols(i)));',
'              END IF;',
'            END IF;',
'          END;',
'        END LOOP;',
'',
'        l_json_response.put(''fields'', l_fields);',
'        l_json_response.put(''mandatory_columns'', l_mandatories);',
'        l_json_response.put(''sample_create_payload'', l_sample_c);',
'        l_json_response.put(''sample_update_payload'', l_sample_u);',
'        l_json_response.put(''sample_delete_payload'', l_sample_d);',
'',
'        p_status := ''S'';',
'        p_message := l_json_response.to_string;',
'      END;',
'',
'',
'------------------------------------------------------------------',
'-- C = CREATE / INSERT (dynamic, JSON-driven)',
'------------------------------------------------------------------',
'ELSIF UPPER(p_mode) = ''C'' THEN',
'  dbg(''Entering CREATE mode for table ''||p_table, p_debug);',
'',
'  DECLARE',
'    l_sql         VARCHAR2(32767);',
'    l_insert_cols VARCHAR2(32767) := '''';',
'    l_insert_vals VARCHAR2(32767) := '''';',
'    l_val         VARCHAR2(4000);',
'    c             INTEGER;',
'    rc            INTEGER;',
'    l_any_found   BOOLEAN := FALSE;',
'  BEGIN',
'    -- Load column metadata for the target table',
'    l_cols := get_table_columns(p_table);',
'    IF l_cols.COUNT = 0 THEN',
'      p_status  := ''E'';',
'      p_message := ''Table "''||p_table||''" does not exist or has no columns'';',
'      RETURN;',
'    END IF;',
'',
'    -- Build column and bind placeholder lists from JSON',
'    FOR i IN 1 .. l_cols.COUNT LOOP',
'      -- Pull value from JSON; non-existent key or JSON null -> NULL',
'      l_val := json_value(p_payload, ''$."''||l_cols(i).col_name||''"'');',
'',
'      IF p_debug = ''Y'' THEN',
'        dbg(''JSON check for column ''||l_cols(i).col_name||'' -> ''||',
'            CASE WHEN l_val IS NULL THEN ''NULL/absent'' ELSE l_val END, p_debug);',
'      END IF;',
'',
'      -- Only include columns that have a non-NULL value in payload',
'      IF l_val IS NOT NULL THEN',
'        l_any_found := TRUE;',
'        -- Note: do not quote column names here; they are from data dictionary and uppercase-safe',
'        l_insert_cols := l_insert_cols || l_cols(i).col_name || '','';',
'        l_insert_vals := l_insert_vals || '':'' || l_cols(i).col_name || '','';',
'      END IF;',
'    END LOOP;',
'',
'    IF NOT l_any_found THEN',
'      p_status  := ''E'';',
'      p_message := ''No matching columns found in payload for insert'';',
'      RETURN;',
'    END IF;',
'',
'    -- Trim trailing commas',
'    l_insert_cols := RTRIM(l_insert_cols, '','');',
'    l_insert_vals := RTRIM(l_insert_vals, '','');',
'',
'    -- Compose SQL',
'    l_sql := ''INSERT INTO '' || p_table || '' ('' || l_insert_cols || '') VALUES ('' || l_insert_vals || '')'';',
'    dbg(''Generated INSERT SQL: ''||l_sql, p_debug);',
'',
'    -- Parse and bind',
'    c := DBMS_SQL.open_cursor;',
'    DBMS_SQL.parse(c, l_sql, DBMS_SQL.native);',
'',
'    -- Bind only the columns we actually included (non-NULL in payload)',
'    FOR i IN 1 .. l_cols.COUNT LOOP',
'      l_val := json_value(p_payload, ''$."''||l_cols(i).col_name||''"'');',
'      IF l_val IS NOT NULL THEN',
'        DBMS_SQL.bind_variable(c, '':''||l_cols(i).col_name, l_val);',
'        dbg(''Binding ''||l_cols(i).col_name||''=''||l_val, p_debug);',
'      END IF;',
'    END LOOP;',
'',
'    rc := DBMS_SQL.execute(c);',
'    DBMS_SQL.close_cursor(c);',
'',
'    p_status  := ''S'';',
'    p_message := ''Inserted ''||rc||'' row(s)'';',
'',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      IF DBMS_SQL.is_open(c) THEN',
'        DBMS_SQL.close_cursor(c);',
'      END IF;',
'      p_status  := ''E'';',
'      p_message := ''Insert failed: ''||SQLERRM;',
'      dbg(''Insert failed: ''||SQLERRM, p_debug);',
'  END;',
'',
'',
'    ------------------------------------------------------------------',
'    -- U = UPDATE',
'    ------------------------------------------------------------------',
'ELSIF UPPER(p_mode) = ''U'' THEN',
'   dbg(''--- UPDATE MODE START ---'', p_debug);',
'',
'   DECLARE',
'     l_sql       VARCHAR2(32767);',
'     l_set_list  VARCHAR2(32767);',
'     l_pk_col    VARCHAR2(128);',
'     c           INTEGER;',
'     l_rows      INTEGER;',
'     l_val       VARCHAR2(4000);',
'     l_first     BOOLEAN := TRUE;',
'   BEGIN',
'     -- 1. Get primary key column',
'     SELECT ucc.column_name',
'       INTO l_pk_col',
'       FROM user_constraints uc',
'       JOIN user_cons_columns ucc ',
'         ON uc.constraint_name = ucc.constraint_name',
'      WHERE uc.table_name = UPPER(p_table)',
'        AND uc.constraint_type = ''P''',
'        AND ROWNUM = 1;',
'',
'     dbg(''Primary Key Column='' || l_pk_col, p_debug);',
'',
'     -- 2. Build SET clause dynamically in PL/SQL',
'     l_set_list := '''';',
'     FOR rec IN (',
'       SELECT column_name',
'       FROM user_tab_columns',
'       WHERE table_name = UPPER(p_table)',
'         AND column_name <> l_pk_col',
'       ORDER BY column_id',
'     )',
'     LOOP',
'       l_val := json_value(p_payload, ''$."''||rec.column_name||''"'' returning varchar2(4000));',
'       IF l_val IS NOT NULL THEN',
'         IF l_first THEN',
'           l_set_list := ''"''||rec.column_name||''" = :''||rec.column_name;',
'           l_first := FALSE;',
'         ELSE',
'           l_set_list := l_set_list || '', "''||rec.column_name||''" = :''||rec.column_name;',
'         END IF;',
'       END IF;',
'     END LOOP;',
'',
'     IF l_set_list IS NULL THEN',
'       p_status  := ''E'';',
'       p_message := ''No updatable columns found in JSON payload.'';',
'       RETURN;',
'     END IF;',
'',
'     -- 3. Final UPDATE statement',
'     l_sql := ''UPDATE '' || p_table || '' SET '' || l_set_list ||',
'              '' WHERE "'' || l_pk_col || ''" = :''||l_pk_col;',
'',
'     dbg(''Final Update SQL = '' || l_sql, p_debug);',
'',
'     -- 4. Parse and bind',
'     c := dbms_sql.open_cursor;',
'     dbms_sql.parse(c, l_sql, dbms_sql.native);',
'',
'     -- Bind non-PK values',
'     FOR rec IN (',
'       SELECT column_name',
'       FROM user_tab_columns',
'       WHERE table_name = UPPER(p_table)',
'         AND column_name <> l_pk_col',
'     )',
'     LOOP',
'       l_val := json_value(p_payload, ''$."''||rec.column_name||''"'' returning varchar2(4000));',
'       IF l_val IS NOT NULL THEN',
'         dbms_sql.bind_variable(c, '':''||rec.column_name, l_val);',
'         dbg(''Binding ''||rec.column_name||''=''||l_val, p_debug);',
'       END IF;',
'     END LOOP;',
'',
'     -- Bind PK',
'     l_val := json_value(p_payload, ''$."''||l_pk_col||''"'' returning varchar2(4000));',
'     IF l_val IS NOT NULL THEN',
'       dbms_sql.bind_variable(c, '':''||l_pk_col, l_val);',
'       dbg(''Binding PK ''||l_pk_col||''=''||l_val, p_debug);',
'     END IF;',
'',
'     -- 5. Execute',
'     l_rows := dbms_sql.execute(c);',
'     dbms_sql.close_cursor(c);',
'',
'     p_status  := ''S'';',
'     p_message := ''Updated ''||l_rows||'' hotel successfully.'';',
'    p_icon  := ''success'';',
'    p_title := ''Success!'';',
'',
'   ',
'',
'',
'     dbg(''--- UPDATE MODE END ---'', p_debug);',
'   EXCEPTION',
'     WHEN OTHERS THEN',
'       IF dbms_sql.is_open(c) THEN',
'         dbms_sql.close_cursor(c);',
'       END IF;',
'       p_status  := ''E'';',
'       p_message := ''Update failed: ''||SQLERRM;',
'        p_icon  := ''error'';',
'    p_title := ''Update Failed'';',
'       dbg(''Update failed: ''||SQLERRM, p_debug);',
'   END;',
'',
'',
'',
'',
'------------------------------------------------------------------',
'-- D = DELETE',
'------------------------------------------------------------------',
'ELSIF p_mode = ''D'' THEN',
'    -- Delete record(s) based on primary key(s)',
'    DECLARE',
'        l_pk_col VARCHAR2(200);',
'        l_pk_val VARCHAR2(4000);',
'        l_sql    VARCHAR2(4000);',
'    BEGIN',
'        -- Fetch the primary key column dynamically',
'        SELECT cols.column_name',
'        INTO   l_pk_col',
'        FROM   all_constraints cons',
'        JOIN   all_cons_columns cols',
'        ON     cons.constraint_name = cols.constraint_name',
'        AND    cons.owner = cols.owner',
'        WHERE  cons.constraint_type = ''P''',
'        AND    cons.table_name = UPPER(p_table)',
'        AND    ROWNUM = 1;',
'',
'        -- Extract PK value from JSON',
'        l_pk_val := json_value(p_payload, ''$."'' || l_pk_col || ''"'');',
'',
'        IF l_pk_val IS NULL THEN',
'            p_status  := ''E'';',
'            p_message := ''Primary key ''||l_pk_col||'' not found in payload'';',
'            RETURN;',
'        END IF;',
'',
'        -- Build DELETE SQL',
'        l_sql := ''DELETE FROM '' || p_table || '' WHERE '' || l_pk_col || '' = :pk'';',
'',
'        IF p_debug = ''Y'' THEN',
'            dbms_output.put_line(''DELETE SQL: '' || l_sql);',
'            dbms_output.put_line(''PK VALUE : '' || l_pk_val);',
'        END IF;',
'',
'        -- Execute delete',
'        EXECUTE IMMEDIATE l_sql USING l_pk_val;',
'',
'        p_status  := ''S'';',
'        p_message := ''Delete successful.'';',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status  := ''E'';',
'            p_message := ''Delete failed: '' || SQLERRM;',
'    END;',
'',
'    ------------------------------------------------------------------',
'    -- Other modes not implemented yet',
'    ------------------------------------------------------------------',
'    ELSE',
'      p_status := ''E'';',
'      p_message := ''Mode ''||p_mode||'' not implemented'';',
'    END IF;',
'',
'  END proc_crud_json;',
'',
'END pkg_generic_crud;',
'/',
'create or replace PACKAGE BODY ur_utils IS',
'',
'    PROCEDURE POPULATE_ERROR_COLLECTION_FROM_LOG (',
'        p_interface_log_id IN  UR_INTERFACE_LOGS.ID%TYPE,',
'        p_collection_name  IN  VARCHAR2,',
'        p_status           OUT VARCHAR2,',
'        p_message          OUT VARCHAR2',
'    )',
'    IS',
'        l_error_json CLOB;',
'        l_json_array_count NUMBER;',
'    BEGIN',
'        -- Initialize OUT parameters to a default error state.',
'        p_status  := ''E'';',
'        p_message := ''An unexpected error occurred during processing.'';',
'',
'        -- Step 1: Validate inputs',
'        IF p_interface_log_id IS NULL THEN',
'            p_status  := ''E'';',
'            p_message := ''Error: The Interface Log ID cannot be null.'';',
'            RETURN;',
'        END IF;',
'',
'        IF p_collection_name IS NULL OR TRIM(p_collection_name) IS NULL THEN',
'            p_status  := ''E'';',
'            p_message := ''Error: The Collection Name cannot be null or empty.'';',
'            RETURN;',
'        END IF;',
'',
'        -- Step 2: Fetch the ERROR_JSON from the logs table',
'        BEGIN',
'            SELECT error_json',
'            INTO   l_error_json',
'            FROM   ur_interface_logs',
'            WHERE  id = p_interface_log_id;',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                p_status  := ''E'';',
'                p_message := ''Error: No record found for Interface Log ID: '' || RAWTOHEX(p_interface_log_id) || ''.'';',
'                RETURN;',
'        END;',
'',
'        -- Step 3: Check if the fetched JSON is null or empty',
'        IF l_error_json IS NULL OR DBMS_LOB.GETLENGTH(l_error_json) = 0 THEN',
'            p_status  := ''W'';',
'            p_message := ''Warning: The error log for the specified ID is empty. No data to populate.'';',
'            -- It''s a good practice to still ensure the collection is empty in this case.',
'            APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(p_collection_name => p_collection_name);',
'            RETURN;',
'        END IF;',
'',
'        -- Step 4: Parse the JSON and check for validity',
'        BEGIN',
'            APEX_JSON.PARSE(l_error_json);',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                -- APEX_JSON raises an unhandled exception (ORA-20987) for parse errors.',
'                p_status  := ''E'';',
'                p_message := ''Error: Failed to parse the ERROR_JSON content. The JSON string may be malformed.'';',
'                RETURN;',
'        END;',
'',
'        -- Step 5: Initialize the APEX Collection',
'        -- This creates the collection if it doesn''t exist or clears it if it does.',
'        APEX_COLLECTION.CREATE_OR_TRUNCATE_COLLECTION(',
'            p_collection_name => p_collection_name',
'        );',
'',
'        -- Step 6: Loop through the JSON array and populate the collection',
'        l_json_array_count := APEX_JSON.GET_COUNT(p_path => ''.'');',
'',
'        IF l_json_array_count > 0 THEN',
'            FOR i IN 1..l_json_array_count LOOP',
'                -- Add members to the collection.',
'                -- c001 for row number, c002 for the error message.',
'                APEX_COLLECTION.ADD_MEMBER(',
'                    p_collection_name => p_collection_name,',
'                    p_c001            => APEX_JSON.GET_VARCHAR2(p_path => ''[%d].row'', p0 => i),',
'                    p_c002            => APEX_JSON.GET_VARCHAR2(p_path => ''[%d].error'', p0 => i)',
'                );',
'            END LOOP;',
'            ',
'            p_status  := ''S'';',
'            p_message := ''Success: Collection '''''' || p_collection_name || '''''' has been populated with '' || l_json_array_count || '' error(s).'';',
'',
'        ELSE',
'            -- This handles cases where the JSON is valid but is an empty array, e.g., ''[]''.',
'            p_status  := ''W'';',
'            p_message := ''Warning: The error log contains an empty array. The collection is empty.'';',
'        END IF;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            -- A final catch-all for any other unexpected Oracle errors.',
'            p_status  := ''E'';',
'            p_message := ''An unexpected system error occurred: '' || SQLERRM;',
'    END POPULATE_ERROR_COLLECTION_FROM_LOG;',
'',
'',
'    PROCEDURE VALIDATE_TEMPLATE_DEFINITION(',
'        p_json_clob  IN            CLOB,',
'        p_alert_clob IN OUT NOCOPY CLOB,',
'        p_status     OUT           VARCHAR2',
'    ) IS',
'        l_error_found BOOLEAN := FALSE;',
'    BEGIN',
'        -- Loop through each JSON object in the array where a ''qualifier'' exists.',
'        FOR r IN (',
'            SELECT',
'                nm,',
'                dt,',
'                qlf',
'            FROM',
'                JSON_TABLE(p_json_clob, ''$[*]''',
'                    COLUMNS (',
'                        nm  VARCHAR2(255) PATH ''$.name'',',
'                        dt  VARCHAR2(50)  PATH ''$.data_type'',',
'                        qlf VARCHAR2(255) PATH ''$.qualifier''',
'                    )',
'                )',
'            WHERE',
'                qlf IS NOT NULL',
'        ) LOOP',
'            -- RULE 1: Qualifiers with ''DATE'' in the name must have a ''DATE'' data_type.',
'            IF INSTR(UPPER(r.qlf), ''DATE'') > 0 THEN',
'                IF r.dt <> ''DATE'' THEN',
'                    l_error_found := TRUE;',
'                    ur_utils.add_alert(',
'                        p_alert_clob,',
'                        ''Field "'' || r.nm || ''": Qualifier "'' || r.qlf || ''" must be DATE.'',',
'                        ''error'',',
'                        NULL,',
'                        NULL,',
'                        p_alert_clob',
'                    );',
'                END IF;',
'            -- RULE 2: All other qualifiers must have a ''NUMBER'' data_type.',
'            ELSE',
'                IF r.dt <> ''NUMBER'' THEN',
'                    l_error_found := TRUE;',
'                    ur_utils.add_alert(',
'                        p_alert_clob,',
'                        ''Field "'' || r.nm || ''": Qualifier "'' || r.qlf || ''" must be NUMBER.'',',
'                        ''error'',',
'                        NULL,',
'                        NULL,',
'                        p_alert_clob',
'                    );',
'                END IF;',
'            END IF;',
'        END LOOP;',
'',
'        -- Set the final status (''S''uccess or ''E''rror) and add a success message if needed.',
'        IF l_error_found THEN',
'            p_status := ''E'';',
'        ELSE',
'            p_status := ''S'';',
'            ur_utils.add_alert(p_alert_clob, ''Template definition validated successfully.'', ''success'', NULL, NULL, p_alert_clob);',
'        END IF;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            ur_utils.add_alert(p_alert_clob, ''Unexpected validation error: '' || SQLERRM, ''error'', NULL, NULL, p_alert_clob);',
'    END VALIDATE_TEMPLATE_DEFINITION;',
'',
'    --------------------------------------------------------------------------------',
'',
'    FUNCTION GET_ATTRIBUTE_VALUE(',
'        p_attribute_id   IN RAW      DEFAULT NULL,',
'        p_attribute_key  IN VARCHAR2 DEFAULT NULL,',
'        p_hotel_id       IN RAW      DEFAULT NULL,',
'        p_stay_date      IN DATE     DEFAULT NULL,',
'        p_round_digits   IN NUMBER   DEFAULT 2',
'    ) RETURN UR_attribute_value_table PIPELINED AS',
'        l_response_clob CLOB;',
'        l_status        VARCHAR2(1);',
'    BEGIN',
'        -- This internal call re'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'mains the same. The JSON it produces should have',
'        -- the attribute_value as a number, date string, or text string.',
'        GET_ATTRIBUTE_VALUE(',
'            p_attribute_id  => p_attribute_id,',
'            p_attribute_key => p_attribute_key,',
'            p_hotel_id      => p_hotel_id,',
'            p_stay_date     => p_stay_date,',
'            p_round_digits  => p_round_digits,',
'            p_debug_flag    => FALSE,',
'            p_response_clob => l_response_clob',
'        );',
'',
'        l_status := JSON_VALUE(l_response_clob, ''$.STATUS'');',
'',
'        IF l_status = ''S'' THEN',
'            FOR rec IN (',
'                SELECT',
'                    TO_DATE(jt.stay_date, ''DD-MON-YYYY'') AS stay_date,',
'                    jt.attribute_value',
'                FROM',
'                    JSON_TABLE(',
'                        l_response_clob,',
'                        ''$.RESPONSE_PAYLOAD[*]''',
'                        COLUMNS (',
'                            stay_date       VARCHAR2(20)   PATH ''$.stay_date'',',
'                            -- MODIFIED: Read the value as VARCHAR2 to handle all types.',
'                            attribute_value VARCHAR2(4000) PATH ''$.attribute_value''',
'                        )',
'                    ) jt',
'            ) LOOP',
'                -- This now works for any data type since attribute_value is a string.',
'                PIPE ROW(UR_attribute_value_row(rec.stay_date, rec.attribute_value));',
'            END LOOP;',
'        END IF;',
'',
'        RETURN;',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            -- Gracefully exit on error',
'            RETURN;',
'    END GET_ATTRIBUTE_VALUE;',
'',
'    --------------------------------------------------------------------------------',
'',
'    -- =================================================================',
'    --  MAIN PROCEDURE IMPLEMENTATION (Returns JSON CLOB)',
'    -- =================================================================',
'    PROCEDURE build_json_response(',
'        p_status                 IN VARCHAR2,',
'        p_message                IN CLOB,',
'        p_attribute_id           IN RAW,',
'        p_attribute_name         IN VARCHAR2,',
'        p_attribute_key          IN VARCHAR2,',
'        p_attribute_datatype     IN VARCHAR2,',
'        p_attribute_qualifier    IN VARCHAR2,',
'        p_attribute_static_val   IN VARCHAR2,',
'        p_hotel_id               IN RAW,',
'        p_stay_date              IN DATE,',
'        p_debug_flag             IN BOOLEAN,',
'        p_record_count           IN NUMBER,',
'        p_payload_array          IN JSON_ARRAY_T,',
'        p_response_clob          OUT CLOB',
'    ) IS',
'        l_json_obj JSON_OBJECT_T;',
'    BEGIN',
'        l_json_obj := JSON_OBJECT_T();',
'        l_json_obj.put(''attribute_id'', RAWTOHEX(p_attribute_id));',
'        l_json_obj.put(''attribute_name'', p_attribute_name);',
'        l_json_obj.put(''attribute_key'', p_attribute_key);',
'        l_json_obj.put(''attribute_datatype'', p_attribute_datatype);',
'        l_json_obj.put(''attribute_qualifier'', p_attribute_qualifier);',
'        l_json_obj.put(''attribute_static_value'', p_attribute_static_val);',
'        l_json_obj.put(''hotel_id'', RAWTOHEX(p_hotel_id));',
'        l_json_obj.put(''stay_date'', TO_CHAR(p_stay_date, ''YYYY-MM-DD''));',
'        l_json_obj.put(''DEBUG_FLAG'', CASE WHEN p_debug_flag THEN ''TRUE'' ELSE ''FALSE'' END);',
'        l_json_obj.put(''RESPONSE_TIME'', TO_CHAR(SYSTIMESTAMP, ''YYYY-MM-DD"T"HH24:MI:SS.FF"Z"''));',
'        l_json_obj.put(''STATUS'', p_status);',
'        l_json_obj.put(''RECORD_COUNT'', p_record_count);',
'        l_json_obj.put(''MESSAGE'', p_message);',
'        l_json_obj.put(''RESPONSE_PAYLOAD'', p_payload_array);',
'',
'        p_response_clob := l_json_obj.to_clob;',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_response_clob := ''{"STATUS":"E", "MESSAGE":"Failed to generate final JSON response: '' || SQLERRM || ''"}'';',
'    END build_json_response;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE GET_ATTRIBUTE_VALUE(',
'        p_attribute_id  IN  RAW      DEFAULT NULL,',
'        p_attribute_key IN  VARCHAR2 DEFAULT NULL,',
'        p_hotel_id      IN  RAW      DEFAULT NULL,',
'        p_stay_date     IN  DATE     DEFAULT NULL,',
'        p_round_digits  IN  NUMBER   DEFAULT 2,',
'        p_debug_flag    IN  BOOLEAN  DEFAULT FALSE,',
'        p_response_clob OUT CLOB',
'    ) IS',
'        l_attribute_rec     UR_ALGO_ATTRIBUTES%ROWTYPE;',
'        l_template_rec      UR_TEMPLATES%ROWTYPE;',
'        l_sql_stmt          VARCHAR2(8000);',
'        l_cursor            SYS_REFCURSOR;',
'        l_stay_date_val     DATE;',
'        l_attribute_val_out VARCHAR2(4000);',
'        l_records_fetched   NUMBER := 0;',
'        l_json_payload_arr  JSON_ARRAY_T := JSON_ARRAY_T();',
'        l_json_row_obj      JSON_OBJECT_T;',
'        l_status            VARCHAR2(1) := ''S'';',
'        l_message           CLOB;',
'        l_debug_log         CLOB;',
'',
'        PROCEDURE append_debug(p_log_entry IN VARCHAR2) IS',
'        BEGIN',
'            IF p_debug_flag THEN',
'                l_debug_log := l_debug_log || TO_CHAR(SYSTIMESTAMP, ''HH24:MI:SS.FF'') || '' - '' || p_log_entry || CHR(10);',
'            END IF;',
'        END append_debug;',
'',
'    BEGIN',
'        append_debug(''Procedure started.'');',
'',
'        IF (p_attribute_id IS NULL AND p_attribute_key IS NULL) OR (p_attribute_id IS NOT NULL AND p_attribute_key IS NOT NULL) THEN',
'            l_message := ''Validation Error: Provide either p_attribute_id or p_attribute_key, but not both.'';',
'            build_json_response(''E'', l_message, NULL, NULL, p_attribute_key, NULL, NULL, NULL, p_hotel_id, p_stay_date, p_debug_flag, 0, JSON_ARRAY_T(''[]''), p_response_clob);',
'            RETURN;',
'        END IF;',
'',
'        BEGIN',
'            IF p_attribute_id IS NOT NULL THEN',
'                SELECT * INTO l_attribute_rec FROM UR_ALGO_ATTRIBUTES WHERE ID = p_attribute_id;',
'            ELSE',
'                SELECT * INTO l_attribute_rec FROM UR_ALGO_ATTRIBUTES WHERE KEY = p_attribute_key;',
'            END IF;',
'            append_debug(''Found attribute with ID: '' || RAWTOHEX(l_attribute_rec.ID) || '', TYPE: '' || l_attribute_rec.TYPE || '', VALUE: '' || l_attribute_rec.VALUE);',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                l_message := ''Attribute not found for the specified ID or KEY.'';',
'                build_json_response(''E'', l_message, p_attribute_id, NULL, p_attribute_key, NULL, NULL, NULL, p_hotel_id, p_stay_date, p_debug_flag, 0, JSON_ARRAY_T(''[]''), p_response_clob);',
'                RETURN;',
'        END;',
'',
'        IF l_attribute_rec.TYPE = ''M'' THEN',
'            append_debug(''Attribute type is Manual. Using static value.'');',
'            l_json_row_obj := JSON_OBJECT_T();',
'            l_json_row_obj.put(''stay_date'', TO_CHAR(p_stay_date, ''DD-MON-YYYY''));',
'            CASE UPPER(l_attribute_rec.DATA_TYPE)',
'                WHEN ''NUMBER'' THEN',
'                    l_json_row_obj.put(''attribute_value'', ROUND(TO_NUMBER(l_attribute_rec.VALUE), p_round_digits));',
'                ELSE',
'                    l_json_row_obj.put(''attribute_value'', l_attribute_rec.VALUE);',
'            END CASE;',
'            l_json_payload_arr.append(l_json_row_obj);',
'            l_records_fetched := 1;',
'            l_message         := ''Manual value returned.'';',
'',
'ELSIF l_attribute_rec.TYPE = ''S'' THEN',
'    append_debug(''Attribute type is Sourced. Parsing value formula.'');',
'    DECLARE',
'        TYPE t_table_map IS TABLE OF VARCHAR2(10) INDEX BY VARCHAR2(150);',
'        l_tables             t_table_map;',
'        l_formula            VARCHAR2(4000) := l_attribute_rec.VALUE;',
'        l_expression         VARCHAR2(4000) := l_formula;',
'        l_from_clause        VARCHAR2(4000);',
'        l_where_clause       VARCHAR2(1000) := '' WHERE 1=1'';',
'        l_stay_date_column   VARCHAR2(150); -- This variable is the target of our change',
'        l_base_table_alias   VARCHAR2(10)   := ''t1'';',
'        l_table_counter      NUMBER         := 1;',
'        l_pos                NUMBER         := 1;',
'        l_source_ref         VARCHAR2(200);',
'    BEGIN',
'        -- ### MODIFIED LOGIC: Determine the STAY_DATE column name ###',
'        IF l_attribute_rec.TEMPLATE_ID IS NOT NULL THEN',
'            -- **[1] Original Logic: Use Template ID if it exists**',
'            append_debug(''Template ID found. Looking up STAY_DATE column from template definition.'');',
'            IF l_attribute_rec.ATTRIBUTE_QUALIFIER IN (''OWN_PROPERTY'', ''COMP_PROPERTY'') THEN',
'                l_stay_date_column := ''STAY_DATE'';',
'            ELSE',
'                BEGIN',
'                    SELECT * INTO l_template_rec FROM UR_TEMPLATES WHERE ID = l_attribute_rec.TEMPLATE_ID;',
'                    SELECT jt.name',
'                    INTO   l_stay_date_column',
'                    FROM   JSON_TABLE(l_template_rec.DEFINITION, ''$[*]'' COLUMNS (name VARCHAR2(100) PATH ''$.name'', qualifier VARCHAR2(100) PATH ''$.qualifier'')) jt',
'                    WHERE  jt.qualifier = ''STAY_DATE'';',
'                EXCEPTION',
'                    WHEN NO_DATA_FOUND THEN',
'                        RAISE_APPLICATION_ERROR(-20004, ''Critical error: The associated template definition requires a column with the ''''STAY_DATE'''' qualifier.'');',
'                END;',
'            END IF;',
'        ELSE',
'            -- **[2] New Logic: Introspect the formula if no Template ID**',
'            append_debug(''Template ID is NULL. Starting non-templated attribute logic.'');',
'',
'            IF p_hotel_id IS NULL THEN',
'                append_debug(''Validation failed: p_hotel_id is NULL for a non-templated Sourced attribute.'');',
'                l_message := ''Validation Error: A Hotel ID must be provided to retrieve values for this attribute configuration.'';',
'                build_json_response(''E'', l_message, l_attribute_rec.ID, l_attribute_rec.NAME, l_attribute_rec.KEY, l_attribute_rec.DATA_TYPE, l_attribute_rec.ATTRIBUTE_QUALIFIER, l_attribute_rec.VALUE, p_hotel_id, p_stay_date, p_debug_flag, 0, JSON_A'
||'RRAY_T(''[]''), p_response_clob);',
'                RETURN;',
'            END IF;',
'',
'            append_debug(''Template ID is NULL. Introspecting formula to find base table and verify STAY_DATE column.'');',
'            ',
'            DECLARE',
'                l_base_table_name VARCHAR2(128);',
'                l_column_exists   NUMBER;',
'            BEGIN',
'                -- Extract the first table name from the formula (e.g., from #TABLE.COLUMN#)',
'                l_base_table_name := REGEXP_SUBSTR(l_formula, ''#([^#.]+)\.'', 1, 1, NULL, 1);',
'',
'                IF l_base_table_name IS NULL THEN',
'                    RAISE_APPLICATION_ERROR(-20006, ''Invalid formula format. Cannot determine base table from value: '' || l_formula);',
'                END IF;',
'                ',
'                append_debug(''Inferred base table is: '' || l_base_table_name);',
'',
'                -- Check if a ''STAY_DATE'' column exists in that table',
'                SELECT COUNT(*)',
'                INTO   l_column_exists',
'                FROM   ALL_TAB_COLUMNS',
'                WHERE  TABLE_NAME = UPPER(l_base_table_name)',
'                  AND  COLUMN_NAME = ''STAY_DATE'';',
'',
'                IF l_column_exists > 0 THEN',
'                    l_stay_date_column := ''STAY_DATE'';',
'                ELSE',
'                    RAISE_APPLICATION_ERROR(-20007, ''Configuration error: The base table '''''' || l_base_table_name || '''''' for this attribute does not have a required ''''STAY_DATE'''' column.'');',
'                END IF;',
'            END;',
'        END IF;',
'',
'        append_debug(''Determined Stay Date column is: '' || l_stay_date_column);',
'',
'        -- 1. Parse all source references and build FROM clause (This logic remains the same)',
'        LOOP',
'            l_source_ref := REGEXP_SUBSTR(l_formula, ''#([^#]+)#'', l_pos, 1, NULL, 1);',
'            EXIT WHEN l_source_ref IS NULL;',
'',
'                    DECLARE',
'                        l_table_name VARCHAR2(150) := REGEXP_SUBSTR(l_source_ref, ''^[^.]+'');',
'                        l_col_name   VARCHAR2(150) := REGEXP_SUBSTR(l_source_ref, ''[^.]+$'');',
'                        l_alias      VARCHAR2(10);',
'                    BEGIN',
'                        IF NOT l_tables.EXISTS(l_table_name) THEN',
'                            l_alias              := ''t'' || l_table_counter;',
'                            l_tables(l_table_name) := l_alias;',
'',
'                            IF l_table_counter = 1 THEN',
'                                l_from_clause := DBMS_ASSERT.ENQUOTE_NAME(l_table_name) || '' '' || l_alias;',
'                            ELSE',
'                                l_from_clause := l_from_clause || '' LEFT JOIN '' || DBMS_ASSERT.ENQUOTE_NAME(l_table_name) || '' '' || l_alias ||',
'                                                 '' ON '' || l_base_table_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_stay_date_column) || '' = '' || l_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_stay_date_column);',
'                            END IF;',
'                            l_table_counter := l_table_counter + 1;',
'                        ELSE',
'                            l_alias := l_tables(l_table_name);',
'                        END IF;',
'',
'                        l_expression := REPLACE(l_expression, ''#'' || l_source_ref || ''#'', l_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_col_name));',
'                    END;',
'                    l_pos := REGEXP_INSTR(l_formula, ''#'', l_pos, 2) + 1;',
'                END LOOP;',
'',
'                IF l_from_clause IS NULL THEN',
'                    RAISE_APPLICATION_ERROR(-20001, ''Invalid Sourced Attribute: Formula is missing a source reference like #TABLE.COLUMN#.'');',
'                END IF;',
'',
'                -- 2. Validate expression (now includes brackets)',
'                DECLARE',
'                    l_validation_check VARCHAR2(4000);',
'                BEGIN',
'                    l_validation_check := REGEXP_REPLACE(l_expression, ''[''''a-zA-Z0-9_."''''\(\)0-9\.\+\*\/ \t\r\n-]'', '''');',
'                    IF l_validation_check IS NOT NULL THEN',
'                        RAISE_APPLICATION_ERROR(-20003, ''Invalid Sourced Attribute: Formula contains illegal characters.'');',
'                    END IF;',
'                END;',
'',
'                -- 4. Build final SQL (Conditionally apply ROUND based on data type)',
'                IF p_stay_date IS NOT NULL THEN l_where_clause := l_where_clause || '' AND TRUNC('' || l_base_table_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_stay_date_column) || '') = TRUNC(:stay_date)''; END IF;',
'                IF p_hotel_id IS NOT NULL THEN l_where_clause := l_where_clause || '' AND '' || l_base_table_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(''HOTEL_ID'') || '' = :hotel_id''; END IF;',
'',
'                IF l_attribute_rec.DATA_TYPE = ''NUMBER'' THEN',
'                    append_debug(''Data type is NUMBER, applying ROUND().'');',
'                    l_sql_stmt := ''SELECT '' || l_base_table_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_stay_date_column) ||',
'                                  '', ROUND(('' || l_expression || ''), :round_digits)'' ||',
'                                  '' FROM '' || l_from_clause || l_where_clause;',
'                ELSE',
'                    append_debug(''Data type is '' || l_attribute_rec.DATA_TYPE || '', not applying ROUND().'');',
'                    l_sql_stmt := ''SELECT '' || l_base_table_alias || ''.'' || DBMS_ASSERT.ENQUOTE_NAME(l_stay_date_column) ||',
'                                  '', '' || l_expression ||',
'                                  '' FROM '' || l_from_clause || l_where_clause;',
'                END IF;',
'',
'                append_debug(''Dynamic SQL: '' || l_sql_stmt);',
'',
'                -- Open the cursor with the correct bind variables based on the data type',
'                IF l_attribute_rec.DATA_TYPE = ''NUMBER'' THEN',
'                    -- This block handles NUMBER types, which always need :round_digits',
'                    CASE',
'                        WHEN p_stay_date IS NOT NULL AND p_hotel_id IS NOT NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_round_digits, p_stay_date, p_hotel_id;',
'                        WHEN p_stay_date IS NOT NULL AND p_hotel_id IS NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_round_digits, p_stay_date;',
'                        WHEN p_stay_date IS NULL AND p_hotel_id IS NOT NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_round_digits, p_hotel_id;',
'                        ELSE',
'                            OPEN l_cursor FOR l_sql_stmt USING p_round_digits;',
'                    END CASE;',
'                ELSE',
'                    -- This block handles non-NUMBER types (DATE, VARCHAR2, etc.), which do NOT have :round_digits',
'                    CASE',
'                        WHEN p_stay_date IS NOT NULL AND p_hotel_id IS NOT NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_stay_date, p_hotel_id;',
'                        WHEN p_stay_date IS NOT NULL AND p_hotel_id IS NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_stay_date;',
'                        WHEN p_stay_date IS NULL AND p_hotel_id IS NOT NULL THEN',
'                            OPEN l_cursor FOR l_sql_stmt USING p_hotel_id;',
'                        ELSE',
'                            -- No bind variables are needed if all parameters are null for non-numeric types',
'                            OPEN l_cursor FOR l_sql_stmt;',
'                    END CASE;',
'                END IF;',
'',
'',
'',
'                LOOP',
'                    FETCH l_cursor INTO l_stay_date_val, l_attribute_val_out;',
'                    EXIT WHEN l_cursor%NOTFOUND;',
'                    ',
'                    l_records_fetched := l_records_fetched + 1;',
'                    l_json_row_obj := JSON_OBJECT_T();',
'                    l_json_row_obj.put(''stay_date'', TO_CHAR(l_stay_date_val, ''DD-MON-YYYY''));',
'',
'                    -- Conditionally handle the attribute value based on its data type',
'                    CASE UPPER(l_attribute_rec.DATA_TYPE)',
'                        WHEN ''NUMBER'' THEN',
'                            l_json_row_obj.put(''attribute_value'', TO_NUMBER(l_attribute_val_out));',
'                        ELSE -- For DATE, VARCHAR2, etc., treat as a string',
'                            l_json_row_obj.put(''attribute_value'', l_attribute_val_out);',
'                    END CASE;',
'                    ',
'                    l_json_payload_arr.append(l_json_row_obj);',
'                END LOOP;',
'                CLOSE l_cursor;',
'            END;',
'        ELSE',
'            RAISE_APPLICATION_ERROR(-20005, ''Attribute validation error: Unknown TYPE '''''' || l_attribute_rec.TYPE || ''''''. Must be ''''M'''' (Manual) or ''''S'''' (Sourced).'');',
'        END IF;',
'',
'        IF l_message IS NULL THEN',
'            l_message := l_records_fetched || '' records fetched successfully.'';',
'            IF l_records_fetched = 0 AND l_attribute_rec.TYPE != ''M'' THEN',
'                l_status  := ''W'';',
'                l_message := ''No records found for the given criteria.'';',
'            END IF;',
'        END IF;',
'',
'        IF p_debug_flag THEN',
'            l_message := l_message || CHR(10) || ''--- DEBUG LOG ---'' || CHR(10) || l_debug_log;',
'        END IF;',
'',
'        build_json_response(l_status, l_message, l_attribute_rec.ID, l_attribute_rec.NAME, l_attribute_rec.KEY, l_attribute_rec.DATA_TYPE, l_attribute_rec.ATTRIBUTE_QUALIFIER, l_attribute_rec.VALUE, p_hotel_id, p_stay_date, p_debug_flag, l_records_fe'
||'tched, l_json_payload_arr, p_response_clob);',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            IF l_cursor%ISOPEN THEN',
'                CLOSE l_cursor;',
'            END IF;',
'            l_status  := ''E'';',
'            l_message := ''An unexpected error occurred: '' || SQLERRM;',
'            append_debug(l_message);',
'            IF p_debug_flag THEN',
'                l_message := l_message || CHR(10) || ''--- DEBUG LOG ---'' || CHR(10) || l_debug_log;',
'            END IF;',
'            build_json_response(',
'                ''E'',',
'                l_message,',
'                l_attribute_rec.ID,',
'                NVL(l_attribute_rec.NAME, ''UNKNOWN''),',
'                NVL(l_attribute_rec.KEY, p_attribute_key),',
'                NVL(l_attribute_rec.DATA_TYPE, ''UNKNOWN''),',
'                NVL(l_attribute_rec.ATTRIBUTE_QUALIFIER, ''UNKNOWN''),',
'                NVL(l_attribute_rec.VALUE, ''UNKNOWN''),',
'                p_hotel_id,',
'                p_stay_date,',
'                p_debug_flag,',
'                0,',
'                JSON_ARRAY_T(''[]''),',
'                p_response_clob',
'            );',
'    END GET_ATTRIBUTE_VALUE;',
'',
'    --------------------------------------------------------------------------------',
'',
'    FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2 IS',
'        v_clean VARCHAR2(4000);',
'    BEGIN',
'        v_clean := UPPER(',
'            SUBSTR(',
'                REGEXP_REPLACE(',
'                    REGEXP_REPLACE(',
'                        REGEXP_REPLACE(',
'                            TRIM(p_text),',
'                            ''^[^A-Za-z0-9]+|[^A-Za-z0-9]+$'',',
'                            ''''',
'                        ),',
'                        ''[^A-Za-z0-9]+'',',
'                        ''_''',
'                    ),',
'                    ''_+'',',
'                    ''_''',
'                ),',
'                1,',
'                110',
'            )',
'        );',
'        RETURN v_clean;',
'    END Clean_TEXT;',
'',
'    --------------------------------------------------------------------------------',
'',
'    FUNCTION normalize_json(p_json CLOB) RETURN CLOB IS',
'    BEGIN',
'        RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'    END normalize_json;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE get_collection_json(',
'        p_collection_name IN  VARCHAR2,',
'        p_json_clob       OUT CLOB,',
'        p_status          OUT VARCHAR2,',
'        p_message         OUT VARCHAR2',
'    ) IS',
'        l_count NUMBER;',
'    BEGIN',
'        SELECT',
'            COUNT(*)',
'        INTO l_count',
'        FROM',
'            apex_collections',
'        WHERE',
'            collection_name = p_collection_name;',
'',
'        IF l_count = 0 THEN',
'            p_status    := ''E'';',
'            p_message   := ''Failure: Collection "'' || p_collection_name || ''" does not exist or is empty'';',
'            p_json_clob := NULL;',
'            RETURN;',
'        END IF;',
'',
'        -- Initialize and build JSON output',
'        apex_json.initialize_clob_output;',
'        apex_json.open_array;',
'',
'        FOR rec IN (',
'            SELECT',
'                c001,',
'                c002,',
'                c003',
'            FROM',
'                apex_collections',
'            WHERE',
'                collection_name = p_collection_name',
'            ORDER BY',
'                seq_id',
'        ) LOOP',
'            apex_json.open_object;',
'            apex_json.write(''name'', rec.c001);',
'            apex_json.write(''data_type'', rec.c002);',
'            apex_json.write(''qualifier'', rec.c003);',
'            apex_json.close_object;',
'        END LOOP;',
'',
'        apex_json.close_array;',
'',
'        p_json_clob := apex_json.get_clob_output;',
'',
'        apex_json.free_output;',
'',
'        p_status  := ''S'';',
'        p_message := ''JSON generated for collection "'' || p_collection_name || ''"'';',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status    := ''E'';',
'            p_message   := ''Failure: '' || SQLERRM;',
'            p_json_clob := NULL;',
'    END get_collection_json;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE define_db_object(',
'        p_template_key IN  VARCHAR2,',
'        p_status       OUT BOOLEAN,',
'        p_message      OUT VARCHAR2,',
'        p_mode         IN  VARCHAR2 DEFAULT ''N'' -- ''N'' = new create, ''U'' = update/replace existing',
'    ) IS',
'        v_db_object_name VARCHAR2(30);',
'        v_sql            CLOB;',
'        v_col_defs       CLOB := '''';',
'        v_unique_defs    CLOB := '''';',
'        v_definition     CLOB;',
'        v_exists         NUMBER;',
'        v_trigger_name   VARCHAR2(130);',
'        l_col_name       VARCHAR2(100);',
'    BEGIN',
unistr('        -- \D83D\DD12 Lock and fetch details'),
'        SELECT',
'            db_object_name,',
'            definition',
'        INTO',
'            v_db_object_name,',
'            v_definition',
'        FROM',
'            ur_templates',
'        WHERE',
'            key = p_template_key',
'        FOR UPDATE;',
'',
'        IF v_definition IS NULL THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'            RETURN;',
'        END IF;',
'',
'        -- Generate table name if not already defined',
'        IF v_db_object_name IS NULL THEN',
'            v_db_object_name := ''UR_TMPLT_'' || UPPER(p_template_key) || ''_T'';',
'        END IF;',
'',
unistr('        -- \D83D\DD0D Check if table exists'),
'        SELECT',
'            COUNT(*)',
'        INTO v_exists',
'        FROM',
'            all_tables',
'        WHERE',
'            table_name = UPPER(v_db_object_name);',
'',
unistr('        -- \D83E\DDE9 Handle based on mode'),
'        IF v_exists > 0 THEN',
'            IF p_mode = ''N'' THEN',
'                p_status  := FALSE;',
'                p_message := ''Failure: Table '' || v_db_object_name || '' already exists.'';',
'                RETURN;',
'            ELSIF p_mode = ''U'' THEN',
'                -- Drop existing trigger if exists',
'                BEGIN',
'                    v_trigger_name := v_db_object_name || ''_BI_TRG'';',
'                    EXECUTE IMMEDIATE ''DROP TRIGGER "'' || v_trigger_name || ''"'';',
'                EXCEPTION',
'                    WHEN OTHERS THEN',
'                        NULL; -- ignore if not exists',
'                END;',
'',
'                -- Drop existing table',
'                BEGIN',
'                    EXECUTE IMMEDIATE ''DROP TABLE "'' || v_db_object_name || ''" CASCADE CONSTRAINTS'';',
'                EXCEPTION',
'                    WHEN OTHERS THEN',
'                        p_status  := FALSE;',
'                        p_message := ''Failure dropping existing table: '' || SQLERRM;',
'                        RETURN;',
'                END;',
'            END IF;',
'        END IF;',
'',
'        -- Start with ID RAW(16) as primary key column',
'        v_col_defs := ''"REC_ID" RAW(16)'';',
'',
'        -- Parse JSON definition',
'        FOR rec IN (',
'            SELECT',
'                jt.name,',
'                jt.data_type,',
'                jt.qualifier',
'            FROM',
'                JSON_TABLE(',
'                    normalize_json(v_definition),',
'                    ''$[*]'' COLUMNS (',
'                        name      VARCHAR2(100) PATH ''$.name'',',
'                        data_type VARCHAR2(30)  PATH ''$.data_type'',',
'                        qualifier VARCHAR2(30)  PATH ''$.qualifier''',
'                    )',
'                ) jt',
'        ) LOOP',
'            -- Sanitize and normalize column name',
'            l_col_name := UPPER(TRIM(BOTH ''_'' FROM rec.name));',
'            l_col_name := REGEXP_REPLACE(l_col_name, ''_{2,}'', ''_'');',
'            v_col_defs := v_col_defs || '', '';',
'',
'            -- Map data types',
'            IF UPPER(rec.data_type) = ''TEXT'' THEN',
'                v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'            ELSIF UPPER(rec.data_type) = ''NUMBER'' THEN',
'                v_col_defs := v_col_defs || ''"'' || l_col_name || ''" NUMBER'';',
'            ELSIF UPPER(rec.data_type) = ''DATE'' THEN',
'                v_col_defs := v_col_defs || ''"'' || l_col_name || ''" DATE'';',
'            ELSE',
'                v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'            END IF;',
'',
'            -- Add unique constraint for special qualifiers',
'            IF UPPER(rec.qualifier) = ''STAY_DATE'' THEN',
'                v_unique_defs :=',
'                    v_unique_defs ||',
'                    '', CONSTRAINT "'' || v_db_object_name || ''_'' || l_col_name || ''_UQ" UNIQUE ("'' ||',
'                    l_col_name || ''")'';',
'            END IF;',
'        END LOOP;',
'',
'        -- Add WHO / AUDIT columns',
'        v_col_defs :=',
'            v_col_defs ||',
'            '', CREATED_BY RAW(16), UPDATED_BY RAW(16), CREATED_ON DATE, UPDATED_ON DATE, HOTEL_ID RAW(16), INTERFACE_LOG_ID RAW(16)'';',
'',
'        -- Build CREATE TABLE DDL',
'        v_sql :=',
'            ''CREATE TABLE "'' || v_db_object_name || ''" ('' ||',
'            v_col_defs ||',
'            '', CONSTRAINT "'' || v_db_object_name || ''_PK" PRIMARY KEY ("REC_ID")'' ||',
'            v_unique_defs || '')'';',
'',
'        EXECUTE IMMEDIATE v_sql;',
'',
'        -- Create or replace trigger',
'        v_trigger_name := v_db_object_name || ''_BI_TRG'';',
'        v_sql          := ''',
'CREATE OR REPLACE EDITIONABLE TRIGGER "'' || v_trigger_name || ''"',
'BEFORE INSERT OR UPDATE ON "'' || v_db_object_name || ''"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'   WHERE USER_NAME = SYS_CONTEXT(''''APEX$SESSION'''', ''''APP_USER'''');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END '' || v_trigger_name || '';',
''';',
'        EXECUTE IMMEDIATE v_sql;',
'',
'        -- Update UR_TEMPLATES',
'        UPDATE ur_templates',
'        SET',
'            db_object_name         = v_db_object_name,',
'            db_object_created_on   = SYSDATE',
'        WHERE',
'            key = p_template_key;',
'',
'        COMMIT;',
'',
'        p_status := TRUE;',
'        IF p_mode = ''U'' THEN',
'            p_message := ''Success: Table "'' || v_db_object_name || ''" redefined (replaced) successfully.'';',
'        ELSE',
'            p_message := ''Success: Table "'' || v_db_object_name || ''" created with ID primary key and trigger.'';',
'        END IF;',
'',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: Template key not found'';',
'        WHEN OTHERS THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: '' || SQLERRM;',
'    END define_db_object;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE create_ranking_view(',
'        p_template_key IN  VARCHAR2,',
'        p_status       OUT BOOLEAN,',
'        p_message      OUT VARCHAR2',
'    ) IS',
'        -- Metadata Variables',
'        v_definition       CLOB;',
'        v_data_table_name  VARCHAR2(128);',
'        v_view_name        VARCHAR2(128);',
'        v_sdate_col        VARCHAR2(128);',
'        v_own_property_col VARCHAR2(128);',
'        v_property_list    CLOB;',
'',
'        -- Dynamic SQL Variables',
'        v_sql              CLOB;'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'OB;',
'        v_pivot_clause     CLOB; -- For inside the subquery',
'        v_final_columns    CLOB; -- For the final SELECT list',
'        v_property_count   NUMBER := 0;',
'        v_exists           NUMBER;',
'',
'    BEGIN',
'        -- Step 1: Lock row and get metadata',
'        SELECT',
'            definition,',
'            db_object_name',
'        INTO',
'            v_definition,',
'            v_data_table_name',
'        FROM',
'            ur_templates',
'        WHERE',
'            key = p_template_key',
'        FOR UPDATE;',
'',
'        -- Step 2: Validation checks',
'        IF v_definition IS NULL THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: Definition JSON is NULL.'';',
'            ROLLBACK;',
'            RETURN;',
'        END IF;',
'        IF v_data_table_name IS NULL THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: DB object not yet defined.'';',
'            ROLLBACK;',
'            RETURN;',
'        END IF;',
'        SELECT COUNT(*) INTO v_exists FROM user_tables WHERE table_name = UPPER(v_data_table_name);',
'        IF v_exists = 0 THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: Source table '' || v_data_table_name || '' does not exist.'';',
'            ROLLBACK;',
'            RETURN;',
'        END IF;',
'',
'        -- Step 3: Parse JSON to get column names and count all properties',
'        SELECT jt.name',
'        INTO   v_sdate_col',
'        FROM   JSON_TABLE(v_definition, ''$[*]'' COLUMNS (name VARCHAR2(128) PATH ''$.name'', qualifier VARCHAR2(128) PATH ''$.qualifier'')) jt',
'        WHERE  jt.qualifier = ''STAY_DATE'';',
'',
'        SELECT jt.name',
'        INTO   v_own_property_col',
'        FROM   JSON_TABLE(v_definition, ''$[*]'' COLUMNS (name VARCHAR2(128) PATH ''$.name'', qualifier VARCHAR2(128) PATH ''$.qualifier'')) jt',
'        WHERE  jt.qualifier = ''OWN_PROPERTY'';',
'',
'        SELECT',
'            LISTAGG(''"'' || jt.name || ''"'', '', '') WITHIN GROUP(',
'            ORDER BY',
'                jt.name',
'            ),',
'            COUNT(jt.name)',
'        INTO',
'            v_property_list,',
'            v_property_count',
'        FROM',
'            JSON_TABLE(v_definition, ''$[*]'' COLUMNS (name VARCHAR2(128) PATH ''$.name'', qualifier VARCHAR2(128) PATH ''$.qualifier'')) jt',
'        WHERE',
'            jt.qualifier IN (''OWN_PROPERTY'', ''COMP_PROPERTY'');',
'',
'        -- Step 4: Build the dynamic PIVOT and final column list clauses',
'        FOR i IN 1..v_property_count LOOP',
'            v_pivot_clause := v_pivot_clause ||',
'                              ''MAX(CASE WHEN overall_rank = '' || i || '' THEN hotel_name END) AS "RANK_'' || i || ''_NAME",'' || CHR(10) ||',
'                              ''MAX(CASE WHEN overall_rank = '' || i || '' THEN price END) AS "RANK_'' || i || ''_RATE",'' || CHR(10);',
'',
'            v_final_columns := v_final_columns ||',
'                               ''p."RANK_'' || i || ''_NAME",'' || CHR(10) ||',
'                               ''p."RANK_'' || i || ''_RATE",'' || CHR(10);',
'        END LOOP;',
'        v_pivot_clause  := RTRIM(v_pivot_clause, '','' || CHR(10));',
'        v_final_columns := RTRIM(v_final_columns, '','' || CHR(10));',
'',
'',
'        -- Step 5: Build the final CREATE VIEW statement',
'        v_view_name := ''UR_TMPLT_'' || p_template_key || ''_RANK_V'';',
'',
'        v_sql := ''CREATE OR REPLACE VIEW "'' || v_view_name || ''" AS '' || CHR(10) ||',
'                 ''WITH all_properties_ranked AS ('' || CHR(10) ||',
'                 ''    SELECT '' || CHR(10) ||',
'                 ''      "HOTEL_ID",'' || CHR(10) || ',
'                 ''        "'' || v_sdate_col || ''",'' || CHR(10) ||',
'                 ''        hotel_name,'' || CHR(10) ||',
'                 ''        CASE WHEN REGEXP_LIKE(price, ''''^[0-9,.]+$'''') THEN TO_NUMBER(REPLACE(price, '''','''', '''''''')) ELSE NULL END AS price,'' || CHR(10) ||',
'                 ''        ROW_NUMBER() OVER(PARTITION BY "'' || v_sdate_col || ''" ORDER BY CASE WHEN REGEXP_LIKE(price, ''''^[0-9,.]+$'''') THEN TO_NUMBER(REPLACE(price, '''','''', '''''''')) ELSE NULL END ASC NULLS LAST) as overall_rank'' || CHR(10) ||',
'                 ''    FROM "'' || v_data_table_name || ''"'' || CHR(10) ||',
'                 ''    UNPIVOT (price FOR hotel_name IN ('' || v_property_list || ''))'' || CHR(10) ||',
'                 '')'' || CHR(10) ||',
'                 ''SELECT '' || CHR(10) ||',
'                 ''    p."'' || v_sdate_col || ''" AS "STAY_DATE",'' || CHR(10) ||',
'                 ''    own.price AS "OWN_PROPERTY_RATE",'' || CHR(10) ||',
'                 ''    own.overall_rank AS "OWN_PROPERTY_RANK",'' || CHR(10) ||',
'                 ''    '' || v_final_columns || CHR(10) ||',
'                 ''FROM ('' || CHR(10) ||',
'                 ''    SELECT "'' || v_sdate_col || ''", '' || v_pivot_clause || '' FROM all_properties_ranked GROUP BY "'' || v_sdate_col || ''"'' || CHR(10) ||',
'                 '') p'' || CHR(10) ||',
'                 ''JOIN ('' || CHR(10) ||',
'                 ''    SELECT "'' || v_sdate_col || ''", price, overall_rank FROM all_properties_ranked WHERE hotel_name = '''''' || v_own_property_col || '''''''' || CHR(10) ||',
'                 '') own ON p."'' || v_sdate_col || ''" = own."'' || v_sdate_col || ''"'';',
'',
'        -- Step 6: Execute the dynamic SQL',
'        EXECUTE IMMEDIATE v_sql;',
'',
'        -- Update UR_TEMPLATES with the new db_view_object_name and timestamp',
'        UPDATE ur_templates',
'        SET',
'            db_view_object_name         = v_view_name,',
'            db_view_object_created_on   = SYSDATE',
'        WHERE',
'            key = p_template_key;',
'',
'        COMMIT;',
'        p_status  := TRUE;',
'        p_message := ''Success! Ranking view "'' || v_view_name || ''" created or replaced.'';',
'',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: Could not find a required qualifier (STAY_DATE, OWN_PROPERTY) in template key '''''' || p_template_key || ''''''.'';',
'            ROLLBACK;',
'        WHEN OTHERS THEN',
'            p_status := FALSE;',
'            p_message := ''Failure: '' || SQLERRM;',
'            DBMS_OUTPUT.PUT_LINE(''--- FAILED SQL ---'');',
'            DBMS_OUTPUT.PUT_LINE(v_sql);',
'            DBMS_OUTPUT.PUT_LINE(''------------------'');',
'            ROLLBACK;',
'    END create_ranking_view;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE LOAD_DATA_MAPPING_COLLECTION(',
'        p_file_id         IN  VARCHAR2,',
'        p_template_id     IN  VARCHAR2,',
'        p_collection_name IN  VARCHAR2,',
'        p_status          OUT VARCHAR2,',
'        p_message         OUT VARCHAR2',
'    ) IS',
'        -- Local variables',
'        v_seq_id NUMBER;',
'    BEGIN',
'        -- Initialize outputs',
'        p_status  := ''S'';',
'        p_message := ''Processing completed successfully.'';',
'',
'        ------------------------------------------------------------------------',
'        -- Step 1: Create or truncate the APEX collection',
'        ------------------------------------------------------------------------',
'        BEGIN',
'            IF APEX_COLLECTION.COLLECTION_EXISTS(p_collection_name) THEN',
'                APEX_COLLECTION.DELETE_COLLECTION(p_collection_name);',
'            END IF;',
'',
'            APEX_COLLECTION.CREATE_COLLECTION(p_collection_name);',
'',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                p_status  := ''E'';',
'                p_message := ''Failed to create or truncate collection "'' || p_collection_name || ''": '' || SQLERRM;',
'                RETURN;',
'        END;',
'',
'        ------------------------------------------------------------------------',
'        -- Step 2: Insert data from TEMP_BLOB JSON into collection (c001)',
'        ------------------------------------------------------------------------',
'        BEGIN',
'            FOR rec IN (',
'                SELECT',
'                    jt.name || '' ('' || jt.data_type || '')'' AS column_desc,',
'                    jt.col_position',
'                FROM',
'                    TEMP_BLOB t,',
'                    JSON_TABLE(',
'                        normalize_json(t.columns),',
'                        ''$[*]'' COLUMNS (',
'                            name       VARCHAR2(100) PATH ''$.name'',',
'                            data_type  VARCHAR2(100) PATH ''$.data_type'',',
'                            col_position VARCHAR2(100) PATH ''$.pos''',
'                        )',
'                    ) jt',
'                WHERE',
'                    t.id = p_file_id',
'            ) LOOP',
'                APEX_COLLECTION.ADD_MEMBER(',
'                    p_collection_name => p_collection_name,',
'                    p_c001            => rec.column_desc,',
'                    p_c004            => rec.col_position',
'                );',
'            END LOOP;',
'',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                p_status  := ''E'';',
'                p_message := ''Failed to insert data from TEMP_BLOB (File ID: '' || p_file_id || ''): '' || SQLERRM;',
'                RETURN;',
'        END;',
'',
'        ------------------------------------------------------------------------',
'        -- Step 3: Update existing collection members with matching data from UR_TEMPLATES (c002, c003)',
'        ------------------------------------------------------------------------',
'        BEGIN',
'            FOR rec IN (',
'                SELECT',
'                    jt.name || '' ('' || jt.data_type || '')'' AS column_desc',
'                FROM',
'                    UR_TEMPLATES t,',
'                    JSON_TABLE(',
'                        normalize_json(t.definition),',
'                        ''$[*]'' COLUMNS (',
'                            name      VARCHAR2(100) PATH ''$.name'',',
'                            data_type VARCHAR2(100) PATH ''$.data_type''',
'                        )',
'                    )',
'                     jt',
'                WHERE',
'                    t.id = p_template_id',
'                ORDER BY',
'                    t.id DESC',
'            ) LOOP',
'                BEGIN',
'                    -- Find the seq_id for matching collection member',
'                    SELECT',
'                        seq_id',
'                    INTO v_seq_id',
'                    FROM',
'                        apex_collections',
'                    WHERE',
'                        collection_name = p_collection_name AND c001 = rec.column_desc;',
'',
'                    -- Update c002 and c003 attributes',
'                    APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                        p_collection_name => p_collection_name,',
'                        p_seq             => v_seq_id,',
'                        p_attr_number     => 2,',
'                        p_attr_value      => rec.column_desc',
'                    );',
'',
'                    APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                        p_collection_name => p_collection_name,',
'                        p_seq             => v_seq_id,',
'                        p_attr_number     => 3,',
'                        p_attr_value      => ''Maps To''',
'                    );',
'',
'                    APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                        p_collection_name => p_collection_name,',
'                        p_seq             => v_seq_id,',
'                        p_attr_number     => 4,',
'                        p_attr_value      => NULL',
'                    );',
'',
'                EXCEPTION',
'                    WHEN NO_DATA_FOUND THEN',
unistr('                        -- No matching collection member found \2014 ignore gracefully'),
'                        NULL;',
'                    WHEN OTHERS THEN',
'                        p_status  := ''E'';',
'                        p_message := ''Failed to update member attribute in collection "'' || p_collection_name || ''" for "''',
'                                     || rec.column_desc || ''": '' || SQLERRM;',
'                        RETURN;',
'                END;',
'            END LOOP;',
'',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                p_status  := ''E'';',
'                p_message := ''Failed to update collection members from UR_TEMPLATES (ID: '' || p_template_id || ''): '' || SQLERRM;',
'                RETURN;',
'        END;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status  := ''E'';',
'            p_message := ''Unexpected error occurred: '' || SQLERRM;',
'    END LOAD_DATA_MAPPING_COLLECTION;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE Load_Data(',
'        p_file_id         IN  NUMBER,',
'        p_template_key    IN  VARCHAR2,',
'        p_hotel_id        IN  RAW,',
'        p_collection_name IN  VARCHAR2,',
'        p_status          OUT BOOLEAN,',
'        p_message         OUT VARCHAR2',
'    ) IS',
'        -------------------------------------------------------------------',
'        -- Variables',
'        -------------------------------------------------------------------',
'        l_blob          BLOB;',
'        l_file_name     VARCHAR2(255);',
'        l_table_name    VARCHAR2(255);',
'        l_template_id   RAW(16);',
'        l_total_rows    NUMBER := 0;',
'        l_success_cnt   NUMBER := 0;',
'        l_fail_cnt      NUMBER := 0;',
'        l_log_id        RAW(16);',
'        l_error_json    CLOB := ''['';',
'        l_apex_user     VARCHAR2(255) := NVL(v(''APP_USER''), ''APEX_USER'');',
'        l_sql           CLOB;',
'',
'        -- Dynamic headers',
'        TYPE t_headers IS TABLE OF VARCHAR2(4000) INDEX BY PLS_INTEGER;',
'        v_headers       t_headers;',
'        v_col_count     PLS_INTEGER := 0;',
'',
'        -- JSON / dynamic variables',
'        v_profile_clob  CLOB;',
'        v_sql_json      CLOB;',
'        c               SYS_REFCURSOR;',
'        v_row_json      CLOB;',
'        v_line_number   NUMBER;',
'',
'        -- Row processing',
'        l_cols          VARCHAR2(32767);',
'        l_vals          VARCHAR2(32767);',
'        l_set           VARCHAR2(32767);',
'        l_stay_col_name VARCHAR2(200);',
'        l_stay_val      VARCHAR2(4000);',
'',
'    BEGIN',
'        INSERT INTO debug_log(message) VALUES (''START Load_Data - file_id='' || p_file_id);',
'',
'        -------------------------------------------------------------------',
'        -- 0. Check for duplicate upload',
'        -------------------------------------------------------------------',
'        SELECT',
'            COUNT(*)',
'        INTO l_total_rows',
'        FROM',
'            ur_interface_logs',
'        WHERE',
'            file_id = p_file_id AND load_status = ''SUCCESS'';',
'',
'        IF l_total_rows > 0 THEN',
'            p_status  := FALSE;',
'            p_message := ''Failure: File is already uploaded successfully.'';',
'            INSERT INTO debug_log(message) VALUES (p_message);',
'            RETURN;',
'        END IF;',
'',
'        -------------------------------------------------------------------',
'        -- 1. Get blob and file name',
'        -------------------------------------------------------------------',
'        SELECT',
'            blob_content,',
'            filename',
'        INTO',
'            l_blob,',
'            l_file_name',
'        FROM',
'            temp_blob',
'        WHERE',
'            id = p_file_id;',
'',
'        INSERT INTO debug_log(message) VALUES (''Got blob and filename: '' || NVL(l_file_name, ''<null>''));',
'',
'        -------------------------------------------------------------------',
'        -- 2. Get target table name + template id',
'        -------------------------------------------------------------------',
'        SELECT',
'            db_object_name,',
'            id',
'        INTO',
'            l_table_name,',
'            l_template_id',
'        FROM',
'            ur_templates',
'        WHERE',
'            upper(id) = upper(p_template_key);',
'',
'        INSERT INTO debug_log(message) VALUES (''Target table: '' || l_table_name || '', template_id: '' || RAWTOHEX(l_template_id));',
'',
'        -------------------------------------------------------------------',
'        -- 3. Get STAY_DATE column name from template definition (if any)',
'        -------------------------------------------------------------------',
'        BEGIN',
'            SELECT',
'                jt.name',
'            INTO l_stay_col_name',
'            FROM',
'                ur_templates t,',
'                JSON_TABLE(',
'                    t.definition,',
'                    ''$[*]''',
'                    COLUMNS (',
'                        name      VARCHAR2(200) PATH ''$.name'',',
'                        qualifier VARCHAR2(200) PATH ''$.qualifier''',
'                    )',
'                ) jt',
'            WHERE',
'                t.id = l_template_id AND UPPER(jt.qualifier) = ''STAY_DATE''',
'            FETCH FIRST 1 ROWS ONLY;',
'            INSERT INTO debug_log(message) VALUES (''Found STAY_DATE column in template: '' || l_stay_col_name);',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                l_stay_col_name := NULL;',
'                INSERT INTO debug_log(message) VALUES (''No STAY_DATE configured in template'');',
'        END;',
'',
'        -------------------------------------------------------------------',
'        -- 4. Discover file profile',
'        -------------------------------------------------------------------',
'        v_profile_clob := apex_data_parser.discover(',
'            p_content   => l_blob,',
'            p_file_name => l_file_name',
'        );',
'',
'        INSERT INTO debug_log(message) VALUES (''apex_data_parser.discover done'');',
'',
'        -------------------------------------------------------------------',
'        -- 5. Insert initial log row',
'        -------------------------------------------------------------------',
'        l_log_id := sys_guid();',
'        INSERT INTO ur_interface_logs (',
'            id, hotel_id, template_id, interface_type,',
'            load_start_time, load_status, created_by, updated_by,',
'            created_on, updated_on, file_id',
'        ) VALUES (',
'            l_log_id,',
'            p_hotel_id,',
'            l_template_id,',
'            ''UPLOAD'',',
'            systimestamp,',
'            ''IN_PROGRESS'',',
'            hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'            hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'            sysdate, sysdate,',
'            p_file_id',
'        );',
'',
'        INSERT INTO debug_log(message) VALUES (''Inserted ur_interface_logs id='' || RAWTOHEX(l_log_id));',
'',
'        -------------------------------------------------------------------',
'        -- 6. Get dynamic headers from file',
'        -------------------------------------------------------------------',
'        FOR r IN (',
'            SELECT',
'                column_position,',
'                column_name',
'            FROM',
'                TABLE(apex_data_parser.get_columns(v_profile_clob))',
'            ORDER BY',
'                column_position',
'        ) LOOP',
'            v_headers(r.column_position) := r.column_name;',
'            v_col_count                  := r.column_position;',
'        END LOOP;',
'',
'        INSERT INTO debug_log(message) VALUES (''Detected '' || v_col_count || '' columns from file.'');',
'        IF v_col_count = 0 THEN',
'            RAISE_APPLICATION_ERROR(-20001, ''No columns detected in uploaded file.'');',
'        END IF;',
'',
'        -------------------------------------------------------------------',
'        -- 7. Build JSON SQL',
'        -------------------------------------------------------------------',
'        v_sql_json := ''SELECT p.line_number, JSON_OBJECT('';',
'        FOR i IN 1..v_col_count LOOP',
'            IF i > 1 THEN',
'                v_sql_json := v_sql_json || '', '';',
'            END IF;',
'            v_sql_json := v_sql_json || '''''''' || REPLACE(v_headers(i), '''''''', '''''''''''') || '''''' VALUE NVL(p.col'' || LPAD(i, 3, ''0'') || '', '''''''')'';',
'        END LOOP;',
'        v_sql_json := v_sql_json || '') AS row_json FROM TABLE(apex_data_parser.parse(p_content => :1, p_file_name => :2, p_skip_rows => 1)) p'';',
'',
'        INSERT INTO debug_log(message) VALUES (''Built SQL for JSON parse (len='' || LENGTH(v_sql_json) || '')'');',
'',
'        -------------------------------------------------------------------',
'        -- 8. Process each row',
'        -------------------------------------------------------------------',
'        OPEN c FOR v_sql_json USING l_blob, l_file_name;',
'        LOOP',
'            FETCH c INTO v_line_number, v_row_json;',
'            EXIT WHEN c%NOTFOUND;',
'',
'            l_total_rows := l_total_rows + 1;',
'            INSERT INTO debug_log(message) VALUES (''--- Processing row #'' || l_total_rows || '' line='' || NVL(TO_CHAR(v_line_number), ''N/A''));',
'',
'            -- Reset dynamic variables',
'            l_cols     := NULL;',
'            l_vals     := NULL;',
'            l_set      := NULL;',
'            l_stay_val := NULL;',
'',
'            BEGIN',
'                DECLARE',
'                    l_elem          JSON_ELEMENT_T := JSON_ELEMENT_T.parse(v_row_json);',
'                    l_obj           JSON_OBJECT_T;',
'                    l_keys          JSON_KEY_LIST;',
'                    l_col           VARCHAR2(4000);',
'                    l_val           VARCHAR2(4000);',
'                    l_val_formatted VARCHAR2(4000);',
'                BEGIN',
'                    IF NOT l_elem.is_object THEN',
'                        RAISE_APPLICATION_ERROR(-20002, ''Row not a JSON object'');',
'                    END IF;',
'',
'                    l_obj  := TREAT(l_elem AS JSON_OBJECT_T);',
'                    l_keys := l_obj.get_keys;',
'',
'                    FOR j IN 1..l_keys.count LOOP',
'                        l_col := sanitize_column_name(l_keys(j));',
'                        l_val := l_obj.get_string(l_keys(j));',
'',
'                        -- Capture STAY_DATE value',
'                        IF l_stay_col_name IS NOT NULL AND l_col = UPPER(l_stay_col_name) THEN',
'                            l_stay_val := l_val;',
'                        END IF;',
'',
'                        -- Format value',
'                        l_val_formatted := NULL;',
'                        IF l_val IS NOT NULL AND REGEXP_LIKE(l_val, ''^-?\d+(\.\d+)?$'') THEN',
'                            l_val_formatted := TO_CHAR(TO_NUMBER(l_val));',
'                        END IF;',
'',
'                        IF l_val_formatted IS NULL THEN',
'                            l_val_formatted := '''''''' || REPLACE(NVL(l_val, ''''), '''''''', '''''''''''') || '''''''';',
'                        END IF;',
'',
'                        -- Append to dynamic SQL parts',
'                        IF l_set IS NOT NULL THEN',
'                            l_set  := l_set || '', '';',
'                            l_cols := l_cols || '', '';',
'                            l_vals := l_vals || '', '';',
'                        END IF;',
'',
'                        l_set  := NVL(l_set, '''') || l_col || '' = '' || l_val_formatted;',
'                        l_cols := NVL(l_cols, '''') || l_col;',
'                        l_vals := NVL(l_vals, '''') || l_val_formatted;',
'                    END LOOP;',
'',
'                    -- Always append HOTEL_ID to the set/insert',
'                    IF NVL(l_cols, '''') <> '''' THEN',
'                        l_cols := l_cols || '', HOTEL_ID'';',
'                        l_vals := l_vals || '', HEXTORAW('''''' || RAWTOHEX(p_hotel_id) || '''''')'';',
'                        l_set  := l_set || '', HOTEL_ID = '''''' || p_hotel_id || '''''''';',
'                    END IF;',
'',
'                    ----------------------------------------------------------------',
'                    -- UPSERT logic (update first, then insert)',
'                    ----------------------------------------------------------------',
'                    l_sql := ''UPDATE '' || l_table_name ||',
'                             '' SET '' || l_set ||',
'                             '' WHERE HOTEL_ID = HEXTORAW('''''' || RAWTOHEX(p_hotel_id) || '''''')'';',
'',
'                    -- Optional: include STAY_DATE if available',
'                    IF l_stay_val IS NOT NULL THEN',
'                        l_sql := l_sql || '' AND '' || l_stay_col_name || '' = '''''' || REPLACE(l_stay_val, '''''''', '''''''''''') || '''''''';',
'                    END IF;',
'',
'                    -- Debug',
'                    INSERT INTO debug_log(message) VALUES (''UPDATE SQL: '' || SUBSTR(l_sql, 1, 2000));',
'',
'                    EXECUTE IMMEDIATE l_sql;',
'',
'                    IF SQL%ROWCOUNT = 0 THEN',
unistr('                        -- No row updated \2192 INSERT'),
'                        l_cols := l_cols || '', HOTEL_ID'';',
'                        l_vals := l_vals || '', HEXTORAW('''''' || RAWTOHEX(p_hotel_id) || '''''')'';',
'',
'                        l_sql := ''INSERT INTO '' || l_table_name || '' ('' || l_cols || '') VALUES ('' || l_vals || '')'';',
'                        INSERT INTO debug_log(message) VALUES (''INSERT SQL: '' || SUBSTR(l_sql, 1, 2000));',
'                        EXECUTE IMMEDIATE l_sql;',
'                    END IF;',
'',
'                    l_success_cnt := l_success_cnt + 1;',
'',
'                END;',
'            EXCEPTION',
'                WHEN OTHERS THEN',
'                    l_fail_cnt   := l_fail_cnt + 1;',
'                    l_error_json := l_error_json || ''{"row":'' || l_total_rows || '',"error":"'' || REPLACE(SQLERRM, ''"'', '''''''') || ''"},'';',
'            END;',
'        END LOOP;',
'        CLOSE c;',
'',
'        -- finalize error JSON',
'        IF l_error_json IS NOT NULL AND l_error_json <> ''['' THEN',
'            IF SUBSTR(l_error_json, -1) = '','' THEN',
'                l_error_json := SUBSTR(l_error_json, 1, LENGTH(l_error_json) - 1);',
'            END IF;',
'            l_error_json := l_error_json || '']'';',
'        ELSE',
'            l_error_json := NULL;',
'        END IF;',
'',
'        COMMIT;',
'',
'        -- Update log',
'        UPDATE ur_interface_logs',
'        SET',
'            load_end_time   = systimestamp,',
'            load_status     = ''SUCCESS'',',
'            updated_on      = sysdate,',
'            error_json      = l_error_json',
'        WHERE',
'            id = l_log_id;',
'',
'        p_status  := TRUE;',
unistr('        p_message := ''Success: Upload completed \2192 Total='' || l_total_rows || '', Success='' || l_success_cnt || '', Failed='' || l_fail_cnt;'),
'',
'        INSERT INTO debug_log(message) VALUES (''Completed Load_Data - '' || p_message);',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            BEGIN',
'                UPDATE ur_interface_logs',
'                SET',
'                    load_end_time   = systimestamp,',
'                    load_status     = ''FAILED'',',
'                    updated_on      = sysdate',
'                WHERE',
'                    id = l_log_id;',
'            EXCEPTION',
'                WHEN OTHERS THEN',
'                    NULL;',
'            END;',
'',
'            ROLLBACK;',
'            p_status  := FALSE;',
'            p_message := ''Failure: '' || SQLERRM;',
'    END Load_Data;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE fetch_templates(',
'        p_file_id     IN  NUMBER,',
'        p_hotel_id    IN  VARCHAR2,',
'        p_min_score   IN  NUMBER DEFAULT 90,',
'        p_debug_flag  IN  VARCHAR2 DEFAULT ''N'',',
'        p_output_json OUT CLOB,',
'        p_status      OUT VARCHAR2,',
'        p_message     OUT VARCHAR2',
'    ) IS',
'        -- Local types',
'        TYPE t_name_type_rec IS RECORD(',
'            name      VARCHAR2(100),',
'            data_type VARCHAR2(30)',
'        );',
'        TYPE t_name_type_tab IS TABLE OF t_name_type_rec;',
'',
'        TYPE t_template_rec IS RECORD(',
'            id         VARCHAR2(50),',
'            name       VARCHAR2(200),',
'            definition t_name_type_tab',
'        );',
'        TYPE t_template_tab IS TABLE OF t_template_rec INDEX BY PLS_INTEGER;',
'',
'        -- Variables',
'        v_source_clob         CLOB;',
'        v_source_normalized   CLOB;',
'',
'        v_target_id           VARCHAR2(50);',
'        v_target_name         VARCHAR2(200);',
'        v_target_def_clob     CLOB;',
'        v_target_normalized   CLOB;',
'',
'        v_source_defs         t_name_type_tab := t_name_type_tab();',
'        v_target_defs         t_name_type_tab := t_name_type_tab();',
'',
'        v_templates           t_template_tab;',
'        v_count_templates     PLS_INTEGER := 0;',
'',
'        v_json_output         CLOB := ''['';',
'        v_min_score_use       NUMBER;',
'        v_separator           VARCHAR2(1) := '''';',
'',
'        v_match_count         NUMBER;',
'        v_score               NUMBER;',
'',
'        CURSOR c_targets IS',
'            SELECT',
'                ID,',
'                NAME,',
'                DEFINITION',
'            FROM',
'                UR_TEMPLATES',
'            WHERE',
'                hotel_id = p_hotel_id;',
'',
'        -- Debug procedure',
'        PROCEDURE debug(p_msg VARCHAR2) IS',
'        BEGIN',
'            IF UPPER(p_debug_flag) = ''Y'' THEN',
'                DBMS_OUTPUT.PUT_LINE(''[DEBUG] '' || p_msg);',
'            END IF;',
'        END;',
'',
'        -- Normalize data-type keys in JSON string (case sensitive replacement)',
'        FUNCTION normalize_json(p_json CLOB) RETURN CLOB IS',
'        BEGIN',
'            RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'        END;',
'',
'        -- Parse definition JSON into PL/SQL collection',
'        FUNCTION parse_definition(p_clob CLOB) RETURN t_name_type_tab IS',
'            l_defs t_name_type_tab := t_name_type_tab();',
'            idx    PLS_INTEGER := 0;',
'        BEGIN',
'            FOR rec IN (',
'                SELECT',
'                    lower(trim(name)) AS name,',
'                    lower(trim(data_type)) AS data_type',
'                FROM',
'                    JSON_TABLE(',
'                        p_clob,',
'                        ''$[*]'' COLUMNS (',
'                            name      VARCHAR2(100) PATH ''$.name'',',
'                            data_type VARCHAR2(30)  PATH ''$.data_type''',
'                        )',
'                    )',
'            ) LOOP',
'                idx := idx + 1;',
'                l_defs.EXTEND;',
'                l_defs(idx).name      := rec.name;',
'                l_defs(idx).data_type := rec.data_type;',
'            END LOOP;',
'            RETURN l_defs;',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                RETURN NULL;',
'        END;',
'',
'        -- Count matches (name + data_type case-insensitive)',
'        FUNCTION count_matches(',
'            p_source t_name_type_tab,',
'            p_target t_name_type_tab',
'        ) RETURN NUMBER IS',
'            v_count NUMBER := 0;',
'        BEGIN',
'            FOR i IN 1..p_source.COUNT LOOP',
'                FOR j IN 1..p_target.COUNT LOOP',
'                    IF p_source(i).name = p_target(j).name AND p_source(i).data_type = p_target(j).data_type THEN',
'                        v_count := v_count + 1;',
'                        EXIT;',
'                    END IF;',
'                END LOOP;',
'            END LOOP;',
'            RETURN v_count;',
'        END;',
'',
'    BEGIN',
'        -- Validate inputs and assign to local variable',
'        v_min_score_use := NVL(p_min_score, 90);',
'        IF v_min_score_use < 0 OR v_min_score_use > 100 THEN',
'            v_min_score_use := 90;',
'        END IF;',
'',
'        IF p_file_id IS NULL THEN',
'            p_status      := ''E'';',
'            p_message     := ''File ID must be provided'';',
'            p_output_json := NULL;',
'            RETURN;',
'        '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'END IF;',
'',
'        IF p_hotel_id IS NULL THEN',
'            p_status      := ''E'';',
'            p_message     := ''Hotel ID must be provided'';',
'            p_output_json := NULL;',
'            RETURN;',
'        END IF;',
'',
'        debug(''Starting processing...'');',
'        debug(''File ID: '' || p_file_id);',
'        debug(''Hotel ID: '' || p_hotel_id);',
'        debug(''Minimum Score: '' || v_min_score_use);',
'',
'        -- Fetch and normalize source CLOB',
'        BEGIN',
'            SELECT columns INTO v_source_clob FROM temp_blob WHERE id = p_file_id;',
'            IF v_source_clob IS NULL THEN',
'                p_status      := ''E'';',
'                p_message     := ''Source definition not found for file_id '' || p_file_id;',
'                p_output_json := NULL;',
'                RETURN;',
'            END IF;',
'        EXCEPTION',
'            WHEN NO_DATA_FOUND THEN',
'                p_status      := ''E'';',
'                p_message     := ''Source file not found for id '' || p_file_id;',
'                p_output_json := NULL;',
'                RETURN;',
'            WHEN OTHERS THEN',
'                p_status      := ''E'';',
'                p_message     := ''Error fetching source definition: '' || SQLERRM;',
'                p_output_json := NULL;',
'                RETURN;',
'        END;',
'',
'        v_source_normalized := normalize_json(v_source_clob);',
'',
'        -- Parse source defs',
'        v_source_defs := parse_definition(v_source_normalized);',
'        IF v_source_defs IS NULL OR v_source_defs.COUNT = 0 THEN',
'            p_status      := ''E'';',
'            p_message     := ''Cannot parse source definition JSON or empty definition'';',
'            p_output_json := NULL;',
'            RETURN;',
'        END IF;',
'        debug(''Parsed Source definitions: '' || v_source_defs.COUNT || '' fields'');',
'',
'        -- Initialize JSON output',
'        v_json_output     := ''['';',
'        v_count_templates := 0;',
'',
'        -- Loop over target templates from cursor',
'        FOR r_target IN c_targets LOOP',
'            v_target_id       := r_target.ID;',
'            v_target_name     := r_target.NAME;',
'            v_target_def_clob := r_target.DEFINITION;',
'',
'            IF v_target_def_clob IS NULL THEN',
'                debug(''Skipping template '' || v_target_id || '' due to NULL definition'');',
'                CONTINUE;',
'            END IF;',
'',
'            v_target_normalized := normalize_json(v_target_def_clob);',
'',
'            v_target_defs := parse_definition(v_target_normalized);',
'            IF v_target_defs IS NULL OR v_target_defs.COUNT = 0 THEN',
'                debug(''Skipping template '' || v_target_id || '' due to parsing error or empty definition'');',
'                CONTINUE;',
'            END IF;',
'',
'            v_match_count := count_matches(v_source_defs, v_target_defs);',
'',
'            v_score := ROUND((2 * v_match_count) / (v_source_defs.COUNT + v_target_defs.COUNT) * 100);',
'',
'            debug(',
'                ''Template '' || v_target_id || '' ('' || v_target_name || ''): Matches='' ||',
'                v_match_count || '', Score='' || v_score',
'            );',
'',
'            IF v_score >= v_min_score_use THEN',
'                IF v_count_templates > 0 THEN',
'                    v_json_output := v_json_output || '','';',
'                END IF;',
'                v_json_output     := v_json_output || ''{"Template_id":"'' || v_target_id ||',
'                                     ''","Template_Name":"'' || REPLACE(v_target_name, ''"'', ''\"'') ||',
'                                     ''","Score":'' || v_score || ''}'';',
'                v_count_templates := v_count_templates + 1;',
'            END IF;',
'        END LOOP;',
'',
'        v_json_output := v_json_output || '']'';',
'',
'        IF v_count_templates = 0 THEN',
'            p_output_json := ''[{}]'';',
'            p_message     := ''No templates matched the minimum score threshold'';',
'            debug(''No matching templates found.'');',
'        ELSE',
'            p_output_json := v_json_output;',
'            p_message     := ''Templates matched: '' || v_count_templates;',
'            debug(''Matching templates count: '' || v_count_templates);',
'        END IF;',
'',
'        p_status := ''S'';',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status      := ''E'';',
'            p_message     := ''Unexpected error: '' || SQLERRM;',
'            p_output_json := NULL;',
'    END fetch_templates;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE DELETE_TEMPLATES(',
'        p_id           IN  VARCHAR2 DEFAULT NULL,',
'        p_hotel_id     IN  VARCHAR2 DEFAULT NULL,',
'        p_key          IN  VARCHAR2 DEFAULT NULL,',
'        p_name         IN  VARCHAR2 DEFAULT NULL,',
'        p_type         IN  VARCHAR2 DEFAULT NULL,',
'        p_active       IN  CHAR     DEFAULT NULL,',
'        p_db_obj_empty IN  CHAR     DEFAULT NULL,',
'        p_delete_all   IN  CHAR     DEFAULT ''N'',',
'        p_debug        IN  CHAR     DEFAULT ''N'',',
'        p_json_output  OUT CLOB',
'    ) AS',
'        v_sql          VARCHAR2(1000);',
'        v_rows_count   NUMBER;',
'        v_status       CHAR(1);',
'        v_message      VARCHAR2(4000);',
'        v_json_list    CLOB := ''['';',
'        v_first        BOOLEAN := TRUE;',
'',
'        CURSOR c_templates IS',
'            SELECT',
'                id,',
'                hotel_id,',
'                key,',
'                name,',
'                type,',
'                active,',
'                db_object_name',
'            FROM',
'                ur_templates',
'            WHERE',
'                (p_delete_all = ''Y'' OR (p_id IS NULL OR id = p_id)) AND (p_delete_all = ''Y'' OR (p_hotel_id IS NULL OR hotel_id = p_hotel_id)) AND (p_delete_all = ''Y'' OR (p_key IS NULL OR key = p_key)) AND (p_delete_all = ''Y'' OR (p_name IS NULL OR nam'
||'e = p_name)) AND (p_delete_all = ''Y'' OR (p_type IS NULL OR type = p_type)) AND (p_delete_all = ''Y'' OR (p_active IS NULL OR active = p_active));',
'',
'        -- Helper to escape JSON strings (basic)',
'        FUNCTION json_escape(str IN VARCHAR2) RETURN VARCHAR2 IS',
'        BEGIN',
'            RETURN REPLACE(REPLACE(REPLACE(REPLACE(str, ''\'', ''\\''), ''"'', ''\"''), CHR(10), ''\n''), CHR(13), '''');',
'        EXCEPTION',
'            WHEN OTHERS THEN',
'                RETURN '''';',
'        END;',
'',
'        PROCEDURE dbg(p_msg VARCHAR2) IS',
'        BEGIN',
'            IF p_debug = ''Y'' THEN',
'                apex_debug.message(p_msg);',
'            END IF;',
'        END;',
'',
'        PROCEDURE append_result(',
'            p_id          IN VARCHAR2,',
'            p_hotel_id    IN VARCHAR2,',
'            p_key         IN VARCHAR2,',
'            p_name        IN VARCHAR2,',
'            p_type        IN VARCHAR2,',
'            p_active      IN CHAR,',
'            p_db_obj_name IN VARCHAR2,',
'            p_status      IN CHAR,',
'            p_message     IN VARCHAR2',
'        ) IS',
'        BEGIN',
'            IF v_first THEN',
'                v_first := FALSE;',
'            ELSE',
'                v_json_list := v_json_list || '','';',
'            END IF;',
'',
'            v_json_list := v_json_list || ''{'' ||',
'                           ''"id":"'' || json_escape(p_id) || ''",'' ||',
'                           ''"hotel_id":"'' || json_escape(p_hotel_id) || ''",'' ||',
'                           ''"key":"'' || json_escape(p_key) || ''",'' ||',
'                           ''"name":"'' || json_escape(p_name) || ''",'' ||',
'                           ''"type":"'' || json_escape(p_type) || ''",'' ||',
'                           ''"active":"'' || json_escape(p_active) || ''",'' ||',
'                           ''"db_object_name":"'' || json_escape(p_db_obj_name) || ''",'' ||',
'                           ''"status":"'' || json_escape(p_status) || ''",'' ||',
'                           ''"message":"'' || json_escape(p_message) || ''"'' ||',
'                           ''}'';',
'        END;',
'',
'    BEGIN',
'        dbg(''Started DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'',
'        FOR rec IN c_templates LOOP',
'            dbg(''Processing template ID='' || rec.id || '', DB_OBJECT_NAME='' || rec.db_object_name);',
'',
'            IF rec.db_object_name IS NULL THEN',
'                v_status  := ''E'';',
'                v_message := ''No DB_OBJECT_NAME specified for template, skipping.'';',
'                dbg(v_message);',
'                append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, NULL, v_status, v_message);',
'                CONTINUE;',
'            END IF;',
'',
'            -- Check if table should be empty before deleting',
'            IF p_db_obj_empty = ''Y'' THEN',
'                v_sql := ''SELECT COUNT(*) FROM '' || rec.db_object_name;',
'                BEGIN',
'                    EXECUTE IMMEDIATE v_sql INTO v_rows_count;',
'                EXCEPTION',
'                    WHEN OTHERS THEN',
'                        v_rows_count := -1; -- can''t count, treat as error or non-empty',
'                END;',
'',
'                IF v_rows_count > 0 THEN',
'                    v_status  := ''E'';',
'                    v_message := ''DB Object table ['' || rec.db_object_name || ''] is not empty (ROWS='' || v_rows_count || ''), skipping deletion.'';',
'                    dbg(v_message);',
'                    append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'                    CONTINUE;',
'                END IF;',
'                dbg(''DB Object table ['' || rec.db_object_name || ''] is empty, proceeding.'');',
'            END IF;',
'',
'            -- Try to drop the table and delete template',
'            BEGIN',
'                v_sql := ''DROP TABLE '' || rec.db_object_name || '' CASCADE CONSTRAINTS'';',
'                dbg(''Executing: '' || v_sql);',
'                EXECUTE IMMEDIATE v_sql;',
'',
'                dbg(''Dropped table '' || rec.db_object_name);',
'',
'                DELETE FROM ur_templates WHERE id = rec.id;',
'',
'                dbg(''Deleted template id='' || rec.id);',
'',
'                v_status  := ''S'';',
'                v_message := ''Successfully dropped table and deleted template.'';',
'                append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'',
'            EXCEPTION',
'                WHEN OTHERS THEN',
'                    v_status  := ''E'';',
'                    v_message := ''Error dropping table or deleting template: '' || SQLERRM;',
'                    dbg(v_message);',
'                    append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'            END;',
'        END LOOP;',
'',
'        v_json_list   := v_json_list || '']'';',
'        p_json_output := v_json_list;',
'',
'        dbg(''Completed DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'    END DELETE_TEMPLATES;',
'',
'    --------------------------------------------------------------------------------',
'',
'   PROCEDURE manage_algo_attributes(',
'        p_template_key   IN  VARCHAR2,',
'        p_mode           IN  CHAR,',
'        p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'        p_status         OUT BOOLEAN,',
'        p_message        OUT VARCHAR2',
'    ) IS',
'      -- Original Variables',
'      v_db_object_name UR_TEMPLATES.DB_OBJECT_NAME%TYPE;',
'      v_definition     UR_TEMPLATES.DEFINITION%TYPE;',
'      v_hotel_id       UR_TEMPLATES.HOTEL_ID%TYPE;',
'      v_user_id        RAW(16);',
'      v_insert_count   NUMBER := 0;',
'      v_delete_count   NUMBER := 0;',
'      v_template_id    RAW(16);',
'      v_attr_qualifier VARCHAR2(4000) := NULL;',
'',
'      -- New Variables for RST logic',
'      v_template_type        UR_TEMPLATES.TYPE%TYPE;',
'      v_db_view_object_name  UR_TEMPLATES.DB_VIEW_OBJECT_NAME%TYPE;',
'      v_own_property_count   NUMBER := 0;',
'      v_comp_property_count  NUMBER := 0;',
'      v_object_exists        NUMBER := 0;',
'      v_column_exists        NUMBER := 0;',
'',
'      -- Local helper procedure updated to accept qualifier name',
'        PROCEDURE create_rst_attribute (',
'          p_attr_name       IN VARCHAR2,',
'          p_attr_key        IN VARCHAR2,',
'          p_attr_val        IN VARCHAR2,',
'          p_qualifier_name  IN VARCHAR2,',
'          p_data_type       IN VARCHAR2 DEFAULT ''NUMBER''',
'      ) IS',
'          v_exists NUMBER;',
'      BEGIN',
'          SELECT COUNT(*) INTO v_exists FROM ur_algo_attributes WHERE key = p_attr_key;',
'          IF v_exists = 0 THEN',
'              INSERT INTO ur_algo_attributes (',
'                  id, algo_id, hotel_id, name, key, data_type, description, type, value, template_id, attribute_qualifier,',
'                  created_by, updated_by, created_on, updated_on',
'              ) VALUES (',
'                  SYS_GUID(), NULL, v_hotel_id, p_attr_name, p_attr_key, p_data_type,',
'                  NULL,',
'                  ''S'', ',
'                  ''#'' || p_attr_val || ''#'', -- Value wrapped in #',
'                  v_template_id,',
'                  p_qualifier_name,',
'                  v_user_id, v_user_id, SYSDATE, SYSDATE',
'              );',
'              v_insert_count := v_insert_count + 1;',
'          END IF;',
'      END create_rst_attribute;',
'',
'    BEGIN',
'      -- Initialization',
'      p_status := FALSE;',
'      p_message := NULL;',
'',
'      -- Obtain needed data from UR_TEMPLATES',
'      BEGIN',
'        SELECT db_object_name, definition, hotel_id, id, type, db_view_object_name',
'        INTO v_db_object_name, v_definition, v_hotel_id, v_template_id, v_template_type, v_db_view_object_name',
'        FROM ur_templates',
'        WHERE key = p_template_key;',
'      EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'          p_message := ''Failure: Template key not found: '' || p_template_key;',
'          RETURN;',
'      END;',
'',
'      IF v_db_object_name IS NULL THEN',
'        p_message := ''Failure: DB_OBJECT_NAME not defined for template_key '' || p_template_key;',
'        RETURN;',
'      END IF;',
'',
'      -- Get USER_ID once for audit columns',
'      BEGIN',
'        SELECT USER_ID INTO v_user_id',
'        FROM UR_USERS',
'        WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'      EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'          v_user_id := NULL;',
'      END;',
'',
'      IF p_mode = ''C'' THEN',
'        IF v_definition IS NULL THEN',
'          p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'          RETURN;',
'        END IF;',
'',
'        -- ====================================================================================',
'        -- START: LOGIC FOR RST TEMPLATES',
'        -- ====================================================================================',
'        IF v_template_type = ''RST'' THEN',
'          -- Count OWN_PROPERTY and COMP_PROPERTY qualifiers',
'          SELECT',
'            COUNT(CASE WHEN UPPER(jt.qualifier) = ''OWN_PROPERTY'' THEN 1 END),',
'            COUNT(CASE WHEN UPPER(jt.qualifier) = ''COMP_PROPERTY'' THEN 1 END)',
'          INTO v_own_property_count, v_comp_property_count',
'          FROM JSON_TABLE(v_definition, ''$[*]'' COLUMNS (qualifier VARCHAR2(30) PATH ''$.qualifier'')) jt;',
'',
'          -- Check if the special qualifiers exist to trigger the RST logic',
'          IF v_own_property_count > 0 AND v_comp_property_count > 0 THEN',
'            -- 1. Validate DB_VIEW_OBJECT_NAME',
'            IF v_db_view_object_name IS NULL THEN',
'              p_message := ''Failure: DB_VIEW_OBJECT_NAME is not defined for RST template '' || p_template_key;',
'              RETURN;',
'            END IF;',
'',
'            -- 2. Validate the view/object exists',
'            BEGIN',
'              SELECT 1 INTO v_object_exists FROM user_objects',
'              WHERE object_name = UPPER(v_db_view_object_name) AND object_type IN (''VIEW'', ''TABLE'', ''SYNONYM'');',
'            EXCEPTION',
'              WHEN NO_DATA_FOUND THEN',
'                v_object_exists := 0;',
'            END;',
'',
'            IF v_object_exists = 0 THEN',
'              p_message := ''Failure: The specified DB_VIEW_OBJECT_NAME '''''' || v_db_view_object_name || '''''' does not exist.'';',
'              RETURN;',
'            END IF;',
'',
'            -- 3. Validate and create attributes for OWN_PROPERTY',
'            FOR r_col IN (',
'                SELECT ''OWN_PROPERTY_RANK'' AS col_name FROM DUAL',
'                UNION ALL',
'                SELECT ''OWN_PROPERTY_RATE'' AS col_name FROM DUAL',
'            ) LOOP',
'                SELECT COUNT(*) INTO v_column_exists FROM user_tab_columns',
'                WHERE table_name = UPPER(v_db_view_object_name) AND column_name = r_col.col_name;',
'',
'                IF v_column_exists = 0 THEN',
'                    p_message := ''Failure: Required column '' || r_col.col_name || '' not found in view '' || v_db_view_object_name;',
'                    RETURN;',
'                END IF;',
'            END LOOP;',
'            ',
'            create_rst_attribute(''OWN PROPERTY RANK'', v_db_view_object_name || ''.OWN_PROPERTY_RANK'', v_db_view_object_name || ''.OWN_PROPERTY_RANK'', ''OWN_PROPERTY'');',
'            create_rst_attribute(''OWN PROPERTY RATE'', v_db_view_object_name || ''.OWN_PROPERTY_RATE'', v_db_view_object_name || ''.OWN_PROPERTY_RATE'', ''OWN_PROPERTY'');',
'            ',
'            -- 4. Create attributes for COMP_PROPERTY',
'            FOR i IN 1 .. (v_comp_property_count + 1) LOOP',
'              DECLARE',
'                l_col_name   VARCHAR2(100) := ''RANK_'' || i || ''_RATE'';',
'                l_attr_name  VARCHAR2(100) := ''COMP SET R'' || i || '' RATE'';',
'                l_attr_key   VARCHAR2(200) := v_db_view_object_name || ''.'' || l_col_name;',
'              BEGIN',
'                -- Validate that the required rank column exists',
'                SELECT COUNT(*) INTO v_column_exists FROM user_tab_columns',
'                WHERE table_name = UPPER(v_db_view_object_name) AND column_name = l_col_name;',
'',
'                IF v_column_exists = 0 THEN',
'                  p_message := ''Failure: Required column '' || l_col_name || '' not found in view '' || v_db_view_object_name || ''.'';',
'                  ROLLBACK;',
'                  RETURN;',
'                END IF;',
'                ',
'                -- Create the attribute using the helper',
'                create_rst_attribute(l_attr_name, l_attr_key, l_attr_key, ''COMP_PROPERTY'');',
'              END;',
'            END LOOP;',
'          END IF;',
'',
'          -- Process any OTHER qualifiers in an RST template using the original logic',
'          FOR rec IN (',
'            SELECT jt.name, jt.data_type, jt.qualifier',
'            FROM JSON_TABLE(',
'              v_definition, ''$[*]'' COLUMNS (',
'                name      VARCHAR2(100) PATH ''$.name'',',
'                data_type VARCHAR2(30)  PATH ''$.data_type'',',
'                qualifier VARCHAR2(30)  PATH ''$.qualifier''',
'              )',
'            ) jt',
'            WHERE jt.qualifier IS NOT NULL',
'              AND UPPER(jt.qualifier) NOT IN (''UNIQUE'', ''OWN_PROPERTY'', ''COMP_PROPERTY'')',
'          )',
'          LOOP',
'            DECLARE',
'              l_col_name VARCHAR2(150) := UPPER(REGEXP_REPLACE(TRIM(rec.name), ''_+$'', ''''));',
'              v_key      VARCHAR2(150) := v_db_object_name || ''.'' || l_col_name;',
'              v_exists   NUMBER;',
'            BEGIN',
'              SELECT COUNT(*) INTO v_exists FROM ur_algo_attributes WHERE key = v_key;',
'              IF v_exists = 0 THEN',
'                INSERT INTO ur_algo_attributes (',
'                  id, algo_id, hotel_id, name, key, data_type, description, type, value, template_id, attribute_qualifier,',
'                  created_by, updated_by, created_on, updated_on',
'                ) VALUES (',
'                  SYS_GUID(), NULL, v_hotel_id, l_col_name, v_key, NVL(UPPER(rec.data_type), ''NUMBER''),',
'                  NULL, ''S'', ',
'                  ''#'' || v_key || ''#'', -- Value wrapped in #',
'                  v_template_id, rec.qualifier,',
'                  v_user_id, v_user_id, SYSDATE, SYSDATE',
'                );',
'                v_insert_count := v_insert_count + 1;',
'              END IF;',
'            END;',
'          END LOOP;',
'',
'        ELSE',
'          -- ====================================================================================',
'          -- START: ORIGINAL LOGIC FOR NON-RST TEMPLATES',
'          -- ====================================================================================',
'          FOR rec IN (',
'            SELECT jt.name, jt.data_type, jt.qualifier',
'            FROM JSON_TABLE(',
'              v_definition, ''$[*]'' COLUMNS (',
'                name      VARCHAR2(100) PATH ''$.name'',',
'                data_type VARCHAR2(30)  PATH ''$.data_type'',',
'                qualifier VARCHAR2(30)  PATH ''$.qualifier''',
'              )',
'            ) jt',
'            WHERE jt.qualifier IS NOT NULL',
'              AND UPPER(jt.qualifier) <> ''UNIQUE''',
'          )',
'          LOOP',
'            DECLARE',
'              l_col_name VARCHAR2(150) := UPPER(REGEXP_REPLACE(TRIM(rec.name), ''_+$'', ''''));',
'              v_key      VARCHAR2(150) := v_db_object_name || ''.'' || l_col_name;',
'              v_exists   NUMBER;',
'            BEGIN',
'              SELECT COUNT(*) INTO v_exists FROM ur_algo_attributes WHERE key = v_key;',
'              IF v_exists = 0 THEN',
'                INSERT INTO ur_algo_attributes (',
'                  id, algo_id, hotel_id, name, key, data_type, description, type, value, template_id, attribute_qualifier,',
'                  created_by, updated_by, created_on, updated_on',
'                ) VALUES (',
'                  SYS_GUID(), NULL, v_hotel_id, l_col_name, v_key, NVL(UPPER(rec.data_type), ''NUMBER''),',
'                  NULL, ''S'', ',
'                  ''#'' || v_key || ''#'', -- Value wrapped in #',
'                  v_template_id, rec.qualifier,',
'                  v_user_id, v_user_id, SYSDATE, SYSDATE',
'                );',
'                v_insert_count := v_insert_count + 1;',
'              END IF;',
'            END;',
'          END LOOP;',
'        END IF;',
'',
'        COMMIT;',
'        p_status := TRUE;',
'        p_message := ''Success: '' || v_insert_count || '' attribute''',
'                   || CASE WHEN v_insert_count = 1 THEN '''' ELSE ''s'' END',
'                   || '' inserted for template_key '' || p_template_key;',
'',
'      ELSIF p_mode = ''D'' THEN',
'        -- Delete logic remains unchanged',
'        IF p_attribute_key IS NOT NULL THEN',
'          IF p_attribute_key LIKE v_db_object_name || ''.%'' OR p_attribute_key LIKE v_db_view_object_name || ''.%'' THEN',
'            DELETE FROM ur_algo_attributes WHERE key = p_attribute_key;',
'            v_delete_count := SQL%ROWCOUNT;',
'            COMMIT;',
'            p_status := TRUE;',
'            IF v_delete_count > 0 THEN',
'              p_message := ''Success: '' || v_delete_count || '' attribute deleted with key '' || p_attribute_key;',
'            ELSE',
'              p_message := ''Info: No attribute found to delete with key '' || p_attribute_key;',
'            END IF;',
'          ELSE',
'            p_status := FALSE;',
'            p_message := ''Failure: Attribute key does not belong to template '' || p_template_key;',
'          END IF;',
'        ELSE',
'          DELETE FROM ur_algo_attributes WHERE template_id = v_template_id; -- Safer delete by template_id',
'          v_delete_count := SQL%ROWCOUNT;',
'          COMMIT;',
'          p_status := TRUE;',
'          p_message := ''Success: '' || v_delete_count || '' attribute''',
'                       || CASE WHEN v_delete_count = 1 THEN '''' ELSE ''s'' END',
'                       || '' deleted for template_key '' || p_template_key;',
'        END IF;',
'',
'      ELSIF p_mode = ''U'' THEN',
'        p_status := FALSE;',
'        p_message := ''Update mode not yet implemented'';',
'',
'      ELSE',
'        p_status := FALSE;',
'        p_message := ''Invalid mode: '' || p_mode || ''. Valid modes are C, U, D.'';',
'      END IF;',
'',
'    EXCEPTION',
'      WHEN OTHERS THEN',
'        ROLLBACK;',
'        p_status := FALSE;',
'        p_message := ''Failure: '' || SQLERRM;',
'    END manage_algo_attributes;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE add_alert(',
'        p_existing_json IN  CLOB,',
'        p_message       IN  VARCHAR2,',
'        p_icon          IN  VARCHAR2 DEFAULT NULL,',
'        p_title         IN  VARCHAR2 DEFAULT NULL,',
'        p_timeout       IN  NUMBER   DEFAULT NULL,',
'        p_updated_json  OUT CLOB',
'    ) IS',
'        l_json_array json_array_t;',
'        l_new_object json_object_t;',
'    BEGIN',
'        -- Create the new JSON object',
'        l_new_object := new json_object_t();',
'        l_new_object.put(''message'', p_message);',
'        l_new_object.put(''icon'', nvl(p_icon, ''success''));',
'        l_new_object.put(''title'', nvl(p_title, ''''));',
'',
'        IF p_timeout IS NOT NULL THEN',
'            l_new_object.put(''timeOut'', to_char(p_timeout));',
'        END IF;',
'',
'        -- Append the new object to the existing array or create a new array',
'        IF p_existing_json IS NULL OR trim(p_existing_json) = '''' THEN',
'            -- Create a new array with the new object',
'            l_json_array := new json_array_t();',
'        ELSE',
'            -- Parse the existing JSON string into a JSON array',
'            l_json_array := json_array_t(p_existing_json);',
'        END IF;',
'',
'        -- Append the new object',
'        l_json_array.append(l_new_object);',
'',
'        -- Convert the JSON array back to a CLOB',
'        p_updated_json := l_json_array.to_clob;',
'    END add_alert;',
'',
'    --------------------------------------------------------------------------------',
'',
'    PROCEDURE validate_expression(',
'        p_expression IN  VARCHAR2,',
'        p_mode       IN  CHAR,',
'        p_hotel_id   IN  VARCHAR2,',
'        p_status     OUT VARCHAR2, -- ''S'' or ''E''',
'        p_message    OUT VARCHAR2',
'    ) IS',
'        TYPE t_str_list IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'        v_attributes         t_str_list;',
'        v_functions          t_str_list;',
'        v_operators          t_str_list;',
'        v_attr_count         NUMBER := 0;',
'        v_func_count         NUMBER := 0;',
'        v_oper_count         NUMBER := 0;',
'',
'        TYPE t_token_rec IS RECORD(',
'            token     VARCHAR2(4000),',
'            start_pos PLS_INTEGER,',
'            end_pos   PLS_INTEGER',
'        );',
'        TYPE t_token_tab IS TABLE OF t_token_rec INDEX BY PLS_INTEGER;',
'        v_tokens             t_token_tab;',
'        v_token_count        PLS_INTEGER := 0;',
'',
'        TYPE t_token_tab_nt IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'        v_unmatched_tokens   t_token_tab;',
'        v_unmatched_count    PLS_INTEGER := 0;',
'',
'        -- To mark tokens consumed by multi-word operators',
'        TYPE t_bool_tab IS TABLE OF BOOLEAN INDEX BY PLS_INTEGER;',
'        v_token_consumed     t_bool_tab;',
'',
'        v_mode               CHAR := UPPER(p_mode);',
'',
'        -- Trim and uppercase token helper',
'        FUNCTION normalize_token(p_token VARCHAR2) RETURN VARCHAR2 IS',
'        BEGIN',
'            RETURN UPPER(TRIM(p_token));',
'        END;',
'',
'        -- Strip function parameters, e.g. "ROUND (n,d)" -> "ROUND"',
'        FUNCTION normalize_func_name(p_func VARCHAR2) RETURN VARCHAR2 IS',
'        BEGIN',
'            RETURN REGEXP_REPLACE(UPPER(TRIM(p_func)), ''\s*\(.*\)$'');',
'        END;',
'',
'        -- Checks if token is numeric',
'        FUNCTION is_number(p_token VARCHAR2) RETURN BOOLEAN IS',
'        BEGIN',
'            RETURN REGEXP_LIKE(p_token, ''^[+-]?(\d+(\.\d*)?|\.\d+)([Ee][+-]?\d+)?$'');',
'        END;',
'',
'        -- Check presence in list',
'        FUNCTION is_in_list(',
'            p_token VARCHAR2,',
'            p_list  t_str_list,',
'            cnt     NUMBER',
'        ) RETURN BOOLEAN IS',
'        BEGIN',
'            FOR i IN 1..cnt LOOP',
'                IF p_list(i) = p_token THEN',
'                    RETURN TRUE;',
'                END IF;',
'            END LOOP;',
'            RETURN FALSE;',
'        END;',
'',
'        -- Check if token valid: attribute, operator, function, number, parentheses',
'        FUNCTION is_token_valid(p_token VARCHAR2) RETURN BOOLEAN IS',
'            l_token VARCHAR2(100) := p_token;',
'        BEGIN',
'            -- Parentheses always valid tokens',
'            IF l_token IN (''('', '')'') THEN',
'                RETURN TRUE;',
'            END IF;',
'',
'            -- Strip trailing ''('' from function calls',
'            IF SUBSTR(l_token, -1) = ''('' THEN',
'                l_token := SUBSTR(l_token, 1, LENGTH(l_token) - 1);',
'            END IF;',
'',
'            -- Check if number',
'            IF is_number(l_token) THEN',
'                RETURN TRUE;',
'            END IF;',
'',
'            l_token := normalize_token(l_token);',
'',
'            IF is_in_list(l_token, v_attributes, v_attr_count) THEN',
'                RETURN TRUE;',
'            ELSIF is_in_list(l_token, v_functions, v_func_count) THEN',
'                RETURN TRUE;',
'            ELSIF is_in_list(l_token, v_operators, v_oper_count) THEN',
'                RETURN TRUE;',
'            END IF;',
'',
'            RETURN FALSE;',
'        END;',
'',
'        PROCEDURE load_functions(',
'            p_list  OUT t_str_list,',
'            p_count OUT NUMBER',
'        ) IS',
'        BEGIN',
'            p_list.DELETE;',
'            p_count := 0;',
'            FOR r IN (',
'                SELECT',
'                    return_value',
'                FROM',
'                    apex_application_lov_entries',
'                WHERE',
'                    list_of_values_name = ''UR EXPRESSION FUNCTIONS''',
'                ORDER BY',
'                    return_value',
'            ) LOOP',
'                p_count        := p_count + 1;',
'                p_list(p_count) := normalize_func_name(r.return_value);',
'            END LOOP;',
'            IF p_count = 0 THEN',
'                RAISE_APPLICATION_ERROR(-20010, ''Functions LOV missing or empty'');',
'            END IF;',
'        END;',
'',
'        PROCEDURE load_operators(',
'            p_list  OUT t_str_list,',
'            p_count OUT NUMBER',
'        ) IS',
'        BEGIN',
'            p_list.DELETE;',
'            p_count := 0;',
'            FOR r IN (',
'                SELECT',
'                    return_value',
'                FROM',
'                    apex_application_lov_entries',
'                WHERE',
'                    list_of_values_name = ''UR EXPRESSION OPERATORS''',
'                ORDER BY',
'                    return_value',
'            ) LOOP',
'                p_count        := p_count + 1;',
'                p_list(p_count) := UPPER(TRIM(r.return_value));',
'            END LOOP;',
'            IF p_count = 0 THEN',
'                RAISE_APPLICATION_ERROR(-20011, ''Operators LOV missing or empty'');',
'            END IF;',
'        END;',
'',
'        PROCEDURE load_attributes(',
'            p_hotel_id IN  VARCHAR2,',
'            p_list     OUT t_str_list,',
'            p_count    OUT NUMBER',
'        ) IS',
'        BEGIN',
'            p_list.DELETE;',
'            p_count := 0;',
'            FOR r IN (',
'                SELECT',
'                    key',
'                FROM',
'                    ur_algo_attributes',
'                WHERE',
'                    hotel_id = p_hotel_id',
'            ) LOOP',
'                p_count        := p_count + 1;',
'                p_list(p_count) := UPPER(TRIM(r.key));',
'            END LOOP;',
'         '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'   IF p_count = 0 THEN',
'                RAISE_APPLICATION_ERROR(-20012, ''Attributes missing for hotel_id '' || p_hotel_id);',
'            END IF;',
'        END;',
'',
'        -- Tokenizer splitting expression into tokens, tracking start/end pos',
'        PROCEDURE tokenize_expression(',
'            p_expr  IN  VARCHAR2,',
'            p_tokens OUT t_token_tab,',
'            p_count OUT NUMBER',
'        ) IS',
'            l_pos         PLS_INTEGER := 1;',
'            l_len         PLS_INTEGER := LENGTH(p_expr);',
'            l_token       VARCHAR2(4000);',
'            l_token_start PLS_INTEGER;',
'            l_token_end   PLS_INTEGER;',
'        BEGIN',
'            p_tokens.DELETE;',
'            p_count := 0;',
'            WHILE l_pos <= l_len LOOP',
'                l_token := REGEXP_SUBSTR(',
'                    p_expr,',
'                    ''([A-Za-z0-9_\.]+|\d+(\.\d+)?|\(|\)|\S)'',',
'                    l_pos,',
'                    1,',
'                    ''i''',
'                );',
'                EXIT WHEN l_token IS NULL;',
'                l_token_start := INSTR(p_expr, l_token, l_pos);',
'                l_token_end   := l_token_start + LENGTH(l_token) - 1;',
'                p_count       := p_count + 1;',
'                p_tokens(p_count) := t_token_rec(token => l_token, start_pos => l_token_start, end_pos => l_token_end);',
'                l_pos         := l_token_end + 1;',
'                WHILE l_pos <= l_len AND SUBSTR(p_expr, l_pos, 1) = '' '' LOOP',
'                    l_pos := l_pos + 1;',
'                END LOOP;',
'            END LOOP;',
'        END;',
'',
'        FUNCTION build_json_errors(',
'            p_unmatched t_token_tab,',
'            p_count     PLS_INTEGER',
'        ) RETURN VARCHAR2 IS',
'            v_json VARCHAR2(4000) := ''['';',
'        BEGIN',
'            IF p_count = 0 THEN',
'                RETURN ''[]'';',
'            END IF;',
'            FOR i IN 1..p_count LOOP',
'                v_json := v_json || ''{"token":"'' || p_unmatched(i).token ||',
'                          ''","start":'' || p_unmatched(i).start_pos ||',
'                          '',"end":'' || p_unmatched(i).end_pos || ''}'';',
'                IF i < p_count THEN',
'                    v_json := v_json || '','';',
'                END IF;',
'            END LOOP;',
'            v_json := v_json || '']'';',
'            RETURN v_json;',
'        END;',
'',
'        -- Return number of consecutive tokens matched as an operator starting at start_idx',
'        FUNCTION get_longest_operator_match(start_idx IN PLS_INTEGER) RETURN PLS_INTEGER IS',
'            combined      VARCHAR2(4000);',
'            max_words     CONSTANT PLS_INTEGER := 4; -- max operator words count',
'            words_count   PLS_INTEGER;',
'            l_len         PLS_INTEGER := LEAST(max_words, v_token_count - start_idx + 1);',
'            i             PLS_INTEGER;',
'        BEGIN',
'            FOR words_count IN REVERSE 1..l_len LOOP',
'                combined := '''';',
'                FOR i IN start_idx..start_idx + words_count - 1 LOOP',
'                    IF combined IS NULL OR combined = '''' THEN',
'                        combined := UPPER(TRIM(v_tokens(i).token));',
'                    ELSE',
'                        combined := combined || '' '' || UPPER(TRIM(v_tokens(i).token));',
'                    END IF;',
'                END LOOP;',
'                IF is_in_list(combined, v_operators, v_oper_count) THEN',
'                    RETURN words_count;',
'                END IF;',
'            END LOOP;',
'            RETURN 0;',
'        END;',
'',
'    BEGIN',
'        p_status  := ''E'';',
'        p_message := NULL;',
'',
'        IF v_mode NOT IN (''V'', ''C'') THEN',
'            p_status  := ''E'';',
'            p_message := ''Invalid mode "'' || p_mode || ''". Valid are V or C.'';',
'            RETURN;',
'        END IF;',
'',
'        IF p_hotel_id IS NULL THEN',
'            p_status  := ''E'';',
'            p_message := ''hotel_id is mandatory'';',
'            RETURN;',
'        END IF;',
'',
'        IF p_expression IS NULL OR LENGTH(TRIM(p_expression)) = 0 THEN',
'            p_status  := ''E'';',
'            p_message := ''Expression is empty'';',
'            RETURN;',
'        END IF;',
'',
'        load_functions(v_functions, v_func_count);',
'        load_operators(v_operators, v_oper_count);',
'        load_attributes(p_hotel_id, v_attributes, v_attr_count);',
'',
'        tokenize_expression(p_expression, v_tokens, v_token_count);',
'',
'        -- Initialize consumed array',
'        v_token_consumed.DELETE;',
'',
'        DECLARE',
'            i             PLS_INTEGER := 1;',
'            words_matched PLS_INTEGER := 0;',
'        BEGIN',
'            WHILE i <= v_token_count LOOP',
'                words_matched := get_longest_operator_match(i);',
'                IF words_matched > 0 THEN',
'                    FOR j IN i..i + words_matched - 1 LOOP',
'                        v_token_consumed(j) := TRUE;',
'                    END LOOP;',
'                    i := i + words_matched;',
'                ELSE',
'                    -- Single token valid check',
'                    v_token_consumed(i) := is_token_valid(normalize_token(v_tokens(i).token));',
'                    i                   := i + 1;',
'                END IF;',
'            END LOOP;',
'        END;',
'',
'        IF v_mode = ''V'' THEN',
'            v_unmatched_tokens.DELETE;',
'            v_unmatched_count := 0;',
'            FOR i IN 1..v_token_count LOOP',
'                IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = FALSE THEN',
'                    v_unmatched_count                       := v_unmatched_count + 1;',
'                    v_unmatched_tokens(v_unmatched_count) := v_tokens(i);',
'                END IF;',
'            END LOOP;',
'',
'            IF v_unmatched_count > 0 THEN',
'                p_status  := ''E'';',
'                p_message := ''Invalid tokens: '' || build_json_errors(v_unmatched_tokens, v_unmatched_count);',
'            ELSE',
'                p_status  := ''S'';',
'                p_message := ''Expression validated successfully.'';',
'            END IF;',
'',
'        ELSIF v_mode = ''C'' THEN',
'            p_status  := ''S'';',
'            p_message := '''';',
'            FOR i IN 1..v_token_count LOOP',
'                IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = TRUE THEN',
'                    p_message := p_message || v_tokens(i).token || '' '';',
'                END IF;',
'            END LOOP;',
'            p_message := RTRIM(p_message);',
'        END IF;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status  := ''E'';',
'            p_message := ''Failure: '' || SQLERRM;',
'    END validate_expression;',
'',
'END ur_utils;',
'/',
'create or replace PACKAGE BODY ur_utils_test IS',
'',
'    FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2 IS',
'      v_clean VARCHAR2(4000);',
'    BEGIN',
'      v_clean := UPPER(',
'                   SUBSTR(',
'                     REGEXP_REPLACE(',
'                       REGEXP_REPLACE(',
'                         REGEXP_REPLACE(',
'                           TRIM(p_text),',
'                           ''^[^A-Za-z0-9]+|[^A-Za-z0-9]+$'', ''''',
'                         ),',
'                         ''[^A-Za-z0-9]+'', ''_''',
'                       ),',
'                       ''_+'', ''_''',
'                     ),',
'                     1, 110',
'                   )',
'                 );',
'      RETURN v_clean;',
'    END Clean_TEXT;',
'',
'FUNCTION normalize_json (p_json CLOB) RETURN CLOB IS',
'BEGIN',
'  RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'END normalize_json;',
'',
'  PROCEDURE get_collection_json(',
'    p_collection_name IN VARCHAR2,',
'    p_json_clob OUT CLOB,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  ) IS',
'    l_count NUMBER;',
'  BEGIN',
'    SELECT COUNT(*)',
'      INTO l_count',
'      FROM apex_collections',
'     WHERE collection_name = p_collection_name;',
'',
'    IF l_count = 0 THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Collection "'' || p_collection_name || ''" does not exist or is empty'';',
'      p_json_clob := NULL;',
'      RETURN;',
'    END IF;',
'',
'    -- Initialize and build JSON output',
'    apex_json.initialize_clob_output;',
'    apex_json.open_array;',
'',
'    FOR rec IN (',
'      SELECT c001, c002, c003',
'        FROM apex_collections',
'       WHERE collection_name = p_collection_name',
'       ORDER BY seq_id',
'    )',
'    LOOP',
'      apex_json.open_object;',
'      apex_json.write(''name'', rec.c001);',
'      apex_json.write(''data_type'', rec.c002);',
'      apex_json.write(''qualifier'', rec.c003);',
'      apex_json.close_object;',
'    END LOOP;',
'',
'    apex_json.close_array;',
'',
'    p_json_clob := apex_json.get_clob_output;',
'',
'    apex_json.free_output;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: JSON generated for collection "'' || p_collection_name || ''"'';',
'',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: '' || SQLERRM;',
'      p_json_clob := NULL;',
'  END get_collection_json;',
'',
'',
'',
' PROCEDURE define_db_object(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
') IS',
'    v_db_object_name VARCHAR2(30);',
'    v_sql            CLOB;',
'    v_col_defs       CLOB := '''';',
'    v_unique_defs    CLOB := '''';',
'    v_definition     CLOB;',
'    v_exists         NUMBER;',
'    v_trigger_name   VARCHAR2(130);',
'    l_col_name       VARCHAR2(100);',
'BEGIN',
'    -- Lock row in UR_TEMPLATES and get DB_OBJECT_NAME and definition',
'    SELECT db_object_name, definition',
'    INTO v_db_object_name, v_definition',
'    FROM ur_templates',
'    WHERE key = p_template_key',
'    FOR UPDATE;',
'',
'    IF v_db_object_name IS NOT NULL THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Table already defined as '' || v_db_object_name;',
'      RETURN;',
'    END IF;',
'',
'    IF v_definition IS NULL THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'      RETURN;',
'    END IF;',
'',
'    -- Generate table name (adjust prefix as needed)',
'    v_db_object_name := ''UR_'' || UPPER(p_template_key) || ''_T'';',
'',
'    -- Check if table exists',
'    SELECT COUNT(*)',
'    INTO v_exists',
'    FROM all_tables',
'    WHERE table_name = UPPER(v_db_object_name);',
'',
'    IF v_exists > 0 THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Table '' || v_db_object_name || '' already exists in schema'';',
'      RETURN;',
'    END IF;',
'',
'    -- Start with ID RAW(16) as primary key column',
'    v_col_defs := ''"REC_ID" RAW(16)'';',
'',
'    -- Parse JSON and build column definitions',
'    FOR rec IN (',
'      SELECT jt.name, jt.data_type, jt.qualifier',
'      FROM JSON_TABLE(',
'  normalize_json(v_definition),',
'  ''$[*]'' COLUMNS (',
'    name       VARCHAR2(100) PATH ''$.name'',',
'    data_type  VARCHAR2(30)  PATH ''$.data_type'',',
'    qualifier  VARCHAR2(30)  PATH ''$.qualifier''',
'  )',
') jt',
'',
'    )',
'    LOOP',
'      -- sanitize column name: trim underscores and collapse multiple',
'      l_col_name := UPPER(TRIM(BOTH ''_'' FROM rec.name));',
'      l_col_name := REGEXP_REPLACE(l_col_name, ''_{2,}'', ''_'');',
'',
'      v_col_defs := v_col_defs || '', '';',
'',
'      -- Map data type including DATE',
'      IF UPPER(rec.data_type) = ''TEXT'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'      ELSIF UPPER(rec.data_type) = ''NUMBER'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" NUMBER'';',
'      ELSIF UPPER(rec.data_type) = ''DATE'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" DATE'';',
'      ELSE',
'        -- Default to VARCHAR2 for unknown type',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'      END IF;',
'',
'      -- Collect STAY_DATE constraint definitions',
'      IF UPPER(rec.qualifier) = ''STAY_DATE'' THEN',
'        v_unique_defs := v_unique_defs ',
'          || '', CONSTRAINT "'' || v_db_object_name || ''_'' || l_col_name || ''_UQ" UNIQUE ("'' || l_col_name || ''")'';',
'      END IF;',
'    END LOOP;',
'',
'    -- Add WHO columns + HOTEL_ID RAW(16)',
'    v_col_defs := v_col_defs',
'      || '', CREATED_BY RAW(16), UPDATED_BY RAW(16), CREATED_ON DATE, UPDATED_ON DATE, HOTEL_ID RAW(16), INTERFACE_LOG_ID RAW(16)'';',
'',
'    -- Build final CREATE TABLE DDL',
'    v_sql := ''CREATE TABLE "'' || v_db_object_name || ''" ('' ',
'        || v_col_defs ',
'        || '', CONSTRAINT "'' || v_db_object_name || ''_PK" PRIMARY KEY ("REC_ID")''',
'        || v_unique_defs',
'        || '')'';',
'',
'    EXECUTE IMMEDIATE v_sql;',
'',
'    -- Create trigger to auto-generate ID (if NULL) using SYS_GUID()',
'    v_trigger_name := v_db_object_name || ''_BI_TRG'';',
'',
'    v_sql := ''',
'CREATE OR REPLACE EDITIONABLE TRIGGER "'' || v_trigger_name || ''"',
'BEFORE INSERT OR UPDATE ON "'' || v_db_object_name || ''"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''''APEX$SESSION'''', ''''APP_USER'''');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END '' || v_trigger_name || '';',
''';',
'',
'    EXECUTE IMMEDIATE v_sql;',
'',
'    -- Update UR_TEMPLATES with the new db_object_name and timestamp',
'    UPDATE ur_templates',
'    SET db_object_name = v_db_object_name,',
'        db_object_created_on = SYSDATE',
'    WHERE key = p_template_key;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: Table "'' || v_db_object_name || ''" created with ID primary key and trigger'';',
'EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Template key not found'';',
'    WHEN OTHERS THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: '' || SQLERRM;',
'END define_db_object;',
'',
'',
'PROCEDURE LOAD_DATA_MAPPING_COLLECTION (',
'    p_file_id         IN  VARCHAR2,',
'    p_template_id    IN  VARCHAR2,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT VARCHAR2,',
'    p_message         OUT VARCHAR2',
') IS',
'',
'    -- Local variables',
'    v_seq_id NUMBER;',
'',
'BEGIN',
'    -- Initialize outputs',
'    p_status := ''S'';',
'    p_message := ''Processing completed successfully.'';',
'',
'    ------------------------------------------------------------------------',
'    -- Step 1: Create or truncate the APEX collection',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        IF APEX_COLLECTION.COLLECTION_EXISTS(p_collection_name) THEN',
'            APEX_COLLECTION.DELETE_COLLECTION(p_collection_name);',
'        END IF;',
'',
'        APEX_COLLECTION.CREATE_COLLECTION(p_collection_name);',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to create or truncate collection "'' || p_collection_name || ''": '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'    ------------------------------------------------------------------------',
'    -- Step 2: Insert data from TEMP_BLOB JSON into collection (c001)',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        FOR rec IN (',
'            SELECT jt.name || '' ('' || jt.data_type || '')'' AS column_desc, jt.col_position',
'            FROM TEMP_BLOB t,',
'                 JSON_TABLE(',
'    normalize_json(t.columns),',
'    ''$[*]'' COLUMNS (',
'       name      VARCHAR2(100) PATH ''$.name'',',
'       data_type VARCHAR2(100) PATH ''$.data_type'',',
'       col_position VARCHAR2(100) PATH ''$.pos''',
'    )',
'',
'                 ) jt',
'            WHERE t.id = p_file_id',
'        ) LOOP',
'            APEX_COLLECTION.ADD_MEMBER(',
'                p_collection_name => p_collection_name,',
'                p_c001            => rec.column_desc,',
'                p_c004            => rec.col_position',
'            );',
'        END LOOP;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to insert data from TEMP_BLOB (File ID: '' || p_file_id || ''): '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'    ------------------------------------------------------------------------',
'    -- Step 3: Update existing collection members with matching data from UR_TEMPLATES (c002, c003)',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        FOR rec IN (',
'            SELECT jt.name || '' ('' || jt.data_type || '')'' AS column_desc',
'            FROM UR_TEMPLATES t,',
'                 JSON_TABLE(',
'    normalize_json(t.definition),',
'    ''$[*]'' COLUMNS (',
'       name      VARCHAR2(100) PATH ''$.name'',',
'       data_type VARCHAR2(100) PATH ''$.data_type''',
'    )',
')',
' jt',
'            WHERE t.id = p_template_id',
'            ORDER BY t.id DESC',
'        ) LOOP',
'            BEGIN',
'                -- Find the seq_id for matching collection member',
'                SELECT seq_id ',
'                INTO v_seq_id',
'                FROM apex_collections',
'                WHERE collection_name = p_collection_name',
'                  AND c001 = rec.column_desc;',
'',
'                -- Update c002 and c003 attributes',
'                APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                    p_collection_name => p_collection_name,',
'                    p_seq             => v_seq_id,',
'                    p_attr_number     => 2,',
'                    p_attr_value      => rec.column_desc',
'                );',
'',
'                APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                    p_collection_name => p_collection_name,',
'                    p_seq             => v_seq_id,',
'                    p_attr_number     => 3,',
'                    p_attr_value      => ''Maps To''',
'                );',
'                ',
'                  ',
'',
'',
'            EXCEPTION',
'                WHEN NO_DATA_FOUND THEN',
unistr('                    -- No matching collection member found \2014 ignore gracefully'),
'                    NULL;',
'                WHEN OTHERS THEN',
'                    p_status := ''E'';',
'                    p_message := ''Failed to update member attribute in collection "'' || p_collection_name || ''" for "'' ',
'                                 || rec.column_desc || ''": '' || SQLERRM;',
'                    RETURN;',
'            END;',
'        END LOOP;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to update collection members from UR_TEMPLATES (ID: '' || p_template_id || ''): '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_message := ''Unexpected error occurred: '' || SQLERRM;',
'END LOAD_DATA_MAPPING_COLLECTION;',
'',
'PROCEDURE Load_Data (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT boolean,',
'    p_message         OUT VARCHAR2',
') IS',
'    l_blob        BLOB;',
'    l_file_name   VARCHAR2(255);',
'    l_table_name  VARCHAR2(255);',
'    l_template_id RAW(16);',
'    l_total_rows  NUMBER := 0;',
'    l_success_cnt NUMBER := 0;',
'    l_fail_cnt    NUMBER := 0;',
'    l_log_id      RAW(16);',
'    l_error_json  CLOB := ''['';',
'    l_first_err   BOOLEAN := TRUE;',
'    l_collection_name VARCHAR2(255);',
'    l_debug boolean := FALSE;',
'',
'    -- mapping record type',
'    TYPE t_map_rec IS RECORD (',
'        src_col     VARCHAR2(128),  ',
'        tgt_col     VARCHAR2(128),  ',
'        parser_col  VARCHAR2(20),   ',
'        data_type   VARCHAR2(50)',
'    );',
'    TYPE t_map IS TABLE OF t_map_rec INDEX BY VARCHAR2(128);',
'',
'    l_mapping   t_map;',
'    l_apex_user VARCHAR2(255) := NVL(v(''APP_USER''),''APEX_USER'');',
'',
'    l_cols   VARCHAR2(32767);',
'    l_vals_calculation   VARCHAR2(32767);',
'    l_sql    CLOB;',
'    k        VARCHAR2(128);',
'    v_expr   VARCHAR2(4000);',
'    l_map_count NUMBER;',
'    l_table_name_1 varchar2(480) := ''UR_VK_NEW_CHINAR_T_INTERFACE'';',
'    l_update_1 CLOB;',
'    l_sql_temp clob;',
'    l_sql_select clob;',
'',
'    -- ADDED: variable for duplicate check',
'    l_existing_cnt NUMBER;',
'    v_cursor   INTEGER;',
'    v_cols     VARCHAR2(1000) := ''hotel_id, booking_id, number_of_rooms'';',
'    v_desc_tab DBMS_SQL.DESC_TAB;',
'    v_col_cnt  INTEGER;',
'    v_value    VARCHAR2(4000);',
'    v_col_val  VARCHAR2(4000);',
'    v_status   INTEGER;',
'BEGIN',
'  XX_LOCAL_Load_Data (',
'    p_file_id         => p_file_id        ',
'    ,p_template_key    => p_template_key   ',
'    ,p_hotel_id        => p_hotel_id       ',
'    ,p_collection_name => p_collection_name',
'    ,p_status          => p_status         ',
'    ,p_message         => p_message        ',
');',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        DECLARE',
'            l_err_msg VARCHAR2(4000);',
'        BEGIN',
'            l_err_msg := SQLERRM;',
'',
'            p_status  := FALSE;',
'            p_message := ''Failure: ''|| l_err_msg;',
'',
'            UPDATE ur_interface_logs',
'               SET load_end_time = systimestamp,',
'                   load_status   = ''FAILED'',',
'                   error_json    = l_error_json || ''{"error":"'' || REPLACE(l_err_msg,''"'','''''''') || ''"}]'',',
'                   updated_on    = sysdate',
'             WHERE id = l_log_id;',
'',
'            ROLLBACK;',
'        END;',
'',
'',
'END Load_Data;',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'PROCEDURE fetch_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
') IS',
'    -- Local types',
'    TYPE t_name_type_rec IS RECORD(',
'        name       VARCHAR2(100),',
'        data_type  VARCHAR2(30)',
'    );',
'    TYPE t_name_type_tab IS TABLE OF t_name_type_rec;',
'',
'    TYPE t_template_rec IS RECORD(',
'        id         VARCHAR2(50),',
'        name       VARCHAR2(200),',
'        definition t_name_type_tab',
'    );',
'    TYPE t_template_tab IS TABLE OF t_template_rec INDEX BY PLS_INTEGER;',
'',
'    -- Variables',
'    v_source_clob       CLOB;',
'    v_source_normalized CLOB;',
'    ',
'    v_target_id         VARCHAR2(50);',
'    v_target_name       VARCHAR2(200);',
'    v_target_def_clob   CLOB;',
'    v_target_normalized CLOB;',
'',
'    v_source_defs       t_name_type_tab := t_name_type_tab();',
'    v_target_defs       t_name_type_tab := t_name_type_tab();',
'',
'    v_templates         t_template_tab;',
'    v_count_templates   PLS_INTEGER := 0;',
'',
'    v_json_output       CLOB := ''['';',
'    v_min_score_use     NUMBER;',
'    v_separator         VARCHAR2(1) := '''';',
'',
'    v_match_count       NUMBER;',
'    v_score             NUMBER;',
'',
'    CURSOR c_targets IS',
'      SELECT ID, NAME, DEFINITION FROM UR_TEMPLATES WHERE hotel_id = p_hotel_id;',
'',
'    -- Debug procedure',
'    PROCEDURE debug(p_msg VARCHAR2) IS',
'    BEGIN',
'        IF UPPER(p_debug_flag) = ''Y'' THEN',
'            DBMS_OUTPUT.PUT_LINE(''[DEBUG] '' || p_msg);',
'        END IF;',
'    END;',
'',
'    -- Normalize data-type keys in JSON string (case sensitive replacement)',
'    FUNCTION normalize_json(p_json CLOB) RETURN CLOB IS',
'    BEGIN',
'        RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'    END;',
'',
'    -- Parse definition JSON into PL/SQL collection',
'    FUNCTION parse_definition(p_clob CLOB) RETURN t_name_type_tab IS',
'        l_defs t_name_type_tab := t_name_type_tab();',
'        idx     PLS_INTEGER := 0;',
'    BEGIN',
'        FOR rec IN (',
'            SELECT lower(trim(name)) AS name, lower(trim(data_type)) AS data_type FROM JSON_TABLE(',
'                p_clob,',
'                ''$[*]'' COLUMNS (',
'                    name VARCHAR2(100) PATH ''$.name'',',
'                    data_type VARCHAR2(30) PATH ''$.data_type''',
'                )',
'            )',
'        ) LOOP',
'            idx := idx + 1;',
'            l_defs.EXTEND;',
'            l_defs(idx).name := rec.name;',
'            l_defs(idx).data_type := rec.data_type;',
'        END LOOP;',
'        RETURN l_defs;',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            RETURN NULL;',
'    END;',
'',
'    -- Count matches (name + data_type case-insensitive)',
'    FUNCTION count_matches(p_source t_name_type_tab, p_target t_name_type_tab) RETURN NUMBER IS',
'        v_count NUMBER := 0;',
'    BEGIN',
'        FOR i IN 1 .. p_source.COUNT LOOP',
'            FOR j IN 1 .. p_target.COUNT LOOP',
'                IF p_source(i).name = p_target(j).name AND p_source(i).data_type = p_target(j).data_type THEN',
'                    v_count := v_count + 1;',
'                    EXIT;',
'                END IF;',
'            END LOOP;',
'        END LOOP;',
'        RETURN v_count;',
'    END;',
'',
'BEGIN',
'    -- Validate inputs and assign to local variable',
'    v_min_score_use := NVL(p_min_score, 90);',
'    IF v_min_score_use < 0 OR v_min_score_use > 100 THEN',
'        v_min_score_use := 90;',
'    END IF;',
'',
'    IF p_file_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''File ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    IF p_hotel_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''Hotel ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    debug(''Starting processing...'');',
'    debug(''File ID: '' || p_file_id);',
'    debug(''Hotel ID: '' || p_hotel_id);',
'    debug(''Minimum Score: '' || v_min_score_use);',
'',
'    -- Fetch and normalize source CLOB',
'    BEGIN',
'        SELECT columns INTO v_source_clob FROM temp_blob WHERE id = p_file_id;',
'        IF v_source_clob IS NULL THEN',
'            p_status := ''E'';',
'            p_message := ''Source definition not found for file_id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        END IF;',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status := ''E'';',
'            p_message := ''Source file not found for id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Error fetching source definition: '' || SQLERRM;',
'            p_output_json := NULL;',
'            RETURN;',
'    END;',
'',
'    v_source_normalized := normalize_json(v_source_clob);',
'',
'    -- Parse source defs',
'    v_source_defs := parse_definition(v_source_normalized);',
'    IF v_source_defs IS NULL OR v_source_defs.COUNT = 0 THEN',
'        p_status := ''E'';',
'        p_message := ''Cannot parse source definition JSON or empty definition'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'    debug(''Parsed Source definitions: '' || v_source_defs.COUNT || '' fields'');',
'',
'    -- Initialize JSON output',
'    v_json_output := ''['';',
'    v_count_templates := 0;',
'',
'    -- Loop over target templates from cursor',
'    FOR r_target IN c_targets LOOP',
'        v_target_id := r_target.ID;',
'        v_target_name := r_target.NAME;',
'        v_target_def_clob := r_target.DEFINITION;',
'',
'        IF v_target_def_clob IS NULL THEN',
'            debug(''Skipping template '' || v_target_id || '' due to NULL definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_target_normalized := normalize_json(v_target_def_clob);',
'',
'        v_target_defs := parse_definition(v_target_normalized);',
'        IF v_target_defs IS NULL OR v_target_defs.COUNT = 0 THEN',
'            debug(''Skipping template '' || v_target_id || '' due to parsing error or empty definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_match_count := count_matches(v_source_defs, v_target_defs);',
'',
'        v_score := ROUND((2 * v_match_count) / (v_source_defs.COUNT + v_target_defs.COUNT) * 100);',
'',
'        debug(''Template '' || v_target_id || '' ('' || v_target_name || ''): Matches='' || ',
'              v_match_count || '', Score='' || v_score);',
'',
'        IF v_score >= v_min_score_use THEN',
'            IF v_count_templates > 0 THEN',
'                v_json_output := v_json_output || '','';',
'            END IF;',
'            v_json_output := v_json_output || ''{"Template_id":"'' || v_target_id || ',
'                            ''","Template_Name":"'' || REPLACE(v_target_name,''"'',''\"'') || ',
'                            ''","Score":'' || v_score || ''}'';',
'            v_count_templates := v_count_templates + 1;',
'        END IF;',
'    END LOOP;',
'',
'    v_json_output := v_json_output || '']'';',
'',
'    IF v_count_templates = 0 THEN',
'        p_output_json := ''[{}]'';',
'        p_message := ''No templates matched the minimum score threshold'';',
'        debug(''No matching templates found.'');',
'    ELSE',
'        p_output_json := v_json_output;',
'        p_message := ''Templates matched: '' || v_count_templates;',
'        debug(''Matching templates count: '' || v_count_templates);',
'    END IF;',
'',
'    p_status := ''S'';',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_message := ''Unexpected error: '' || SQLERRM;',
'        p_output_json := NULL;',
'END fetch_templates;',
'',
'PROCEDURE DELETE_TEMPLATES (',
'    p_id            IN VARCHAR2 DEFAULT NULL,',
'    p_hotel_id      IN VARCHAR2 DEFAULT NULL,',
'    p_key           IN VARCHAR2 DEFAULT NULL,',
'    p_name          IN VARCHAR2 DEFAULT NULL,',
'    p_type          IN VARCHAR2 DEFAULT NULL,',
'    p_active        IN CHAR DEFAULT NULL,',
'    p_db_obj_empty  IN CHAR DEFAULT NULL,',
'    p_delete_all    IN CHAR DEFAULT ''N'',',
'    p_debug         IN CHAR DEFAULT ''N'',',
'    p_json_output   OUT CLOB',
'  )',
'  AS',
'    v_sql            VARCHAR2(1000);',
'    v_rows_count     NUMBER;',
'    v_status         CHAR(1);',
'    v_message        VARCHAR2(4000);',
'    v_json_list      CLOB := ''['';',
'    v_first          BOOLEAN := TRUE;',
'',
'    CURSOR c_templates IS',
'      SELECT id, hotel_id, key, name, type, active, db_object_name',
'      FROM ur_templates',
'      WHERE (p_delete_all = ''Y''',
'            OR (p_id IS NULL OR id = p_id))',
'        AND (p_delete_all = ''Y''',
'             OR (p_hotel_id IS NULL OR hotel_id = p_hotel_id))',
'        AND (p_delete_all = ''Y''',
'             OR (p_key IS NULL OR key = p_key))',
'        AND (p_delete_all = ''Y''',
'             OR (p_name IS NULL OR name = p_name))',
'        AND (p_delete_all = ''Y''',
'             OR (p_type IS NULL OR type = p_type))',
'        AND (p_delete_all = ''Y''',
'             OR (p_active IS NULL OR active = p_active));',
'',
'    -- Helper to escape JSON strings (basic)',
'    FUNCTION json_escape(str IN VARCHAR2) RETURN VARCHAR2 IS',
'    BEGIN',
'      RETURN REPLACE(REPLACE(REPLACE(REPLACE(str, ''\'', ''\\''), ''"'', ''\"''), CHR(10), ''\n''), CHR(13), '''');',
'    EXCEPTION WHEN OTHERS THEN',
'      RETURN '''';',
'    END;',
'',
'    PROCEDURE dbg(p_msg VARCHAR2) IS',
'    BEGIN',
'      IF p_debug = ''Y'' THEN',
'        apex_debug.message(p_msg);',
'      END IF;',
'    END;',
'',
'    PROCEDURE append_result (',
'      p_id            IN VARCHAR2,',
'      p_hotel_id      IN VARCHAR2,',
'      p_key           IN VARCHAR2,',
'      p_name          IN VARCHAR2,',
'      p_type          IN VARCHAR2,',
'      p_active        IN CHAR,',
'      p_db_obj_name   IN VARCHAR2,',
'      p_status        IN CHAR,',
'      p_message       IN VARCHAR2',
'    ) IS',
'    BEGIN',
'      IF v_first THEN',
'        v_first := FALSE;',
'      ELSE',
'        v_json_list := v_json_list || '','';',
'      END IF;',
'',
'      v_json_list := v_json_list || ''{'' ||',
'        ''"id":"''          || json_escape(p_id)          || ''",'' ||',
'   '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'     ''"hotel_id":"''    || json_escape(p_hotel_id)    || ''",'' ||',
'        ''"key":"''         || json_escape(p_key)         || ''",'' ||',
'        ''"name":"''        || json_escape(p_name)        || ''",'' ||',
'        ''"type":"''        || json_escape(p_type)        || ''",'' ||',
'        ''"active":"''      || json_escape(p_active)      || ''",'' ||',
'        ''"db_object_name":"'' || json_escape(p_db_obj_name) || ''",'' ||',
'        ''"status":"''      || json_escape(p_status)      || ''",'' ||',
'        ''"message":"''     || json_escape(p_message)     || ''"'' ||',
'      ''}'';',
'    END;',
'',
'  BEGIN',
'    dbg(''Started DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'',
'    FOR rec IN c_templates LOOP',
'      dbg(''Processing template ID='' || rec.id || '', DB_OBJECT_NAME='' || rec.db_object_name);',
'',
'      IF rec.db_object_name IS NULL THEN',
'        v_status := ''E'';',
'        v_message := ''No DB_OBJECT_NAME specified for template, skipping.'';',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, NULL, v_status, v_message);',
'        CONTINUE;',
'      END IF;',
'',
'      -- Check if table exists in user schema',
'    --   SELECT COUNT(*)',
'    --     INTO v_rows_count',
'    --     FROM all_tables',
'    --    WHERE table_name = rec.db_object_name',
'    --      AND owner = USER;',
'',
'    --   IF v_rows_count = 0 THEN',
'    --     v_status := ''E'';',
'    --     v_message := ''DB Object ['' || rec.db_object_name || ''] does not exist or is not a table.'';',
'    --     dbg(v_message);',
'    --     append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    --     CONTINUE;',
'    --   END IF;',
'',
'      -- Check if table should be empty before deleting',
'      IF p_db_obj_empty = ''Y'' THEN',
'        v_sql := ''SELECT COUNT(*) FROM '' || rec.db_object_name;',
'        BEGIN',
'          EXECUTE IMMEDIATE v_sql INTO v_rows_count;',
'        EXCEPTION',
'          WHEN OTHERS THEN',
'            v_rows_count := -1; -- can''t count, treat as error or non-empty',
'        END;',
'',
'        IF v_rows_count > 0 THEN',
'          v_status := ''E'';',
'          v_message := ''DB Object table ['' || rec.db_object_name || ''] is not empty (ROWS='' || v_rows_count || ''), skipping deletion.'';',
'          dbg(v_message);',
'          append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'          CONTINUE;',
'        END IF;',
'        dbg(''DB Object table ['' || rec.db_object_name || ''] is empty, proceeding.'');',
'      END IF;',
'',
'      -- Try to drop the table and delete template',
'      BEGIN',
'        v_sql := ''DROP TABLE '' || rec.db_object_name || '' CASCADE CONSTRAINTS'';',
'        dbg(''Executing: '' || v_sql);',
'        EXECUTE IMMEDIATE v_sql;',
'',
'        dbg(''Dropped table '' || rec.db_object_name);',
'',
'        DELETE FROM ur_templates WHERE id = rec.id;',
'',
'        dbg(''Deleted template id='' || rec.id);',
'',
'        v_status := ''S'';',
'        v_message := ''Successfully dropped table and deleted template.'';',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'',
'      EXCEPTION',
'        WHEN OTHERS THEN',
'          v_status := ''E'';',
'          v_message := ''Error dropping table or deleting template: '' || SQLERRM;',
'          dbg(v_message);',
'          append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'      END;',
'    END LOOP;',
'',
'    v_json_list := v_json_list || '']'';',
'',
'    p_json_output := v_json_list;',
'',
'    dbg(''Completed DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'  END DELETE_TEMPLATES;',
'',
'PROCEDURE manage_algo_attributes(',
'    p_template_key   IN  VARCHAR2,',
'    p_mode           IN  CHAR,',
'    p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'    p_status         OUT BOOLEAN,',
'    p_message        OUT VARCHAR2',
') IS',
'  v_db_object_name UR_TEMPLATES.DB_OBJECT_NAME%TYPE;',
'  v_definition     UR_TEMPLATES.DEFINITION%TYPE;',
'  v_hotel_id       UR_TEMPLATES.HOTEL_ID%TYPE;',
'  v_user_id        RAW(16);',
'  v_insert_count   NUMBER := 0;',
'  v_delete_count   NUMBER := 0;',
'BEGIN',
'  -- Initialization',
'  p_status := FALSE;',
'  p_message := NULL;',
'',
'  -- Obtain needed data from UR_TEMPLATES',
'  BEGIN',
'    SELECT db_object_name, definition, hotel_id',
'    INTO v_db_object_name, v_definition, v_hotel_id',
'    FROM ur_templates',
'    WHERE key = p_template_key;',
'  EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      p_message := ''Failure: Template key not found: '' || p_template_key;',
'      RETURN;',
'  END;',
'',
'  IF v_db_object_name IS NULL THEN',
'    p_message := ''Failure: DB_OBJECT_NAME not defined for template_key '' || p_template_key;',
'    RETURN;',
'  END IF;',
'',
'  -- Get USER_ID once for audit columns',
'  BEGIN',
'    SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'  EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      v_user_id := NULL;',
'  END;',
'',
'  IF p_mode = ''C'' THEN',
'    IF v_definition IS NULL THEN',
'      p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'      RETURN;',
'    END IF;',
'',
'    -- Insert attributes for all columns with qualifier <> ''UNIQUE''',
'    FOR rec IN (',
'      SELECT jt.name, jt.data_type, jt.qualifier',
'      FROM JSON_TABLE(',
'        v_definition,',
'        ''$[*]'' COLUMNS (',
'          name       VARCHAR2(100) PATH ''$.name'',',
'          data_type  VARCHAR2(30)  PATH ''$.data_type'',',
'          qualifier  VARCHAR2(30)  PATH ''$.qualifier''',
'        )',
'      ) jt',
'      WHERE jt.qualifier IS NOT NULL',
'        AND UPPER(jt.qualifier) <> ''UNIQUE''',
'    )',
'    LOOP',
'      DECLARE',
'        l_col_name VARCHAR2(150);',
'        v_key      VARCHAR2(150);',
'        v_exists   NUMBER;',
'      BEGIN',
'        -- Normalize column name (remove trailing underscores, spaces, upper-case)',
'    --  l_col_name := UPPER(TRIM(BOTH ''_'' FROM TRIM(rec.name)));',
'-- Normalize: trim spaces, collapse multiple underscores, and remove trailing underscores',
'l_col_name := UPPER(',
'                REGEXP_REPLACE(',
'                  TRIM(rec.name),      -- trim spaces',
'                  ''_+$'',               -- remove trailing underscores',
'                  ''''',
'                )',
'              );',
'',
'',
'        v_key := v_db_object_name || ''.'' || l_col_name;',
'',
'        SELECT COUNT(*) INTO v_exists FROM ur_algo_attributes WHERE key = v_key;',
'        IF v_exists = 0 THEN',
'          INSERT INTO ur_algo_attributes (',
'            id, algo_id, hotel_id, name, key, data_type, description, type, value,',
'            created_by, updated_by, created_on, updated_on',
'          ) VALUES (',
'            SYS_GUID(),',
'            NULL, -- algo_id set to NULL as requested',
'            v_hotel_id,',
'            l_col_name,',
'            v_key,',
'            NVL(UPPER(rec.data_type), ''NUMBER''),',
'            NULL,',
'            ''S'',',
'            v_key,',
'            v_user_id,',
'            v_user_id,',
'            SYSDATE,',
'            SYSDATE',
'          );',
'',
'          v_insert_count := v_insert_count + 1;',
'        END IF;',
'      END;',
'    END LOOP;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: '' || v_insert_count || '' attribute''',
'                 || CASE WHEN v_insert_count = 1 THEN '''' ELSE ''s'' END',
'                 || '' inserted for template_key '' || p_template_key;',
'',
'  ELSIF p_mode = ''D'' THEN',
'    IF p_attribute_key IS NOT NULL THEN',
'      IF p_attribute_key LIKE v_db_object_name || ''.%'' THEN',
'        DELETE FROM ur_algo_attributes WHERE key = p_attribute_key;',
'        v_delete_count := SQL%ROWCOUNT;',
'        COMMIT;',
'',
'        p_status := TRUE;',
'        IF v_delete_count > 0 THEN',
'          p_message := ''Success: '' || v_delete_count || '' attribute deleted with key '' || p_attribute_key;',
'        ELSE',
'          p_message := ''Info: No attribute found to delete with key '' || p_attribute_key;',
'        END IF;',
'      ELSE',
'        p_status := FALSE;',
'        p_message := ''Failure: Attribute key does not belong to template '' || p_template_key;',
'      END IF;',
'    ELSE',
'      DELETE FROM ur_algo_attributes WHERE key LIKE v_db_object_name || ''.%'';',
'      v_delete_count := SQL%ROWCOUNT;',
'      COMMIT;',
'',
'      p_status := TRUE;',
'      p_message := ''Success: '' || v_delete_count || '' attribute''',
'                   || CASE WHEN v_delete_count = 1 THEN '''' ELSE ''s'' END',
'                   || '' deleted for template_key '' || p_template_key;',
'    END IF;',
'',
'  ELSIF p_mode = ''U'' THEN',
'    p_status := FALSE;',
'    p_message := ''Update mode not yet implemented'';',
'',
'  ELSE',
'    p_status := FALSE;',
'    p_message := ''Invalid mode: '' || p_mode || ''. Valid modes are C, U, D.'';',
'  END IF;',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    p_status := FALSE;',
'    p_message := ''Failure: '' || SQLERRM;',
'END manage_algo_attributes;',
'',
'',
'procedure add_alert(',
'    p_existing_json in clob,',
'    p_message in varchar2,',
'    p_icon in varchar2 default null,',
'    p_title in varchar2 default null,',
'    p_timeout in number default null,',
'    p_updated_json out clob',
') is',
'    l_json_array json_array_t;',
'    l_new_object json_object_t;',
'begin',
'    -- Create the new JSON object',
'    l_new_object := new json_object_t();',
'    l_new_object.put(''message'', p_message);',
'    l_new_object.put(''icon'', nvl(p_icon, ''success''));',
'    l_new_object.put(''title'', nvl(p_title, ''''));',
'',
'    if p_timeout is not null then',
'        l_new_object.put(''timeOut'', to_char(p_timeout));',
'    end if;',
'',
'    -- Append the new object to the existing array or create a new array',
'    if p_existing_json is null or trim(p_existing_json) = '''' then',
'        -- Create a new array with the new object',
'        l_json_array := new json_array_t();',
'    else',
'        -- Parse the existing JSON string into a JSON array',
'        l_json_array := json_array_t(p_existing_json);',
'    end if;',
'',
'    -- Append the new object',
'    l_json_array.append(l_new_object);',
'',
'    -- Convert the JSON array back to a CLOB',
'    p_updated_json := l_json_array.to_clob;',
'end add_alert;',
'',
'PROCEDURE validate_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode IN CHAR,',
'    p_hotel_id IN VARCHAR2,',
'    p_status OUT VARCHAR2, -- ''S'' or ''E''',
'    p_message OUT VARCHAR2',
') IS',
'  TYPE t_str_list IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_attributes t_str_list;',
'  v_functions t_str_list;',
'  v_operators t_str_list;',
'  v_attr_count NUMBER := 0;',
'  v_func_count NUMBER := 0;',
'  v_oper_count NUMBER := 0;',
'',
'  TYPE t_token_rec IS RECORD (',
'    token VARCHAR2(4000),',
'    start_pos PLS_INTEGER,',
'    end_pos PLS_INTEGER',
'  );',
'  TYPE t_token_tab IS TABLE OF t_token_rec INDEX BY PLS_INTEGER;',
'  v_tokens t_token_tab;',
'  v_token_count PLS_INTEGER := 0;',
'',
'  TYPE t_token_tab_nt IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_unmatched_tokens t_token_tab;',
'  v_unmatched_count PLS_INTEGER := 0;',
'',
'  -- To mark tokens consumed by multi-word operators',
'  TYPE t_bool_tab IS TABLE OF BOOLEAN INDEX BY PLS_INTEGER;',
'  v_token_consumed t_bool_tab;',
'',
'  v_mode CHAR := UPPER(p_mode);',
'',
'  -- Trim and uppercase token helper',
'  FUNCTION normalize_token(p_token VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN UPPER(TRIM(p_token));',
'  END;',
'',
'  -- Strip function parameters, e.g. "ROUND (n,d)" -> "ROUND"',
'  FUNCTION normalize_func_name(p_func VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN REGEXP_REPLACE(UPPER(TRIM(p_func)), ''\s*\(.*\)$'');',
'  END;',
'',
'  -- Checks if token is numeric',
'  FUNCTION is_number(p_token VARCHAR2) RETURN BOOLEAN IS',
'  BEGIN',
'    RETURN REGEXP_LIKE(p_token, ''^[+-]?(\d+(\.\d*)?|\.\d+)([Ee][+-]?\d+)?$'');',
'  END;',
'',
'  -- Check presence in list',
'  FUNCTION is_in_list(p_token VARCHAR2, p_list t_str_list, cnt NUMBER) RETURN BOOLEAN IS',
'  BEGIN',
'    FOR i IN 1..cnt LOOP',
'      IF p_list(i) = p_token THEN',
'        RETURN TRUE;',
'      END IF;',
'    END LOOP;',
'    RETURN FALSE;',
'  END;',
'',
'  -- Check if token valid: attribute, operator, function, number, parentheses',
'  FUNCTION is_token_valid(p_token VARCHAR2) RETURN BOOLEAN IS',
'    l_token VARCHAR2(100) := p_token;',
'  BEGIN',
'    -- Parentheses always valid tokens',
'    IF l_token IN (''('', '')'') THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    -- Strip trailing ''('' from function calls',
'    IF SUBSTR(l_token, -1) = ''('' THEN',
'      l_token := SUBSTR(l_token, 1, LENGTH(l_token) - 1);',
'    END IF;',
'',
'    -- Check if number',
'    IF is_number(l_token) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    l_token := normalize_token(l_token);',
'',
'    IF is_in_list(l_token, v_attributes, v_attr_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_functions, v_func_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_operators, v_oper_count) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    RETURN FALSE;',
'  END;',
'',
'  PROCEDURE load_functions(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION FUNCTIONS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := normalize_func_name(r.return_value);',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20010, ''Functions LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_operators(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION OPERATORS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.return_value));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20011, ''Operators LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_attributes(p_hotel_id IN VARCHAR2, p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT key FROM ur_algo_attributes WHERE hotel_id = p_hotel_id',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.key));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20012, ''Attributes missing for hotel_id '' || p_hotel_id);',
'    END IF;',
'  END;',
'',
'  -- Tokenizer splitting expression into tokens, tracking start/end pos',
'  PROCEDURE tokenize_expression(p_expr IN VARCHAR2, p_tokens OUT t_token_tab, p_count OUT NUMBER) IS',
'    l_pos PLS_INTEGER := 1;',
'    l_len PLS_INTEGER := LENGTH(p_expr);',
'    l_token VARCHAR2(4000);',
'    l_token_start PLS_INTEGER;',
'    l_token_end PLS_INTEGER;',
'  BEGIN',
'    p_tokens.DELETE;',
'    p_count := 0;',
'    WHILE l_pos <= l_len LOOP',
'      l_token := REGEXP_SUBSTR(p_expr,',
'        ''([A-Za-z0-9_\.]+|\d+(\.\d+)?|\(|\)|\S)'',',
'        l_pos,',
'        1,',
'        ''i'');',
'      EXIT WHEN l_token IS NULL;',
'      l_token_start := INSTR(p_expr, l_token, l_pos);',
'      l_token_end := l_token_start + LENGTH(l_token) - 1;',
'      p_count := p_count + 1;',
'      p_tokens(p_count) := t_token_rec(token => l_token, start_pos => l_token_start, end_pos => l_token_end);',
'      l_pos := l_token_end + 1;',
'      WHILE l_pos <= l_len AND SUBSTR(p_expr, l_pos, 1) = '' '' LOOP',
'        l_pos := l_pos + 1;',
'      END LOOP;',
'    END LOOP;',
'  END;',
'',
'  FUNCTION build_json_errors(p_unmatched t_token_tab, p_count PLS_INTEGER) RETURN VARCHAR2 IS',
'    v_json VARCHAR2(4000) := ''['';',
'  BEGIN',
'    IF p_count = 0 THEN',
'      RETURN ''[]'';',
'    END IF;',
'    FOR i IN 1..p_count LOOP',
'      v_json := v_json || ''{"token":"'' || p_unmatched(i).token ||',
'                ''","start":'' || p_unmatched(i).start_pos ||',
'                '',"end":'' || p_unmatched(i).end_pos || ''}'';',
'      IF i < p_count THEN',
'        v_json := v_json || '','';',
'      END IF;',
'    END LOOP;',
'    v_json := v_json || '']'';',
'    RETURN v_json;',
'  END;',
'',
'  -- Return number of consecutive tokens matched as an operator starting at start_idx',
'  FUNCTION get_longest_operator_match(start_idx IN PLS_INTEGER) RETURN PLS_INTEGER IS',
'    combined VARCHAR2(4000);',
'    max_words CONSTANT PLS_INTEGER := 4; -- max operator words count',
'    words_count PLS_INTEGER;',
'    l_len PLS_INTEGER := LEAST(max_words, v_token_count - start_idx + 1);',
'    i PLS_INTEGER;',
'  BEGIN',
'    FOR words_count IN REVERSE 1 .. l_len LOOP',
'      combined := '''';',
'      FOR i IN start_idx .. start_idx + words_count - 1 LOOP',
'        IF combined IS NULL OR combined = '''' THEN',
'          combined := UPPER(TRIM(v_tokens(i).token));',
'        ELSE',
'          combined := combined || '' '' || UPPER(TRIM(v_tokens(i).token));',
'        END IF;',
'      END LOOP;',
'      IF is_in_list(combined, v_operators, v_oper_count) THEN',
'        RETURN words_count;',
'      END IF;',
'    END LOOP;',
'    RETURN 0;',
'  END;',
'',
'BEGIN',
'  p_status := ''E'';',
'  p_message := NULL;',
'',
'  IF v_mode NOT IN (''V'', ''C'') THEN',
'    p_status := ''E'';',
'    p_message := ''Invalid mode "'' || p_mode || ''". Valid are V or C.'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_hotel_id IS NULL THEN',
'    p_status := ''E'';',
'    p_message := ''hotel_id is mandatory'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_expression IS NULL OR LENGTH(TRIM(p_expression)) = 0 THEN',
'    p_status := ''E'';',
'    p_message := ''Expression is empty'';',
'    RETURN;',
'  END IF;',
'',
'  load_functions(v_functions, v_func_count);',
'  load_operators(v_operators, v_oper_count);',
'  load_attributes(p_hotel_id, v_attributes, v_attr_count);',
'',
'  tokenize_expression(p_expression, v_tokens, v_token_count);',
'',
'  -- Initialize consumed array',
'  v_token_consumed.DELETE;',
'',
'  DECLARE',
'    i PLS_INTEGER := 1;',
'    words_matched PLS_INTEGER := 0;',
'  BEGIN',
'    WHILE i <= v_token_count LOOP',
'      words_matched := get_longest_operator_match(i);',
'      IF words_matched > 0 THEN',
'        FOR j IN i .. i + words_matched - 1 LOOP',
'          v_token_consumed(j) := TRUE;',
'        END LOOP;',
'        i := i + words_matched;',
'      ELSE',
'        -- Single token valid check',
'        v_token_consumed(i) := is_token_valid(normalize_token(v_tokens(i).token));',
'        i := i + 1;',
'      END IF;',
'    END LOOP;',
'  END;',
'',
'  IF v_mode = ''V'' THEN',
'    v_unmatched_tokens.DELETE;',
'    v_unmatched_count := 0;',
'    FOR i IN 1 .. v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = FALSE THEN',
'        v_unmatched_count := v_unmatched_count + 1;',
'        v_unmatched_tokens(v_unmatched_count) := v_tokens(i);',
'      END IF;',
'    END LOOP;',
'',
'    IF v_unmatched_count > 0 THEN',
'      p_status := ''E'';',
'      p_message := ''Invalid tokens: '' || build_json_errors(v_unmatched_tokens, v_unmatched_count);',
'    ELSE',
'      p_status := ''S'';',
'      p_message := ''Expression validated successfully.'';',
'    END IF;',
'',
'  ELSIF v_mode = ''C'' THEN',
'    p_status := ''S'';',
'    p_message := '''';',
'    FOR i IN 1..v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = TRUE THEN',
'        p_message := p_message || v_tokens(i).token || '' '';',
'      END IF;',
'    END LOOP;',
'    p_message := RTRIM(p_message);',
'  END IF;',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    p_status := ''E'';',
'    p_message := ''Failure: '' || SQLERRM;',
'END validate_expression;',
'',
'',
'END ur_utils_test;',
'/',
'create or replace PACKAGE BODY UR_UTILS_TEST_1 IS',
'',
'    FUNCTION Clean_TEXT(p_text IN VARCHAR2) RETURN VARCHAR2 IS',
'      v_clean VARCHAR2(4000);',
'    BEGIN',
'      v_clean := UPPER(',
'                   SUBSTR(',
'                     REGEXP_REPLACE(',
'                       REGEXP_REPLACE(',
'                         REGEXP_REPLACE(',
'                           TRIM(p_text),',
'                           ''^[^A-Za-z0-9]+|[^A-Za-z0-9]+$'', ''''',
'                         ),',
'                         ''[^A-Za-z0-9]+'', ''_''',
'                       ),',
'                       ''_+'', ''_''',
'                     ),',
'                     1, 110',
'                   )',
'                 );',
'      RETURN v_clean;',
'    END Clean_TEXT;',
'',
'FUNCTION normalize_json (p_json CLOB) RETURN CLOB IS',
'BEGIN',
'  RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'END normalize_json;',
'',
'  PROCEDURE get_collection_json(',
'    p_collection_name IN VARCHAR2,',
'    p_json_clob OUT CLOB,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
'  ) IS',
'    l_count NUMBER;',
'  BEGIN',
'    SELECT COUNT(*)',
'      INTO l_count',
'      FROM apex_collections',
'     WHERE collection_name = p_collection_name;',
'',
'    IF l_count = 0 THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Collection "'' || p_collection_name || ''" does not exist or is empty'';',
'      p_json_clob := NULL;',
'      RETURN;',
'    END IF;',
'',
'    -- Initialize and build JSON output',
'    apex_json.initialize_clob_output;',
'    apex_json.open_array;',
'',
'    FOR rec IN (',
'      SELECT c001, c002, c003',
'        FROM apex_collections',
'       WHERE collection_name = p_collection_name',
'       ORDER BY seq_id',
'    )',
'    LOOP',
'      apex_json.open_object;',
'      apex_json.write(''name'', rec.c001);',
'      apex_json.write(''data_type'', rec.c002);',
'      apex_json.write(''qualifier'', rec.c003);',
'      apex_json.close_object;',
'    END LOOP;',
'',
'    apex_json.close_array;',
'',
'    p_json_clob := apex_json.get_clob_output;',
'',
'    apex_json.free_output;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: JSON generated for collection "'' || p_collection_name || ''"'';',
'',
'  EXCEPTION',
'    WHEN OTHERS THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: '' || SQLERRM;',
'      p_json_clob := NULL;',
'  END get_collection_json;',
'',
'',
'',
' PROCEDURE define_db_object(',
'    p_template_key IN VARCHAR2,',
'    p_status OUT BOOLEAN,',
'    p_message OUT VARCHAR2',
') IS',
'    v_db_object_name VARCHAR2(30);',
'    v_sql            CLOB;',
'    v_col_defs       CLOB := '''';',
'    v_unique_defs    CLOB := '''';',
'    v_definition     CLOB;',
'    v_exists         NUMBER;',
'    v_trigger_name   VARCHAR2(130);',
'    l_col_name       VARCHAR2(100);',
'BEGIN',
'    -- Lock row in UR_TEMPLATES and get DB_OBJECT_NAME and definition',
'    SELECT db_object_name, definition',
'    INTO v_db_object_name, v_definition',
'    FROM ur_templates',
'    WHERE key = p_template_key',
'    FOR UPDATE;',
'',
'    IF v_db_object_name IS NOT NULL THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Table already defined as '' || v_db_object_name;',
'      RETURN;',
'    END IF;',
'',
'    IF v_definition IS NULL THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'      RETURN;',
'    END IF;',
'',
'    -- Generate table name (adjust prefix as needed)',
'    v_db_object_name := ''UR_'' || UPPER(p_template_key) || ''_T'';',
'',
'    -- Check if table exists',
'    SELECT COUNT(*)',
'    INTO v_exists',
'    FROM all_tables',
'    WHERE table_name = UPPER(v_db_object_name);',
'',
'    IF v_exists > 0 THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Table '' || v_db_object_name || '' already exists in schema'';',
'      RETURN;',
'    END IF;',
'',
'    -- Start with ID RAW(16) as primary key column',
'    v_col_defs := ''"REC_ID" RAW(16)'';',
'',
'    -- Parse JSON and build column definitions',
'    FOR rec IN (',
'      SELECT jt.name, jt.data_type, jt.qualifier',
'      FROM JSON_TABLE(',
'  normalize_json(v_definition),',
'  ''$[*]'' COLUMNS (',
'    name       VARCHAR2(100) PATH ''$.name'',',
'    data_type  VARCHAR2(30)  PATH ''$.data_type'',',
'    qualifier  VARCHAR2(30)  PATH ''$.qualifier''',
'  )',
') jt',
'',
'    )',
'    LOOP',
'      -- sanitize column name: trim underscores and collapse multiple',
'      l_col_name := UPPER(TRIM(BOTH ''_'' FROM rec.name));',
'      l_col_name := REGEXP_REPLACE(l_col_name, ''_{2,}'', ''_'');',
'',
'      v_col_defs := v_col_defs || '', '';',
'',
'      -- Map data type including DATE',
'      IF UPPER(rec.data_type) = ''TEXT'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'      ELSIF UPPER(rec.data_type) = ''NUMBER'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" NUMBER'';',
'      ELSIF UPPER(rec.data_type) = ''DATE'' THEN',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" DATE'';',
'      ELSE',
'        -- Default to VARCHAR2 for unknown type',
'        v_col_defs := v_col_defs || ''"'' || l_col_name || ''" VARCHAR2(4000)'';',
'      END IF;',
'',
'      -- Collect STAY_DATE constraint definitions',
'      IF UPPER(rec.qualifier) = ''STAY_DATE'' THEN',
'        v_unique_defs := v_unique_defs ',
'          || '', CONSTRAINT "'' || v_db_object_name || ''_'' || l_col_name || ''_UQ" UNIQUE ("'' || l_col_name || ''")'';',
'      END IF;',
'    END LOOP;',
'',
'    -- Add WHO columns + HOTEL_ID RAW(16)',
'    v_col_defs := v_col_defs',
'      || '', CREATED_BY RAW(16), UPDATED_BY RAW(16), CREATED_ON DATE, UPDATED_ON DATE, HOTEL_ID RAW(16), INTERFACE_LOG_ID RAW(16)'';',
'',
'    -- Build final CREATE TABLE DDL',
'    v_sql := ''CREATE TABLE "'' || v_db_object_name || ''" ('' ',
'        || v_col_defs ',
'        || '', CONSTRAINT "'' || v_db_object_name || ''_PK" PRIMARY KEY ("REC_ID")''',
'        || v_unique_defs',
'        || '')'';',
'',
'    EXECUTE IMMEDIATE v_sql;',
'',
'    -- Create trigger to auto-generate ID (if NULL) using SYS_GUID()',
'    v_trigger_name := v_db_object_name || ''_BI_TRG'';',
'',
'    v_sql := ''',
'CREATE OR REPLACE EDITIONABLE TRIGGER "'' || v_trigger_name || ''"',
'BEFORE INSERT OR UPDATE ON "'' || v_db_object_name || ''"',
'FOR EACH ROW',
'DECLARE',
'  v_user_id UR_USERS.USER_ID%TYPE;',
'BEGIN',
'  -- Get the USER_ID once',
'  SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''''APEX$SESSION'''', ''''APP_USER'''');',
'',
'  IF :NEW.REC_ID IS NULL THEN',
'    :NEW.REC_ID := SYS_GUID();',
'  END IF;',
'',
'  IF INSERTING THEN',
'    :NEW.CREATED_BY := v_user_id;',
'    :NEW.CREATED_ON := SYSDATE;',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  ELSIF UPDATING THEN',
'    :NEW.UPDATED_BY := v_user_id;',
'    :NEW.UPDATED_ON := SYSDATE;',
'  END IF;',
'END '' || v_trigger_name || '';',
''';',
'',
'    EXECUTE IMMEDIATE v_sql;',
'',
'    -- Update UR_TEMPLATES with the new db_object_name and timestamp',
'    UPDATE ur_templates',
'    SET db_object_name = v_db_object_name,',
'        db_object_created_on = SYSDATE',
'    WHERE key = p_template_key;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: Table "'' || v_db_object_name || ''" created with ID primary key and trigger'';',
'EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: Template key not found'';',
'    WHEN OTHERS THEN',
'      p_status := FALSE;',
'      p_message := ''Failure: '' || SQLERRM;',
'END define_db_object;',
'',
'',
'PROCEDURE LOAD_DATA_MAPPING_COLLECTION (',
'    p_file_id         IN  VARCHAR2,',
'    p_template_id    IN  VARCHAR2,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT VARCHAR2,',
'    p_message         OUT VARCHAR2',
') IS',
'',
'    -- Local variables',
'    v_seq_id NUMBER;',
'',
'BEGIN',
'    -- Initialize outputs',
'    p_status := ''S'';',
'    p_message := ''Processing completed successfully.'';',
'',
'    ------------------------------------------------------------------------',
'    -- Step 1: Create or truncate the APEX collection',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        IF APEX_COLLECTION.COLLECTION_EXISTS(p_collection_name) THEN',
'            APEX_COLLECTION.DELETE_COLLECTION(p_collection_name);',
'        END IF;',
'',
'        APEX_COLLECTION.CREATE_COLLECTION(p_collection_name);',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to create or truncate collection "'' || p_collection_name || ''": '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'    ------------------------------------------------------------------------',
'    -- Step 2: Insert data from TEMP_BLOB JSON into collection (c001)',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        FOR rec IN (',
'            SELECT jt.name || '' ('' || jt.data_type || '')'' AS column_desc, jt.col_position',
'            FROM TEMP_BLOB t,',
'                 JSON_TABLE(',
'    normalize_json(t.columns),',
'    ''$[*]'' COLUMNS (',
'       name      VARCHAR2(100) PATH ''$.name'',',
'       data_type VARCHAR2(100) PATH ''$.data_type'',',
'       col_position VARCHAR2(100) PATH ''$.pos''',
'    )',
'',
'                 ) jt',
'            WHERE t.id = p_file_id',
'        ) LOOP',
'            APEX_COLLECTION.ADD_MEMBER(',
'                p_collection_name => p_collection_name,',
'                p_c001            => rec.column_desc,',
'                p_c004            => rec.col_position',
'            );',
'        END LOOP;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to insert data from TEMP_BLOB (File ID: '' || p_file_id || ''): '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'    ------------------------------------------------------------------------',
'    -- Step 3: Update existing collection members with matching data from UR_TEMPLATES (c002, c003)',
'    ------------------------------------------------------------------------',
'    BEGIN',
'        FOR rec IN (',
'            SELECT jt.name || '' ('' || jt.data_type || '')'' AS column_desc',
'            FROM UR_TEMPLATES t,',
'                 JSON_TABLE(',
'    normalize_json(t.definition),',
'    ''$[*]'' COLUMNS (',
'       name      VARCHAR2(100) PATH ''$.name'',',
'       data_type VARCHAR2(100) PATH ''$.data_type''',
'    )',
')',
' jt',
'            WHERE t.id = p_template_id',
'            ORDER BY t.id DESC',
'        ) LOOP',
'            BEGIN',
'                -- Find the seq_id for matching collection member',
'                SELECT seq_id ',
'                INTO v_seq_id',
'                FROM apex_collections',
'                WHERE collection_name = p_collection_name',
'                  AND c001 = rec.column_desc;',
'',
'                -- Update c002 and c003 attributes',
'                APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                    p_collection_name => p_collection_name,',
'                    p_seq             => v_seq_id,',
'                    p_attr_number     => 2,',
'                    p_attr_value      => rec.column_desc',
'                );',
'',
'                APEX_COLLECTION.UPDATE_MEMBER_ATTRIBUTE(',
'                    p_collection_name => p_collection_name,',
'                    p_seq             => v_seq_id,',
'                    p_attr_number     => 3,',
'                    p_attr_value      => ''Maps To''',
'                );',
'',
'            EXCEPTION',
'                WHEN NO_DATA_FOUND THEN',
unistr('                    -- No matching collection member found \2014 ignore gracefully'),
'                    NULL;',
'                WHEN OTHERS THEN',
'                    p_status := ''E'';',
'                    p_message := ''Failed to update member attribute in collection "'' || p_collection_name || ''" for "'' ',
'                                 || rec.column_desc || ''": '' || SQLERRM;',
'                    RETURN;',
'            END;',
'        END LOOP;',
'',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Failed to update collection members from UR_TEMPLATES (ID: '' || p_template_id || ''): '' || SQLERRM;',
'            RETURN;',
'    END;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p'))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'_status := ''E'';',
'        p_message := ''Unexpected error occurred: '' || SQLERRM;',
'END LOAD_DATA_MAPPING_COLLECTION;',
'',
'PROCEDURE Load_Data (',
'    p_file_id         IN  NUMBER,',
'    p_template_key    IN  VARCHAR2,',
'    p_hotel_id        IN  RAW,',
'    p_collection_name IN  VARCHAR2,',
'    p_status          OUT boolean,',
'    p_message         OUT VARCHAR2',
') IS',
'    l_blob        BLOB;',
'    l_file_name   VARCHAR2(255);',
'    l_table_name  VARCHAR2(255);',
'    l_template_id RAW(16);',
'    l_total_rows  NUMBER := 0;',
'    l_success_cnt NUMBER := 0;',
'    l_fail_cnt    NUMBER := 0;',
'    l_log_id      RAW(16);',
'    l_error_json  CLOB := ''['';',
'    l_first_err   BOOLEAN := TRUE;',
'    l_collection_name VARCHAR2(255);',
'    l_debug boolean := FALSE;',
'',
'    -- mapping record type',
'    TYPE t_map_rec IS RECORD (',
'        src_col     VARCHAR2(128),  ',
'        tgt_col     VARCHAR2(128),  ',
'        parser_col  VARCHAR2(20),   ',
'        data_type   VARCHAR2(50)',
'    );',
'    TYPE t_map IS TABLE OF t_map_rec INDEX BY VARCHAR2(128);',
'',
'    l_mapping   t_map;',
'    l_apex_user VARCHAR2(255) := NVL(v(''APP_USER''),''APEX_USER'');',
'',
'    l_cols   VARCHAR2(32767);',
'    l_vals   VARCHAR2(32767);',
'    l_sql    CLOB;',
'    k        VARCHAR2(128);',
'    v_expr   VARCHAR2(4000);',
'    l_map_count NUMBER;',
'    l_table_name_1 varchar2(480) := ''UR_VK_NEW_CHINAR_T_INTERFACE'';',
'    l_update_1 CLOB;',
'    l_sql_temp clob;',
'    l_sql_select clob;',
'',
'    -- ADDED: variable for duplicate check',
'    l_existing_cnt NUMBER;',
'    v_cursor   INTEGER;',
'    v_cols     VARCHAR2(1000) := ''hotel_id, booking_id, number_of_rooms'';',
'    v_desc_tab DBMS_SQL.DESC_TAB;',
'    v_col_cnt  INTEGER;',
'    v_value    VARCHAR2(4000);',
'    v_col_val  VARCHAR2(4000);',
'    v_status   INTEGER;',
'    l_rows_fetched    NUMBER;',
'    l_cursor_id       INTEGER;',
'    l_col_count       NUMBER;',
'    l_describe_tab    DBMS_SQL.DESC_TAB;',
'    l_column_value    VARCHAR2(4000);',
'BEGIN',
'    -------------------------------------------------------------------',
'    -- 0. DUPLICATE CHECK: stop if file already uploaded successfully',
'    -------------------------------------------------------------------',
'    SELECT COUNT(*)',
'      INTO l_existing_cnt',
'      FROM ur_interface_logs',
'     WHERE file_id   = p_file_id',
'       AND load_status = ''SUCCESS'';',
'',
'    IF l_existing_cnt > 0 THEN',
'        p_status  := FALSE;',
'        p_message := ''Failure: File is already uploaded successfully.'';',
'        RETURN;',
'    END IF;',
'',
'    -- 1. Get blob and file name',
'    SELECT blob_content, filename',
'      INTO l_blob, l_file_name',
'      FROM temp_blob',
'     WHERE id = p_file_id;',
'     ',
'     /*',
'    IF l_file_name < 0 THEN',
'        p_status  := FALSE;',
'        p_message := ''Failure: File ID ''||p_file_id||'' is already uploaded successfully.'';',
'        RETURN;',
'    END IF;*/',
'',
'    -- 2. Get target table name + template id',
'    SELECT db_object_name, id',
'      INTO l_table_name, l_template_id',
'      FROM ur_templates',
'     WHERE upper(id) = upper(p_template_key);',
'',
'    -- 3. Insert log entry',
'    l_log_id := sys_guid();',
'    INSERT INTO ur_interface_logs (',
'        id, hotel_id, template_id, interface_type,',
'        load_start_time, load_status, created_by, updated_by,',
'        created_on, updated_on, file_id',
'    )',
'    VALUES (',
'        l_log_id,',
'        p_hotel_id,',
'        l_template_id,',
'        ''UPLOAD'',',
'        systimestamp,',
'        ''IN_PROGRESS'',',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'        sysdate, sysdate,',
'        p_file_id',
'    );',
'',
'    -- 4. Load mapping directly from collection',
'    FOR rec IN (',
'        SELECT regexp_substr(c001, ''^[^(]+'')                    src_col,',
'               regexp_substr(c002, ''^[^(]+'')                    tgt_col,',
'               TRIM(c004)                                       parser_col,',
'               UPPER(regexp_replace(c001, ''^[^(]+\(([^)]+)\).*'', ''\1'')) datatype',
'          FROM apex_collections',
'         WHERE collection_name = p_collection_name',
'           AND c003 = ''Maps To''',
'           AND c004 IS NOT NULL',
'    ) LOOP',
'        l_mapping(UPPER(TRIM(rec.src_col))).src_col    := TRIM(rec.src_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).tgt_col    := TRIM(rec.tgt_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).parser_col := TRIM(rec.parser_col);',
'        l_mapping(UPPER(TRIM(rec.src_col))).data_type  := TRIM(rec.datatype);',
'INSERT INTO debug_log(message) VALUES(''rec.src_col: '' || rec.src_col);',
'    INSERT INTO debug_log(message) VALUES(''rec.tgt_col : '' || rec.tgt_col);',
'     INSERT INTO debug_log(message) VALUES(''rec.parser_col : '' || rec.parser_col);',
'    commit;',
'    END LOOP;',
'',
'    l_map_count := l_mapping.count;',
'    IF l_map_count = 0 THEN',
'        RAISE_APPLICATION_ERROR(-20001, ''No mapped columns found in collection!'');',
'    END IF;',
'',
'    -- 5. Build dynamic column list and values',
'    k := l_mapping.first;',
'    WHILE k IS NOT NULL LOOP',
'        IF l_mapping.exists(k)',
'           AND l_mapping(k).tgt_col IS NOT NULL',
'           AND l_mapping(k).parser_col IS NOT NULL',
'        THEN',
'            IF l_cols IS NOT NULL THEN',
'                l_cols := l_cols || '','';',
'                l_vals := l_vals || '','';',
'            END IF;',
'            INSERT INTO debug_log(message) VALUES(''In while loop 1 l_cols: '' || l_cols);',
'            INSERT INTO debug_log(message) VALUES(''In while loop 1 l_vals: '' || l_vals);',
'            l_cols := l_cols || l_mapping(k).tgt_col;',
'            INSERT INTO debug_log(message) VALUES(''In while loop 1 l_cols: '' || l_cols);',
'            -- safe conversions',
'            IF l_mapping(k).data_type = ''NUMBER'' THEN',
'                v_expr := ''CASE WHEN REGEXP_LIKE(p.''|| l_mapping(k).parser_col ||'', ''''^-?\d+(\.\d+)?$'''') ''||',
'                          ''THEN TO_NUMBER(p.''|| l_mapping(k).parser_col ||'') ELSE NULL END'';',
'             ',
'            ELSIF l_mapping(k).data_type = ''DATE'' THEN',
'                v_expr := ''CASE ''||',
'                          -- Full datetime with DD-MM-YYYY',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-\d{2}-\d{4}\s+\d{2}:\d{2}:\d{2}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MM-YYYY HH24:MI:SS'''') ''||',
'',
'                          -- Full datetime with DD/MM/YYYY',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}/\d{2}/\d{4}\s+\d{2}:\d{2}:\d{2}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD/MM/YYYY HH24:MI:SS'''') ''||',
'',
'                          -- Full datetime with DD-MON-YYYY (your case)',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-[A-Z]{3}-\d{4}\s+\d{2}:\d{2}:\d{2}$'''', ''''i'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MON-YYYY HH24:MI:SS'''') ''||',
'',
'                          -- Just date YYYY-MM-DD',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{4}-\d{2}-\d{2}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''YYYY-MM-DD'''') ''||',
'',
'                          -- Just date DD/MM/YYYY',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}/\d{2}/\d{4}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD/MM/YYYY'''') ''||',
'',
'                          -- Just date DD-MM-YYYY',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-\d{2}-\d{4}$'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MM-YYYY'''') ''||',
'',
'                          -- Just date DD-MON-YYYY',
'                          '' WHEN REGEXP_LIKE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''^\d{2}-[A-Z]{3}-\d{4}$'''', ''''i'''') ''||',
'                          ''      THEN TO_DATE(TRIM(p.''|| l_mapping(k).parser_col ||''), ''''DD-MON-YYYY'''') ''||',
'',
'                          -- Fallback',
'                          '' ELSE NULL END'';',
'',
'',
'',
'                        ELSE',
'                            v_expr := ''p.''|| l_mapping(k).parser_col;',
'                            INSERT INTO debug_log(message) VALUES(''v_expr: '' || v_expr);',
'               ',
'                        END IF;',
'',
'            l_vals := l_vals || v_expr;',
'        END IF;',
'        k := l_mapping.next(k);',
'    END LOOP;',
'',
'',
'    -- 6. Build INSERT statement (HOTEL_ID injected as constant)',
'    /*l_sql :=',
'        ''INSERT INTO ''|| l_table_name ||'' (HOTEL_ID,''|| l_cols ||'',INTERFACE_LOG_ID) ''||',
'        ''SELECT :hotel_id,''|| l_vals ||'',:log_id ''||',
'        ''  FROM TABLE(apex_data_parser.parse(p_content => :b1, p_file_name => :b2)) p ''||',
'        '' WHERE p.line_number > 1'';',
'',
'            EXECUTE IMMEDIATE l_sql USING p_hotel_id, l_log_id, l_blob, l_file_name;',
'',
'*/',
'       -- l_blob := UTL_RAW.CAST_TO_RAW(''header1,header2'' || CHR(10) || ''data1,data2'');',
'    ',
'    -- 1. Construct the SQL query with bind variable placeholders',
'    -- Note: l_vals is concatenated because the list of columns is dynamic.',
'    -- All other *values* are passed via bind variables.',
'    l_sql := ''SELECT :p_hotel_id, '' || l_vals || '', :l_log_id '' ||',
'             '' FROM TABLE(apex_data_parser.parse(p_content => :p_content, p_file_name => :p_file_name)) p '' ||',
'             '' where 1=1'';',
'',
'    INSERT INTO debug_log(message) VALUES(''l_vals 0.11112 :>>>>>>>>>>>>>>>>>> ''||l_vals ); ',
'    ',
'    -- Open & parse',
'    l_cursor_id := DBMS_SQL.OPEN_CURSOR;',
'    DBMS_SQL.PARSE(l_cursor_id, l_sql, DBMS_SQL.NATIVE);',
'    ',
'    INSERT INTO debug_log(message) VALUES(''l_vals 0.1111222222 :>>>>>>>>>>>>>>>>>> ''||l_vals ); ',
'    ',
'    -- Bind variables',
'    DBMS_SQL.BIND_VARIABLE(l_cursor_id, '':p_hotel_id'', p_hotel_id);',
'    DBMS_SQL.BIND_VARIABLE(l_cursor_id, '':l_log_id'', l_log_id);',
'    DBMS_SQL.BIND_VARIABLE(l_cursor_id, '':p_content'', l_blob);',
'    DBMS_SQL.BIND_VARIABLE(l_cursor_id, '':p_file_name'', l_file_name);',
'',
'    INSERT INTO debug_log(message) VALUES(''l_vals 0.2 :>>>>>>>>>>>>>>>>>> ''||l_vals ); ',
'    INSERT INTO debug_log(message) VALUES(''p_hotel_id 0.20 :>>>>>>>>>>>>>>>>>> ''||p_hotel_id ); ',
'    INSERT INTO debug_log(message) VALUES(''l_blob 0.21 :>>>>>>>>>>>>>>>>>> ''||l_blob); ',
'    INSERT INTO debug_log(message) VALUES(''l_log_id 0.21 :>>>>>>>>>>>>>>>>>> ''||l_log_id ); ',
'    INSERT INTO debug_log(message) VALUES(''l_file_name 0.22 :>>>>>>>>>>>>>>>>>> ''||l_file_name );',
'',
'    -- Describe columns to get the actual column count',
'    DBMS_SQL.DESCRIBE_COLUMNS(l_cursor_id, l_col_count, l_describe_tab);',
'    ',
'    INSERT INTO debug_log(message) VALUES(''l_col_count:>>''||l_col_count);',
'',
'    -- Define columns',
'    FOR i IN 1 .. l_col_count LOOP',
'        DBMS_SQL.DEFINE_COLUMN(l_cursor_id, i, l_column_value, 4000);',
'    END LOOP;',
'',
'    -- Execute the cursor',
'    l_rows_fetched := DBMS_SQL.EXECUTE_AND_FETCH(l_cursor_id); ',
'    INSERT INTO debug_log(message) VALUES(''l_rows_fetched:>>>''||l_rows_fetched);',
'',
'    -- Fetch rows',
'    WHILE DBMS_SQL.FETCH_ROWS(l_cursor_id) > 0 LOOP',
'        FOR i IN 1 .. l_col_count LOOP',
'            DBMS_SQL.COLUMN_VALUE(l_cursor_id, i, l_column_value);',
'            INSERT INTO debug_log(message) VALUES(''Column '' || i || '': '' || l_column_value);',
'        END LOOP;',
'    END LOOP;',
'',
'    DBMS_SQL.CLOSE_CURSOR(l_cursor_id);',
'',
'',
'    INSERT INTO debug_log(message) VALUES(''Cursor closed successfully'');',
'',
'',
'INSERT INTO debug_log(message) VALUES(''l_sql: '' || l_sql);    ',
'   commit;',
'    EXECUTE IMMEDIATE l_sql USING p_hotel_id, l_log_id, l_blob, l_file_name;',
'',
'    l_success_cnt := SQL%ROWCOUNT;',
'    l_total_rows  := l_success_cnt;',
'',
'    -- 7. Update log entry',
'    UPDATE ur_interface_logs',
'       SET load_end_time      = systimestamp,',
'           load_status        = CASE WHEN l_fail_cnt = 0 THEN ''SUCCESS'' ELSE ''FAILED'' END,',
'           records_processed  = l_total_rows,',
'           records_successful = l_success_cnt,',
'           records_failed     = l_fail_cnt,',
'           error_json         = CASE WHEN l_fail_cnt > 0 THEN l_error_json || '']'' ELSE NULL END,',
'           updated_by         = hextoraw(rawtohex(utl_raw.cast_to_raw(l_apex_user))),',
'           updated_on         = sysdate',
'     WHERE id = l_log_id;',
'',
'    COMMIT;',
'',
'    -- OUT params',
'    p_status  := TRUE;',
'    p_message := ''Success: Upload completed for File ID  ',
unistr('                  \2192 Total='' || l_total_rows ||'),
'                 '', Success='' || l_success_cnt ||',
'                 '', Failed='' || l_fail_cnt;',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'',
'        /*DECLARE',
'            l_err_msg VARCHAR2(4000);',
'        BEGIN',
'            l_err_msg := SQLERRM;',
'',
'            p_status  := FALSE;',
'            p_message := ''Failure: ''|| l_err_msg;',
'',
'            UPDATE ur_interface_logs',
'               SET load_end_time = systimestamp,',
'                   load_status   = ''FAILED'',',
'                   error_json    = l_error_json || ''{"error":"'' || REPLACE(l_err_msg,''"'','''''''') || ''"}]'',',
'                   updated_on    = sysdate',
'             WHERE id = l_log_id;',
'',
'            ROLLBACK;',
'        END;*/',
'        l_table_name_1 := l_table_name || ''_INTERFACE'';',
'         l_sql := ''CREATE TABLE '' || l_table_name_1 ||',
'             '' AS SELECT * FROM '' || l_table_name || '' WHERE 1=0'';',
'',
'    EXECUTE IMMEDIATE l_sql;',
'',
'         l_sql :=',
'        ''INSERT INTO ''|| l_table_name_1 ||'' (HOTEL_ID,''|| l_cols ||'',INTERFACE_LOG_ID) ''||',
'        ''SELECT :hotel_id,''|| l_vals ||'',:log_id ''||',
'        ''  FROM TABLE(apex_data_parser.parse(p_content => :b1, p_file_name => :b2)) p ''||',
'        '' WHERE p.line_number > 1'';',
'        EXECUTE IMMEDIATE l_sql USING p_hotel_id, l_log_id, l_blob, l_file_name;',
'        commit;',
'     ',
'    -- Build dynamic update set clause',
'    SELECT LISTAGG(''t.''||column_name||'' = s.''||column_name, '', '')',
'             WITHIN GROUP (ORDER BY column_id)',
'      INTO l_update_1',
'      FROM user_tab_columns',
'     WHERE table_name = UPPER(l_table_name)',
'       AND column_name NOT IN (''STAY_DATE'',''HOTEL_ID'');  -- exclude key columns',
'',
'    -- Build merge SQL',
'    l_sql :=',
'        ''MERGE INTO ''||l_table_name||'' t ''||',
'        ''USING ''||l_table_name_1||'' s ''||',
'        ''   ON (t.STAY_DATE = s.STAY_DATE AND t.HOTEL_ID = s.HOTEL_ID) ''||',
'        '' WHEN MATCHED THEN ''||',
'        ''   UPDATE SET ''|| l_update_1;',
'',
'    --dbms_output.put_line(l_sql); -- debug',
'    EXECUTE IMMEDIATE l_sql;',
'    COMMIT;',
'    -- Step 4: clean up interface table',
'        EXECUTE IMMEDIATE ''drop TABLE ''|| l_table_name_1;',
'        commit;',
'',
'         l_success_cnt := SQL%ROWCOUNT; -- rows inserted',
'        l_fail_cnt    := 0;            -- since all go to _INT',
'        l_total_rows  := l_success_cnt;',
'',
'        p_status  := TRUE;',
'        p_message := ''Success: Update completed for File ID ''||p_file_id||',
unistr('                     '' \2192 Total='' || l_total_rows ||'),
'                     '', Success='' || l_success_cnt ||',
'                     '', Failed='' || l_fail_cnt;',
'',
'--END;',
'',
'',
'END Load_Data;',
'',
'',
'PROCEDURE fetch_templates(',
'    p_file_id      IN NUMBER,',
'    p_hotel_id     IN VARCHAR2,',
'    p_min_score    IN NUMBER DEFAULT 90,',
'    p_debug_flag   IN VARCHAR2 DEFAULT ''N'',',
'    p_output_json  OUT CLOB,',
'    p_status       OUT VARCHAR2,',
'    p_message      OUT VARCHAR2',
') IS',
'    -- Local types',
'    TYPE t_name_type_rec IS RECORD(',
'        name       VARCHAR2(100),',
'        data_type  VARCHAR2(30)',
'    );',
'    TYPE t_name_type_tab IS TABLE OF t_name_type_rec;',
'',
'    TYPE t_template_rec IS RECORD(',
'        id         VARCHAR2(50),',
'        name       VARCHAR2(200),',
'        definition t_name_type_tab',
'    );',
'    TYPE t_template_tab IS TABLE OF t_template_rec INDEX BY PLS_INTEGER;',
'',
'    -- Variables',
'    v_source_clob       CLOB;',
'    v_source_normalized CLOB;',
'    ',
'    v_target_id         VARCHAR2(50);',
'    v_target_name       VARCHAR2(200);',
'    v_target_def_clob   CLOB;',
'    v_target_normalized CLOB;',
'',
'    v_source_defs       t_name_type_tab := t_name_type_tab();',
'    v_target_defs       t_name_type_tab := t_name_type_tab();',
'',
'    v_templates         t_template_tab;',
'    v_count_templates   PLS_INTEGER := 0;',
'',
'    v_json_output       CLOB := ''['';',
'    v_min_score_use     NUMBER;',
'    v_separator         VARCHAR2(1) := '''';',
'',
'    v_match_count       NUMBER;',
'    v_score             NUMBER;',
'',
'    CURSOR c_targets IS',
'      SELECT ID, NAME, DEFINITION FROM UR_TEMPLATES WHERE hotel_id = p_hotel_id;',
'',
'    -- Debug procedure',
'    PROCEDURE debug(p_msg VARCHAR2) IS',
'    BEGIN',
'        IF UPPER(p_debug_flag) = ''Y'' THEN',
'            DBMS_OUTPUT.PUT_LINE(''[DEBUG] '' || p_msg);',
'        END IF;',
'    END;',
'',
'    -- Normalize data-type keys in JSON string (case sensitive replacement)',
'    FUNCTION normalize_json(p_json CLOB) RETURN CLOB IS',
'    BEGIN',
'        RETURN REPLACE(REPLACE(p_json, ''"data-type"'', ''"data_type"''), ''"DATA-TYPE"'', ''"data_type"'');',
'    END;',
'',
'    -- Parse definition JSON into PL/SQL collection',
'    FUNCTION parse_definition(p_clob CLOB) RETURN t_name_type_tab IS',
'        l_defs t_name_type_tab := t_name_type_tab();',
'        idx     PLS_INTEGER := 0;',
'    BEGIN',
'        FOR rec IN (',
'            SELECT lower(trim(name)) AS name, lower(trim(data_type)) AS data_type FROM JSON_TABLE(',
'                p_clob,',
'                ''$[*]'' COLUMNS (',
'                    name VARCHAR2(100) PATH ''$.name'',',
'                    data_type VARCHAR2(30) PATH ''$.data_type''',
'                )',
'            )',
'        ) LOOP',
'            idx := idx + 1;',
'            l_defs.EXTEND;',
'            l_defs(idx).name := rec.name;',
'            l_defs(idx).data_type := rec.data_type;',
'        END LOOP;',
'        RETURN l_defs;',
'    EXCEPTION',
'        WHEN OTHERS THEN',
'            RETURN NULL;',
'    END;',
'',
'    -- Count matches (name + data_type case-insensitive)',
'    FUNCTION count_matches(p_source t_name_type_tab, p_target t_name_type_tab) RETURN NUMBER IS',
'        v_count NUMBER := 0;',
'    BEGIN',
'        FOR i IN 1 .. p_source.COUNT LOOP',
'            FOR j IN 1 .. p_target.COUNT LOOP',
'                IF p_source(i).name = p_target(j).name AND p_source(i).data_type = p_target(j).data_type THEN',
'                    v_count := v_count + 1;',
'                    EXIT;',
'                END IF;',
'            END LOOP;',
'        END LOOP;',
'        RETURN v_count;',
'    END;',
'',
'BEGIN',
'    -- Validate inputs and assign to local variable',
'    v_min_score_use := NVL(p_min_score, 90);',
'    IF v_min_score_use < 0 OR v_min_score_use > 100 THEN',
'        v_min_score_use := 90;',
'    END IF;',
'',
'    IF p_file_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''File ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    IF p_hotel_id IS NULL THEN',
'        p_status := ''E'';',
'        p_message := ''Hotel ID must be provided'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'',
'    debug(''Starting processing...'');',
'    debug(''File ID: '' || p_file_id);',
'    debug(''Hotel ID: '' || p_hotel_id);',
'    debug(''Minimum Score: '' || v_min_score_use);',
'',
'    -- Fetch and normalize source CLOB',
'    BEGIN',
'        SELECT columns INTO v_source_clob FROM temp_blob WHERE id = p_file_id;',
'        IF v_source_clob IS NULL THEN',
'            p_status := ''E'';',
'            p_message := ''Source definition not found for file_id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        END IF;',
'    EXCEPTION',
'        WHEN NO_DATA_FOUND THEN',
'            p_status := ''E'';',
'            p_message := ''Source file not found for id '' || p_file_id;',
'            p_output_json := NULL;',
'            RETURN;',
'        WHEN OTHERS THEN',
'            p_status := ''E'';',
'            p_message := ''Error fetching source definition: '' || SQLERRM;',
'            p_output_json := NULL;',
'            RETURN;',
'    END;',
'',
'    v_source_normalized := normalize_json(v_source_clob);',
'',
'    -- Parse source defs',
'    v_source_defs := parse_definition(v_source_normalized);',
'    IF v_source_defs IS NULL OR v_source_defs.COUNT = 0 THEN',
'        p_status := ''E'';',
'        p_message := ''Cannot parse source definition JSON or empty definition'';',
'        p_output_json := NULL;',
'        RETURN;',
'    END IF;',
'    debug(''Parsed Source definitions: '' || v_source_defs.COUNT || '' fields'');',
'',
'    -- Initialize JSON output',
'    v_json_output := ''['';',
'    v_count_templates := 0;',
'',
'    -- Loop over target templates from cursor',
'    FOR r_target IN c_targets LOOP',
'        v_target_id := r_target.ID;',
'        v_target_name := r_target.NAME;',
'        v_target_def_clob := r_target.DEFINITION;',
'',
'        IF v_target_def_clob IS NULL THEN',
'            debug(''Skipping template '' || v_target_id || '' due to NULL definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_target_normalized := normalize_json(v_target_def_clob);',
'',
'        v_target_defs := parse_definition(v_target_normalized);',
'        IF v_target_defs IS NULL OR v_target_defs.COUNT = 0 THEN',
'            debug(''Skipping template '' || v_target_id || '' due to parsing error or empty definition'');',
'            CONTINUE;',
'        END IF;',
'',
'        v_match_count := count_matches(v_source_defs, v_target_defs);',
'',
'        v_score := ROUND((2 * v_match_count) / (v_source_defs.COUNT + v_target_defs.COUNT) * 100);',
'',
'        debug(''Template '' || v_target_id || '' ('' || v_target_name || ''): Matches='' || ',
'              v_match_count || '', Score='' || v_score);',
'',
'        IF v_score >= v_min_score_use THEN',
'            IF v_count_templates > 0 THEN',
'                v_json_output := v_json_output || '','';',
'            END IF;',
'            v_json_output := v_json_output || ''{"Template_id":"'' || v_target_id || ',
'                            ''","Template_Name":"'' || REPLACE(v_target_name,''"'',''\"'') || ',
'                            ''","Score":'' || v_score || ''}'';',
'            v_count_templates := v_count_templates + 1;',
'        END IF;',
'    END LOOP;',
'',
'    v_json_output := v_json_output || '']'';',
'',
'    IF v_count_templates = 0 THEN',
'        p_output_json := ''[{}]'';',
'        p_message := ''No templates matched the minimum score threshold'';',
'        debug(''No matching templates found.'');',
'    ELSE',
'        p_output_json := v_json_output;',
'        p_message := ''Templates matched: '' || v_count_templates;',
'        debug(''Matching templates count: '' || v_count_templates);',
'    END IF;',
'',
'    p_status := ''S'';',
'',
'EXCEPTION',
'    WHEN OTHERS THEN',
'        p_status := ''E'';',
'        p_message := ''Unexpected error: '' || SQLERRM;',
'        p_output_json := NULL;',
'END fetch_templates;',
'',
'PROCEDURE DELETE_TEMPLATES (',
'    p_id            IN VARCHAR2 DEFAULT NULL,',
'    p_hotel_id      IN VARCHAR2 DEFAULT NULL,',
'    p_key           IN VARCHAR2 DEFAULT NULL,',
'    p_name          IN VARCHAR2 DEFAULT NULL,',
'    p_type          IN VARCHAR2 DEFAULT NULL,',
'    p_active        IN CHAR DEFAULT NULL,',
'    p_db_obj_empty  IN CHAR DEFAULT NULL,',
'    p_delete_all    IN CHAR DEFAULT ''N'',',
'    p_debug         IN CHAR DEFAULT ''N'',',
'    p_json_output   OUT CLOB',
'  )',
'  AS',
'    v_sql            VARCHAR2(1000);',
'    v_rows_count     NUMBER;',
'    v_status         CHAR(1);',
'    v_message        VARCHAR2(4000);',
'    v_json_list      CLOB := ''['';',
'    v_first          BOOLEAN := TRUE;',
'',
'    CURSOR c_templates IS',
'      SELECT id, hotel_id, key, name, type, active, db_object_name',
'      FROM ur_templates',
'      WHERE (p_delete_all = ''Y''',
'            OR (p_id IS NULL OR id = p_id))',
'        AND (p_delete_all = ''Y''',
'             OR (p_hotel_id IS NULL OR hotel_id = p_hotel_id))',
'        AND (p_delete_all = ''Y''',
'             OR (p_key IS NULL OR key = p_key))',
'        AND (p_delete_all = ''Y''',
'             OR (p_name IS NULL OR name = p_name))',
'        AND (p_delete_all = ''Y''',
'             OR (p_type IS NULL OR type = p_type))',
'        AND (p_delete_all = ''Y''',
'             OR (p_active IS NULL OR active = p_active));',
'',
'    -- Helper to escape JSON strings (basic)',
'    FUNCTION json_escape(str IN VARCHAR2) RETURN VARCHAR2 IS',
'    BEGIN',
'      RETURN REPLACE(REPLACE(REPLACE(REPLACE(str, ''\'', ''\\''), ''"'', ''\"''), CHR(10), ''\n''), CHR(13), '''');',
'    EXCEPTION WHEN OTHERS THEN',
'      RETURN '''';',
'    END;',
'',
'    PROCEDURE dbg(p_msg VARCHAR2) IS',
'    BEGIN',
'      IF p_debug = ''Y'' THEN',
'        apex_debug.message(p_msg);',
'      END IF;',
'    END;',
'',
'    PROCEDURE append_result (',
'      p_id            IN VARCHAR2,',
'      p_hotel_id      IN VARCHAR2,',
'      p_key           IN VARCHAR2,',
'      p_name          IN VARCHAR2,',
'      p_type          IN VARCHAR2,',
'      p_active        IN CHAR,',
'      p_db_obj_name   IN VARCHAR2,',
'      p_status        IN CHAR,',
'      p_message       IN VARCHAR2',
'    ) IS',
'    BEGIN',
'      IF v_first THEN',
'        v_first := FALSE;',
'      ELSE',
'        v_json_list := v_json_list || '','';',
'      END IF;',
'',
'      v_json_list := v_json_list || ''{'' ||',
'        ''"id":"''          || json_escape(p_id)          || ''",'' ||',
'        ''"hotel_id":"''    || json_escape(p_hotel_id)    || ''",'' ||',
'        ''"key":"''         || json_escape(p_key)         || ''",'' ||',
'        ''"name":"''        || json_escape(p_name)        || ''",'' ||',
'        ''"type":"''        || json_escape(p_type)        || ''",'' ||',
'        ''"active":"''      || json_escape(p_active)      || ''",'' ||',
'        ''"db_object_name":"'' || json_escape(p_db_obj_name) || ''",'' ||',
'        ''"status":"''      || json_escape(p_status)      || ''",'' ||',
'        ''"message":"''     || json_escape(p_message)     || ''"'' ||',
'      ''}'';',
'    END;',
'',
'  BEGIN',
'    dbg(''Started DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'',
'    FOR rec IN c_templates LOOP',
'      dbg(''Processing template ID='' || rec.id || '', DB_OBJECT_NAME='' || rec.db_object_name);',
'',
'      IF rec.db_object_name IS NULL THEN',
'        v_status := ''E'';',
'        v_message := ''No DB_OBJECT_NAME specified for template, skipping.'';',
'        dbg(v_message);',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, NULL, v_status, v_message);',
'        CONTINUE;',
'      END IF;',
'',
'      -- Check if table exists in user schema',
'    --   SELECT COUNT(*)',
'    --     INTO v_rows_count',
'    --     FROM all_tables',
'    --    WHERE table_name = rec.db_object_name',
'    --      AND owner = USER;',
'',
'    --   IF v_rows_count = 0 THEN',
'    --     v_status := ''E'';',
'    --     v_message := ''DB Object ['' || rec.db_object_name || ''] does not exist or is not a table.'';',
'    --     dbg(v_message);',
'    --     append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'    --     CONTINUE;',
'    --   END IF;',
'',
'      -- Check if table should be empty before deleting',
'      IF p_db_obj_empty = ''Y'' THEN',
'        v_sql := ''SELECT COUNT(*) FROM '' || rec.db_object_name;',
'        BEGIN',
'          EXECUTE IMMEDIATE v_sql INTO v_rows_count;',
'        EXCEPTION',
'          WHEN OTHERS THEN',
'            v_rows_count := -1; -- can''t count, treat as error or non-empty',
'        END;',
'',
'        IF v_rows_count > 0 THEN',
'          v_status := ''E'';',
'          v_message := ''DB Object table ['' || rec.db_object_name || ''] is not empty (ROWS='' || v_rows_count || ''), skipping deletion.'';',
'          dbg(v_message);',
'          append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'          CONTINUE;',
'        END IF;',
'        dbg(''DB Object table ['' || rec.db_object_name || ''] is empty, proceeding.'');',
'      END IF;',
'',
'      -- Try to drop the table and delete template',
'      BEGIN',
'        v_sql := ''DROP TABLE '' || rec.db_object_name || '' CASCADE CONSTRAINTS'';',
'        dbg(''Executing: '' || v_sql);',
'        EXECUTE IMMEDIATE v_sql;',
'',
'        dbg(''Dropped table '' || rec.db_object_name);',
'',
'        DELETE FROM ur_templates WHERE id = rec.id;',
'',
'        dbg(''Deleted template id='' || rec.id);',
'',
'        v_status := ''S'';',
'        v_message := ''Successfully dropped table and deleted template.'';',
'        append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'',
'      EXCEPTION',
'        WHEN OTHERS THEN',
'          v_status := ''E'';',
'          v_message := ''Error dropping table or deleting template: '' || SQLERRM;',
'          dbg(v_message);',
'          append_result(rec.id, rec.hotel_id, rec.key, rec.name, rec.type, rec.active, rec.db_object_name, v_status, v_message);',
'      END;',
'    END LOOP;',
'',
'    v_json_list := v_json_list || '']'';',
'',
'    p_json_output := v_json_list;',
'',
'    dbg(''Completed DELETE_TEMPLATES_AND_DB_OBJECTS_JSON procedure.'');',
'  END DELETE_TEMPLATES;',
'',
'PROCEDURE manage_algo_attributes(',
'    p_template_key   IN  VARCHAR2,',
'    p_mode           IN  CHAR,',
'    p_attribute_key  IN  VARCHAR2 DEFAULT NULL,',
'    p_status         OUT BOOLEAN,',
'    p_message        OUT VARCHAR2',
') IS',
'  v_db_object_name UR_TEMPLATES.DB_OBJECT_NAME%TYPE;',
'  v_definition     UR_TEMPLATES.DEFINITION%TYPE;',
'  v_hotel_id       UR_TEMPLATES.HOTEL_ID%TYPE;',
'  v_user_id        RAW(16);',
'  v_insert_count   NUMBER := 0;',
'  v_delete_count   NUMBER := 0;',
'BEGIN',
'  -- Initialization',
'  p_status := FALSE;',
'  p_message := NULL;',
'',
'  -- Obtain needed data from UR_TEMPLATES',
'  BEGIN',
'    SELECT db_object_name, definition, hotel_id',
'    INTO v_db_object_name, v_definition, v_hotel_id',
'    FROM ur_templates',
'    WHERE key = p_template_key;',
'  EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      p_message := ''Failure: Template key not found: '' || p_template_key;',
'      RETURN;',
'  END;',
'',
'  IF v_db_object_name IS NULL THEN',
'    p_message := ''Failure: DB_OBJECT_NAME not defined for template_key '' || p_template_key;',
'    RETURN;',
'  END IF;',
'',
'  -- Get USER_ID once for audit columns',
'  BEGIN',
'    SELECT USER_ID INTO v_user_id',
'    FROM UR_USERS',
'    WHERE USER_NAME = SYS_CONTEXT(''APEX$SESSION'', ''APP_USER'');',
'  EXCEPTION',
'    WHEN NO_DATA_FOUND THEN',
'      v_user_id := NULL;',
'  END;',
'',
'  IF p_mode = ''C'' THEN',
'    IF v_definition IS NULL THEN',
'      p_message := ''Failure: Definition JSON is NULL for template_key '' || p_template_key;',
'      RETURN;',
'    END IF;',
'',
'    -- Insert attributes for all columns with qualifier <> ''UNIQUE''',
'    FOR rec IN (',
'      SELECT jt.name, jt.data_type, jt.qualifier',
'      FROM JSON_TABLE(',
'        v_definition,',
'        ''$[*]'' COLUMNS (',
'          name       VARCHAR2(100) PATH ''$.name'',',
'          data_type  VARCHAR2(30)  PATH ''$.data_type'',',
'          qualifier  VARCHAR2(30)  PATH ''$.qualifier''',
'        )',
'      ) jt',
'      WHERE jt.qualifier IS NOT NULL',
'        AND UPPER(jt.qualifier) <> ''UNIQUE''',
'    )',
'    LOOP',
'      DECLARE',
'        l_col_name VARCHAR2(150);',
'        v_key      VARCHAR2(150);',
'        v_exists   NUMBER;',
'      BEGIN',
'        -- Normalize column name (remove trailing underscores, '))
);
wwv_flow_imp_shared.append_to_install_script(
 p_id=>wwv_flow_imp.id(15324122283564330)
,p_script_clob=>wwv_flow_string.join(wwv_flow_t_varchar2(
'spaces, upper-case)',
'    --  l_col_name := UPPER(TRIM(BOTH ''_'' FROM TRIM(rec.name)));',
'-- Normalize: trim spaces, collapse multiple underscores, and remove trailing underscores',
'l_col_name := UPPER(',
'                REGEXP_REPLACE(',
'                  TRIM(rec.name),      -- trim spaces',
'                  ''_+$'',               -- remove trailing underscores',
'                  ''''',
'                )',
'              );',
'',
'',
'        v_key := v_db_object_name || ''.'' || l_col_name;',
'',
'        SELECT COUNT(*) INTO v_exists FROM ur_algo_attributes WHERE key = v_key;',
'        IF v_exists = 0 THEN',
'          INSERT INTO ur_algo_attributes (',
'            id, algo_id, hotel_id, name, key, data_type, description, type, value,',
'            created_by, updated_by, created_on, updated_on',
'          ) VALUES (',
'            SYS_GUID(),',
'            NULL, -- algo_id set to NULL as requested',
'            v_hotel_id,',
'            l_col_name,',
'            v_key,',
'            NVL(UPPER(rec.data_type), ''NUMBER''),',
'            NULL,',
'            ''S'',',
'            v_key,',
'            v_user_id,',
'            v_user_id,',
'            SYSDATE,',
'            SYSDATE',
'          );',
'',
'          v_insert_count := v_insert_count + 1;',
'        END IF;',
'      END;',
'    END LOOP;',
'',
'    COMMIT;',
'',
'    p_status := TRUE;',
'    p_message := ''Success: '' || v_insert_count || '' attribute''',
'                 || CASE WHEN v_insert_count = 1 THEN '''' ELSE ''s'' END',
'                 || '' inserted for template_key '' || p_template_key;',
'',
'  ELSIF p_mode = ''D'' THEN',
'    IF p_attribute_key IS NOT NULL THEN',
'      IF p_attribute_key LIKE v_db_object_name || ''.%'' THEN',
'        DELETE FROM ur_algo_attributes WHERE key = p_attribute_key;',
'        v_delete_count := SQL%ROWCOUNT;',
'        COMMIT;',
'',
'        p_status := TRUE;',
'        IF v_delete_count > 0 THEN',
'          p_message := ''Success: '' || v_delete_count || '' attribute deleted with key '' || p_attribute_key;',
'        ELSE',
'          p_message := ''Info: No attribute found to delete with key '' || p_attribute_key;',
'        END IF;',
'      ELSE',
'        p_status := FALSE;',
'        p_message := ''Failure: Attribute key does not belong to template '' || p_template_key;',
'      END IF;',
'    ELSE',
'      DELETE FROM ur_algo_attributes WHERE key LIKE v_db_object_name || ''.%'';',
'      v_delete_count := SQL%ROWCOUNT;',
'      COMMIT;',
'',
'      p_status := TRUE;',
'      p_message := ''Success: '' || v_delete_count || '' attribute''',
'                   || CASE WHEN v_delete_count = 1 THEN '''' ELSE ''s'' END',
'                   || '' deleted for template_key '' || p_template_key;',
'    END IF;',
'',
'  ELSIF p_mode = ''U'' THEN',
'    p_status := FALSE;',
'    p_message := ''Update mode not yet implemented'';',
'',
'  ELSE',
'    p_status := FALSE;',
'    p_message := ''Invalid mode: '' || p_mode || ''. Valid modes are C, U, D.'';',
'  END IF;',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    p_status := FALSE;',
'    p_message := ''Failure: '' || SQLERRM;',
'END manage_algo_attributes;',
'',
'',
'procedure add_alert(',
'    p_existing_json in clob,',
'    p_message in varchar2,',
'    p_icon in varchar2 default null,',
'    p_title in varchar2 default null,',
'    p_timeout in number default null,',
'    p_updated_json out clob',
') is',
'    l_json_array json_array_t;',
'    l_new_object json_object_t;',
'begin',
'    -- Create the new JSON object',
'    l_new_object := new json_object_t();',
'    l_new_object.put(''message'', p_message);',
'    l_new_object.put(''icon'', nvl(p_icon, ''success''));',
'    l_new_object.put(''title'', nvl(p_title, ''''));',
'',
'    if p_timeout is not null then',
'        l_new_object.put(''timeOut'', to_char(p_timeout));',
'    end if;',
'',
'    -- Append the new object to the existing array or create a new array',
'    if p_existing_json is null or trim(p_existing_json) = '''' then',
'        -- Create a new array with the new object',
'        l_json_array := new json_array_t();',
'    else',
'        -- Parse the existing JSON string into a JSON array',
'        l_json_array := json_array_t(p_existing_json);',
'    end if;',
'',
'    -- Append the new object',
'    l_json_array.append(l_new_object);',
'',
'    -- Convert the JSON array back to a CLOB',
'    p_updated_json := l_json_array.to_clob;',
'end add_alert;',
'',
'PROCEDURE validate_expression (',
'    p_expression IN VARCHAR2,',
'    p_mode IN CHAR,',
'    p_hotel_id IN VARCHAR2,',
'    p_status OUT VARCHAR2, -- ''S'' or ''E''',
'    p_message OUT VARCHAR2',
') IS',
'  TYPE t_str_list IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_attributes t_str_list;',
'  v_functions t_str_list;',
'  v_operators t_str_list;',
'  v_attr_count NUMBER := 0;',
'  v_func_count NUMBER := 0;',
'  v_oper_count NUMBER := 0;',
'',
'  TYPE t_token_rec IS RECORD (',
'    token VARCHAR2(4000),',
'    start_pos PLS_INTEGER,',
'    end_pos PLS_INTEGER',
'  );',
'  TYPE t_token_tab IS TABLE OF t_token_rec INDEX BY PLS_INTEGER;',
'  v_tokens t_token_tab;',
'  v_token_count PLS_INTEGER := 0;',
'',
'  TYPE t_token_tab_nt IS TABLE OF VARCHAR2(100) INDEX BY PLS_INTEGER;',
'  v_unmatched_tokens t_token_tab;',
'  v_unmatched_count PLS_INTEGER := 0;',
'',
'  -- To mark tokens consumed by multi-word operators',
'  TYPE t_bool_tab IS TABLE OF BOOLEAN INDEX BY PLS_INTEGER;',
'  v_token_consumed t_bool_tab;',
'',
'  v_mode CHAR := UPPER(p_mode);',
'',
'  -- Trim and uppercase token helper',
'  FUNCTION normalize_token(p_token VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN UPPER(TRIM(p_token));',
'  END;',
'',
'  -- Strip function parameters, e.g. "ROUND (n,d)" -> "ROUND"',
'  FUNCTION normalize_func_name(p_func VARCHAR2) RETURN VARCHAR2 IS',
'  BEGIN',
'    RETURN REGEXP_REPLACE(UPPER(TRIM(p_func)), ''\s*\(.*\)$'');',
'  END;',
'',
'  -- Checks if token is numeric',
'  FUNCTION is_number(p_token VARCHAR2) RETURN BOOLEAN IS',
'  BEGIN',
'    RETURN REGEXP_LIKE(p_token, ''^[+-]?(\d+(\.\d*)?|\.\d+)([Ee][+-]?\d+)?$'');',
'  END;',
'',
'  -- Check presence in list',
'  FUNCTION is_in_list(p_token VARCHAR2, p_list t_str_list, cnt NUMBER) RETURN BOOLEAN IS',
'  BEGIN',
'    FOR i IN 1..cnt LOOP',
'      IF p_list(i) = p_token THEN',
'        RETURN TRUE;',
'      END IF;',
'    END LOOP;',
'    RETURN FALSE;',
'  END;',
'',
'  -- Check if token valid: attribute, operator, function, number, parentheses',
'  FUNCTION is_token_valid(p_token VARCHAR2) RETURN BOOLEAN IS',
'    l_token VARCHAR2(100) := p_token;',
'  BEGIN',
'    -- Parentheses always valid tokens',
'    IF l_token IN (''('', '')'') THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    -- Strip trailing ''('' from function calls',
'    IF SUBSTR(l_token, -1) = ''('' THEN',
'      l_token := SUBSTR(l_token, 1, LENGTH(l_token) - 1);',
'    END IF;',
'',
'    -- Check if number',
'    IF is_number(l_token) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    l_token := normalize_token(l_token);',
'',
'    IF is_in_list(l_token, v_attributes, v_attr_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_functions, v_func_count) THEN',
'      RETURN TRUE;',
'    ELSIF is_in_list(l_token, v_operators, v_oper_count) THEN',
'      RETURN TRUE;',
'    END IF;',
'',
'    RETURN FALSE;',
'  END;',
'',
'  PROCEDURE load_functions(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION FUNCTIONS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := normalize_func_name(r.return_value);',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20010, ''Functions LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_operators(p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT return_value FROM apex_application_lov_entries',
'      WHERE list_of_values_name = ''UR EXPRESSION OPERATORS''',
'      ORDER BY return_value',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.return_value));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20011, ''Operators LOV missing or empty'');',
'    END IF;',
'  END;',
'',
'  PROCEDURE load_attributes(p_hotel_id IN VARCHAR2, p_list OUT t_str_list, p_count OUT NUMBER) IS',
'  BEGIN',
'    p_list.DELETE;',
'    p_count := 0;',
'    FOR r IN (',
'      SELECT key FROM ur_algo_attributes WHERE hotel_id = p_hotel_id',
'    ) LOOP',
'      p_count := p_count + 1;',
'      p_list(p_count) := UPPER(TRIM(r.key));',
'    END LOOP;',
'    IF p_count = 0 THEN',
'      RAISE_APPLICATION_ERROR(-20012, ''Attributes missing for hotel_id '' || p_hotel_id);',
'    END IF;',
'  END;',
'',
'  -- Tokenizer splitting expression into tokens, tracking start/end pos',
'  PROCEDURE tokenize_expression(p_expr IN VARCHAR2, p_tokens OUT t_token_tab, p_count OUT NUMBER) IS',
'    l_pos PLS_INTEGER := 1;',
'    l_len PLS_INTEGER := LENGTH(p_expr);',
'    l_token VARCHAR2(4000);',
'    l_token_start PLS_INTEGER;',
'    l_token_end PLS_INTEGER;',
'  BEGIN',
'    p_tokens.DELETE;',
'    p_count := 0;',
'    WHILE l_pos <= l_len LOOP',
'      l_token := REGEXP_SUBSTR(p_expr,',
'        ''([A-Za-z0-9_\.]+|\d+(\.\d+)?|\(|\)|\S)'',',
'        l_pos,',
'        1,',
'        ''i'');',
'      EXIT WHEN l_token IS NULL;',
'      l_token_start := INSTR(p_expr, l_token, l_pos);',
'      l_token_end := l_token_start + LENGTH(l_token) - 1;',
'      p_count := p_count + 1;',
'      p_tokens(p_count) := t_token_rec(token => l_token, start_pos => l_token_start, end_pos => l_token_end);',
'      l_pos := l_token_end + 1;',
'      WHILE l_pos <= l_len AND SUBSTR(p_expr, l_pos, 1) = '' '' LOOP',
'        l_pos := l_pos + 1;',
'      END LOOP;',
'    END LOOP;',
'  END;',
'',
'  FUNCTION build_json_errors(p_unmatched t_token_tab, p_count PLS_INTEGER) RETURN VARCHAR2 IS',
'    v_json VARCHAR2(4000) := ''['';',
'  BEGIN',
'    IF p_count = 0 THEN',
'      RETURN ''[]'';',
'    END IF;',
'    FOR i IN 1..p_count LOOP',
'      v_json := v_json || ''{"token":"'' || p_unmatched(i).token ||',
'                ''","start":'' || p_unmatched(i).start_pos ||',
'                '',"end":'' || p_unmatched(i).end_pos || ''}'';',
'      IF i < p_count THEN',
'        v_json := v_json || '','';',
'      END IF;',
'    END LOOP;',
'    v_json := v_json || '']'';',
'    RETURN v_json;',
'  END;',
'',
'  -- Return number of consecutive tokens matched as an operator starting at start_idx',
'  FUNCTION get_longest_operator_match(start_idx IN PLS_INTEGER) RETURN PLS_INTEGER IS',
'    combined VARCHAR2(4000);',
'    max_words CONSTANT PLS_INTEGER := 4; -- max operator words count',
'    words_count PLS_INTEGER;',
'    l_len PLS_INTEGER := LEAST(max_words, v_token_count - start_idx + 1);',
'    i PLS_INTEGER;',
'  BEGIN',
'    FOR words_count IN REVERSE 1 .. l_len LOOP',
'      combined := '''';',
'      FOR i IN start_idx .. start_idx + words_count - 1 LOOP',
'        IF combined IS NULL OR combined = '''' THEN',
'          combined := UPPER(TRIM(v_tokens(i).token));',
'        ELSE',
'          combined := combined || '' '' || UPPER(TRIM(v_tokens(i).token));',
'        END IF;',
'      END LOOP;',
'      IF is_in_list(combined, v_operators, v_oper_count) THEN',
'        RETURN words_count;',
'      END IF;',
'    END LOOP;',
'    RETURN 0;',
'  END;',
'',
'BEGIN',
'  p_status := ''E'';',
'  p_message := NULL;',
'',
'  IF v_mode NOT IN (''V'', ''C'') THEN',
'    p_status := ''E'';',
'    p_message := ''Invalid mode "'' || p_mode || ''". Valid are V or C.'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_hotel_id IS NULL THEN',
'    p_status := ''E'';',
'    p_message := ''hotel_id is mandatory'';',
'    RETURN;',
'  END IF;',
'',
'  IF p_expression IS NULL OR LENGTH(TRIM(p_expression)) = 0 THEN',
'    p_status := ''E'';',
'    p_message := ''Expression is empty'';',
'    RETURN;',
'  END IF;',
'',
'  load_functions(v_functions, v_func_count);',
'  load_operators(v_operators, v_oper_count);',
'  load_attributes(p_hotel_id, v_attributes, v_attr_count);',
'',
'  tokenize_expression(p_expression, v_tokens, v_token_count);',
'',
'  -- Initialize consumed array',
'  v_token_consumed.DELETE;',
'',
'  DECLARE',
'    i PLS_INTEGER := 1;',
'    words_matched PLS_INTEGER := 0;',
'  BEGIN',
'    WHILE i <= v_token_count LOOP',
'      words_matched := get_longest_operator_match(i);',
'      IF words_matched > 0 THEN',
'        FOR j IN i .. i + words_matched - 1 LOOP',
'          v_token_consumed(j) := TRUE;',
'        END LOOP;',
'        i := i + words_matched;',
'      ELSE',
'        -- Single token valid check',
'        v_token_consumed(i) := is_token_valid(normalize_token(v_tokens(i).token));',
'        i := i + 1;',
'      END IF;',
'    END LOOP;',
'  END;',
'',
'  IF v_mode = ''V'' THEN',
'    v_unmatched_tokens.DELETE;',
'    v_unmatched_count := 0;',
'    FOR i IN 1 .. v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = FALSE THEN',
'        v_unmatched_count := v_unmatched_count + 1;',
'        v_unmatched_tokens(v_unmatched_count) := v_tokens(i);',
'      END IF;',
'    END LOOP;',
'',
'    IF v_unmatched_count > 0 THEN',
'      p_status := ''E'';',
'      p_message := ''Invalid tokens: '' || build_json_errors(v_unmatched_tokens, v_unmatched_count);',
'    ELSE',
'      p_status := ''S'';',
'      p_message := ''Expression validated successfully.'';',
'    END IF;',
'',
'  ELSIF v_mode = ''C'' THEN',
'    p_status := ''S'';',
'    p_message := '''';',
'    FOR i IN 1..v_token_count LOOP',
'      IF v_token_consumed.EXISTS(i) AND v_token_consumed(i) = TRUE THEN',
'        p_message := p_message || v_tokens(i).token || '' '';',
'      END IF;',
'    END LOOP;',
'    p_message := RTRIM(p_message);',
'  END IF;',
'',
'EXCEPTION',
'  WHEN OTHERS THEN',
'    p_status := ''E'';',
'    p_message := ''Failure: '' || SQLERRM;',
'END validate_expression;',
'',
'',
'END UR_UTILS_TEST_1;',
'/',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
''))
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15324220046564345)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'GET_PROFILE_JSON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15324341221564346)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'GUESS_DELIMITER'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15324568853564347)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'FUNCTION'
,p_object_name=>'SANITIZE_COLUMN_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15324743801564348)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_ADDRESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15324960389564348)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_TEMP_BLOB'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15325188625564349)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGOS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15325358337564350)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGO_ATTRIBUTES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15325525307564351)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_ALGO_VERSIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15325782976564351)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_CONTACTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15325930624564352)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_EVENTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15326131233564353)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTELS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15326389221564354)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_ACCESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15326503185564355)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_GROUPS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15326784159564355)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_RESERVATIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15326965964564356)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_HOTEL_ROOM_TYPES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15327132196564357)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_INTERFACE_LOGS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15327302933564358)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_PROFILE_OPTIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15327586988564358)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15327738826564359)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15327941704564360)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_TEMPLATES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15328141679564361)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'PK_UR_USERS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15328373064564361)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UK_UR_ALGO_ATTRIBUTES_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15328584524564362)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UK_UR_ALGO_VERSIONS_ALGO_VERSION'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15328785650564363)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_HOTEL_GROUPS_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15328933836564364)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_HOTEL_RES_NUMBER'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15329112744564365)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_PROFILE_OPTIONS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15329326584564365)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORTS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15329569400564366)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_HOTEL_ID'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15329756798564367)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15329954788564368)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_REPORT_DASHBOARDS_NAME'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15330101741564368)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_TEMPLATES_KEY'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15330351277564369)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UQ_UR_USERS_EMAIL'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15330559865564370)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_ADAM_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15330768659564371)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_ALGOS_CON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15330967674564371)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_BHAUMIK_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15331120013564372)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_BHAUMIK_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15331340949564373)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_22SEPT1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15331543773564374)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_22SEPT_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15331724695564374)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_22SEPT_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15331991618564375)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_28_SEP_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15332131421564376)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_28_SEP_T_STAY_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15332393863564377)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_STAY_DATE_TEMPLATE_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15332551769564378)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_STAY_DATE_TEMPLATE_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15332724768564378)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_TEST_111_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15332906049564379)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_TEST_112_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15333157893564380)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_CHINAR_TEST_112_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15333365531564381)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN11_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15333599489564382)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15333700440564382)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_2_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15333979549564383)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_2_T_RNS__OTB__UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15334140939564384)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_3_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15334356627564385)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_3_T_RNS__OTB__UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15334514878564385)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_4_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15334735289564386)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15334973518564387)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXPENSE_TEMPLATE_02_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15335185902564388)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_2122122_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15335369388564388)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_212212_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15335528011564389)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_21221_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15335771149564390)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_21_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15335915855564391)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_3_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15336133306564391)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_EXP_REPORT_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15336335994564392)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_INDIGO_L_SQUARE_I_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15336569846564393)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_INDIGO_L_SQUARE_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15336740833564394)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_T_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15336954889564395)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15337110872564395)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_YORK_2_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15337329621564396)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_YORK_2_T_SDATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15337557871564397)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_YORK_T_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15337753946564398)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS1_YORK_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15337968117564398)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS3_YORK_T_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15338129593564399)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_LOS3_YORK_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15338387551564400)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST1_22_CHINAR_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15338588715564401)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_1_T_BOOKING_ID_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15338788131564401)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15338903476564402)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_29_SEP_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15339134138564403)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_29_SEP_T_STAY_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15339308286564404)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_2_T_BOOKING_ID_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15339595836564404)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_2_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15339734498564405)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_NEWEST_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15339937794564406)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_NEW_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15340199654564407)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15340387807564407)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_CHINAR_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15340570786564408)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_STACY_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15340778039564409)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TEST_TEMPLATE_T_PK'
);
end;
/
begin
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15340963013564410)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_TT_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15341182186564411)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_UR_CHINAR_QUAL_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15341362050564411)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_UR_CHINAR_QUAL_T_STAY_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15341595449564412)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15341737412564413)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_1_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15341975144564414)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_2_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15342155521564414)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_2_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15342371529564415)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_3_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15342557579564416)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_4_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15342764756564417)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_4_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15342923627564417)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15343102256564418)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_250915_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15343385241564419)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_ATT_QUAL1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15343524325564420)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_ATT_QUAL1_T_RNS__OTB__UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15343771626564421)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_LEAVE_SETUP_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15343954045564421)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_NEW_CHINAR_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15344121617564422)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_NEW_CHINAR_T_STAY_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15344325453564423)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SAMPLE_HOTEL_DATA_T_BOOKING_ID_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15344595734564424)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SAMPLE_HOTEL_DATA_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15344754219564424)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SEG1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15344907338564425)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15345187800564426)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER2_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15345372981564427)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15345599045564428)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_VK_TMS_TASK_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15345721883564428)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_YORK_LOS1_T_DATE_UQ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15345965640564429)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'INDEX'
,p_object_name=>'UR_YORK_LOS1_T_PK'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15346145061564430)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'GRAPH_SQL'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15346382854564431)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'PKG_GENERIC_CRUD'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15346539087564431)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'UR_UTILS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15346768363564432)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'UR_UTILS_TEST'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15346908111564433)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PACKAGE'
,p_object_name=>'UR_UTILS_TEST_1'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15347159772564434)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'CALL_AI_CHAT_COMPLETION'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15347354992564434)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'CALL_OPENAI_CHAT_COMPLETION'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15347556493564435)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'DELETE_TEMPLATES_AND_DB_OBJECTS_JSON'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15347772274564436)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'GENERIC_CRUD_PROC'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15347953110564437)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'LOAD_DATA_STANDALONE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15348115889564437)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'LOAD_DATA_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15348291926564438)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'MATCH_TEMPLATES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15348475427564439)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'PRC_INSERT_HOTEL_GROUP'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15348698126564440)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'P_GENERIC_CRUD'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15348845428564440)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'UR_UPLOAD_FILE_PROC'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15349095967564441)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'PROCEDURE'
,p_object_name=>'VALIDATE_OR_CLEAN_EXPRESSION'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15349215276564442)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'SEQUENCE'
,p_object_name=>'ISEQ$$_113689'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15349489588564443)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'SEQUENCE'
,p_object_name=>'ISEQ$$_113692'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15349655883564443)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'SEQUENCE'
,p_object_name=>'ISEQ$$_113696'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15349810585564444)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'SEQUENCE'
,p_object_name=>'ISEQ$$_131819'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15350023838564445)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'DEBUG_LOG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15350201310564446)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'EXPENSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15350425539564446)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'HTMLDB_PLAN_TABLE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15350660783564447)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_BLOB'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15350823022564448)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15351037223564449)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'TEMP_UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15351292327564449)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ADAM_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15351433611564450)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ADDRESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15351642572564451)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGOS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15351872783564452)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGO_ATTRIBUTES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15352064833564452)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_ALGO_VERSIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15352251608564453)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_BHAUMIK_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15352436573564454)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_22SEPT1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15352685850564455)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_22SEPT_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15352864275564456)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_28_SEP_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15353050118564456)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_STAY_DATE_TEMPLATE_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15353285299564457)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_TEST_111_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15353431672564458)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CHINAR_TEST_112_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15353650098564459)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_CONTACTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15353872731564459)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN11_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15354082517564460)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15354250228564461)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_2_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15354467240564462)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_3_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15354654775564462)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_4_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15354844741564463)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15355075846564464)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EVENTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15355238733564465)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXPENSE_TEMPLATE_02_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15355443100564465)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_2122122_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15355635700564466)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_212212_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15355872809564467)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_21221_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15356008237564468)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_21_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15356254147564469)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_3_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15356410781564469)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_EXP_REPORT_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15356634917564470)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTELS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15356862951564471)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_ACCESSES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15357050197564472)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_GROUPS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15357270715564472)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_RESERVATIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15357417015564473)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_HOTEL_ROOM_TYPES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15357674094564474)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_INDIGO_L_SQUARE_I_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15357886303564475)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_INDIGO_L_SQUARE_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15358029027564475)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_INTERFACE_LOGS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15358294977564476)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15358445738564477)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS1_YORK_2_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15358666414564478)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS1_YORK_2_T_INTERFACE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15358848186564478)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS1_YORK_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15359043853564479)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS1_YORK_T_INTERFACE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15359264832564480)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_LOS3_YORK_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15359434320564481)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_PROFILE_OPTIONS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15359690858564482)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_REPORTS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15359811878564482)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_REPORT_DASHBOARDS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15360059676564483)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEMPLATES'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15360238059564484)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST1_22_CHINAR_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15360414061564485)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15360682567564485)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_29_SEP_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15360825523564486)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_29_SEP_T_INTERFACE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15361005118564487)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_2_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15361291592564488)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_NEWEST_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15361442915564488)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_NEW_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15361616276564489)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15361843585564490)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_CHINAR_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15362092273564491)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_STACY_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15362209411564491)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TEST_TEMPLATE_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15362491461564492)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_TT_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15362659163564493)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_UR_CHINAR_QUAL_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15362811452564494)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_UR_CHINAR_QUAL_T_INTERFACE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15363049095564494)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_USERS'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15363280748564495)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_250915_1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15363445330564496)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_250915_2_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15363600507564497)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_250915_3_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15363858245564498)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_250915_4_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15364013827564498)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_250915_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15364278496564499)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_ATT_QUAL1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15364462122564500)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_LEAVE_SETUP_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15364632466564501)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_NEW_CHINAR_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15364819866564501)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_NEW_CHINAR_T_INTERFACE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15365078399564502)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_SAMPLE_HOTEL_DATA_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15365298849564503)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_SEG1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15365489241564504)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15365602141564505)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER2_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15365843188564505)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15366022573564506)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_VK_TMS_TASK_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15366259273564507)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TABLE'
,p_object_name=>'UR_YORK_LOS1_T'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15366416680564508)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ADDRESSES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15366678201564508)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGOS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15366889867564509)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGO_ATTRIBUTES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15367084733564510)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_ALGO_VERSIONS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15367207137564511)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_CONTACTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15367402361564511)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_EVENTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15367672564564512)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTELS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15367817521564513)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_GROUPS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15368047245564514)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_RESERVATIONS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15368277293564514)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_HOTEL_ROOM_TYPES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15368422695564515)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_INTERFACE_LOGS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15368684958564516)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_REPORTS_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15368846942564517)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_REPORT_DASHBOARDS_BI'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15369085564564517)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'TRG_UR_TEMPLATES_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15369291556564518)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_ADAM_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15369416335564519)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_BHAUMIK_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15369675671564520)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_22SEPT1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15369833920564521)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_22SEPT_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15370085065564521)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_28_SEP_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15370279258564522)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_STAY_DATE_TEMPLATE_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15370469375564523)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_TEST_111_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15370671802564524)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_CHINAR_TEST_112_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15370872068564525)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN11_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15371083395564525)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15371288086564526)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_2_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15371482863564527)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_3_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15371692112564528)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_4_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15371849842564528)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_DAILY_BREAKDOWN_VK_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15372098001564529)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXPENSE_TEMPLATE_02_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15372282846564530)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_2122122_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15372473525564531)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_212212_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15372612731564531)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_21221_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15372888263564532)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_21_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15373063754564533)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_3_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15373244780564534)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_EXP_REPORT_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15373413538564534)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_INDIGO_L_SQUARE_I_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15373662549564535)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_INDIGO_L_SQUARE_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15373819477564536)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_LOS1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15374056599564537)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_LOS1_YORK_2_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15374245302564538)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_LOS1_YORK_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15374468013564538)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_LOS3_YORK_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15374653004564539)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST1_22_CHINAR_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15374815901564540)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15375085510564541)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_29_SEP_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15375268418564541)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_2_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15375487887564542)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_NEWEST_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15375657580564543)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_NEW_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15375804080564544)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_NO_USC_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15376007317564544)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_CHINAR_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15376299829564545)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_STACY_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15376496403564546)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TEST_TEMPLATE_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15376675097564547)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_TT_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15376833126564547)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_UR_CHINAR_QUAL_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15377093754564548)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_250915_1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15377228627564549)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_250915_2_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15377426897564550)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_250915_3_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15377653042564551)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_250915_4_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15377838983564551)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_250915_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15378058008564552)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_ATT_QUAL1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15378254351564553)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_LEAVE_SETUP_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15378473496564554)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_NEW_CHINAR_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15378637523564554)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_SAMPLE_HOTEL_DATA_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15378837550564555)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_SEG1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15379038250564556)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15379287214564557)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER2_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15379423910564557)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_SEGMENT_QUALIFIER_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15379614856564558)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_VK_TMS_TASK_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15379893439564559)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TRIGGER'
,p_object_name=>'UR_YORK_LOS1_T_BI_TRG'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15380072753564560)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'LOG_REC_OBJ'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15380204023564560)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'TYPE'
,p_object_name=>'LOG_TAB_TYPE'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15380485231564561)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGOHOTELS_R2_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15380614153564562)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGOHOTELS_R6_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15380898115564563)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGOHOTELS_REPORT1_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15381032403564563)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGOHOTELS_REPORT24_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15381214218564564)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGOHOTELS_REPORTTEMP_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15381459218564565)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_INDIGO_HOTELS_R2_V'
);
wwv_flow_imp_shared.create_install_object(
 p_id=>wwv_flow_imp.id(15381672406564566)
,p_script_id=>wwv_flow_imp.id(15324122283564330)
,p_object_owner=>'#OWNER#'
,p_object_type=>'VIEW'
,p_object_name=>'TEMP_MARRIOTCENTRALLONDON_R1_V'
);
wwv_flow_imp.component_end;
end;
/
